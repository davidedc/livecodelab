<!DOCTYPE html>  <html> <head>   <title>autocode.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="autocode.html">                 autocode.js               </a>                                           <a class="source" href="background-painting.html">                 background-painting.js               </a>                                           <a class="source" href="big-cursor-animation.html">                 big-cursor-animation.js               </a>                                           <a class="source" href="code-transformations.html">                 code-transformations.js               </a>                                           <a class="source" href="demos-and-tutorials.html">                 demos-and-tutorials.js               </a>                                           <a class="source" href="coffeescript-livecodelab-mode.html">                 coffeescript-livecodelab-mode.js               </a>                                           <a class="source" href="editor.html">                 editor.js               </a>                                           <a class="source" href="mousewheel.html">                 mousewheel.js               </a>                                           <a class="source" href="from-processing.html">                 from-processing.js               </a>                                           <a class="source" href="geometry-commands.html">                 geometry-commands.js               </a>                                           <a class="source" href="init-threejs.html">                 init-threejs.js               </a>                                           <a class="source" href="init.html">                 init.js               </a>                                           <a class="source" href="lights-functions.html">                 lights-functions.js               </a>                                           <a class="source" href="livecodelab.html">                 livecodelab.js               </a>                                           <a class="source" href="math.html">                 math.js               </a>                                           <a class="source" href="matrix-commands.html">                 matrix-commands.js               </a>                                           <a class="source" href="menu.html">                 menu.js               </a>                                           <a class="source" href="sound-functions.html">                 sound-functions.js               </a>                                           <a class="source" href="text-dimming.html">                 text-dimming.js               </a>                                           <a class="source" href="var-definitions.html">                 var-definitions.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               autocode.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>We starts with some declarations and two functions that take
care of the UI parts (showing the correct state of the button and making it blink).
The remaining part then takes care of the mutations.</p>             </td>             <td class="code">               <div class="highlight"><pre>
<span class="keyword">var</span> autocodeOn = <span class="literal">false</span>;
<span class="keyword">var</span> blinkingAutocoderTimeout;
<span class="keyword">var</span> blinkingAutocoderStatus = <span class="literal">false</span>;
<span class="keyword">var</span> numberOfResults = <span class="number">0</span>;
<span class="keyword">var</span> whichOneToChange = <span class="number">0</span>;

<span class="function"><span class="keyword">function</span> <span class="title">blinkAutocodeIndicator</span><span class="params">()</span> {</span>
  blinkingAutocoderStatus = !blinkingAutocoderStatus;
  <span class="keyword">if</span> (blinkingAutocoderStatus) {
    $(<span class="string">"#autocodeIndicatorContainer"</span>).css(<span class="string">"background-color"</span>, <span class="string">''</span>);
  } <span class="keyword">else</span> {
    $(<span class="string">"#autocodeIndicatorContainer"</span>).css(<span class="string">"background-color"</span>, <span class="string">'#FF0000'</span>);
    mutate();
  }
}

<span class="function"><span class="keyword">function</span> <span class="title">toggleAutocodeAndUpdateButtonAndBlinking</span><span class="params">()</span> {</span>
  autocodeOn = !autocodeOn;

  <span class="keyword">if</span> (!autocodeOn) {
    $(<span class="string">"#autocodeIndicator"</span>).html(<span class="string">"Autocode: off"</span>);
    clearInterval(blinkingAutocoderTimeout);
    $(<span class="string">"#autocodeIndicatorContainer"</span>).css(<span class="string">"background-color"</span>, <span class="string">''</span>);
  } <span class="keyword">else</span> {
    $(<span class="string">"#autocodeIndicator"</span>).html(<span class="string">"Autocode: on"</span>);
    blinkingAutocoderTimeout = setInterval(<span class="string">'blinkAutocodeIndicator();'</span>, <span class="number">500</span>);
    $(<span class="string">"#autocodeIndicatorContainer"</span>).css(<span class="string">"background-color"</span>, <span class="string">'#FF0000'</span>);
    <span class="keyword">if</span> (editor.getValue() === <span class="string">''</span> || (
    (window.location.hash.indexOf(<span class="string">"bookmark"</span>) !== -<span class="number">1</span>) &amp;&amp; (window.location.hash.indexOf(<span class="string">"autocodeTutorial"</span>) !== -<span class="number">1</span>))

    ) loadDemoOrTutorial(<span class="string">'cubesAndSpikes'</span>);
  }
}

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Every time a mutation is invoked, the following happens</p>

<ul>
<li><p>the program is scanned by a lexer
the lexer could maintain/change/act on an user-defined state based on what it
encounters but for the time being that is not used. So for the time being in practice the lexer
parses the tokens based on regular expressions without using states.
The definitions of what constitutes a token is defined by regexes in the "rules" section</p></li>
<li><p>for each token, a function is added to the Token array. For example "rotate 20" creates two
tokens, which are two functions TRANSLATE and NUM</p></li>
<li><p>each of the "token" functions contains a) a string representation from the text in the program
e.g. in the example above "rotate" and "20" and b) an accessory function for printout of the token and
c) optionally, a function mutate() that changes the string of the field of a) with a mutated string</p></li>
<li><p>the token list is scanned. Each function is checked for whether it contains a "mutate"
function. If yes, then it's added as a candidate to an "mutatableTokens" array.</p></li>
<li><p>a random option is picked and mutate is ran for that token</p></li>
<li><p>the token list is traversed and the strings are appended one to another, creating the new
mutated program.</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>
<span class="function"><span class="keyword">function</span> <span class="title">mutate</span><span class="params">()</span> {</span>
	<span class="keyword">var</span> editorContent = editor.getValue();
	<span class="keyword">var</span> newContent;

	Tokens = [];
	<span class="keyword">try</span> {
	INIT.lex(editorContent)
	} <span class="keyword">catch</span>(e) {console.log(e);} 

	pickMutatableTokenAndMutateIt(Tokens);
	newContent = emit(Tokens);

	editor.setValue(newContent);
}


</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Lexing states. There are no particular states so far.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="keyword">var</span> INIT = <span class="keyword">new</span> McLexer.State() ;


</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>We keep an array of colours as they can be mutated too!
TODO this is duplicated somewhere else in livecodelab.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="keyword">var</span> colours = Array( <span class="string">"aliceblue"</span>,<span class="string">"antiquewhite"</span>,<span class="string">"aqua"</span>,<span class="string">"aquamarine"</span>,<span class="string">"azure"</span>,<span class="string">"beige"</span>,<span class="string">"bisque"</span>,<span class="string">"black"</span>,<span class="string">"blanchedalmond"</span>,<span class="string">"blue"</span>,<span class="string">"blueviolet"</span>,<span class="string">"brown"</span>,<span class="string">"burlywood"</span>,<span class="string">"cadetblue"</span>,<span class="string">"chartreuse"</span>,<span class="string">"chocolate"</span>,<span class="string">"coral"</span>,<span class="string">"cornflowerblue"</span>,<span class="string">"cornsilk"</span>,<span class="string">"crimson"</span>,<span class="string">"cyan"</span>,<span class="string">"darkblue"</span>,<span class="string">"darkcyan"</span>,<span class="string">"darkgoldenrod"</span>,<span class="string">"darkgray"</span>,<span class="string">"darkgrey"</span>,<span class="string">"darkgreen"</span>,<span class="string">"darkkhaki"</span>,<span class="string">"darkmagenta"</span>,<span class="string">"darkolivegreen"</span>,<span class="string">"darkorange"</span>,<span class="string">"darkorchid"</span>,<span class="string">"darkred"</span>,<span class="string">"darksalmon"</span>,<span class="string">"darkseagreen"</span>,<span class="string">"darkslateblue"</span>,<span class="string">"darkslategray"</span>,<span class="string">"darkslategrey"</span>,<span class="string">"darkturquoise"</span>,<span class="string">"darkviolet"</span>,<span class="string">"deeppink"</span>,<span class="string">"deepskyblue"</span>,<span class="string">"dimgray"</span>,<span class="string">"dimgrey"</span>,<span class="string">"dodgerblue"</span>,<span class="string">"firebrick"</span>,<span class="string">"floralwhite"</span>,<span class="string">"forestgreen"</span>,<span class="string">"fuchsia"</span>,<span class="string">"gainsboro"</span>,<span class="string">"ghostwhite"</span>,<span class="string">"gold"</span>,<span class="string">"goldenrod"</span>,<span class="string">"gray"</span>,<span class="string">"grey"</span>,<span class="string">"green"</span>,<span class="string">"greenyellow"</span>,<span class="string">"honeydew"</span>,<span class="string">"hotpink"</span>,<span class="string">"indianred"</span>,<span class="string">"indigo"</span>,<span class="string">"ivory"</span>,<span class="string">"khaki"</span>,<span class="string">"lavender"</span>,<span class="string">"lavenderblush"</span>,<span class="string">"lawngreen"</span>,<span class="string">"lemonchiffon"</span>,<span class="string">"lightblue"</span>,<span class="string">"lightcoral"</span>,<span class="string">"lightcyan"</span>,<span class="string">"lightgoldenrodyellow"</span>,<span class="string">"lightgrey"</span>,<span class="string">"lightgray"</span>,<span class="string">"lightgreen"</span>,<span class="string">"lightpink"</span>,<span class="string">"lightsalmon"</span>,<span class="string">"lightseagreen"</span>,<span class="string">"lightskyblue"</span>,<span class="string">"lightslategray"</span>,<span class="string">"lightslategrey"</span>,<span class="string">"lightsteelblue"</span>,<span class="string">"lightyellow"</span>,<span class="string">"lime"</span>,<span class="string">"limegreen"</span>,<span class="string">"linen"</span>,<span class="string">"magenta"</span>,<span class="string">"maroon"</span>,<span class="string">"mediumaquamarine"</span>,<span class="string">"mediumblue"</span>,<span class="string">"mediumorchid"</span>,<span class="string">"mediumpurple"</span>,<span class="string">"mediumseagreen"</span>,<span class="string">"mediumslateblue"</span>,<span class="string">"mediumspringgreen"</span>,<span class="string">"mediumturquoise"</span>,<span class="string">"mediumvioletred"</span>,<span class="string">"midnightblue"</span>,<span class="string">"mintcream"</span>,<span class="string">"mistyrose"</span>,<span class="string">"moccasin"</span>,<span class="string">"navajowhite"</span>,<span class="string">"navy"</span>,<span class="string">"oldlace"</span>,<span class="string">"olive"</span>,<span class="string">"olivedrab"</span>,<span class="string">"orange"</span>,<span class="string">"orangered"</span>,<span class="string">"orchid"</span>,<span class="string">"palegoldenrod"</span>,<span class="string">"palegreen"</span>,<span class="string">"paleturquoise"</span>,<span class="string">"palevioletred"</span>,<span class="string">"papayawhip"</span>,<span class="string">"peachpuff"</span>,<span class="string">"peru"</span>,<span class="string">"pink"</span>,<span class="string">"plum"</span>,<span class="string">"powderblue"</span>,<span class="string">"purple"</span>,<span class="string">"red"</span>,<span class="string">"rosybrown"</span>,<span class="string">"royalblue"</span>,<span class="string">"saddlebrown"</span>,<span class="string">"salmon"</span>,<span class="string">"sandybrown"</span>,<span class="string">"seagreen"</span>,<span class="string">"seashell"</span>,<span class="string">"sienna"</span>,<span class="string">"silver"</span>,<span class="string">"skyblue"</span>,<span class="string">"slateblue"</span>,<span class="string">"slategray"</span>,<span class="string">"slategrey"</span>,<span class="string">"snow"</span>,<span class="string">"springgreen"</span>,<span class="string">"steelblue"</span>,<span class="string">"tan"</span>,<span class="string">"teal"</span>,<span class="string">"thistle"</span>,<span class="string">"tomato"</span>,<span class="string">"turquoise"</span>,<span class="string">"violet"</span>,<span class="string">"wheat"</span>,<span class="string">"white"</span>,<span class="string">"whitesmoke"</span>,<span class="string">"yellow"</span>,<span class="string">"yellowgreen"</span> );

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>The Tokens array will contain all of the tokens in the form of functions.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="keyword">var</span> Tokens = [] ;

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Token types. If they contain a mutate() function, then they can be mutated.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="function"><span class="keyword">function</span> <span class="title">COMMENT</span><span class="params">(string)</span> {</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"COMMENT("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">SPACE</span><span class="params">(string)</span> {</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"SPACE("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">NEWLINE</span><span class="params">(string)</span> {</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"&lt;br/&gt;"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">TRANSLATION</span><span class="params">(string)</span> {</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"TRANSLATION("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">VARIABLE</span><span class="params">(string)</span> {</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"VARIABLE("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">NUM</span><span class="params">(string)</span> {</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"NUM("</span> + string + <span class="string">")"</span> ; } ;

  <span class="keyword">this</span>.mutate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  	<span class="keyword">var</span> num = <span class="keyword">new</span> Number(<span class="keyword">this</span>.string);
	<span class="keyword">var</span> scalar;

	<span class="keyword">if</span> ( <span class="number">0</span> == num )
		num = <span class="number">0.1</span>;

	<span class="keyword">if</span> ( Math.random() &gt; <span class="number">0.5</span> )
	{
		scalar = <span class="number">0</span> - Math.random();
	} <span class="keyword">else</span> {
		scalar = Math.random();
	}
	<span class="keyword">var</span> offset = num * Math.random();

	num += offset;
	num = num.toFixed(<span class="number">2</span>);

	console.log(<span class="string">"mutate number "</span>+ <span class="keyword">this</span>.string +<span class="string">" -&gt; "</span>+num.toString());
	<span class="keyword">this</span>.string = num.toString();
  }
}

<span class="function"><span class="keyword">function</span> <span class="title">OP</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"OP("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">ARGDLIM</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"ARGDLIM("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">TAB</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"TAB("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">DOONCE</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"DOONCE("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">COLOUROP</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"COLOUROP("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">COLOUR</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"COLOUR("</span> + string + <span class="string">")"</span> ; } ;

  <span class="keyword">this</span>.mutate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
	<span class="keyword">var</span> idx = Math.floor(Math.random() * colours.length);

	<span class="keyword">while</span> ( <span class="keyword">this</span>.string == colours[idx] )
		idx = Math.floor(Math.random() * colours.length);

	console.log(<span class="string">"mutate colour "</span> + <span class="keyword">this</span>.string + <span class="string">" -&gt; "</span> + colours[idx]);
	<span class="keyword">this</span>.string = colours[idx];
  }
}

<span class="function"><span class="keyword">function</span> <span class="title">MESH</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"MESH("</span> + string + <span class="string">")"</span> ; } ;

  <span class="keyword">this</span>.mutate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  	<span class="keyword">switch</span>(<span class="keyword">this</span>.string)
	{
		<span class="keyword">case</span> <span class="string">'box'</span>:
			<span class="keyword">this</span>.string = <span class="string">'ball'</span>
			<span class="keyword">return</span>;
		<span class="keyword">case</span> <span class="string">'ball'</span>:
			<span class="keyword">this</span>.string = <span class="string">'box'</span>
			<span class="keyword">return</span>;
		<span class="keyword">case</span> <span class="string">'line'</span>:
			<span class="keyword">this</span>.string = <span class="string">'rect'</span>
			<span class="keyword">return</span>;
		<span class="keyword">case</span> <span class="string">'rect'</span>:
			<span class="keyword">this</span>.string = <span class="string">'line'</span>
			<span class="keyword">return</span>;
	}
  }
}

<span class="function"><span class="keyword">function</span> <span class="title">STATEFUN</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"STATEFUN("</span> + string + <span class="string">")"</span> ; } ;
}

<span class="function"><span class="keyword">function</span> <span class="title">ITERATION</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"ITERATION("</span> + string + <span class="string">")"</span> ; } ;

  <span class="keyword">this</span>.mutate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  	<span class="keyword">var</span> pat = <span class="regexp">/\d/</span>;
	<span class="keyword">var</span> num = pat.exec(<span class="keyword">this</span>.string);

	console.log(<span class="string">"ITER NUM: "</span>+num);
	<span class="keyword">if</span> ( Math.random() &gt; <span class="number">0.5</span> )
	{
		num++;
	} <span class="keyword">else</span> {
		num--;
	}

	<span class="keyword">this</span>.string = num.toString()+<span class="string">" times -&gt;"</span>
  }
}


<span class="function"><span class="keyword">function</span> <span class="title">UNKNOWN</span><span class="params">(string)</span>{</span>
  <span class="keyword">this</span>.string = string ;
  <span class="keyword">this</span>.toString = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">"UNKNOWN("</span> + string + <span class="string">")"</span> ; } ;
}


</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Rules are used to</p>

<ul>
<li><p>define how tokens are picked up from text (i.e. which regex)</p></li>
<li><p>how the lexer behaves depending on different states. This is currently not used.</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>
INIT (<span class="regexp">/\/\/.*\n/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> COMMENT(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/\t/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> TAB(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/-?[0-9]+\.?[0-9]*/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> NUM(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/[*|\/|+|-]/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> OP(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/,/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> ARGDLIM(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/[\n|\r]{1,2}/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> NEWLINE(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>translations</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/rotate/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> TRANSLATION(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/move/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> TRANSLATION(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/scale/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> TRANSLATION(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>colour</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="keyword">for</span>( <span class="keyword">var</span> scanningAllColors=<span class="number">0</span>; scanningAllColors &lt; colours.length;scanningAllColors++)
{
	INIT (<span class="keyword">new</span> RegExp( colours[scanningAllColors] )) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span> Tokens.push(<span class="keyword">new</span> COLOUR(match[<span class="number">0</span>])); <span class="keyword">return</span> state.continuation(rest) ; }) ;
}

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>colour ops</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/background/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> COLOUROP(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/fill/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> COLOUROP(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/stroke/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> COLOUROP(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>hmm  TODO</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/simpleGradient/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> COLOUROP(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>mesh</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/box/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> MESH(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/ball/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> MESH(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/rect/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> MESH(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/line/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> MESH(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>state changes?</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/ballDetail/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> STATEFUN(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

INIT (<span class="regexp">/animationStyle\s\w+/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> STATEFUN(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>iteration</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/\d+\s+times\s+-&gt;/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> ITERATION(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>vars</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/time/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> VARIABLE(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/delay/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> VARIABLE(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>special</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/\?doOnce\s+-&gt;\s*/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> DOONCE(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;


</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>ignore white space ?</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/ +/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> SPACE(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;



</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>The bad stuff</p>             </td>             <td class="code">               <div class="highlight"><pre>INIT (<span class="regexp">/color\s*\(.+\)/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> UNKNOWN(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/noFill/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> UNKNOWN(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;
INIT (<span class="regexp">/strokeSize/</span>) (<span class="function"><span class="keyword">function</span> <span class="params">(match,rest,state)</span> {</span>
    Tokens.push(<span class="keyword">new</span> UNKNOWN(match[<span class="number">0</span>])); 
    <span class="keyword">return</span> state.continuation(rest) ;
 }) ;


</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Traverses the Tokens array and concatenates the strings, hence generating a possibly mutated program.</p>             </td>             <td class="code">               <div class="highlight"><pre>
<span class="function"><span class="keyword">function</span> <span class="title">emit</span><span class="params">( stream )</span>
{</span>
	<span class="keyword">var</span> ret = <span class="string">""</span>;

	<span class="keyword">for</span>( <span class="keyword">var</span> scanningTheStream=<span class="number">0</span>; scanningTheStream&lt;stream.length; scanningTheStream++ )
	{
		ret = ret + stream[scanningTheStream].string
	}

	<span class="keyword">return</span> ret;
}

</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Checks whether a token can mutate by checking whether the mutate function exists.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="function"><span class="keyword">function</span> <span class="title">canMutate</span><span class="params">( token )</span>
{</span>
	<span class="keyword">if</span> ( <span class="keyword">typeof</span> token.mutate == <span class="string">'function'</span> )
		<span class="keyword">return</span> <span class="literal">true</span>;
	<span class="keyword">return</span> <span class="literal">false</span>;
}

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Scans the tokens and collects the mutatable ones. Then picks one random and invokes its mutate().</p>             </td>             <td class="code">               <div class="highlight"><pre>
<span class="function"><span class="keyword">function</span> <span class="title">pickMutatableTokenAndMutateIt</span><span class="params">( stream )</span>
{</span>
	<span class="keyword">var</span> mutatableTokens = Array();

	<span class="keyword">for</span>( <span class="keyword">var</span> scanningTheStream=<span class="number">0</span>; scanningTheStream&lt;stream.length; scanningTheStream++ )
	{
		<span class="keyword">if</span> ( canMutate( stream[scanningTheStream] ) )
		{
			mutatableTokens.push(scanningTheStream);
		}
	}

	<span class="keyword">if</span> ( <span class="number">0</span> == mutatableTokens.length )
	{
		console.log(<span class="string">'no possible mutations'</span>);
		<span class="keyword">return</span>;
	}

	console.log(mutatableTokens);

	<span class="keyword">var</span> idx = Math.floor(Math.random() * mutatableTokens.length);

	stream[ mutatableTokens[idx] ].mutate();
}


</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Currently unused.</p>             </td>             <td class="code">               <div class="highlight"><pre>
<span class="function"><span class="keyword">function</span> <span class="title">replaceTimeWithAConstant</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> editorContent = editor.getValue();
  <span class="keyword">var</span> rePattern;
  rePattern = <span class="regexp">/(time)/gi</span>;

  <span class="keyword">var</span> allMatches = editorContent.match(rePattern);
  <span class="keyword">if</span> (allMatches === <span class="literal">null</span>) numberOfResults = <span class="number">0</span>;
  <span class="keyword">else</span> numberOfResults = allMatches.length;
  whichOneToChange = Math.floor(Math.random() * numberOfResults) + <span class="number">1</span>;

  <span class="keyword">var</span> countWhichOneToSwap = <span class="number">0</span>;
  editorContent = editorContent.replace(rePattern, <span class="keyword">function</span>(match, text, urlId) {
    countWhichOneToSwap++;
    <span class="keyword">if</span> (countWhichOneToSwap === whichOneToChange) {
      <span class="keyword">return</span> <span class="string">''</span> + Math.floor(Math.random() * <span class="number">20</span>) + <span class="number">1</span>;
    }
    <span class="keyword">return</span> match;
  });
  editor.setValue(editorContent);
}

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 