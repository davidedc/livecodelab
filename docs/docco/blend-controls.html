<!DOCTYPE html>  <html> <head>   <title>blend-controls.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="animation-loop.html">                 animation-loop.coffee               </a>                                           <a class="source" href="autocoder.html">                 autocoder.coffee               </a>                                           <a class="source" href="lexer.html">                 lexer.coffee               </a>                                           <a class="source" href="background-painter.html">                 background-painter.coffee               </a>                                           <a class="source" href="big-cursor.html">                 big-cursor.coffee               </a>                                           <a class="source" href="blend-controls.html">                 blend-controls.coffee               </a>                                           <a class="source" href="code-transformer.html">                 code-transformer.coffee               </a>                                           <a class="source" href="colour-functions.html">                 colour-functions.coffee               </a>                                           <a class="source" href="colour-literals.html">                 colour-literals.coffee               </a>                                           <a class="source" href="editor.html">                 editor.coffee               </a>                                           <a class="source" href="event-router.html">                 event-router.coffee               </a>                                           <a class="source" href="globals.html">                 globals.coffee               </a>                                           <a class="source" href="graphics-commands.html">                 graphics-commands.coffee               </a>                                           <a class="source" href="init.html">                 init.coffee               </a>                                           <a class="source" href="lights-commands.html">                 lights-commands.coffee               </a>                                           <a class="source" href="livecodelab-core.html">                 livecodelab-core.coffee               </a>                                           <a class="source" href="math.html">                 math.coffee               </a>                                           <a class="source" href="matrix-commands.html">                 matrix-commands.coffee               </a>                                           <a class="source" href="parser.html">                 parser.coffee               </a>                                           <a class="source" href="program-loader.html">                 program-loader.coffee               </a>                                           <a class="source" href="program-runner.html">                 program-runner.coffee               </a>                                           <a class="source" href="renderer.html">                 renderer.coffee               </a>                                           <a class="source" href="samplebank.html">                 samplebank.coffee               </a>                                           <a class="source" href="sound-system.html">                 sound-system.coffee               </a>                                           <a class="source" href="text-dimming.html">                 text-dimming.coffee               </a>                                           <a class="source" href="threejs-system.html">                 threejs-system.coffee               </a>                                           <a class="source" href="time-keeper.html">                 time-keeper.coffee               </a>                                           <a class="source" href="ui.html">                 ui.coffee               </a>                                           <a class="source" href="url-router.html">                 url-router.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               blend-controls.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>BlendControls manages the three different blending styles.
One can decide for either 'normal' (e.g. next frame completely
replaces the previous one) or 'paintOver' (new frame is painted
over the previous one, meaning that the previous frame shows through
the transparent bits of the new frame) or 'motionBlur'
(previous frame is shown faintly below the current one so to give
a vague effect of motion blur).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BlendControls</span>
  
  <span class="nv">previousanimationStyleValue: </span><span class="mi">0</span>
  <span class="nv">animationStyleValue: </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Just an object to hold the animation style variables</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">animationStyles: </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Used for setting how much blending there is between frames</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">blendAmount: </span><span class="mi">0</span>
  
  <span class="nv">constructor: </span><span class="nf">(@liveCodeLabCoreInstance) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>These all need to be made global so they can be used by sketches</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nv">normal = </span><span class="vi">@animationStyles.normal = </span><span class="mi">0</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">paintOver = </span><span class="vi">@animationStyles.paintOver = </span><span class="mi">1</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">motionBlur = </span><span class="vi">@animationStyles.motionBlur = </span><span class="mi">2</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">animationStyle = </span><span class="nf">(a) =&gt;</span> <span class="nx">@animationStyle</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>

  <span class="nv">animationStyle: </span><span class="nf">(a) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>turns out when you type normal that the first two letters "no"
are sent as "false"</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span>  <span class="k">if</span> <span class="nx">a</span> <span class="o">is</span> <span class="kc">false</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">a</span><span class="o">?</span>
    <span class="vi">@animationStyleValue = </span><span class="nx">a</span>

  <span class="nv">animationStyleUpdateIfChanged: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Animation Style hasn't changed so we don't need to do anything</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span>  <span class="k">if</span> <span class="nx">@animationStyleValue</span> <span class="o">is</span> <span class="nx">@previousanimationStyleValue</span>
    <span class="vi">@previousanimationStyleValue = </span><span class="nx">@animationStyleValue</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>defining a couple of shorthands to avoid super-long lines</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">isWebGLUsed = </span><span class="nx">@liveCodeLabCoreInstance</span><span class="p">.</span><span class="nx">threeJsSystem</span><span class="p">.</span><span class="nx">isWebGLUsed</span>
    <span class="vi">@animationStyles = </span><span class="nx">@animationStyles</span>

    <span class="k">if</span> <span class="nx">isWebGLUsed</span> <span class="o">and</span> <span class="nx">@animationStyleValue</span> <span class="o">is</span> <span class="nx">@animationStyles</span><span class="p">.</span><span class="nx">motionBlur</span>
      <span class="vi">@liveCodeLabCoreInstance.threeJsSystem.effectBlend.uniforms.mixRatio.value = </span><span class="mf">0.7</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">isWebGLUsed</span> <span class="o">and</span> <span class="nx">@animationStyleValue</span> <span class="o">is</span> <span class="nx">@animationStyles</span><span class="p">.</span><span class="nx">motionBlur</span>
      <span class="vi">@blendAmount = </span><span class="mf">0.6</span>

    <span class="k">if</span> <span class="nx">isWebGLUsed</span> <span class="o">and</span> <span class="nx">@animationStyleValue</span> <span class="o">is</span> <span class="nx">@animationStyles</span><span class="p">.</span><span class="nx">paintOver</span>
      <span class="vi">@liveCodeLabCoreInstance.threeJsSystem.effectBlend.uniforms.mixRatio.value = </span><span class="mi">1</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">isWebGLUsed</span> <span class="o">and</span> <span class="nx">@animationStyleValue</span> <span class="o">is</span> <span class="nx">@animationStyles</span><span class="p">.</span><span class="nx">paintOver</span>
      <span class="vi">@blendAmount = </span><span class="mi">1</span>

    <span class="k">if</span> <span class="nx">isWebGLUsed</span> <span class="o">and</span> <span class="nx">@animationStyleValue</span> <span class="o">is</span> <span class="nx">@animationStyles</span><span class="p">.</span><span class="nx">normal</span>
      <span class="vi">@liveCodeLabCoreInstance.threeJsSystem.effectBlend.uniforms.mixRatio.value = </span><span class="mi">0</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">isWebGLUsed</span> <span class="o">and</span> <span class="nx">@animationStyleValue</span> <span class="o">is</span> <span class="nx">@animationStyles</span><span class="p">.</span><span class="nx">normal</span>
      <span class="vi">@blendAmount = </span><span class="mi">0</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 