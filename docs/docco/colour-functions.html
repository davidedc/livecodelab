<!DOCTYPE html>  <html> <head>   <title>colour-functions.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="animation-loop.html">                 animation-loop.coffee               </a>                                           <a class="source" href="autocoder.html">                 autocoder.coffee               </a>                                           <a class="source" href="lexer.html">                 lexer.coffee               </a>                                           <a class="source" href="background-painter.html">                 background-painter.coffee               </a>                                           <a class="source" href="big-cursor.html">                 big-cursor.coffee               </a>                                           <a class="source" href="blend-controls.html">                 blend-controls.coffee               </a>                                           <a class="source" href="code-transformer.html">                 code-transformer.coffee               </a>                                           <a class="source" href="colour-functions.html">                 colour-functions.coffee               </a>                                           <a class="source" href="colour-literals.html">                 colour-literals.coffee               </a>                                           <a class="source" href="editor.html">                 editor.coffee               </a>                                           <a class="source" href="event-router.html">                 event-router.coffee               </a>                                           <a class="source" href="globals.html">                 globals.coffee               </a>                                           <a class="source" href="graphics-commands.html">                 graphics-commands.coffee               </a>                                           <a class="source" href="init.html">                 init.coffee               </a>                                           <a class="source" href="lights-commands.html">                 lights-commands.coffee               </a>                                           <a class="source" href="livecodelab-core.html">                 livecodelab-core.coffee               </a>                                           <a class="source" href="math.html">                 math.coffee               </a>                                           <a class="source" href="matrix-commands.html">                 matrix-commands.coffee               </a>                                           <a class="source" href="parser.html">                 parser.coffee               </a>                                           <a class="source" href="program-loader.html">                 program-loader.coffee               </a>                                           <a class="source" href="program-runner.html">                 program-runner.coffee               </a>                                           <a class="source" href="renderer.html">                 renderer.coffee               </a>                                           <a class="source" href="samplebank.html">                 samplebank.coffee               </a>                                           <a class="source" href="sound-system.html">                 sound-system.coffee               </a>                                           <a class="source" href="text-dimming.html">                 text-dimming.coffee               </a>                                           <a class="source" href="threejs-system.html">                 threejs-system.coffee               </a>                                           <a class="source" href="time-keeper.html">                 time-keeper.coffee               </a>                                           <a class="source" href="ui.html">                 ui.coffee               </a>                                           <a class="source" href="url-router.html">                 url-router.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               colour-functions.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>jslint browser: true, bitwise: true </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>global max, min </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Code adapted from processing.js</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Closure compiler automatically replaces symbolic Constants.* names with their
values (it does it for everything it thinks it's a constant really).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ColourFunctions</span>
  <span class="s">&quot;use strict&quot;</span>

  <span class="nv">constructor: </span><span class="nf">-&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">color = </span><span class="nf">(a,b,c,d) =&gt;</span> <span class="nx">@color</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">colorToHSB = </span><span class="nf">(a) =&gt;</span> <span class="nx">@colorToHSB</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">brightness = </span><span class="nf">(a) =&gt;</span> <span class="nx">@brightness</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">saturation = </span><span class="nf">(a) =&gt;</span> <span class="nx">@saturation</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">hue = </span><span class="nf">(a) =&gt;</span> <span class="nx">@hue</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">redF = </span><span class="nf">(a) =&gt;</span> <span class="nx">@redF</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">greenF = </span><span class="nf">(a) =&gt;</span> <span class="nx">@greenF</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">blueF = </span><span class="nf">(a) =&gt;</span> <span class="nx">@blueF</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">alpha = </span><span class="nf">(a) =&gt;</span> <span class="nx">@alpha</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">alphaZeroToOne = </span><span class="nf">(a) =&gt;</span> <span class="nx">@alphaZeroToOne</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">lerp = </span><span class="nf">(a,b,c) =&gt;</span> <span class="nx">@lerp</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">lerpColor = </span><span class="nf">(a,b,c) =&gt;</span> <span class="nx">@lerpColor</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">colorMode = </span><span class="nf">(a,b,c,d,e) =&gt;</span> <span class="nx">@colorMode</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">blendColor = </span><span class="nf">(a,b,c) =&gt;</span> <span class="nx">@blendColor</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)</span>

    <span class="vi">@colorModeX = </span><span class="mi">255</span>
    <span class="vi">@colorModeY = </span><span class="mi">255</span>
    <span class="vi">@colorModeZ = </span><span class="mi">255</span>
    <span class="vi">@colorModeA = </span><span class="mi">255</span>
    <span class="vi">@Constants = </span>     </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Color modes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">RGB: </span><span class="mi">1</span>
      <span class="nv">ARGB: </span><span class="mi">2</span>
      <span class="nv">HSB: </span><span class="mi">3</span>
      <span class="nv">ALPHA: </span><span class="mi">4</span>
      <span class="nv">CMYK: </span><span class="mi">5</span>
      </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Blend modes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">REPLACE: </span><span class="mi">0</span>
      <span class="nv">BLEND: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span>
      <span class="nv">ADD: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
      <span class="nv">SUBTRACT: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
      <span class="nv">LIGHTEST: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span>
      <span class="nv">DARKEST: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span>
      <span class="nv">DIFFERENCE: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>
      <span class="nv">EXCLUSION: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span>
      <span class="nv">MULTIPLY: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span>
      <span class="nv">SCREEN: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
      <span class="nv">OVERLAY: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span>
      <span class="nv">HARD_LIGHT: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span>
      <span class="nv">SOFT_LIGHT: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span>
      <span class="nv">DODGE: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
      <span class="nv">BURN: </span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span>
      </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Color component bit masks</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">ALPHA_MASK: </span><span class="mh">0xff000000</span>
      <span class="nv">RED_MASK: </span><span class="mh">0x00ff0000</span>
      <span class="nv">GREEN_MASK: </span><span class="mh">0x0000ff00</span>
      <span class="nv">BLUE_MASK: </span><span class="mh">0x000000ff</span>
    
    <span class="nb">window</span><span class="p">.</span><span class="nv">HSB = </span><span class="nx">@Constants</span><span class="p">.</span><span class="nx">HSB</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">RGB = </span><span class="nx">@Constants</span><span class="p">.</span><span class="nx">RGB</span>

    <span class="vi">@curColorMode = </span><span class="nx">@Constants</span><span class="p">.</span><span class="nx">RGB</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Ease of use function to extract the colour bits into a string</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color.toString = </span><span class="nf">(colorInt) =&gt;</span>
      <span class="s">&quot;rgba(&quot;</span> <span class="o">+</span> <span class="p">((</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="p">((</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="p">((</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Easy of use function to pack rgba values into a single bit-shifted color int.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color.toInt = </span><span class="nf">(r, g, b, a) =&gt;</span>
      <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="nx">b</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span>
  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Creates a simple array in [R, G, B, A] format, [255, 255, 255, 255]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color.toArray = </span><span class="nf">(colorInt) =&gt;</span>
      <span class="p">[(</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">,</span> <span class="p">(</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span><span class="p">,</span> <span class="p">(</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Creates a WebGL color array in [R, G, B, A] format. WebGL wants the color ranges between 0 and 1, [1, 1, 1, 1]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color.toGLArray= </span><span class="nf">(colorInt) =&gt;</span>
      <span class="p">[((</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="p">((</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="p">((</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>HSB conversion function from Mootools, MIT Licensed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color.toRGB = </span><span class="nf">(h, s, b) =&gt;</span>
      <span class="nv">br = </span><span class="kc">undefined</span>
      <span class="nv">hue = </span><span class="kc">undefined</span>
      <span class="nv">f = </span><span class="kc">undefined</span>
      <span class="nv">p = </span><span class="kc">undefined</span>
      <span class="nv">q = </span><span class="kc">undefined</span>
      <span class="nv">t = </span><span class="kc">undefined</span>
      </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Limit values greater than range</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">h = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">h</span> <span class="o">&gt;</span> <span class="nx">@colorModeX</span><span class="p">)</span> <span class="k">then</span> <span class="nx">@colorModeX</span> <span class="k">else</span> <span class="nx">h</span><span class="p">)</span>
      <span class="nv">s = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">&gt;</span> <span class="nx">@colorModeY</span><span class="p">)</span> <span class="k">then</span> <span class="nx">@colorModeY</span> <span class="k">else</span> <span class="nx">s</span><span class="p">)</span>
      <span class="nv">b = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="nx">@colorModeZ</span><span class="p">)</span> <span class="k">then</span> <span class="nx">@colorModeZ</span> <span class="k">else</span> <span class="nx">b</span><span class="p">)</span>
      <span class="nv">h = </span><span class="p">(</span><span class="nx">h</span> <span class="o">/</span> <span class="nx">@colorModeX</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span>
      <span class="nv">s = </span><span class="p">(</span><span class="nx">s</span> <span class="o">/</span> <span class="nx">@colorModeY</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
      <span class="nv">b = </span><span class="p">(</span><span class="nx">b</span> <span class="o">/</span> <span class="nx">@colorModeZ</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
      <span class="nv">br = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">b</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Grayscale</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="p">[</span><span class="nx">br</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">br</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">s</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nv">hue = </span><span class="nx">h</span> <span class="o">%</span> <span class="mi">360</span>
      <span class="nv">f = </span><span class="nx">hue</span> <span class="o">%</span> <span class="mi">60</span>
      <span class="nv">p = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="nx">s</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10000</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
      <span class="nv">q = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6000</span> <span class="o">-</span> <span class="nx">s</span> <span class="o">*</span> <span class="nx">f</span><span class="p">))</span> <span class="o">/</span> <span class="mi">600000</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
      <span class="nv">t = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6000</span> <span class="o">-</span> <span class="nx">s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">60</span> <span class="o">-</span> <span class="nx">f</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">600000</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
      <span class="k">switch</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">hue</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">when</span> <span class="mi">0</span>
          <span class="p">[</span><span class="nx">br</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">p</span><span class="p">]</span>
        <span class="k">when</span> <span class="mi">1</span>
          <span class="p">[</span><span class="nx">q</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">p</span><span class="p">]</span>
        <span class="k">when</span> <span class="mi">2</span>
          <span class="p">[</span><span class="nx">p</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">t</span><span class="p">]</span>
        <span class="k">when</span> <span class="mi">3</span>
          <span class="p">[</span><span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">br</span><span class="p">]</span>
        <span class="k">when</span> <span class="mi">4</span>
          <span class="p">[</span><span class="nx">t</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">br</span><span class="p">]</span>
        <span class="k">when</span> <span class="mi">5</span>
          <span class="p">[</span><span class="nx">br</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">q</span><span class="p">]</span>
    <span class="vi">@modes = </span><span class="nx">@modesFunction</span><span class="p">()</span>

  <span class="nv">color$4: </span><span class="nf">(aValue1, aValue2, aValue3, aValue4) -&gt;</span>
    <span class="nv">r = </span><span class="kc">undefined</span>
    <span class="nv">g = </span><span class="kc">undefined</span>
    <span class="nv">b = </span><span class="kc">undefined</span>
    <span class="nv">a = </span><span class="kc">undefined</span>
    <span class="nv">rgb = </span><span class="kc">undefined</span>
    <span class="k">if</span> <span class="nx">@curColorMode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">HSB</span>
      <span class="nv">rgb = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toRGB</span><span class="p">(</span><span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue2</span><span class="p">,</span> <span class="nx">aValue3</span><span class="p">)</span>
      <span class="nv">r = </span><span class="nx">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">g = </span><span class="nx">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="nv">b = </span><span class="nx">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="nv">r = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="nx">aValue1</span> <span class="o">/</span> <span class="nx">@colorModeX</span><span class="p">))</span>
      <span class="nv">g = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="nx">aValue2</span> <span class="o">/</span> <span class="nx">@colorModeY</span><span class="p">))</span>
      <span class="nv">b = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="nx">aValue3</span> <span class="o">/</span> <span class="nx">@colorModeZ</span><span class="p">))</span>
    <span class="nv">a = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="nx">aValue4</span> <span class="o">/</span> <span class="nx">@colorModeA</span><span class="p">))</span>
    </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Limit values less than 0 and greater than 255</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">r = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">r</span><span class="p">)</span>
    <span class="nv">g = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">g</span><span class="p">)</span>
    <span class="nv">b = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">b</span><span class="p">)</span>
    <span class="nv">a = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">a</span><span class="p">)</span>
    <span class="nv">r = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">r</span><span class="p">)</span>
    <span class="nv">g = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">g</span><span class="p">)</span>
    <span class="nv">b = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">b</span><span class="p">)</span>
    <span class="nv">a = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">a</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Create color int</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="nx">b</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span>

  <span class="nv">color$2: </span><span class="nf">(aValue1, aValue2) -&gt;</span>
    <span class="nv">a = </span><span class="kc">undefined</span>
    </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>lowest than any 32 bit color is a special
color that paints based on normals.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">angleColor = </span><span class="o">-</span><span class="mi">16777217</span>
    <span class="k">return</span> <span class="nx">angleColor</span>  <span class="k">if</span> <span class="nx">aValue1</span> <span class="o">is</span> <span class="nx">angleColor</span>
    </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Color int and alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">aValue1</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span>
      <span class="nv">a = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="nx">aValue2</span> <span class="o">/</span> <span class="nx">@colorModeA</span><span class="p">))</span>
      </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Limit values less than 0 and greater than 255</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">a = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">a</span><span class="p">)</span>
      <span class="nv">a = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">a</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">aValue1</span> <span class="o">-</span> <span class="p">(</span><span class="nx">aValue1</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">a</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Grayscale and alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@color$4</span><span class="p">(</span><span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue2</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">@curColorMode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RGB</span>
    <span class="nx">@color$4</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nx">aValue1</span> <span class="o">/</span> <span class="nx">@colorModeX</span><span class="p">)</span> <span class="o">*</span> <span class="nx">@colorModeZ</span><span class="p">,</span> <span class="nx">aValue2</span>  <span class="k">if</span> <span class="nx">@curColorMode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">HSB</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>so, color in both processing and processing.js is slightly weird, because
color is just a Java integer, which is a little bit of a headache to
fold into a Javascript number, which is a float and it's 64 bits.
For example, the color black is 0xFF000000, which
in unsigned integer (or 64 bits float) would be 4278190080.
OK, instead color(0) in Java return -16777216, because Java integers are signed in
two's complement and they go from -2147483648 to 2147483647 included</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">color$1: </span><span class="nf">(aValue1) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>so that special colors still work with "color", e.g.
fill(color(angleColor))</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">aValue1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span>
      <span class="k">return</span> <span class="nx">aValue1</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Grayscale</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">aValue1</span> <span class="o">&lt;=</span> <span class="nx">@colorModeX</span> <span class="o">and</span> <span class="nx">aValue1</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">@color$4</span><span class="p">(</span><span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue1</span><span class="p">,</span> <span class="nx">@colorModeA</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">@curColorMode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RGB</span>
      <span class="k">return</span> <span class="nx">@color$4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nx">aValue1</span> <span class="o">/</span> <span class="nx">@colorModeX</span><span class="p">)</span> <span class="o">*</span> <span class="nx">@colorModeZ</span><span class="p">,</span> <span class="nx">@colorModeA</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">@curColorMode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">HSB</span>
    </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Color int</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">aValue1</span>      </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Java Overflow
in two's complement, 2147483647 is 0xFFFFFFFF i.e. the very max of
java integer's 32 bits, so if you add one you go back to the java int minimum
so in java the following program gives -2147483648
   int a = 2147483647 + 1; // equivalent to int a = color(2147483647 + 1)
   println("a " + a); 
so we are emulating this here with this subtraction.
note that this stops being correct at 2147483647<em>3 + 3, i.e.
  int a = color(2147483647</em>3 + 3 ) ;
  println("a " + a);
in Java gives -2147483648
while this routine gives 2147483648</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">aValue1</span> <span class="o">-=</span> <span class="mi">4294967296</span>  <span class="k">if</span> <span class="nx">aValue1</span> <span class="o">&gt;</span> <span class="mi">2147483647</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>note that folding below the lower bound is not handled, i.e. -2147483648 -1
doesn't fold to 2147483647</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">aValue1</span>

  
  
  <span class="nx">Creates</span> <span class="nx">colors</span> <span class="k">for</span> <span class="nx">storing</span> <span class="k">in</span> <span class="nx">variables</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">parameters</span> <span class="nx">are</span>
  <span class="nx">interpreted</span> <span class="nx">as</span> <span class="nx">RGB</span> <span class="o">or</span> <span class="nx">HSB</span> <span class="nx">values</span> <span class="nx">depending</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">colorMode</span><span class="p">().</span> <span class="nx">The</span> <span class="nx">default</span>
  <span class="nx">mode</span> <span class="o">is</span> <span class="nx">RGB</span> <span class="nx">values</span> <span class="nx">from</span> <span class="mi">0</span> <span class="nx">to</span> <span class="mi">255</span> <span class="o">and</span> <span class="nx">therefore</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">function</span> <span class="nx">call</span> <span class="nx">color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="nx">will</span> <span class="k">return</span> <span class="nx">a</span> <span class="nx">bright</span> <span class="nx">yellow</span> <span class="nx">color</span><span class="p">.</span> <span class="nx">More</span> <span class="nx">about</span> <span class="nx">how</span> <span class="nx">colors</span> <span class="nx">are</span> <span class="nx">stored</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">found</span> <span class="k">in</span>
  <span class="nx">the</span> <span class="nx">reference</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">aValue1</span>        <span class="nx">red</span> <span class="o">or</span> <span class="nx">hue</span> <span class="o">or</span> <span class="nx">grey</span> <span class="nx">values</span> <span class="nx">relative</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">color</span> <span class="nx">range</span><span class="p">.</span>
  <span class="nx">Also</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">color</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">hexadecimal</span> <span class="nx">notation</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.</span> <span class="c1">#FFCC00 or 0xFFFFCC00)</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">aValue2</span>        <span class="nx">green</span> <span class="o">or</span> <span class="nx">saturation</span> <span class="nx">values</span> <span class="nx">relative</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">color</span> <span class="nx">range</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">aValue3</span>        <span class="nx">blue</span> <span class="o">or</span> <span class="nx">brightness</span> <span class="nx">values</span> <span class="nx">relative</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">color</span> <span class="nx">range</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">aValue4</span>        <span class="nx">relative</span> <span class="nx">to</span> <span class="nx">current</span> <span class="nx">color</span> <span class="nx">range</span><span class="p">.</span> <span class="nx">Represents</span> <span class="nx">alpha</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">the</span> <span class="nx">color</span>
  
  <span class="nx">@see</span> <span class="nx">colorMode</span>
  
  <span class="nv">color: </span><span class="nf">(aValue1, aValue2, aValue3, aValue4) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>4 arguments: (R, G, B, A) or (H, S, B, A)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@color$4</span><span class="p">(</span><span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue2</span><span class="p">,</span> <span class="nx">aValue3</span><span class="p">,</span> <span class="nx">aValue4</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">aValue1</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span> <span class="o">and</span> <span class="nx">aValue2</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span> <span class="o">and</span> <span class="nx">aValue3</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span> <span class="o">and</span> <span class="nx">aValue4</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
    </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>3 arguments: (R, G, B) or (H, S, B)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@color$4</span><span class="p">(</span><span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue2</span><span class="p">,</span> <span class="nx">aValue3</span><span class="p">,</span> <span class="nx">@colorModeA</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">aValue1</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span> <span class="o">and</span> <span class="nx">aValue2</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span> <span class="o">and</span> <span class="nx">aValue3</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
    </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>2 arguments: (Color, A) or (Grayscale, A)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@color$2</span><span class="p">(</span><span class="nx">aValue1</span><span class="p">,</span> <span class="nx">aValue2</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">aValue1</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span> <span class="o">and</span> <span class="nx">aValue2</span> <span class="o">isnt</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
    </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>1 argument: (Grayscale) or (Color)
we also accept strings because special colors such as angleColor are encoded
through strings</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">aValue1</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span> <span class="o">or</span> <span class="k">typeof</span> <span class="nx">aValue1</span> <span class="o">is</span> <span class="s">&quot;string&quot;</span> 
      <span class="k">return</span> <span class="nx">@color$1</span><span class="p">(</span><span class="nx">aValue1</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Default</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@color$4</span> <span class="nx">@colorModeX</span><span class="p">,</span> <span class="nx">@colorModeY</span><span class="p">,</span> <span class="nx">@colorModeZ</span><span class="p">,</span> <span class="nx">@colorModeA</span>

  <span class="nv">colorToHSB: </span><span class="nf">(colorInt) -&gt;</span>
    <span class="nv">red = </span><span class="kc">undefined</span>
    <span class="nv">green = </span><span class="kc">undefined</span>
    <span class="nv">blue = </span><span class="kc">undefined</span>
    <span class="nv">minBright = </span><span class="kc">undefined</span>
    <span class="nv">maxBright = </span><span class="kc">undefined</span>
    <span class="nv">hue = </span><span class="kc">undefined</span>
    <span class="nv">saturation = </span><span class="kc">undefined</span>
    <span class="nv">red = </span><span class="p">((</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">green = </span><span class="p">((</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">blue = </span><span class="p">(</span><span class="nx">colorInt</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">maxBright = </span><span class="nx">max</span><span class="p">(</span><span class="nx">max</span><span class="p">(</span><span class="nx">red</span><span class="p">,</span> <span class="nx">green</span><span class="p">),</span> <span class="nx">blue</span><span class="p">)</span>
    <span class="nv">minBright = </span><span class="nx">min</span><span class="p">(</span><span class="nx">min</span><span class="p">(</span><span class="nx">red</span><span class="p">,</span> <span class="nx">green</span><span class="p">),</span> <span class="nx">blue</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">maxBright</span> <span class="o">*</span> <span class="nx">@colorModeZ</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">minBright</span> <span class="o">is</span> <span class="nx">maxBright</span>
    <span class="nv">saturation = </span><span class="p">(</span><span class="nx">maxBright</span> <span class="o">-</span> <span class="nx">minBright</span><span class="p">)</span> <span class="o">/</span> <span class="nx">maxBright</span>
    <span class="k">if</span> <span class="nx">red</span> <span class="o">is</span> <span class="nx">maxBright</span>
      <span class="nv">hue = </span><span class="p">(</span><span class="nx">green</span> <span class="o">-</span> <span class="nx">blue</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">maxBright</span> <span class="o">-</span> <span class="nx">minBright</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">green</span> <span class="o">is</span> <span class="nx">maxBright</span>
      <span class="nv">hue = </span><span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="nx">blue</span> <span class="o">-</span> <span class="nx">red</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">maxBright</span> <span class="o">-</span> <span class="nx">minBright</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="nv">hue = </span><span class="mi">4</span> <span class="o">+</span> <span class="p">((</span><span class="nx">red</span> <span class="o">-</span> <span class="nx">green</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">maxBright</span> <span class="o">-</span> <span class="nx">minBright</span><span class="p">))</span>
    <span class="nx">hue</span> <span class="o">/=</span> <span class="mi">6</span>
    <span class="k">if</span> <span class="nx">hue</span> <span class="o">&lt;</span> <span class="mi">0</span>
      <span class="nx">hue</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span> <span class="nx">hue</span> <span class="o">-=</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">hue</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="p">[</span><span class="nx">hue</span> <span class="o">*</span> <span class="nx">@colorModeX</span><span class="p">,</span> <span class="nx">saturation</span> <span class="o">*</span> <span class="nx">@colorModeY</span><span class="p">,</span> <span class="nx">maxBright</span> <span class="o">*</span> <span class="nx">@colorModeZ</span><span class="p">]</span>

  
  
  <span class="nx">Extracts</span> <span class="nx">the</span> <span class="nx">brightness</span> <span class="nx">value</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">color</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">colInt</span> <span class="nx">any</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">brightness</span> <span class="nx">color</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">red</span>
  <span class="nx">@see</span> <span class="nx">green</span>
  <span class="nx">@see</span> <span class="nx">blue</span>
  <span class="nx">@see</span> <span class="nx">hue</span>
  <span class="nx">@see</span> <span class="nx">saturation</span>
  
  <span class="nv">brightness: </span><span class="nf">(colInt) -&gt;</span>
    <span class="nx">@colorToHSB</span><span class="p">(</span><span class="nx">colInt</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

  
  
  <span class="nx">Extracts</span> <span class="nx">the</span> <span class="nx">saturation</span> <span class="nx">value</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">color</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">colInt</span> <span class="nx">any</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">saturation</span> <span class="nx">color</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">red</span>
  <span class="nx">@see</span> <span class="nx">green</span>
  <span class="nx">@see</span> <span class="nx">blue</span>
  <span class="nx">@see</span> <span class="nx">hue</span>
  <span class="nx">@see</span> <span class="nx">brightness</span>
  
  <span class="nv">saturation: </span><span class="nf">(colInt) -&gt;</span>
    <span class="nx">@colorToHSB</span><span class="p">(</span><span class="nx">colInt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

  
  
  <span class="nx">Extracts</span> <span class="nx">the</span> <span class="nx">hue</span> <span class="nx">value</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">color</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">colInt</span> <span class="nx">any</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">hue</span> <span class="nx">color</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">red</span>
  <span class="nx">@see</span> <span class="nx">green</span>
  <span class="nx">@see</span> <span class="nx">blue</span>
  <span class="nx">@see</span> <span class="nx">saturation</span>
  <span class="nx">@see</span> <span class="nx">brightness</span>
  
  <span class="nv">hue: </span><span class="nf">(colInt) -&gt;</span>
    <span class="nx">@colorToHSB</span><span class="p">(</span><span class="nx">colInt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

  
  
  <span class="nx">Extracts</span> <span class="nx">the</span> <span class="nx">red</span> <span class="nx">value</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">color</span><span class="p">,</span> <span class="nx">scaled</span> <span class="nx">to</span> <span class="nx">match</span> <span class="nx">current</span> <span class="nx">colorMode</span><span class="p">().</span>
  <span class="nx">This</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">always</span> <span class="nx">returned</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">float</span> <span class="nx">so</span> <span class="nx">be</span> <span class="nx">careful</span> <span class="o">not</span> <span class="nx">to</span> <span class="nx">assign</span> <span class="nx">it</span> <span class="nx">to</span> <span class="nx">an</span> <span class="nx">int</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">aColor</span> <span class="nx">any</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">red</span> <span class="nx">color</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">green</span>
  <span class="nx">@see</span> <span class="nx">blue</span>
  <span class="nx">@see</span> <span class="nx">alpha</span>
  <span class="nx">@see</span> <span class="o">&gt;&gt;</span> <span class="nx">right</span> <span class="nx">shift</span>
  <span class="nx">@see</span> <span class="nx">hue</span>
  <span class="nx">@see</span> <span class="nx">saturation</span>
  <span class="nx">@see</span> <span class="nx">brightness</span>
  
  <span class="nv">redF: </span><span class="nf">(aColor) -&gt;</span>
    <span class="p">((</span><span class="nx">aColor</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span> <span class="o">*</span> <span class="nx">@colorModeX</span>

  
  
  <span class="nx">Extracts</span> <span class="nx">the</span> <span class="nx">green</span> <span class="nx">value</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">color</span><span class="p">,</span> <span class="nx">scaled</span> <span class="nx">to</span> <span class="nx">match</span> <span class="nx">current</span> <span class="nx">colorMode</span><span class="p">().</span>
  <span class="nx">This</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">always</span> <span class="nx">returned</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">float</span> <span class="nx">so</span> <span class="nx">be</span> <span class="nx">careful</span> <span class="o">not</span> <span class="nx">to</span> <span class="nx">assign</span> <span class="nx">it</span> <span class="nx">to</span> <span class="nx">an</span> <span class="nx">int</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">aColor</span> <span class="nx">any</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">green</span> <span class="nx">color</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">red</span>
  <span class="nx">@see</span> <span class="nx">blue</span>
  <span class="nx">@see</span> <span class="nx">alpha</span>
  <span class="nx">@see</span> <span class="o">&gt;&gt;</span> <span class="nx">right</span> <span class="nx">shift</span>
  <span class="nx">@see</span> <span class="nx">hue</span>
  <span class="nx">@see</span> <span class="nx">saturation</span>
  <span class="nx">@see</span> <span class="nx">brightness</span>
  
  <span class="nv">greenF: </span><span class="nf">(aColor) -&gt;</span>
    <span class="p">((</span><span class="nx">aColor</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span> <span class="o">*</span> <span class="nx">@colorModeY</span>

  
  
  <span class="nx">Extracts</span> <span class="nx">the</span> <span class="nx">blue</span> <span class="nx">value</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">color</span><span class="p">,</span> <span class="nx">scaled</span> <span class="nx">to</span> <span class="nx">match</span> <span class="nx">current</span> <span class="nx">colorMode</span><span class="p">().</span>
  <span class="nx">This</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">always</span> <span class="nx">returned</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">float</span> <span class="nx">so</span> <span class="nx">be</span> <span class="nx">careful</span> <span class="o">not</span> <span class="nx">to</span> <span class="nx">assign</span> <span class="nx">it</span> <span class="nx">to</span> <span class="nx">an</span> <span class="nx">int</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">aColor</span> <span class="nx">any</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">blue</span> <span class="nx">color</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">red</span>
  <span class="nx">@see</span> <span class="nx">green</span>
  <span class="nx">@see</span> <span class="nx">alpha</span>
  <span class="nx">@see</span> <span class="o">&gt;&gt;</span> <span class="nx">right</span> <span class="nx">shift</span>
  <span class="nx">@see</span> <span class="nx">hue</span>
  <span class="nx">@see</span> <span class="nx">saturation</span>
  <span class="nx">@see</span> <span class="nx">brightness</span>
  
  <span class="nv">blueF: </span><span class="nf">(aColor) -&gt;</span>
    <span class="p">(</span><span class="nx">aColor</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span> <span class="o">*</span> <span class="nx">@colorModeZ</span>

  
  
  <span class="nx">Extracts</span> <span class="nx">the</span> <span class="nx">alpha</span> <span class="nx">value</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">color</span><span class="p">,</span> <span class="nx">scaled</span> <span class="nx">to</span> <span class="nx">match</span> <span class="nx">current</span> <span class="nx">colorMode</span><span class="p">().</span>
  <span class="nx">This</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">always</span> <span class="nx">returned</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">float</span> <span class="nx">so</span> <span class="nx">be</span> <span class="nx">careful</span> <span class="o">not</span> <span class="nx">to</span> <span class="nx">assign</span> <span class="nx">it</span> <span class="nx">to</span> <span class="nx">an</span> <span class="nx">int</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">aColor</span> <span class="nx">any</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">color</span> <span class="nx">datatype</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">alpha</span> <span class="nx">color</span> <span class="nx">value</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">red</span>
  <span class="nx">@see</span> <span class="nx">green</span>
  <span class="nx">@see</span> <span class="nx">blue</span>
  <span class="nx">@see</span> <span class="o">&gt;&gt;</span> <span class="nx">right</span> <span class="nx">shift</span>
  <span class="nx">@see</span> <span class="nx">hue</span>
  <span class="nx">@see</span> <span class="nx">saturation</span>
  <span class="nx">@see</span> <span class="nx">brightness</span>
  
  <span class="nv">alpha: </span><span class="nf">(aColor) -&gt;</span>
    <span class="p">((</span><span class="nx">aColor</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span> <span class="o">*</span> <span class="nx">@colorModeA</span>

  <span class="nv">alphaZeroToOne: </span><span class="nf">(aColor) -&gt;</span>
    <span class="p">((</span><span class="nx">aColor</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>

  
  
  <span class="nx">Calculates</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">between</span> <span class="nx">two</span> <span class="nx">numbers</span> <span class="nx">at</span> <span class="nx">a</span> <span class="nx">specific</span> <span class="nx">increment</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">amt</span>  <span class="nx">parameter</span> <span class="o">is</span> <span class="nx">the</span>
  <span class="nx">amount</span> <span class="nx">to</span> <span class="nx">interpolate</span> <span class="nx">between</span> <span class="nx">the</span> <span class="nx">two</span> <span class="nx">values</span> <span class="nx">where</span> <span class="mf">0.0</span> <span class="nx">equal</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">point</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">is</span> <span class="nx">very</span>
  <span class="nx">near</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">point</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">is</span> <span class="nx">half</span><span class="o">-</span><span class="nx">way</span> <span class="k">in</span> <span class="nx">between</span><span class="p">,</span> <span class="nx">etc</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">lerp</span> <span class="nx">function</span> <span class="o">is</span> <span class="nx">convenient</span> <span class="k">for</span>
  <span class="nx">creating</span> <span class="nx">motion</span> <span class="nx">along</span> <span class="nx">a</span> <span class="nx">straight</span> <span class="nx">path</span> <span class="o">and</span> <span class="k">for</span> <span class="nx">drawing</span> <span class="nx">dotted</span> <span class="nx">lines</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">value1</span>       <span class="nx">float</span> <span class="o">or</span> <span class="nv">int: </span><span class="nx">first</span> <span class="nx">value</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">value2</span>       <span class="nx">float</span> <span class="o">or</span> <span class="nv">int: </span><span class="nx">second</span> <span class="nx">value</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">amt</span>          <span class="nv">float: </span><span class="nx">between</span> <span class="mf">0.0</span> <span class="o">and</span> <span class="mf">1.0</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span>
  
  <span class="nx">@see</span> <span class="nx">curvePoint</span>
  <span class="nx">@see</span> <span class="nx">bezierPoint</span>
  
  <span class="nv">lerp: </span><span class="nf">(value1, value2, amt) -&gt;</span>
    <span class="p">((</span><span class="nx">value2</span> <span class="o">-</span> <span class="nx">value1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">amt</span><span class="p">)</span> <span class="o">+</span> <span class="nx">value1</span>

  
  
  <span class="nx">Calculates</span> <span class="nx">a</span> <span class="nx">color</span> <span class="o">or</span> <span class="nx">colors</span> <span class="nx">between</span> <span class="nx">two</span> <span class="nx">colors</span> <span class="nx">at</span> <span class="nx">a</span> <span class="nx">specific</span> <span class="nx">increment</span><span class="p">.</span>
  <span class="nx">The</span> <span class="nx">amt</span> <span class="nx">parameter</span> <span class="o">is</span> <span class="nx">the</span> <span class="nx">amount</span> <span class="nx">to</span> <span class="nx">interpolate</span> <span class="nx">between</span> <span class="nx">the</span> <span class="nx">two</span> <span class="nx">values</span> <span class="nx">where</span> <span class="mf">0.0</span>
  <span class="nx">equal</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">point</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">is</span> <span class="nx">very</span> <span class="nx">near</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">point</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">is</span> <span class="nx">half</span><span class="o">-</span><span class="nx">way</span> <span class="k">in</span> <span class="nx">between</span><span class="p">,</span> <span class="nx">etc</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">c1</span>     <span class="nx">interpolate</span> <span class="nx">from</span> <span class="k">this</span> <span class="nx">color</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">c2</span>     <span class="nx">interpolate</span> <span class="nx">to</span> <span class="k">this</span> <span class="nx">color</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">amt</span>    <span class="nx">between</span> <span class="mf">0.0</span> <span class="o">and</span> <span class="mf">1.0</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">blended</span> <span class="nx">color</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">blendColor</span>
  <span class="nx">@see</span> <span class="nx">color</span>
  
  <span class="nv">lerpColor: </span><span class="nf">(c1, c2, amt) -&gt;</span>
    <span class="nv">r = </span><span class="kc">undefined</span>
    <span class="nv">g = </span><span class="kc">undefined</span>
    <span class="nv">b = </span><span class="kc">undefined</span>
    <span class="nv">a = </span><span class="kc">undefined</span>
    <span class="nv">r1 = </span><span class="kc">undefined</span>
    <span class="nv">g1 = </span><span class="kc">undefined</span>
    <span class="nv">b1 = </span><span class="kc">undefined</span>
    <span class="nv">a1 = </span><span class="kc">undefined</span>
    <span class="nv">r2 = </span><span class="kc">undefined</span>
    <span class="nv">g2 = </span><span class="kc">undefined</span>
    <span class="nv">b2 = </span><span class="kc">undefined</span>
    <span class="nv">a2 = </span><span class="kc">undefined</span>
    <span class="nv">hsb1 = </span><span class="kc">undefined</span>
    <span class="nv">hsb2 = </span><span class="kc">undefined</span>
    <span class="nv">rgb = </span><span class="kc">undefined</span>
    <span class="nv">h = </span><span class="kc">undefined</span>
    <span class="nv">s = </span><span class="kc">undefined</span>
    <span class="nv">colorBits1 = </span><span class="nx">@color</span><span class="p">(</span><span class="nx">c1</span><span class="p">)</span>
    <span class="nv">colorBits2 = </span><span class="nx">@color</span><span class="p">(</span><span class="nx">c2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@curColorMode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">HSB</span>
      </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Special processing for HSB mode.
Get HSB and Alpha values for Color 1 and 2</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">hsb1 = </span><span class="nx">@colorToHSB</span><span class="p">(</span><span class="nx">colorBits1</span><span class="p">)</span>
      <span class="nv">a1 = </span><span class="p">((</span><span class="nx">colorBits1</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="nx">@colorModeA</span>
      <span class="nv">hsb2 = </span><span class="nx">@colorToHSB</span><span class="p">(</span><span class="nx">colorBits2</span><span class="p">)</span>
      <span class="nv">a2 = </span><span class="p">((</span><span class="nx">colorBits2</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="nx">@colorModeA</span>
      </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>RColourFunctions.eturn lerp value for each channel, for HSB components</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">h = </span><span class="nx">@lerp</span><span class="p">(</span><span class="nx">hsb1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">hsb2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">amt</span><span class="p">)</span>
      <span class="nv">s = </span><span class="nx">@lerp</span><span class="p">(</span><span class="nx">hsb1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">hsb2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">amt</span><span class="p">)</span>
      <span class="nv">b = </span><span class="nx">@lerp</span><span class="p">(</span><span class="nx">hsb1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">hsb2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">amt</span><span class="p">)</span>
      <span class="nv">rgb = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toRGB</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
      </pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>... and for Alpha-range</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">a = </span><span class="nx">@lerp</span><span class="p">(</span><span class="nx">a1</span><span class="p">,</span> <span class="nx">a2</span><span class="p">,</span> <span class="nx">amt</span><span class="p">)</span> <span class="o">*</span> <span class="nx">@colorModeA</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="nx">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span>
    </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Get RGBA values for Color 1 to floats</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">r1 = </span><span class="p">(</span><span class="nx">colorBits1</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span>
    <span class="nv">g1 = </span><span class="p">(</span><span class="nx">colorBits1</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span>
    <span class="nv">b1 = </span><span class="p">(</span><span class="nx">colorBits1</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span><span class="p">)</span>
    <span class="nv">a1 = </span><span class="p">((</span><span class="nx">colorBits1</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="nx">@colorModeA</span>
    </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Get RGBA values for Color 2 to floats</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">r2 = </span><span class="p">(</span><span class="nx">colorBits2</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span>
    <span class="nv">g2 = </span><span class="p">(</span><span class="nx">colorBits2</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span>
    <span class="nv">b2 = </span><span class="p">(</span><span class="nx">colorBits2</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span><span class="p">)</span>
    <span class="nv">a2 = </span><span class="p">((</span><span class="nx">colorBits2</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="nx">@colorModeA</span>
    </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Return lerp value for each channel, INT for color, Float for Alpha-range</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">r = </span><span class="nx">@lerp</span><span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">r2</span><span class="p">,</span> <span class="nx">amt</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span>
    <span class="nv">g = </span><span class="nx">@lerp</span><span class="p">(</span><span class="nx">g1</span><span class="p">,</span> <span class="nx">g2</span><span class="p">,</span> <span class="nx">amt</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span>
    <span class="nv">b = </span><span class="nx">@lerp</span><span class="p">(</span><span class="nx">b1</span><span class="p">,</span> <span class="nx">b2</span><span class="p">,</span> <span class="nx">amt</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span>
    <span class="nv">a = </span><span class="nx">@lerp</span><span class="p">(</span><span class="nx">a1</span><span class="p">,</span> <span class="nx">a2</span><span class="p">,</span> <span class="nx">amt</span><span class="p">)</span> <span class="o">*</span> <span class="nx">@colorModeA</span>
    <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="nx">b</span> <span class="o">&amp;</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span>

  
  
  <span class="nx">Changes</span> <span class="nx">the</span> <span class="nx">way</span> <span class="nx">Processing</span> <span class="nx">interprets</span> <span class="nx">color</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">By</span> <span class="nx">default</span><span class="p">,</span> <span class="nx">fill</span><span class="p">(),</span> <span class="nx">stroke</span><span class="p">(),</span> <span class="o">and</span> <span class="nx">background</span><span class="p">()</span>
  <span class="nx">colors</span> <span class="nx">are</span> <span class="nx">set</span> <span class="k">by</span> <span class="nx">values</span> <span class="nx">between</span> <span class="mi">0</span> <span class="o">and</span> <span class="mi">255</span> <span class="nx">using</span> <span class="nx">the</span> <span class="nx">RGB</span> <span class="nx">color</span> <span class="nx">model</span><span class="p">.</span> <span class="nx">It</span> <span class="o">is</span> <span class="nx">possible</span> <span class="nx">to</span> <span class="nx">change</span> <span class="nx">the</span>
  <span class="nx">numerical</span> <span class="nx">range</span> <span class="nx">used</span> <span class="k">for</span> <span class="nx">specifying</span> <span class="nx">colors</span> <span class="o">and</span> <span class="nx">to</span> <span class="k">switch</span> <span class="nx">color</span> <span class="nx">systems</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">example</span><span class="p">,</span> <span class="nx">calling</span> <span class="nx">colorMode</span><span class="p">(</span><span class="nx">RGB</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
  <span class="nx">will</span> <span class="nx">specify</span> <span class="nx">that</span> <span class="nx">values</span> <span class="nx">are</span> <span class="nx">specified</span> <span class="nx">between</span> <span class="mi">0</span> <span class="o">and</span> <span class="mi">1</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">limits</span> <span class="k">for</span> <span class="nx">defining</span> <span class="nx">colors</span> <span class="nx">are</span> <span class="nx">altered</span> <span class="k">by</span> <span class="nx">setting</span> <span class="nx">the</span>
  <span class="nx">parameters</span> <span class="nx">range1</span><span class="p">,</span> <span class="nx">range2</span><span class="p">,</span> <span class="nx">range3</span><span class="p">,</span> <span class="o">and</span> <span class="nx">range</span> <span class="mi">4</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">MODE</span><span class="p">}</span> <span class="nx">mode</span> <span class="nx">Either</span> <span class="nx">RGB</span> <span class="o">or</span> <span class="nx">HSB</span><span class="p">,</span> <span class="nx">corresponding</span> <span class="nx">to</span> <span class="nx">Red</span><span class="o">/</span><span class="nx">Green</span><span class="o">/</span><span class="nx">Blue</span> <span class="o">and</span> <span class="nx">Hue</span><span class="o">/</span><span class="nx">Saturation</span><span class="o">/</span><span class="nx">Brightness</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">range</span>              <span class="nx">range</span> <span class="k">for</span> <span class="nx">all</span> <span class="nx">color</span> <span class="nx">elements</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">range1</span>             <span class="nx">range</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">red</span> <span class="o">or</span> <span class="nx">hue</span> <span class="nx">depending</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">color</span> <span class="nx">mode</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">range2</span>             <span class="nx">range</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">green</span> <span class="o">or</span> <span class="nx">saturation</span> <span class="nx">depending</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">color</span> <span class="nx">mode</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">range3</span>             <span class="nx">range</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">blue</span> <span class="o">or</span> <span class="nx">brightness</span> <span class="nx">depending</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">color</span> <span class="nx">mode</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span><span class="p">}</span> <span class="nx">range4</span>             <span class="nx">range</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">alpha</span>
  
  <span class="nx">@returns</span> <span class="nx">none</span>
  
  <span class="nx">@see</span> <span class="nx">background</span>
  <span class="nx">@see</span> <span class="nx">fill</span>
  <span class="nx">@see</span> <span class="nx">stroke</span>
  
  <span class="nv">colorMode: </span><span class="nf">(mode, range1, range2, range3, range4) -&gt;</span>
    <span class="vi">@curColorMode = </span><span class="nx">mode</span>
    <span class="k">if</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="vi">@colorModeX = </span><span class="nx">range1</span>
      <span class="vi">@colorModeY = </span><span class="nx">range2</span> <span class="o">or</span> <span class="nx">range1</span>
      <span class="vi">@colorModeZ = </span><span class="nx">range3</span> <span class="o">or</span> <span class="nx">range1</span>
      <span class="vi">@colorModeA = </span><span class="nx">range4</span> <span class="o">or</span> <span class="nx">range1</span>

  </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>blending modes</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nx">These</span> <span class="nx">are</span> <span class="nx">internal</span> <span class="nx">blending</span> <span class="nx">modes</span> <span class="nx">used</span> <span class="k">for</span> <span class="nx">BlendColor</span><span class="p">()</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">Color</span><span class="p">}</span> <span class="nx">c1</span>       <span class="nx">First</span> <span class="nx">Color</span> <span class="nx">to</span> <span class="nx">blend</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">Color</span><span class="p">}</span> <span class="nx">c2</span>       <span class="nx">Second</span> <span class="nx">Color</span> <span class="nx">to</span> <span class="nx">blend</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">Color</span><span class="p">}</span>        <span class="nx">The</span> <span class="nx">blended</span> <span class="nx">Color</span>
  
  <span class="nx">@see</span> <span class="nx">BlendColor</span>
  <span class="nx">@see</span> <span class="nx">Blend</span>
  
  <span class="nv">modesFunction: </span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nv">ALPHA_MASK = </span><span class="nx">@Constants</span><span class="p">.</span><span class="nx">ALPHA_MASK</span>
    <span class="nv">RED_MASK = </span><span class="nx">@Constants</span><span class="p">.</span><span class="nx">RED_MASK</span>
    <span class="nv">GREEN_MASK = </span><span class="nx">@Constants</span><span class="p">.</span><span class="nx">GREEN_MASK</span>
    <span class="nv">BLUE_MASK = </span><span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLUE_MASK</span>
    <span class="nv">min = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span>
    <span class="nv">max = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span>
    <span class="nv">applyMode = </span><span class="kc">undefined</span>
    <span class="nv">applyMode = </span><span class="nf">(c1, f, ar, ag, ab, br, bg, bb, cr, cg, cb) -&gt;</span>
      <span class="nv">a = </span><span class="kc">undefined</span>
      <span class="nv">r = </span><span class="kc">undefined</span>
      <span class="nv">g = </span><span class="kc">undefined</span>
      <span class="nv">b = </span><span class="kc">undefined</span>
      <span class="nv">a = </span><span class="nx">min</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="mh">0xff000000</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span>
      <span class="nv">r = </span><span class="p">(</span><span class="nx">ar</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">cr</span> <span class="o">-</span> <span class="nx">ar</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span>
      <span class="nv">r = </span><span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">r</span><span class="p">))))</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span>
      <span class="nv">g = </span><span class="p">(</span><span class="nx">ag</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">cg</span> <span class="o">-</span> <span class="nx">ag</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span>
      <span class="nv">g = </span><span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">g</span><span class="p">))))</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
      <span class="nv">b = </span><span class="nx">ab</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">cb</span> <span class="o">-</span> <span class="nx">ab</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>
      <span class="nv">b = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">b</span><span class="p">)))</span>
      <span class="nx">a</span> <span class="o">|</span> <span class="nx">r</span> <span class="o">|</span> <span class="nx">g</span> <span class="o">|</span> <span class="nx">b</span>

    <span class="nv">replace = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nx">c2</span>

    <span class="nv">blend = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nx">min</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span> <span class="o">|</span> <span class="p">(</span><span class="nx">ar</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">br</span> <span class="o">-</span> <span class="nx">ar</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">ag</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">bg</span> <span class="o">-</span> <span class="nx">ag</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">ab</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">bb</span> <span class="o">-</span> <span class="nx">ab</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span>

    <span class="nv">add = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nx">min</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span> <span class="o">|</span> <span class="nx">min</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">),</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span> <span class="o">|</span> <span class="nx">min</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">),</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="nx">min</span><span class="p">((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">),</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>

    <span class="nv">subtract = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nx">min</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span> <span class="o">|</span> <span class="nx">max</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">),</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span> <span class="o">|</span> <span class="nx">max</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">),</span> <span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="nx">max</span><span class="p">((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">-</span> <span class="p">(((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nv">lightest = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nx">min</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span> <span class="o">|</span> <span class="nx">max</span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">,</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span> <span class="o">|</span> <span class="nx">max</span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">,</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="nx">max</span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">,</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>

    <span class="nv">darkest = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="nx">min</span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">,</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span>
      <span class="nv">bg = </span><span class="nx">min</span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">,</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span>
      <span class="nv">bb = </span><span class="nx">min</span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">,</span> <span class="p">((</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>
      <span class="nx">min</span><span class="p">(((</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span> <span class="o">|</span> <span class="p">(</span><span class="nx">ar</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">br</span> <span class="o">-</span> <span class="nx">ar</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">ag</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">bg</span> <span class="o">-</span> <span class="nx">ag</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span> <span class="o">|</span> <span class="p">(</span><span class="nx">ab</span> <span class="o">+</span> <span class="p">(((</span><span class="nx">bb</span> <span class="o">-</span> <span class="nx">ab</span><span class="p">)</span> <span class="o">*</span> <span class="nx">f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span>

    <span class="nv">difference = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">ar</span> <span class="o">&gt;</span> <span class="nx">br</span><span class="p">)</span> <span class="k">then</span> <span class="p">(</span><span class="nx">ar</span> <span class="o">-</span> <span class="nx">br</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="nx">br</span> <span class="o">-</span> <span class="nx">ar</span><span class="p">))</span>
      <span class="nv">cg = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">ag</span> <span class="o">&gt;</span> <span class="nx">bg</span><span class="p">)</span> <span class="k">then</span> <span class="p">(</span><span class="nx">ag</span> <span class="o">-</span> <span class="nx">bg</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="nx">bg</span> <span class="o">-</span> <span class="nx">ag</span><span class="p">))</span>
      <span class="nv">cb = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">ab</span> <span class="o">&gt;</span> <span class="nx">bb</span><span class="p">)</span> <span class="k">then</span> <span class="p">(</span><span class="nx">ab</span> <span class="o">-</span> <span class="nx">bb</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="nx">bb</span> <span class="o">-</span> <span class="nx">ab</span><span class="p">))</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>

    <span class="nv">exclusion = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="nx">ar</span> <span class="o">+</span> <span class="nx">br</span> <span class="o">-</span> <span class="p">((</span><span class="nx">ar</span> <span class="o">*</span> <span class="nx">br</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span>
      <span class="nv">cg = </span><span class="nx">ag</span> <span class="o">+</span> <span class="nx">bg</span> <span class="o">-</span> <span class="p">((</span><span class="nx">ag</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span>
      <span class="nv">cb = </span><span class="nx">ab</span> <span class="o">+</span> <span class="nx">bb</span> <span class="o">-</span> <span class="p">((</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">bb</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>

    <span class="nv">multiply = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="p">(</span><span class="nx">ar</span> <span class="o">*</span> <span class="nx">br</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">cg = </span><span class="p">(</span><span class="nx">ag</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">cb = </span><span class="p">(</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">bb</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>

    <span class="nv">screen = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">br</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>
      <span class="nv">cg = </span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ag</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">bg</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>
      <span class="nv">cb = </span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ab</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">bb</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>

    <span class="nv">hard_light = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">br</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">)</span> <span class="k">then</span> <span class="p">((</span><span class="nx">ar</span> <span class="o">*</span> <span class="nx">br</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">br</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)))</span>
      <span class="nv">cg = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">bg</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">)</span> <span class="k">then</span> <span class="p">((</span><span class="nx">ag</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ag</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">bg</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)))</span>
      <span class="nv">cb = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">bb</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">)</span> <span class="k">then</span> <span class="p">((</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">bb</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ab</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">bb</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)))</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>

    <span class="nv">soft_light = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="p">((</span><span class="nx">ar</span> <span class="o">*</span> <span class="nx">br</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">ar</span> <span class="o">*</span> <span class="nx">ar</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="nx">ar</span> <span class="o">*</span> <span class="nx">ar</span> <span class="o">*</span> <span class="nx">br</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span>
      <span class="nv">cg = </span><span class="p">((</span><span class="nx">ag</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">ag</span> <span class="o">*</span> <span class="nx">ag</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="nx">ag</span> <span class="o">*</span> <span class="nx">ag</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span>
      <span class="nv">cb = </span><span class="p">((</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">bb</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">ab</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">ab</span> <span class="o">*</span> <span class="nx">bb</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>

    <span class="nv">overlay = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">ar</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">)</span> <span class="k">then</span> <span class="p">((</span><span class="nx">ar</span> <span class="o">*</span> <span class="nx">br</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">br</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)))</span>
      <span class="nv">cg = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">ag</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">)</span> <span class="k">then</span> <span class="p">((</span><span class="nx">ag</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ag</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">bg</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)))</span>
      <span class="nv">cb = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">ab</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">)</span> <span class="k">then</span> <span class="p">((</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">bb</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="p">(((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ab</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">bb</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)))</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>

    <span class="nv">dodge = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="kc">undefined</span>
      <span class="nv">cg = </span><span class="kc">undefined</span>
      <span class="nv">cb = </span><span class="kc">undefined</span>
      <span class="nv">cr = </span><span class="mi">255</span>
      <span class="k">if</span> <span class="nx">br</span> <span class="o">isnt</span> <span class="mi">255</span>
        <span class="nv">cr = </span><span class="p">(</span><span class="nx">ar</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">br</span><span class="p">)</span>
        <span class="nv">cr = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">cr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cr</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">cr</span><span class="p">)))</span>
      <span class="nv">cg = </span><span class="mi">255</span>
      <span class="k">if</span> <span class="nx">bg</span> <span class="o">isnt</span> <span class="mi">255</span>
        <span class="nv">cg = </span><span class="p">(</span><span class="nx">ag</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">bg</span><span class="p">)</span>
        <span class="nv">cg = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">cg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cg</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">cg</span><span class="p">)))</span>
      <span class="nv">cb = </span><span class="mi">255</span>
      <span class="k">if</span> <span class="nx">bb</span> <span class="o">isnt</span> <span class="mi">255</span>
        <span class="nv">cb = </span><span class="p">(</span><span class="nx">ab</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">bb</span><span class="p">)</span>
        <span class="nv">cb = </span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">cb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cb</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">cb</span><span class="p">)))</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>

    <span class="nv">burn = </span><span class="nf">(c1, c2) -&gt;</span>
      <span class="nv">f = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">ALPHA_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">24</span>
      <span class="nv">ar = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">ag = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">ab = </span><span class="p">(</span><span class="nx">c1</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">br = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">RED_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
      <span class="nv">bg = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">GREEN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
      <span class="nv">bb = </span><span class="p">(</span><span class="nx">c2</span> <span class="o">&amp;</span> <span class="nx">BLUE_MASK</span><span class="p">)</span>
      <span class="nv">cr = </span><span class="kc">undefined</span>
      <span class="nv">cg = </span><span class="kc">undefined</span>
      <span class="nv">cb = </span><span class="kc">undefined</span>
      <span class="nv">cr = </span><span class="mi">0</span>
      <span class="k">if</span> <span class="nx">br</span> <span class="o">isnt</span> <span class="mi">0</span>
        <span class="nv">cr = </span><span class="p">((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ar</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="nx">br</span>
        <span class="nv">cr = </span><span class="mi">255</span> <span class="o">-</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cr</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">cr</span><span class="p">))))</span>
      <span class="nv">cg = </span><span class="mi">0</span>
      <span class="k">if</span> <span class="nx">bg</span> <span class="o">isnt</span> <span class="mi">0</span>
        <span class="nv">cg = </span><span class="p">((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="nx">bg</span>
        <span class="nv">cg = </span><span class="mi">255</span> <span class="o">-</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cg</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">cg</span><span class="p">))))</span>
      <span class="nv">cb = </span><span class="mi">0</span>
      <span class="k">if</span> <span class="nx">bb</span> <span class="o">isnt</span> <span class="mi">0</span>
        <span class="nv">cb = </span><span class="p">((</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">ab</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="nx">bb</span>
        <span class="nv">cb = </span><span class="mi">255</span> <span class="o">-</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">cb</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span> <span class="k">then</span> <span class="mi">255</span> <span class="k">else</span> <span class="nx">cb</span><span class="p">))))</span>
      <span class="nx">applyMode</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">ar</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">br</span><span class="p">,</span> <span class="nx">bg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">cr</span><span class="p">,</span> <span class="nx">cg</span><span class="p">,</span> <span class="nx">cb</span>
  
  
  <span class="nx">Blends</span> <span class="nx">two</span> <span class="nx">color</span> <span class="nx">values</span> <span class="nx">together</span> <span class="nx">based</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">blending</span> <span class="nx">mode</span> <span class="nx">given</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">MODE</span> <span class="nx">parameter</span><span class="p">.</span>
  <span class="nx">The</span> <span class="nx">possible</span> <span class="nx">modes</span> <span class="nx">are</span> <span class="nx">described</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">reference</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">blend</span><span class="p">()</span> <span class="nx">function</span><span class="p">.</span>
  
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">c1</span> <span class="nv">color: </span><span class="nx">the</span> <span class="nx">first</span> <span class="nx">color</span> <span class="nx">to</span> <span class="nx">blend</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">color</span><span class="p">}</span> <span class="nx">c2</span> <span class="nv">color: </span><span class="nx">the</span> <span class="nx">second</span> <span class="nx">color</span> <span class="nx">to</span> <span class="nx">blend</span>
  <span class="nx">@param</span> <span class="p">{</span><span class="nx">MODE</span><span class="p">}</span> <span class="nx">MODE</span> <span class="nx">Either</span> <span class="nx">BLEND</span><span class="p">,</span> <span class="nx">ADD</span><span class="p">,</span> <span class="nx">SUBTRACT</span><span class="p">,</span> <span class="nx">DARKEST</span><span class="p">,</span> <span class="nx">LIGHTEST</span><span class="p">,</span> <span class="nx">DIFFERENCE</span><span class="p">,</span> <span class="nx">EXCLUSION</span><span class="p">,</span> <span class="nx">MULTIPLY</span><span class="p">,</span>
  <span class="nx">SCREEN</span><span class="p">,</span> <span class="nx">OVERLAY</span><span class="p">,</span> <span class="nx">HARD_LIGHT</span><span class="p">,</span> <span class="nx">SOFT_LIGHT</span><span class="p">,</span> <span class="nx">DODGE</span><span class="p">,</span> <span class="o">or</span> <span class="nx">BURN</span>
  
  <span class="nx">@returns</span> <span class="p">{</span><span class="nx">float</span><span class="p">}</span> <span class="nx">The</span> <span class="nx">blended</span> <span class="nx">color</span><span class="p">.</span>
  
  <span class="nx">@see</span> <span class="nx">blend</span>
  <span class="nx">@see</span> <span class="nx">color</span>
  
  <span class="nv">blendColor: </span><span class="nf">(c1, c2, mode) -&gt;</span>
    <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">REPLACE</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">replace</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BLEND</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">blend</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">ADD</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">add</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">SUBTRACT</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">subtract</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">LIGHTEST</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">lightest</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">DARKEST</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">darkest</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">DIFFERENCE</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">difference</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">EXCLUSION</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">exclusion</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">MULTIPLY</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">multiply</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">SCREEN</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">screen</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">HARD_LIGHT</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">hard_light</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">SOFT_LIGHT</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">soft_light</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">OVERLAY</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">overlay</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">DODGE</span>
      <span class="nx">@modes</span><span class="p">.</span><span class="nx">dodge</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>
    <span class="k">else</span> <span class="nx">@modes</span><span class="p">.</span><span class="nx">burn</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span>  <span class="k">if</span> <span class="nx">mode</span> <span class="o">is</span> <span class="nx">@Constants</span><span class="p">.</span><span class="nx">BURN</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 