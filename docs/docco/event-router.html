<!DOCTYPE html>  <html> <head>   <title>event-router.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="animation-loop.html">                 animation-loop.coffee               </a>                                           <a class="source" href="autocoder.html">                 autocoder.coffee               </a>                                           <a class="source" href="lexer.html">                 lexer.coffee               </a>                                           <a class="source" href="background-painter.html">                 background-painter.coffee               </a>                                           <a class="source" href="big-cursor.html">                 big-cursor.coffee               </a>                                           <a class="source" href="blend-controls.html">                 blend-controls.coffee               </a>                                           <a class="source" href="code-transformer.html">                 code-transformer.coffee               </a>                                           <a class="source" href="colour-functions.html">                 colour-functions.coffee               </a>                                           <a class="source" href="colour-literals.html">                 colour-literals.coffee               </a>                                           <a class="source" href="editor.html">                 editor.coffee               </a>                                           <a class="source" href="event-router.html">                 event-router.coffee               </a>                                           <a class="source" href="globals.html">                 globals.coffee               </a>                                           <a class="source" href="graphics-commands.html">                 graphics-commands.coffee               </a>                                           <a class="source" href="init.html">                 init.coffee               </a>                                           <a class="source" href="lights-commands.html">                 lights-commands.coffee               </a>                                           <a class="source" href="livecodelab-core.html">                 livecodelab-core.coffee               </a>                                           <a class="source" href="math.html">                 math.coffee               </a>                                           <a class="source" href="matrix-commands.html">                 matrix-commands.coffee               </a>                                           <a class="source" href="parser.html">                 parser.coffee               </a>                                           <a class="source" href="program-loader.html">                 program-loader.coffee               </a>                                           <a class="source" href="program-runner.html">                 program-runner.coffee               </a>                                           <a class="source" href="renderer.html">                 renderer.coffee               </a>                                           <a class="source" href="samplebank.html">                 samplebank.coffee               </a>                                           <a class="source" href="sound-system.html">                 sound-system.coffee               </a>                                           <a class="source" href="text-dimming.html">                 text-dimming.coffee               </a>                                           <a class="source" href="threejs-system.html">                 threejs-system.coffee               </a>                                           <a class="source" href="time-keeper.html">                 time-keeper.coffee               </a>                                           <a class="source" href="ui.html">                 ui.coffee               </a>                                           <a class="source" href="url-router.html">                 url-router.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               event-router.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>EventRouter bridges most events in LiveCodeLab.
Error message pops up? Event router steps in.
Big cursor needs to shrink? It's the event router who stepped in.
You get the picture.
Any part of LiveCodeLab can just register callbacks and trigger events,
using some descriptive strings as keys.
Handy because it's a hub where one could attach debugging and listing
of all registered callbacks. Probably not a good idea to attach
rapid-fire events due to overheads.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">EventRouter</span>

  <span class="nv">events: </span><span class="p">{}</span>
  
  <span class="nv">constructor: </span><span class="nf">-&gt;</span>
  
  <span class="nv">bind: </span><span class="nf">(name, callback, context) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>console.log("binding: " + name + " to callback: " +
  callback + " with context: " + context);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">listenerInfo =</span>
      <span class="nv">callback: </span><span class="nx">callback</span>
      <span class="nv">context: </span><span class="nx">context</span>

    <span class="nx">@events</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="k">unless</span> <span class="nx">@events</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
    <span class="nx">@events</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span> <span class="nx">listenerInfo</span>

  <span class="nv">trigger: </span><span class="nf">(name) -&gt;</span>
    <span class="nv">args = </span><span class="kc">undefined</span>
    <span class="nv">callbacks = </span><span class="kc">undefined</span>
    <span class="nv">i = </span><span class="kc">undefined</span>
    <span class="nv">listenerInfo = </span><span class="kc">undefined</span>
    </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>console.log("triggered: " + name);
convert the arguments object into an array</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">args = </span><span class="nb">Array</span><span class="o">::</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@events</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
      <span class="nv">args = </span><span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="nv">callbacks = </span><span class="nx">@events</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">listenerInfo</span> <span class="k">in</span> <span class="nx">callbacks</span>
        <span class="nx">listenerInfo</span><span class="p">.</span><span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">listenerInfo</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 