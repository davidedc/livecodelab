<!DOCTYPE html>  <html> <head>   <title>lights-commands.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="animation-loop.html">                 animation-loop.coffee               </a>                                           <a class="source" href="autocoder.html">                 autocoder.coffee               </a>                                           <a class="source" href="lexer.html">                 lexer.coffee               </a>                                           <a class="source" href="background-painter.html">                 background-painter.coffee               </a>                                           <a class="source" href="big-cursor.html">                 big-cursor.coffee               </a>                                           <a class="source" href="blend-controls.html">                 blend-controls.coffee               </a>                                           <a class="source" href="code-transformer.html">                 code-transformer.coffee               </a>                                           <a class="source" href="colour-functions.html">                 colour-functions.coffee               </a>                                           <a class="source" href="colour-literals.html">                 colour-literals.coffee               </a>                                           <a class="source" href="editor.html">                 editor.coffee               </a>                                           <a class="source" href="event-router.html">                 event-router.coffee               </a>                                           <a class="source" href="globals.html">                 globals.coffee               </a>                                           <a class="source" href="graphics-commands.html">                 graphics-commands.coffee               </a>                                           <a class="source" href="init.html">                 init.coffee               </a>                                           <a class="source" href="lights-commands.html">                 lights-commands.coffee               </a>                                           <a class="source" href="livecodelab-core.html">                 livecodelab-core.coffee               </a>                                           <a class="source" href="math.html">                 math.coffee               </a>                                           <a class="source" href="matrix-commands.html">                 matrix-commands.coffee               </a>                                           <a class="source" href="parser.html">                 parser.coffee               </a>                                           <a class="source" href="program-loader.html">                 program-loader.coffee               </a>                                           <a class="source" href="program-runner.html">                 program-runner.coffee               </a>                                           <a class="source" href="renderer.html">                 renderer.coffee               </a>                                           <a class="source" href="samplebank.html">                 samplebank.coffee               </a>                                           <a class="source" href="sound-system.html">                 sound-system.coffee               </a>                                           <a class="source" href="text-dimming.html">                 text-dimming.coffee               </a>                                           <a class="source" href="threejs-system.html">                 threejs-system.coffee               </a>                                           <a class="source" href="time-keeper.html">                 time-keeper.coffee               </a>                                           <a class="source" href="ui.html">                 ui.coffee               </a>                                           <a class="source" href="url-router.html">                 url-router.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               lights-commands.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Implementation of all lights-related commands.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">LightsCommands</span>

  <span class="nv">lightsAreOn: </span><span class="kc">false</span>
  <span class="nv">constructor: </span><span class="nf">(@liveCodeLabCore_graphicsCommands, @liveCodeLabCoreInstance) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>defining a couple of shorthands</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@objectPools = </span><span class="nx">@liveCodeLabCore_graphicsCommands</span><span class="p">.</span><span class="nx">objectPools</span>
    <span class="vi">@primitiveTypes = </span><span class="nx">@liveCodeLabCore_graphicsCommands</span><span class="p">.</span><span class="nx">primitiveTypes</span>
    <span class="vi">@objectsUsedInFrameCounts = </span><span class="nx">@liveCodeLabCore_graphicsCommands</span><span class="p">.</span><span class="nx">objectsUsedInFrameCounts</span>

    <span class="nx">@objectPools</span><span class="p">[</span><span class="nx">@primitiveTypes</span><span class="p">.</span><span class="nx">ambientLight</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">@objectsUsedInFrameCounts</span><span class="p">[</span><span class="nx">@primitiveTypes</span><span class="p">.</span><span class="nx">ambientLight</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="nb">window</span><span class="p">.</span><span class="nv">lights = </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@lights</span><span class="p">()</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">noLights = </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@noLights</span><span class="p">()</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">ambientLight = </span><span class="nf">(a,b,c,d) =&gt;</span> <span class="nx">@ambientLight</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">)</span>

  <span class="nv">lights: </span><span class="nf">-&gt;</span>
    <span class="vi">@lightsAreOn = </span><span class="kc">true</span>

  <span class="nv">noLights: </span><span class="nf">-&gt;</span>
    <span class="vi">@lightsAreOn = </span><span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>ambientLight needs to be global</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ambientLight: </span><span class="nf">(r, g, b, a) -&gt;</span>
    <span class="nv">newLightCreated = </span><span class="kc">false</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">r</span><span class="o">?</span>
      </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>empty arguments gives some sort
of grey ambient light.
black is too stark and white
doesn't show the effect with the
default white fill</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">colorToBeUsed = </span><span class="nx">@liveCodeLabCoreInstance</span><span class="p">.</span><span class="nx">colourFunctions</span><span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">colorToBeUsed = </span><span class="nx">@liveCodeLabCoreInstance</span><span class="p">.</span><span class="nx">colourFunctions</span><span class="p">.</span><span class="nx">color</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span>
    <span class="vi">@lightsAreOn = </span><span class="kc">true</span>
    </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>used by graphic-primitives</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@liveCodeLabCore_graphicsCommands.defaultNormalFill = </span><span class="kc">false</span>
    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>used by graphic-primitives</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@liveCodeLabCore_graphicsCommands.defaultNormalStroke = </span><span class="kc">false</span>
    <span class="nv">ambientLightsPool = </span><span class="nx">@objectPools</span><span class="p">[</span><span class="nx">@primitiveTypes</span><span class="p">.</span><span class="nx">ambientLight</span><span class="p">]</span>
    <span class="nv">pooledAmbientLight = </span><span class="nx">ambientLightsPool</span><span class="p">[</span><span class="nx">@objectsUsedInFrameCounts</span><span class="p">[</span><span class="nx">@primitiveTypes</span><span class="p">.</span><span class="nx">ambientLight</span><span class="p">]]</span>

    <span class="k">if</span> <span class="o">not</span> <span class="nx">pooledAmbientLight</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>So here is the thing, the command is currently called AmbientLight but
in reality we are creating a PointLight in a specific position.
AmbientLight just fills the whole scene,
so the faces of the cube would all be of the same
exact color. Note that in Three.js versions before r50 the AmbientLight
would work like a PointLight does now.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">pooledAmbientLight = </span><span class="k">new</span> <span class="nx">@liveCodeLabCoreInstance</span><span class="p">.</span><span class="nx">three</span><span class="p">.</span><span class="nx">PointLight</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">)</span>
      <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">130</span>
      <span class="nv">newLightCreated = </span><span class="kc">true</span>
      <span class="nx">ambientLightsPool</span><span class="p">.</span><span class="nx">push</span> <span class="nx">pooledAmbientLight</span>
      <span class="nv">pooledAmbientLight.detailLevel = </span><span class="mi">0</span>
      <span class="nv">pooledAmbientLight.primitiveType = </span><span class="nx">@primitiveTypes</span><span class="p">.</span><span class="nx">ambientLight</span>
    <span class="k">else</span>
      <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span> <span class="nx">colorToBeUsed</span>

    <span class="nx">@objectsUsedInFrameCounts</span><span class="p">[</span><span class="nx">@primitiveTypes</span><span class="p">.</span><span class="nx">ambientLight</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>NOTE that an ambient light is not actually added as an object.
i.e. if you navigate the objects you don't find it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@liveCodeLabCoreInstance</span><span class="p">.</span><span class="nx">threeJsSystem</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span> <span class="nx">pooledAmbientLight</span>  <span class="k">if</span> <span class="nx">newLightCreated</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 