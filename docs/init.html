<!DOCTYPE html>  <html> <head>   <title>init.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="autocode.html">                 autocode.js               </a>                                           <a class="source" href="background-painting.html">                 background-painting.js               </a>                                           <a class="source" href="big-cursor-animation.html">                 big-cursor-animation.js               </a>                                           <a class="source" href="code-transformations.html">                 code-transformations.js               </a>                                           <a class="source" href="demos-and-tutorials.html">                 demos-and-tutorials.js               </a>                                           <a class="source" href="coffeescript-livecodelab-mode.html">                 coffeescript-livecodelab-mode.js               </a>                                           <a class="source" href="editor.html">                 editor.js               </a>                                           <a class="source" href="mousewheel.html">                 mousewheel.js               </a>                                           <a class="source" href="from-processing.html">                 from-processing.js               </a>                                           <a class="source" href="geometry-commands.html">                 geometry-commands.js               </a>                                           <a class="source" href="init-threejs.html">                 init-threejs.js               </a>                                           <a class="source" href="init.html">                 init.js               </a>                                           <a class="source" href="lights-functions.html">                 lights-functions.js               </a>                                           <a class="source" href="livecodelab.html">                 livecodelab.js               </a>                                           <a class="source" href="math.html">                 math.js               </a>                                           <a class="source" href="matrix-commands.html">                 matrix-commands.js               </a>                                           <a class="source" href="menu.html">                 menu.js               </a>                                           <a class="source" href="sound-functions.html">                 sound-functions.js               </a>                                           <a class="source" href="text-dimming.html">                 text-dimming.js               </a>                                           <a class="source" href="var-definitions.html">                 var-definitions.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               init.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="keyword">var</span> startingSound;

<span class="keyword">var</span> closeAndCheckAudio = <span class="keyword">function</span>() {
</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>$('#noWebGLMessage').close();</p>             </td>             <td class="code">               <div class="highlight"><pre>    $.modal.close();
    setTimeout(<span class="string">'checkAudio();'</span>, <span class="number">500</span>);
  }

<span class="keyword">var</span> checkAudio = <span class="keyword">function</span>() {
    <span class="keyword">if</span> (!buzz.isSupported()) {
</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>if (true) {</p>             </td>             <td class="code">               <div class="highlight"><pre>      $(<span class="string">'#noAudioMessage'</span>).modal();
      $(<span class="string">'#simplemodal-container'</span>).height(<span class="number">200</span>);
    }
  }

<span class="keyword">var</span> loadAndTestAllTheSounds = <span class="keyword">function</span>() {
    log(<span class="string">"loading and testing all sounds"</span>);
    <span class="keyword">for</span> (<span class="keyword">var</span> cycleSoundDefs = <span class="number">0</span>; cycleSoundDefs &lt; numberOfSounds; cycleSoundDefs++) {

      <span class="keyword">if</span> (buzz.isMP3Supported()) soundDef[cycleSoundDefs].soundFile = soundDef[cycleSoundDefs].soundFile + <span class="string">".mp3"</span>;
      <span class="keyword">else</span> <span class="keyword">if</span> (buzz.isOGGSupported()) soundDef[cycleSoundDefs].soundFile = soundDef[cycleSoundDefs].soundFile + <span class="string">".ogg"</span>;
      <span class="keyword">else</span> {
        <span class="keyword">break</span>;
      }

      soundBank[soundDef[cycleSoundDefs].soundName] = [];
      soundFiles[soundDef[cycleSoundDefs].soundName] = soundDef[cycleSoundDefs].soundFile;

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Chrome can deal with dynamic loading
of many files but doesn't like loading too many audio objects
so fast - it crashes.
At the opposite end, Safari doesn't like loading sound dynamically
and instead works fine by loading sound all at the beginning.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="keyword">if</span> (navigator.userAgent.toLowerCase().indexOf(<span class="string">'chrome'</span>) === -<span class="number">1</span> &amp;&amp; !(<span class="regexp">/MSIE (\d+\.\d+);/</span>.test(navigator.userAgent))) {
        <span class="keyword">for</span> (<span class="keyword">var</span> preloadSounds = <span class="number">0</span>; preloadSounds &lt; CHANNELSPERSOUND; preloadSounds++) {
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>if you load and play all the channels of all the sounds all together
the browser freezes, and the OS doesn't feel too well either
so better stagger the checks in time.</p>             </td>             <td class="code">               <div class="highlight"><pre>          setTimeout(<span class="string">"checkSound("</span> + cycleSoundDefs + <span class="string">");"</span>, <span class="number">200</span> * cycleSoundDefs);
        }
      }

    } <span class="comment">// end of the for loop</span>
    <span class="keyword">if</span> (navigator.userAgent.toLowerCase().indexOf(<span class="string">'chrome'</span>) &gt; -<span class="number">1</span> || (<span class="regexp">/MSIE (\d+\.\d+);/</span>.test(navigator.userAgent))) {
      startEnvironment();
    }
  }

<span class="keyword">var</span> checkSound = <span class="keyword">function</span>(cycleSoundDefs) {
    <span class="keyword">var</span> newSound = <span class="keyword">new</span> buzz.sound(soundDef[cycleSoundDefs].soundFile);
    log(<span class="string">"loading sound "</span>+ soundDef[cycleSoundDefs].soundFile);
    newSound.mute();
    newSound.load();
    newSound.bind(<span class="string">"ended"</span>, <span class="keyword">function</span>(e) {
      <span class="keyword">this</span>.unbind(<span class="string">"ended"</span>);
      <span class="keyword">this</span>.unmute();
      endedFirstPlay++;
      <span class="keyword">if</span> (endedFirstPlay % <span class="number">10</span> === <span class="number">0</span>) $(<span class="string">'#loading'</span>).append(<span class="string">'/'</span>);
      log(<span class="string">"tested "</span>+endedFirstPlay+<span class="string">" sounds"</span>);
      <span class="keyword">if</span> (endedFirstPlay === numberOfSounds * CHANNELSPERSOUND) {
        log(<span class="string">"tested all sounds"</span>);
        startEnvironment();
      }
    });
    newSound.play();
    soundBank[soundDef[cycleSoundDefs].soundName].push(newSound);
  }


<span class="keyword">var</span> startEnvironment = <span class="keyword">function</span>() {
  pickRandomDefaultGradient();

  log(<span class="string">"startEnvironment"</span>);
  <span class="keyword">if</span> (!initThreeJs()) animate();

  <span class="keyword">if</span> (!Detector.webgl || forceCanvasRenderer) {
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>$('#noWebGLMessage').modal()</p>             </td>             <td class="code">               <div class="highlight"><pre>    $(<span class="string">'#noWebGLMessage'</span>).modal({
      onClose: closeAndCheckAudio
    });
    $(<span class="string">'#simplemodal-container'</span>).height(<span class="number">200</span>);
  }

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>alert('resizing canvas');</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="keyword">var</span> canvas = document.getElementById(<span class="string">'backGroundCanvas'</span>);

  <span class="keyword">if</span> (fullScreenifyBackground) {
    fullscreenify(canvas);
  }
  resetGradientStack();
  simpleGradientUpdateIfChanged();

  $(<span class="string">'#startingCourtainScreen'</span>).fadeOut();
  $(<span class="string">"#formCode"</span>).css(<span class="string">'opacity'</span>, <span class="number">0</span>);

  editor = createEditor();


  editor.focus();
  adjustCodeMirrorHeight();

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>check if the url points to a particular demo,
in which case we load the demo directly.
otherwise we do as usual.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="keyword">if</span> (window.location.hash.indexOf(<span class="string">"bookmark"</span>) !== -<span class="number">1</span>) {
    <span class="keyword">var</span> demoToLoad = window.location.hash.substring(<span class="string">"bookmark"</span>.length + <span class="number">2</span>);
</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>setTimeout ( "loadDemoOrTutorial('"+demoToLoad+"');",500);</p>             </td>             <td class="code">               <div class="highlight"><pre>    loadDemoOrTutorial(demoToLoad);
  }
  <span class="keyword">else</span> {
			startingSound = <span class="keyword">new</span> buzz.sound( <span class="string">"./sound/audioFiles/start_bing"</span>, {
					formats: [ <span class="string">"ogg"</span>, <span class="string">"mp3"</span> ]
			});
			
			setTimeout(<span class="string">"startingSound.play();"</span>,<span class="number">650</span>);
  }
  fakeCursorInterval = setInterval(<span class="string">"fakeCursorBlinking()"</span>, <span class="number">800</span>);


</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Init of the dim code toggle.
set it to false, then immediatly toggle it to true with the managing function
that way we can easily invert the default: just change false to true -- julien</p>             </td>             <td class="code">               <div class="highlight"><pre>  dimcodeOn = <span class="literal">false</span>;
  toggleDimCode();

}

$(document).ready(<span class="keyword">function</span>() {
  log(<span class="string">"document ready"</span>);
  <span class="keyword">if</span> (!isCanvasSupported) {
    $(<span class="string">'#noCanvasMessage'</span>).modal({
      onClose: <span class="keyword">function</span>() {
        $(<span class="string">'#loading'</span>).text(<span class="string">'sorry :-('</span>);
        $.modal.close();
      }
    });
    $(<span class="string">'#simplemodal-container'</span>).height(<span class="number">200</span>);
    <span class="keyword">return</span>;
  }

  loadAndTestAllTheSounds();
});

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 