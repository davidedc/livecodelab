<!DOCTYPE html>  <html> <head>   <title>livecodelab.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               livecodelab.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>init the scene</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>

  <span class="nx">scaledBackgroundWidth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nx">backGroundFraction</span><span class="p">);</span>
  <span class="nx">scaledBackgroundHeight</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">/</span> <span class="nx">backGroundFraction</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">forceCanvasRenderer</span> <span class="o">&amp;&amp;</span> <span class="nx">Detector</span><span class="p">.</span><span class="nx">webgl</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">forceCanvasRenderer</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">ballDefaultDetLevel</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
    <span class="nx">sceneRenderingCanvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>

    <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span><span class="p">({</span>
      <span class="nx">canvas</span><span class="o">:</span> <span class="nx">sceneRenderingCanvas</span><span class="p">,</span>
      <span class="nx">preserveDrawingBuffer</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>to allow screenshot</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">antialias</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">premultipliedAlpha</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>renderer.autoClearColor = false;
renderer.autoClear = false;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">isWebGLUsed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>this is really a bad hack, but chrome goes twice
as fast with this, while safari doesn't work,
and firefox is the fastest no matter what</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;chrome&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>renderer.autoClear = false;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span>

    <span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">sceneRenderingCanvas</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>document.getElementById('finalRenderWithSceneAndBlendCanvas').appendChild(finalRenderWithSceneAndBlend);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>we always draw the 3d scene off-screen</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">ballDefaultDetLevel</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="nx">sceneRenderingCanvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
    <span class="nx">sceneRenderingCanvasContext</span> <span class="o">=</span> <span class="nx">sceneRenderingCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
    <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">CanvasRenderer</span><span class="p">({</span>
      <span class="nx">canvas</span><span class="o">:</span> <span class="nx">sceneRenderingCanvas</span><span class="p">,</span>
      <span class="nx">antialias</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>to get smoother output</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">preserveDrawingBuffer</span><span class="o">:</span> <span class="kc">false</span> <span class="c1">// to allow screenshot</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>renderer.autoClear = true;
renderer.setClearColorHex( 0x000000, 1 );</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">previousRenderForBlending</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
    <span class="nx">previousRenderForBlending</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">;</span>
    <span class="nx">previousRenderForBlending</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">;</span>
    <span class="nx">previousRenderForBlendingContext</span> <span class="o">=</span> <span class="nx">previousRenderForBlending</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>

    <span class="nx">finalRenderWithSceneAndBlend</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;finalRenderWithSceneAndBlendCanvas&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>finalRenderWithSceneAndBlend.width = scaledBackgroundWidth;
finalRenderWithSceneAndBlend.height = scaledBackgroundHeight;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">finalRenderWithSceneAndBlend</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">;</span>
    <span class="nx">finalRenderWithSceneAndBlend</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">;</span>
    <span class="nx">finalRenderWithSceneAndBlendContext</span> <span class="o">=</span> <span class="nx">finalRenderWithSceneAndBlend</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>

    <span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>document.getElementById('container').appendChild(sceneRenderingCanvas);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span>


  <span class="nx">backgroundScene</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;backGroundCanvas&#39;</span><span class="p">);</span>
  <span class="nx">backgroundScene</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">scaledBackgroundWidth</span><span class="p">;</span>
  <span class="nx">backgroundScene</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">scaledBackgroundHeight</span><span class="p">;</span>
  <span class="nx">backgroundSceneContext</span> <span class="o">=</span> <span class="nx">backgroundScene</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>add Stats.js - https://github.com/mrdoob/stats.js</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">stats</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stats</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Align bottom-left</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">stats</span><span class="p">.</span><span class="nx">getDomElement</span><span class="p">().</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span><span class="p">;</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nx">getDomElement</span><span class="p">().</span><span class="nx">style</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="s1">&#39;0px&#39;</span><span class="p">;</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nx">getDomElement</span><span class="p">().</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s1">&#39;0px&#39;</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">getDomElement</span><span class="p">());</span>

  <span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">();</span>
  <span class="nx">scene</span><span class="p">.</span><span class="nx">matrixAutoUpdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>put a camera in the scene</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">camera</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>temporarily, add a light
add subtle ambient lighting
var ambientLight = new THREE.AmbientLight(0xFF0000);
scene.add(ambientLight);
create a point light</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">pointLight</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PointLight</span><span class="p">(</span><span class="mh">0xFFFFFF</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>set its position</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">pointLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="nx">pointLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
  <span class="nx">pointLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">130</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>add to the scene</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pointLight</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>transparently support window resize</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">THREEx</span><span class="p">.</span><span class="nx">WindowResize</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">renderer</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">isWebGLUsed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">buildPostprocessingChain</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">buildPostprocessingChain</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">renderTargetParameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">format</span><span class="o">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">RGBAFormat</span><span class="p">,</span>
    <span class="nx">stencilBuffer</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">};</span>

  <span class="nx">renderTarget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderTarget</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span> <span class="nx">renderTargetParameters</span><span class="p">);</span>
  <span class="nx">effectSaveTarget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SavePass</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderTarget</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span> <span class="nx">renderTargetParameters</span><span class="p">));</span>
  <span class="nx">effectSaveTarget</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">fxaaPass</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderPass</span><span class="p">(</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderExtras</span><span class="p">[</span><span class="s2">&quot;fxaa&quot;</span><span class="p">]);</span>
  <span class="nx">fxaaPass</span><span class="p">.</span><span class="nx">uniforms</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">].</span><span class="nx">value</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span>

  <span class="nx">effectBlend</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderPass</span><span class="p">(</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderExtras</span><span class="p">[</span><span class="s2">&quot;blend&quot;</span><span class="p">],</span> <span class="s2">&quot;tDiffuse1&quot;</span><span class="p">);</span>
  <span class="nx">screenPass</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderPass</span><span class="p">(</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderExtras</span><span class="p">[</span><span class="s2">&quot;screen&quot;</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>motion blur</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">effectBlend</span><span class="p">.</span><span class="nx">uniforms</span><span class="p">[</span><span class="s1">&#39;tDiffuse2&#39;</span><span class="p">].</span><span class="nx">texture</span> <span class="o">=</span> <span class="nx">effectSaveTarget</span><span class="p">.</span><span class="nx">renderTarget</span><span class="p">;</span>
  <span class="nx">effectBlend</span><span class="p">.</span><span class="nx">uniforms</span><span class="p">[</span><span class="s1">&#39;mixRatio&#39;</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">renderModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">RenderPass</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span>

  <span class="nx">composer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">EffectComposer</span><span class="p">(</span><span class="nx">renderer</span><span class="p">,</span> <span class="nx">renderTarget</span><span class="p">);</span>

  <span class="nx">composer</span><span class="p">.</span><span class="nx">addPass</span><span class="p">(</span><span class="nx">renderModel</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>composer.addPass( fxaaPass );</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">composer</span><span class="p">.</span><span class="nx">addPass</span><span class="p">(</span><span class="nx">effectBlend</span><span class="p">);</span>
  <span class="nx">composer</span><span class="p">.</span><span class="nx">addPass</span><span class="p">(</span><span class="nx">effectSaveTarget</span><span class="p">);</span>
  <span class="nx">composer</span><span class="p">.</span><span class="nx">addPass</span><span class="p">(</span><span class="nx">screenPass</span><span class="p">);</span>
  <span class="nx">screenPass</span><span class="p">.</span><span class="nx">renderToScreen</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>



<span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>


  <span class="cm">/*</span>

<span class="cm">//DIVIDER</span>
<span class="cm">      var light = new THREE.PointLight( 0xFFFFFF );</span>
<span class="cm">      light.position.set( 10, 0, 10 );</span>
<span class="cm">      scene.add( light );</span>
<span class="cm">      */</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>need a light for the meshlambert material</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">isWebGLUsed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">composer</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>//////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>renderer.render(scene,camera);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>the renderer draws into an offscreen canvas called sceneRenderingCanvas</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">finalRenderWithSceneAndBlendContext</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="nx">finalRenderWithSceneAndBlendContext</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>clear the final render context</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">finalRenderWithSceneAndBlendContext</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="nx">blendAmount</span><span class="p">;</span>
    <span class="nx">finalRenderWithSceneAndBlendContext</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">previousRenderForBlending</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="nx">finalRenderWithSceneAndBlendContext</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="nx">finalRenderWithSceneAndBlendContext</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">sceneRenderingCanvas</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>draw the rendering of the scene on the final render
clear the final render context</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">previousRenderForBlendingContext</span><span class="p">.</span><span class="nx">globalCompositeOperation</span> <span class="o">=</span> <span class="s1">&#39;copy&#39;</span><span class="p">;</span>
    <span class="nx">previousRenderForBlendingContext</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">finalRenderWithSceneAndBlend</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>previousRenderForBlendingContext.clearRect(0, 0, window.innerWidth,window.innerHeight)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">sceneRenderingCanvasContext</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span>



  <span class="p">}</span>


<span class="p">}</span>


<span class="kd">var</span> <span class="nx">drawLoopTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">doLNOnce</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>clear the renderer's canvas to transparent black</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">combDisplayList</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sceneObject</span> <span class="o">=</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">objects</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isLine</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">usedLines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">usedLines</span><span class="o">--</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isRectangle</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">usedRectangles</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">usedRectangles</span><span class="o">--</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isBox</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">usedBoxes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">usedBoxes</span><span class="o">--</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isCylinder</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">usedCylinders</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">usedCylinders</span><span class="o">--</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isAmbientLight</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">usedAmbientLights</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">usedAmbientLights</span><span class="o">--</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isSphere</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">usedSpheres</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isSphere</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">usedSpheres</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isSphere</span><span class="p">]</span> <span class="o">=</span> <span class="nx">usedSpheres</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">isSphere</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">sceneObject</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kd">function</span> <span class="nx">clearDisplayList</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  for(var i = 0; i &lt; scene.objects.length; ++i) {</span>
<span class="cm">      scene.remove(scene.objects[i]);</span>
<span class="cm">      i--;</span>
<span class="cm">  }</span>
<span class="cm">  */</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">registerCode</span><span class="p">()</span> <span class="p">{</span>


  <span class="k">try</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">editorContent</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">fakeText</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">shrinkFakeText</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">editorContent</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">fakeText</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">resetTheSpinThingy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">fakeText</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
        <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span>
      <span class="p">},</span> <span class="s2">&quot;fast&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>By doing some profiling it is apparent that
adding and removing objects has a big cost.
So instead of adding/removing objects every frame,
objects are only added at creation and they are
never removed from the scene. They are
only made invisible. This routine combs the
scene and finds the objects that.
TODO a way to shrink the scene if it's been a
long time that only a handful of lines/meshes
have been used.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unshrinking&#39;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#justForFakeCursor&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#toMove&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#caption&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">);</span>


      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#toMove&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
        <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">margin</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">350</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="mi">0</span>
      <span class="p">},</span> <span class="s2">&quot;fast&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#caption&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#fakeStartingBlinkingCursor&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>$("#formCode").css('opacity',0);
setTimeout('if (editor.getValue() !== "") $("#formCode").css("opacity",0);',10);</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">});</span>

    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">copyOfEditorContent</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">programIsMangled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">programContainsStringsOrComments</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">characterBeingExamined</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">nextCharacterBeingExamined</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/é/g</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ê/g</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/temps/g</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/uneFois/g</span><span class="p">,</span> <span class="s2">&quot;doOnce&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/boite/g</span><span class="p">,</span> <span class="s2">&quot;box&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/balle/g</span><span class="p">,</span> <span class="s2">&quot;ball&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/rectangle/g</span><span class="p">,</span> <span class="s2">&quot;rect&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ligne/g</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/deplace/g</span><span class="p">,</span> <span class="s2">&quot;move&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/tourne/g</span><span class="p">,</span> <span class="s2">&quot;rotate&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/changeTaille/g</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/tailleTrait/g</span><span class="p">,</span> <span class="s2">&quot;strokeSize&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/taille/g</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/fond/g</span><span class="p">,</span> <span class="s2">&quot;background&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/degradeSimple/g</span><span class="p">,</span> <span class="s2">&quot;simpleGradient&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/styleAnimation/g</span><span class="p">,</span> <span class="s2">&quot;animationStyle&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/flouMouvement/g</span><span class="p">,</span> <span class="s2">&quot;motionBlur&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/peindreAudessus/g</span><span class="p">,</span> <span class="s2">&quot;paintOver&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/peindreAuDessus/g</span><span class="p">,</span> <span class="s2">&quot;paintOver&quot;</span><span class="p">);</span>

      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/sauveMatrice/g</span><span class="p">,</span> <span class="s2">&quot;pushMatrix&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/sauveMatrix/g</span><span class="p">,</span> <span class="s2">&quot;pushMatrix&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/pushMatrice/g</span><span class="p">,</span> <span class="s2">&quot;pushMatrix&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/restaureMatrice/g</span><span class="p">,</span> <span class="s2">&quot;popMatrix&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/restaureMatrix/g</span><span class="p">,</span> <span class="s2">&quot;popMatrix&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/popMatrice/g</span><span class="p">,</span> <span class="s2">&quot;popMatrix&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/effaceMatrice/g</span><span class="p">,</span> <span class="s2">&quot;resetMatrix&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/effaceMatrix/g</span><span class="p">,</span> <span class="s2">&quot;resetMatrix&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/resetMatrice/g</span><span class="p">,</span> <span class="s2">&quot;resetMatrix&quot;</span><span class="p">);</span>

      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/sansRemplissage/g</span><span class="p">,</span> <span class="s2">&quot;noFill&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/remplissage/g</span><span class="p">,</span> <span class="s2">&quot;fill&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/trait/g</span><span class="p">,</span> <span class="s2">&quot;stroke&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/couleur/g</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/eclairageAmbiant/g</span><span class="p">,</span> <span class="s2">&quot;ambientLight&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/sansEclairage/g</span><span class="p">,</span> <span class="s2">&quot;noLights&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/eclairage/g</span><span class="p">,</span> <span class="s2">&quot;lights&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ajouteSon/g</span><span class="p">,</span> <span class="s2">&quot;addSound&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/fois/g</span><span class="p">,</span> <span class="s2">&quot;times&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/image/g</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">);</span>

      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/couleurAngle/g</span><span class="p">,</span> <span class="s2">&quot;angleColor&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/noire/g</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/noir/g</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/blanche/g</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/blanc/g</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/grise/g</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/gris/g</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/rouge/g</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/bleue/g</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/bleu/g</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/jaune/g</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/verte/g</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/vert/g</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/violet/g</span><span class="p">,</span> <span class="s2">&quot;purple&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/marron/g</span><span class="p">,</span> <span class="s2">&quot;brown&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/rose/g</span><span class="p">,</span> <span class="s2">&quot;pink&quot;</span><span class="p">);</span>
      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/peche/g</span><span class="p">,</span> <span class="s2">&quot;peachpuff&quot;</span><span class="p">);</span>


    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>fakeCursorInterval = setInterval ( "fakeCursorBlinking()", 800 );</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(\s)*✓[ ]*doOnce[ ]*\-\&gt;[ ]*$/gm</span><span class="p">,</span> <span class="s2">&quot;$1if false&quot;</span><span class="p">);</span>
    <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;\u2713&quot;</span><span class="p">,</span> <span class="s2">&quot;//&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>a check mark is added to the left of
doOnce statements that have been executed
but in reality those check marks
are just single-line comments, so replace here.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>according to jsperf, this is the fastest way to count for
occurrences of a character. We count apostrophes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">copyOfEditorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">        if (chromeHackUncaughtReferenceNames !== []) {</span>

<span class="cm">//DIVIDER</span>

<span class="cm">      var lengthToCheck = chromeHackUncaughtReferenceNames.length;</span>
<span class="cm">      for (var iteratingOverSource = 0; iteratingOverSource &lt; lengthToCheck; iteratingOverSource++) {</span>
<span class="cm">            copyOfEditorContent = copyOfEditorContent.replace(new RegExp( &#39;\\s+&#39;+chromeHackUncaughtReferenceNames[iteratingOverSource]+&#39;\\s+&#39;, &quot;g&quot; ),&quot;ERROR&quot;);</span>
<span class="cm">      }</span>
<span class="cm">  </span>
<span class="cm">      if (copyOfEditorContent.indexOf(&#39;ERROR&#39;) &gt; -1) {</span>
<span class="cm">        alert(&quot;found some old undefineds&quot;);</span>
<span class="cm">        return;</span>
<span class="cm">      }</span>
<span class="cm">      </span>

<span class="cm">//DIVIDER</span>
<span class="cm">      chromeHackUncaughtReferenceNames = [];</span>

<span class="cm">    }</span>
<span class="cm">    */</span>


    <span class="k">while</span> <span class="p">(</span><span class="nx">copyOfEditorContent</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">characterBeingExamined</span> <span class="o">=</span> <span class="nx">copyOfEditorContent</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="nx">nextCharacterBeingExamined</span> <span class="o">=</span> <span class="nx">copyOfEditorContent</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">||</span> <span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">||</span> <span class="p">(</span><span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
      <span class="nx">nextCharacterBeingExamined</span> <span class="o">===</span> <span class="s2">&quot;*&quot;</span> <span class="o">||</span> <span class="nx">nextCharacterBeingExamined</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nx">programContainsStringsOrComments</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>check whether the program potentially
contains strings or comments
if it doesn't then we can do some
simple syntactic checks that are likely
to be much faster than attempting a
coffescript to javascript translation</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">copyOfEditorContent</span> <span class="o">=</span> <span class="nx">copyOfEditorContent</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>alert("there is at least one undefined, actually: " + chromeHackUncaughtReferenceNames.length);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">programContainsStringsOrComments</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>if we are here it means that
all the previous undefineds are not
found anymore
TODO this wouldn't work if one uses a function name
and then one defines it. We should also check
whether there is a function definition</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&quot;(?:[^&quot;\\\n]|\\.)*&quot;)|(&#39;(?:[^&#39;\\\n]|\\.)*&#39;)|(\/\/[^\n]*\n)|(\/\*(?:(?!\*\/)(?:.|\n))*\*\/)/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">all</span><span class="p">,</span> <span class="nx">quoted</span><span class="p">,</span> <span class="nx">aposed</span><span class="p">,</span> <span class="nx">singleComment</span><span class="p">,</span> <span class="nx">comment</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>alert('program contains strings or comments');</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">quoted</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">quoted</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">aposed</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">aposed</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">singleComment</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>let's do a quick check:
these groups of characters should be in even number:
", ', (), {}, []</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>OK the program contains comments and/or strings
so this is what we are going to do:
first we remove all the comments for good
then we create a version without the strings
so we can perform some basic syntax checking.
Note that when we remove the comments we also need to
take into account strings because otherwise we mangle a line like
print "frame/100 //"
where we need to now that that single comment is actually the content
of a string.
modified from Processing.js (search for: "masks strings and regexs")
this is useful to remove all comments but keeping all the strings
the difference is that here I don't treat regular expressions.
Note that string take precedence over comments i.e.
is a string, not half a string with a quote in a comment
get rid of the comments for good.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">numberOfLinesInMultilineComment</span> <span class="o">=</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>strings are kept as they are</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">rebuiltNewLines</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">cycleToRebuildNewLines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">cycleToRebuildNewLines</span> <span class="o">&lt;</span> <span class="nx">numberOfLinesInMultilineComment</span><span class="p">;</span> <span class="nx">cycleToRebuildNewLines</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">rebuiltNewLines</span> <span class="o">=</span> <span class="nx">rebuiltNewLines</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>preserve the line because
the doOnce mechanism needs to retrieve
the line where it was</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">return</span> <span class="nx">rebuiltNewLines</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>eliminate multiline comments preserving the lines</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">copyOfEditorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&quot;(?:[^&quot;\\\n]|\\.)*&quot;)|(&#39;(?:[^&#39;\\\n]|\\.)*&#39;)/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">copyOfEditorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">aposCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">quoteCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">roundBrackCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">curlyBrackCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">squareBrackCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nx">copyOfEditorContent</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">characterBeingExamined</span> <span class="o">=</span> <span class="nx">copyOfEditorContent</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">aposCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">quoteCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s1">&#39;(&#39;</span> <span class="o">||</span> <span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">roundBrackCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s1">&#39;{&#39;</span> <span class="o">||</span> <span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">curlyBrackCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s1">&#39;[&#39;</span> <span class="o">||</span> <span class="nx">characterBeingExamined</span> <span class="o">===</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">squareBrackCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">copyOfEditorContent</span> <span class="o">=</span> <span class="nx">copyOfEditorContent</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>alert('rebuilding multilines: '+ numberOfLinesInMultilineComment);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span>
    <span class="nx">aposCount</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">quoteCount</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">roundBrackCount</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">curlyBrackCount</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">squareBrackCount</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">autocodeOn</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">editor</span><span class="p">.</span><span class="nx">undo</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>alert('rebuilding multilines: '+ rebuiltNewLines);</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">programHasBasicError</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>ok now in the version we use for syntax checking we delete all the strings</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dangerSignText&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">aposCount</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">reasonOfBasicError</span> <span class="o">=</span> <span class="s2">&quot;Missing &#39;&quot;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">quoteCount</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">reasonOfBasicError</span> <span class="o">=</span> <span class="s1">&#39;Missing &quot;&#39;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">roundBrackCount</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">reasonOfBasicError</span> <span class="o">=</span> <span class="s2">&quot;Unbalanced ()&quot;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">curlyBrackCount</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">reasonOfBasicError</span> <span class="o">=</span> <span class="s2">&quot;Unbalanced {}&quot;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">squareBrackCount</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">reasonOfBasicError</span> <span class="o">=</span> <span class="s2">&quot;Unbalanced []&quot;</span><span class="p">;</span>

      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#errorMessageText&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">reasonOfBasicError</span><span class="p">);</span>


      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>according to jsperf, the fastest way to check if number is even/odd</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span>
    <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">),</span> <span class="s2">&quot;\n\t&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="s2">&quot;draw = -&gt;\n&quot;</span> <span class="o">+</span> <span class="nx">elaboratedSource</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>alert("did an undo");</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>alert("basic error");
alert("p:" + $('#dangerSignText').css('color'));</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(\d+)\s+times[ ]*\-&gt;/g</span><span class="p">,</span> <span class="s2">&quot;;( $1 + 0).times -&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>indent the code</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;doOnce&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>little trick. This is mangled up in the translation from coffeescript
(1).times ->
But this isn't:
(1+0).times ->
So here is the little replace.
TODO: you should be a little smarter about the substitution of the draw method
You can tell a method declaration because the line below is indented
so you should check that.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">elaboratedSourceByLine</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>elaboratedSource =  elaboratedSource.replace(/^([a-z]+[a-zA-Z0-9]+)\s*$/gm, "$1 = ->" );
some replacements add a semicolon for the
following reason: coffeescript allows you to split arguments
over multiple lines.
So if you have:
  rotate 0,0,1
  box
and you want to add a scale like so:
  scale 2,2,2
  rotate 0,0,1
  box
What happens is that as you are in the middle of typing:
  scale 2,
  rotate 0,0,1
  box
coffeescript takes the rotate as the second argument of scale
causing mayhem.
Instead, all is good if rotate is prepended with a semicolon.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">iteratingOverSource</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">iteratingOverSource</span> <span class="o">&lt;</span> <span class="nx">elaboratedSourceByLine</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">iteratingOverSource</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>if there is at least one doOnce:
split the source in lines
add all the line numbers info
regroup the lines into a single string again
alert('soon before replacing doOnces'+elaboratedSource);</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">]</span> <span class="o">=</span> <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(\s*)doOnce[ ]*\-&gt;[ ]*(.+)$/gm</span><span class="p">,</span> <span class="s2">&quot;$1;doLNOnce.push(&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">iteratingOverSource</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;); (1+0).times -&gt; $2&quot;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^(\s*)doOnce[ ]*\-&gt;[ ]*$/gm</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>alert("a doOnce is potentially executable");</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">]</span> <span class="o">=</span> <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(\s*)doOnce[ ]*\-&gt;[ ]*$/gm</span><span class="p">,</span> <span class="s2">&quot;$1(1+0).times -&gt;&quot;</span><span class="p">);</span>
          <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">iteratingOverSource</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">iteratingOverSource</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(\s*)(.+)$/gm</span><span class="p">,</span> <span class="s2">&quot;$1;doLNOnce.push(&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">iteratingOverSource</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;); $2&quot;</span><span class="p">);</span>
        <span class="p">}</span>

      <span class="p">}</span>
      <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSourceByLine</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>alert('splitting: ' + elaboratedSourceByLine.length );</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span>



    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(\s*)([a-z]+[a-zA-Z0-9]+)[ ]*$/gm</span><span class="p">,</span> <span class="s2">&quot;$1;$2()&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>alert('iterating: ' + iteratingOverSource );</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/;\s*([a-z]+[a-zA-Z0-9]+)[ ]*([;\n]+)/g</span><span class="p">,</span> <span class="s2">&quot;;$1()$2&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>alert('doOnce multiline!');</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\-&gt;\s*([a-z]+[a-zA-Z0-9]+)[ ]*([;\n]+)/g</span><span class="p">,</span> <span class="s2">&quot;;$1()$2&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>alert('soon after replacing doOnces'+elaboratedSource);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span>
    <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/[\s\+\;]+draw\s*\(/</span><span class="p">)</span> <span class="o">||</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">autocodeOn</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">editor</span><span class="p">.</span><span class="nx">undo</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>this takes care of when a token that it's supposed to be
a function is inlined with something else e.g.
doOnce frame = 0; box
2 times -> box</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">programHasBasicError</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dangerSignText&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#errorMessageText&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;You can&#39;t call draw()&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>this takes care of when a token that it's supposed to be
a function is inlined like so:
2 times -> box</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/;if\(\)/g</span><span class="p">,</span> <span class="s2">&quot;;if&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/;for\(\)/g</span><span class="p">,</span> <span class="s2">&quot;;for&quot;</span><span class="p">);</span>

    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/\//g</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/scale(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;scale$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/rotate(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;rotate$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/move(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;move$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/rect(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;rect$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/line(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;line$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/bpm(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;bpm$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/addSound(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;addSound$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/pushMatrix(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;pushMatrix$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/popMatrix(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;popMatrix$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/resetMatrix(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;resetMatrix$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/fill(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;fill$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/noFill(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;noFill$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/stroke(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;stroke$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/noStroke(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;noStroke$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/strokeSize(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;strokeSize$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/animationStyle(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;animationStyle$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/simpleGradient(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;simpleGradient$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/background(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;background$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/color(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;color$1&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>draw() could just be called by mistake and it's likely
to be disastrous. User doesn't even have visibility of such method,
why should he/she call it?
TODO: call draw() something else that the user is not
likely to use by mistake and take away this check.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/lights(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;lights$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/noLights(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;noLights$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ambientLight(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;ambientLight$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/pointLight(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;pointLight$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ball(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;ball$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ballDetail(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;ballDetail$1&quot;</span><span class="p">);</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/peg(\s)+/g</span><span class="p">,</span> <span class="s2">&quot;;peg$1&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>alert("did an undo");</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-&gt;(\s+);/g</span><span class="p">,</span> <span class="s2">&quot;-&gt;$1&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>we don't want if and for to undergo the same tratment as, say, box
so put those back to normal.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(\s)if\s*([a-zA-Z0-9]*)(\s*);/g</span><span class="p">,</span> <span class="s2">&quot;$1if $2$3&quot;</span><span class="p">);</span>


    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">elaboratedSource</span> <span class="p">);</span>
    <span class="nx">out</span> <span class="o">=</span> <span class="nx">CoffeeScript</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">elaboratedSource</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">bare</span><span class="o">:</span> <span class="s2">&quot;on&quot;</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;in javascript: &quot;</span> <span class="o">+</span> <span class="nx">out</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">autocodeOn</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">editor</span><span class="p">.</span><span class="nx">undo</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>elaboratedSource =  elaboratedSource.replace(/ambient(\s)+/g, ";ambient$1" );
elaboratedSource =  elaboratedSource.replace(/reflect(\s)+/g, ";reflect$1" );
elaboratedSource =  elaboratedSource.replace(/refract(\s)+/g, ";refract$1" );</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dangerSignText&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">coffeeScriptErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">coffeeScriptErrorMessage</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Unexpected &#39;INDENT&#39;&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">coffeeScriptErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;weird indentation&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">coffeeScriptErrorMessage</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Unexpected &#39;TERMINATOR&#39;&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">coffeeScriptErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;line not complete&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">coffeeScriptErrorMessage</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Unexpected &#39;CALL_END&#39;&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">coffeeScriptErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;line not complete&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">coffeeScriptErrorMessage</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Unexpected &#39;}&#39;&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">coffeeScriptErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;something wrong&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">coffeeScriptErrorMessage</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Unexpected &#39;MATH&#39;&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">coffeeScriptErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;weird arithmetic there&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">coffeeScriptErrorMessage</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Unexpected &#39;LOGIC&#39;&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">coffeeScriptErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;odd expression thingy&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">coffeeScriptErrorMessage</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Unexpected &#39;NUMBER&#39;&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">coffeeScriptErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;lost number?&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#errorMessageText&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">coffeeScriptErrorMessage</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>the semicolon mangles the first line of the function definitions
coffeescript doesn't like that</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">matchDeclaredMethod</span> <span class="o">=</span> <span class="sr">/([a-z]+[a-zA-Z0-9]*) = function/</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">declaredMethods</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">mc</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">copyOfOut</span> <span class="o">=</span> <span class="nx">out</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">((</span><span class="nx">mc</span> <span class="o">=</span> <span class="nx">copyOfOut</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">matchDeclaredMethod</span><span class="p">)))</span> <span class="p">{</span>
    <span class="nx">declaredMethods</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">mc</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nx">copyOfOut</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">rightContext</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>the semicolon mangles the first line of if statements
coffeescript doesn't like that</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">usedMethods</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">md</span><span class="p">;</span>
  <span class="nx">copyOfOut</span> <span class="o">=</span> <span class="nx">out</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">((</span><span class="nx">md</span> <span class="o">=</span> <span class="nx">copyOfOut</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\s([a-z]+[a-zA-Z0-9]*)\(/</span><span class="p">)))</span> <span class="p">{</span>
    <span class="nx">usedMethods</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">md</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nx">copyOfOut</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">rightContext</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>alert("did an undo");</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">scanningUsedMethods</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">scanningUsedMethods</span> <span class="o">&lt;</span> <span class="nx">usedMethods</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">scanningUsedMethods</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span>
    <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;rotate&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;rect&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;line&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;box&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;move&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;scale&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;alert&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;bpm&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;addSound&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;pushMatrix&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;popMatrix&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;resetMatrix&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;fill&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;noFill&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;stroke&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;noStroke&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;strokeSize&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;animationStyle&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;background&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;simpleGradient&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;color&quot;</span> <span class="o">||</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>FINDS USED METHODS WHICH ARE NOT DECLARED</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;lights&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;noLights&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;ambientLight&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;pointLight&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;ball&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;ballDetail&quot;</span> <span class="o">||</span> <span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;peg&quot;</span> <span class="o">||</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">declaredMethods</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">error</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>alert("found declared methods " + declaredMethods.length);
alert("out:"+out)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dangerSignText&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#errorMessageText&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; doesn&#39;t exist&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">scanningDeclaredMethods</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">scanningDeclaredMethods</span> <span class="o">&lt;</span> <span class="nx">declaredMethods</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">scanningDeclaredMethods</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>alert("found used methods " + usedMethods.length);</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">===</span> <span class="nx">declaredMethods</span><span class="p">[</span><span class="nx">scanningDeclaredMethods</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">scanningDeclaredMethods</span> <span class="o">==</span> <span class="nx">declaredMethods</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">error</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>usedMethods[scanningUsedMethods] === "ambient" ||
usedMethods[scanningUsedMethods] === "reflect" ||
usedMethods[scanningUsedMethods] === "refract" ||</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dangerSignText&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#errorMessageText&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">usedMethods</span><span class="p">[</span><span class="nx">scanningUsedMethods</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; doesn&#39;t exist&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="nx">programHasBasicError</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">reasonOfBasicError</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dangerSignText&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;#000000&#39;</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#errorMessageText&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">reasonOfBasicError</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>alert("used method not declared: " + usedMethods[scanningUsedMethods]);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">consecutiveFramesWithoutRunTimeError</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>alert ("comparing >" + usedMethods[scanningUsedMethods]  + "&lt; , >" + declaredMethods[scanningDeclaredMethods] +"&lt;");</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/var frame/</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>alert("used method not declared: " + usedMethods[scanningUsedMethods]);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="nx">out</span><span class="p">);</span>


<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>see here for the deepest examination ever of "eval"
http://perfectionkills.com/global-eval-what-are-the-options/
note that exceptions are caught by the window.onerror callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">linenumber</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">autocodeOn</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">undo</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>so it turns out that when you ASSIGN to the frame variable inside
the coffeescript, it declares a local one, which makes changing
it impossible.
TODO: There must be a way to tell coffeescript to accept
some variables as global, for the time being let's put
the cheap hack in place.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Uncaught ReferenceError: &quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">msg</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dangerSignText&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#errorMessageText&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>alert("out:"+out);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="cm">/*</span>
<span class="cm"> if (msg.indexOf(&quot;Uncaught ReferenceError&quot;) &gt; -1) {</span>
<span class="cm">  chromeHackUncaughtReferenceName = msg.split(&#39; &#39;)[2];</span>

<span class="cm">  var lengthToCheck = chromeHackUncaughtReferenceNames.length;</span>
<span class="cm">  if (lengthToCheck == 0){</span>
<span class="cm">    chromeHackUncaughtReferenceNames.push(chromeHackUncaughtReferenceName);</span>
<span class="cm">  }</span>
<span class="cm">  else {</span>
<span class="cm">    for (var iteratingOverSource = 0; iteratingOverSource &lt; lengthToCheck; iteratingOverSource++) {</span>
<span class="cm">      if (chromeHackUncaughtReferenceNames[iteratingOverSource].indexOf(chromeHackUncaughtReferenceName) &gt; -1) {</span>
<span class="cm">        break;</span>
<span class="cm">      }</span>
<span class="cm">      else if (iteratingOverSource == lengthToCheck-1) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">       chromeHackUncaughtReferenceNames.push(chromeHackUncaughtReferenceName);</span>
<span class="cm">      }</span>
<span class="cm">    }</span>
<span class="cm">  }</span>
<span class="cm"> }</span>
<span class="cm"> */</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>var chromeHackUncaughtReferenceName = '';
var chromeHackUncaughtReferenceNames = [];</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">consecutiveFramesWithoutRunTimeError</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="nb">window</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="nx">lastStableProgram</span><span class="p">);</span>

  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">background</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">clearDisplayList</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>alert("did an undo");</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">theColor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">();</span>
  <span class="nx">theColor</span><span class="p">.</span><span class="nx">setRGB</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>ok so this is kind of a hack that we need to put
in place for Chrome (both Windows and Mac)
what Chrome does is: when there is a function call,
it evaluates the arguments
of a function even if the function is undefined
so for example
doO alert "miao"
alerts a miao, because it's translated into
doO(alert("miao))
and even if doO is undefined, the argumen is evaluated
This is a problem because doOnce would encourage
the following use: misspell doOnce until the rest of the
line is finished, then correct the mispell to actually
run the line once.
But unfortunately because of the quirk described above,
that wouldn't work in Chrome.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>if we are here it means that the variable is not in the array</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">loopInterval</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">time</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">timeAtStart</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">animate</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>we set this to 6 because we save it as stable
when it's 5, so we avoid re-saving.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">useRequestAnimationFrame</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">wantedFramesPerSecond</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">animate</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>canvas renderer</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">loopInterval</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">loopInterval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="s2">&quot;window.requestAnimationFrame(animate)&quot;</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">/</span> <span class="nx">wantedFramesPerSecond</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;animate();&#39;</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">/</span> <span class="nx">wantedFramesPerSecond</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>renderer.setClearColor(theColor,1);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">matrixStack</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">worldMatrix</span><span class="p">.</span><span class="nx">identity</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>animation loop</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">beatsPerMinute</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">soundLoops</span><span class="p">.</span><span class="nx">beatStrings</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>loop on request animation loop
- it has to be at the begining of the function
- see details at http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
requestAnimationFrame seems to only do 60 fps, which in my case is too much,
I rather prefer to have a slower framerate but steadier.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">draw</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">frame</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">timeAtStart</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
      <span class="nx">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">time</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">timeAtStart</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">doLNOnce</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">fill</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">);</span>
    <span class="nx">stroke</span><span class="p">(</span><span class="mh">0xFF000000</span><span class="p">);</span>
    <span class="nx">currentStrokeSize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">defaultNormalFill</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">defaultNormalStroke</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">ballDetLevel</span> <span class="o">=</span> <span class="nx">ballDefaultDetLevel</span><span class="p">;</span>
    <span class="nx">noLights</span><span class="p">();</span>
    <span class="nx">usedLines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">usedRectangles</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">usedBoxes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">usedAmbientLights</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">usedPointLights</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>setTimeout("window.requestAnimationFrame(animate)",
      1000 / wantedFramesPerSecond);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">usedSpheres</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">animationStyleValue</span> <span class="o">=</span> <span class="nx">normal</span><span class="p">;</span>
    <span class="nx">resetGradientStack</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>clearDisplayList();</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">draw</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>the sound list needs to be cleaned
and the beatsPerMinute set to zero
so that the user program can create its own from scratch</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">frame</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">timeAtStart</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
      <span class="nx">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">animationStyleUpdateIfChanged</span><span class="p">();</span>
    <span class="nx">simpleGradientUpdateIfChanged</span><span class="p">();</span>
    <span class="nx">updateBpmIfChanged</span><span class="p">();</span>
    <span class="nx">frame</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">consecutiveFramesWithoutRunTimeError</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">consecutiveFramesWithoutRunTimeError</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">lastStableProgram</span> <span class="o">=</span> <span class="nx">out</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>rootObject = new THREE.Object3D();
scene.add(rootObject);
parentObject = rootObject;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>In theory there is no need to chuck away the
counter altogether, you could go through
the existing counters contained in this object
(one for each ball detail ever used)
and set it to zero. That would maybe save
some garbage collection time.
But it's probably not worth it...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">combDisplayList</span><span class="p">();</span>
  <span class="nx">render</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>bpm(0);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">stats</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>


  <span class="k">if</span> <span class="p">(</span><span class="nx">doLNOnce</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>we have to repeat this check because in the case
the user has set frame = 0,
then we have to catch that case here
after the program has executed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/uneFois/g</span><span class="p">,</span> <span class="s2">&quot;doOnce&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">elaboratedSourceByLine</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>chromeHackUncaughtReferenceName = '';</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">iteratingOverSource</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">iteratingOverSource</span> <span class="o">&lt;</span> <span class="nx">doLNOnce</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">iteratingOverSource</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>do the render</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">doLNOnce</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">doLNOnce</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">]].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(\s*)doOnce([ ]*\-&gt;[ ]*.+)$/gm</span><span class="p">,</span> <span class="s2">&quot;$1\u2713doOnce$2&quot;</span><span class="p">);</span>
      <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">doLNOnce</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">elaboratedSourceByLine</span><span class="p">[</span><span class="nx">doLNOnce</span><span class="p">[</span><span class="nx">iteratingOverSource</span><span class="p">]].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(\s*)doOnce([ ]*\-&gt;[ ]*)$/gm</span><span class="p">,</span> <span class="s2">&quot;$1\u2713doOnce$2&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSourceByLine</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">cursorPositionBeforeAddingCheckMark</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getCursor</span><span class="p">();</span>
    <span class="nx">cursorPositionBeforeAddingCheckMark</span><span class="p">.</span><span class="nx">ch</span> <span class="o">=</span> <span class="nx">cursorPositionBeforeAddingCheckMark</span><span class="p">.</span><span class="nx">ch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elaboratedSource</span> <span class="o">=</span> <span class="nx">elaboratedSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/doOnce/g</span><span class="p">,</span> <span class="s2">&quot;uneFois&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">elaboratedSource</span><span class="p">);</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setCursor</span><span class="p">(</span><span class="nx">cursorPositionBeforeAddingCheckMark</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>clearDisplayList();
update stats</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">registerCode</span><span class="p">();</span>
  <span class="p">}</span>


<span class="p">}</span>

<span class="kd">var</span> <span class="nx">lastkey</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">fakeText</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">onkeypress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">fakeText</span> <span class="o">&amp;&amp;</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="nx">shrinkFakeText</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

<span class="p">}</span>

<span class="kd">var</span> <span class="nx">shrinkFakeText</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">theEvent</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">theEvent</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">||</span> <span class="nx">theEvent</span><span class="p">.</span><span class="nx">which</span><span class="p">;</span>
      <span class="nx">key</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="nx">key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">currentCaption</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#caption&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">shorterCaption</span> <span class="o">=</span> <span class="nx">currentCaption</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">currentCaption</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#caption&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">shorterCaption</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#fakeStartingBlinkingCursor&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#toMove&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
      <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">margin</span><span class="o">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
      <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">300</span><span class="p">,</span>
      <span class="nx">left</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">},</span> <span class="s2">&quot;fast&quot;</span><span class="p">);</span>

    <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;$(&quot;#formCode&quot;).animate({opacity: 1}, &quot;fast&quot;);&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;$(&quot;#justForFakeCursor&quot;).hide();&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;$(&quot;#toMove&quot;).hide();&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>alert("a doOnce has been ran");</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">fakeText</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="p">}</span>


<span class="kd">var</span> <span class="nx">parentObject</span><span class="p">,</span> <span class="nx">rootObject</span><span class="p">,</span> <span class="nx">rotate</span><span class="p">,</span> <span class="nx">move</span><span class="p">;</span>
<span class="nx">parentObject</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">rootObject</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">currentObject</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">beatsPerMinute</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">oldBeatsPerMinute</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">soundLoopTimer</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">beatNumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">bpm</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>alert('splitting: ' + elaboratedSourceByLine.length );</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">)</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="nx">beatsPerMinute</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="nx">updateBpmIfChanged</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">updateBpmIfChanged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">oldBeatsPerMinute</span> <span class="o">!==</span> <span class="nx">beatsPerMinute</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>alert('iterating: ' + iteratingOverSource );</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">soundLoopTimer</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">beatsPerMinute</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">soundLoopTimer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="s1">&#39;soundLoop();&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">/</span> <span class="nx">beatsPerMinute</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">oldBeatsPerMinute</span> <span class="o">=</span> <span class="nx">beatsPerMinute</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>we want to avoid that another frame is run with the old
code, as this would mean that the
runOnce code is run more than once,
so we need to register the new code.
TODO: ideally we don't want to register the
new code by getting the code from codemirror again
because we don't know what that entails. We should
just pass the code we already have.
Also registerCode() may split the source code by line, so we can
avoid that since we've just split it, we could pass
the already split code.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">}</span>

<span class="nx">soundLoop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>setTimeout('clearTimeout(fakeCursorInterval);',200);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">soundSystemIsMangled</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="nx">beatNumber</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">beatNumber</span> <span class="o">=</span> <span class="nx">beatNumber</span> <span class="o">%</span> <span class="mi">16</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;about to loop in &#39;</span><span class="o">+</span><span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="o">+</span><span class="s2">&quot; of length &quot;</span><span class="o">+</span><span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">loopingTheSoundIDs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">loopingTheSoundIDs</span> <span class="o">&lt;</span> <span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">loopingTheSoundIDs</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">loopedSoundID</span> <span class="o">=</span> <span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="p">[</span><span class="nx">loopingTheSoundIDs</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">playOrNoPlay</span><span class="p">;</span>
    <span class="nx">playOrNoPlay</span> <span class="o">=</span> <span class="nx">soundLoops</span><span class="p">.</span><span class="nx">beatStrings</span><span class="p">[</span><span class="nx">loopingTheSoundIDs</span><span class="p">].</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">beatNumber</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;checking sound loop &#39;</span><span class="o">+</span><span class="nx">soundLoops</span><span class="p">.</span><span class="nx">beatStrings</span><span class="p">[</span><span class="nx">loopingTheSoundIDs</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; beat &quot;</span><span class="o">+</span><span class="nx">beatNumber</span><span class="o">+</span><span class="s2">&quot; : &quot;</span><span class="o">+</span><span class="nx">playOrNoPlay</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">playOrNoPlay</span> <span class="o">===</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>timid attempt at sanity check.
the sound system might well bork out
even below 500 bpm.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">relevantSoundBank</span> <span class="o">=</span> <span class="nx">soundBank</span><span class="p">[</span><span class="nx">loopedSoundID</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">lengthOfSoundBank</span> <span class="o">=</span> <span class="nx">relevantSoundBank</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">availableSoundBank</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;playing  &#39;</span><span class="o">+</span><span class="nx">loopedSoundID</span><span class="o">+</span><span class="s2">&quot; length: &quot;</span><span class="o">+</span><span class="nx">lengthOfSoundBank</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">checkingAvailableSoundBank</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">checkingAvailableSoundBank</span> <span class="o">&lt;</span> <span class="nx">lengthOfSoundBank</span><span class="p">;</span> <span class="nx">checkingAvailableSoundBank</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">checkingSoundBank</span> <span class="o">=</span> <span class="nx">relevantSoundBank</span><span class="p">[</span><span class="nx">checkingAvailableSoundBank</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">checkingSoundBank</span><span class="p">.</span><span class="nx">isEnded</span><span class="p">())</span> <span class="p">{</span>
          <span class="nx">availableSoundBank</span> <span class="o">=</span> <span class="nx">checkingSoundBank</span><span class="p">;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;sound bank &#39;</span><span class="o">+</span><span class="nx">checkingAvailableSoundBank</span><span class="o">+</span><span class="s2">&quot; is available &quot;</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;sound bank &#39;</span><span class="o">+</span><span class="nx">checkingAvailableSoundBank</span><span class="o">+</span><span class="s2">&quot; has not ended &quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">availableSoundBank</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;creating new sound object &#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">totalCreatedSoundObjects</span> <span class="o">&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">soundSystemIsMangled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#soundSystemIsMangledMessage&#39;</span><span class="p">).</span><span class="nx">modal</span><span class="p">();</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#simplemodal-container&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">availableSoundBank</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">buzz</span><span class="p">.</span><span class="nx">sound</span><span class="p">(</span><span class="nx">soundFiles</span><span class="p">[</span><span class="nx">loopedSoundID</span><span class="p">]);</span>
        <span class="nx">soundBank</span><span class="p">[</span><span class="nx">loopedSoundID</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">availableSoundBank</span><span class="p">);</span>
        <span class="nx">totalCreatedSoundObjects</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;using version: &#39;</span> <span class="o">+</span> <span class="nx">soundBank</span><span class="p">[</span><span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="p">[</span><span class="nx">i</span><span class="p">]][</span><span class="s1">&#39;lastUsed&#39;</span><span class="p">]);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;soundID: &#39;</span> <span class="o">+</span> <span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">soundBank</span><span class="p">[</span><span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="p">[</span><span class="nx">i</span><span class="p">]][</span><span class="nx">soundBank</span><span class="p">[</span><span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="p">[</span><span class="nx">i</span><span class="p">]][</span><span class="s1">&#39;lastUsed&#39;</span><span class="p">]]);</span>
      <span class="nx">availableSoundBank</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>alert('changing beats per minute old ' + oldBeatsPerMinute + ' new: ' + beatsPerMinute);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="nx">addSound</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">soundID</span><span class="p">,</span> <span class="nx">beatString</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">beatString</span> <span class="o">=</span> <span class="nx">beatString</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
  <span class="nx">soundLoops</span><span class="p">.</span><span class="nx">soundIDs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">soundID</span><span class="p">);</span>
  <span class="nx">soundLoops</span><span class="p">.</span><span class="nx">beatStrings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">beatString</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;pushing &#39;</span><span class="o">+</span><span class="nx">soundID</span><span class="o">+</span><span class="s2">&quot; beat: &quot;</span><span class="o">+</span><span class="nx">beatString</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">matrixStack</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">pushMatrix</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">matrixStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">worldMatrix</span><span class="p">);</span>
  <span class="nx">worldMatrix</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Matrix4</span><span class="p">()).</span><span class="nx">copy</span><span class="p">(</span><span class="nx">worldMatrix</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">popMatrix</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">matrixStack</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">worldMatrix</span> <span class="o">=</span> <span class="nx">matrixStack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
  <span class="k">else</span> <span class="nx">worldMatrix</span><span class="p">.</span><span class="nx">identity</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">resetMatrix</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">worldMatrix</span><span class="p">.</span><span class="nx">identity</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">move</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">time</span> <span class="o">/</span> <span class="mi">500</span><span class="p">);</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">time</span> <span class="o">/</span> <span class="mi">500</span><span class="p">);</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">  currentObject = new THREE.Object3D();</span>
<span class="cm">  currentObject.position.x = a;</span>
<span class="cm">  currentObject.position.y = b;</span>
<span class="cm">  currentObject.position.z = c;</span>
<span class="cm">  parentObject.add(currentObject);</span>
<span class="cm">  parentObject = currentObject;</span>
<span class="cm">  */</span>
  <span class="nx">worldMatrix</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">));</span>
<span class="p">};</span>

<span class="nx">rotate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">  currentObject = new THREE.Object3D();</span>
<span class="cm">  currentObject.rotation.x = a;</span>
<span class="cm">  currentObject.rotation.y = b;</span>
<span class="cm">  currentObject.rotation.z = c;</span>
<span class="cm">  parentObject.add(currentObject);</span>
<span class="cm">  parentObject = currentObject;</span>
<span class="cm">  */</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>alert('AFTER old ' + oldBeatsPerMinute + ' new: ' + a);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">worldMatrix</span><span class="p">.</span><span class="nx">rotateX</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">rotateY</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">rotateZ</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>

<span class="p">};</span>

<span class="nx">scale</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">time</span> <span class="o">/</span> <span class="mi">500</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>clearTimeout(soundLoopTimer);
alert('soundLoop');
if (beatsPerMinute !== 0) {
   soundLoopTimer = setTimeout('soundLoop();',(1000*60)/beatsPerMinute);
}</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.000000001</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="mf">0.000000001</span><span class="p">)</span> <span class="nx">a</span> <span class="o">=</span> <span class="mf">0.000000001</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.000000001</span> <span class="o">&amp;&amp;</span> <span class="nx">b</span> <span class="o">&lt;</span> <span class="mf">0.000000001</span><span class="p">)</span> <span class="nx">b</span> <span class="o">=</span> <span class="mf">0.000000001</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">c</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.000000001</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">&lt;</span> <span class="mf">0.000000001</span><span class="p">)</span> <span class="nx">c</span> <span class="o">=</span> <span class="mf">0.000000001</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">  currentObject = new THREE.Object3D();</span>
<span class="cm">  currentObject.scale.x = a;</span>
<span class="cm">  currentObject.scale.y = b;</span>
<span class="cm">  currentObject.scale.z = c;</span>
<span class="cm">  parentObject.add(currentObject);</span>
<span class="cm">  parentObject = currentObject;</span>
<span class="cm">  */</span>
  <span class="nx">worldMatrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">));</span>

<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>OK so this is what we do here:
when each Audio object plays, it plays from start to end
and you can't get it to re-start until it's completely done
playing.
This is bad because some sounds last a second or so, and they
need to play more often than one time per second.
So there are two possible solutions:
1) to have 20 or so sound objects, and all the times that
   a file needs playing, scan them and find one that is free,
   then associate that to the file one wants to play
   this works well in IE and Chrome but really bad in Safari
2) for each file, give it a queue of audio objects.
   This is more complicated but seems to work
   about right in all browsers. Only caveat is that Safari
   needs the audio objects to be preloaded because otherwise
   it jams. Conversely, IE and Chrome don't like them preloaded
   because they have a limit of 35 or so sounds.
So here we went for 2), and we preload the sounds only for
browsers other than Chrome and IE.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">line</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="nx">linesPool</span><span class="p">[</span><span class="nx">usedLines</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lineBasicMaterialCOL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">LineBasicMaterial</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>soundBank[soundLoops.soundIDs[i]]['lastUsed'] = (soundBank[soundLoops.soundIDs[i]]['lastUsed']+1)%CHANNELSPERSOUND;</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">opacity</span><span class="o">:</span> <span class="nx">currentStrokeAlpha</span><span class="p">,</span>
      <span class="nx">linewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span>
    <span class="p">});</span>

    <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Line</span><span class="p">(</span><span class="nx">lineGeometry</span><span class="p">,</span> <span class="nx">lineBasicMaterialCOL</span><span class="p">);</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">isLine</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">isRectangle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">isBox</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">isCylinder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">isAmbientLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">isPointLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">isSphere</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">linesPool</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">mesh</span><span class="p">);</span>
    <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">mesh</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>worldMatrix.setRotationFromEuler(new THREE.Vector3(a,b,c));</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">currentStrokeAlpha</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">linewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">usedLines</span><span class="o">++</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>odd things happen setting scale to zero</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixAutoUpdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">worldMatrix</span><span class="p">);</span>
  <span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixWorldNeedsUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>TODO Note that lines have a "solid fill" mode
and something similar to the normalMaterial mode
but there is no equivalent to the lambert material
mode.
That could be done by somehow mixing the color of
an ambient light to the color of the stroke
(although which ambient light do you pick if there
is more than one?)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>color: currentStrokeColor,</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">currentStrokeColor</span> <span class="o">===</span> <span class="nx">angleColor</span> <span class="o">||</span> <span class="nx">defaultNormalStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sasaas</span> <span class="o">=</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">multiplyVector3</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)).</span><span class="nx">normalize</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sasaas</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">sasaas</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">sasaas</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">color</span><span class="p">(((</span><span class="nx">sasaas</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="p">((</span><span class="nx">sasaas</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="p">((</span><span class="nx">sasaas</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span><span class="p">));</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">currentStrokeColor</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>mesh.geometry = lineGeometry;
mesh.material = lineBasicMaterialCOL;
mesh.material.color.setHex(currentStrokeColor);</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">ambientColor</span> <span class="o">=</span> <span class="nx">color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>old unpooled mechanism
var mesh = new THREE.Line(lineGeometry, lineBasicMaterialCOL);</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">reflectValue</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>in theory the docs say that we should change the boundradius
but I don't think that we need it...
mesh.boundRadiusScale = Math.max(a,b,c);</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">refractValue</span> <span class="o">=</span> <span class="mf">0.98</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>setting the color after the geometry has been dealt with
because in case we use the angleColor then we
need to know the geometry.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">lightsAreOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">lights</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">lightsAreOn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">noLights</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">lightsAreOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">rect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>ambientColor is always white
because it needs to reflect what the
ambient light color is
I tried to set the ambientColor directly
but it doesn't work. It needs to be white so
that the tint of the ambientLight is shown. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>ambient = function(a) {
ambientColor = a;
}</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="nx">doStroke</span> <span class="o">||</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">defaultNormalFill</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">defaultNormalStroke</span> <span class="o">&amp;&amp;</span> <span class="nx">currentStrokeColor</span> <span class="o">===</span> <span class="nx">currentFillColor</span> <span class="o">&amp;&amp;</span> <span class="nx">currentFillAlpha</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">currentStrokeAlpha</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">||</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">defaultNormalFill</span> <span class="o">&amp;&amp;</span> <span class="nx">defaultNormalStroke</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>reflect = function(a) {
 reflectValue = a;
}</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;si: &quot;</span> <span class="o">+</span> <span class="nx">startIndex</span> <span class="o">+</span> <span class="s2">&quot; endI: &quot;</span> <span class="o">+</span> <span class="nx">endIndex</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">strokeTime</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">colorToBeUsed</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">newRectCreated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>refract = function(a) {
 refractValue = a;
}</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">fillAndStroke</span> <span class="o">=</span> <span class="nx">startIndex</span><span class="p">;</span> <span class="nx">fillAndStroke</span> <span class="o">&lt;</span> <span class="nx">endIndex</span><span class="p">;</span> <span class="nx">fillAndStroke</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fillAndStroke</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">strokeTime</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">currentStrokeColor</span><span class="p">;</span>
      <span class="nx">alphaToBeUsed</span> <span class="o">=</span> <span class="nx">currentStrokeAlpha</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">currentFillColor</span><span class="p">;</span>
      <span class="nx">alphaToBeUsed</span> <span class="o">=</span> <span class="nx">currentFillAlpha</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">pooledRectangle</span> <span class="o">=</span> <span class="nx">rectanglesPool</span><span class="p">[</span><span class="nx">usedRectangles</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>simple case - if there is no fill and
no stroke then there is nothing to do.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pooledRectangle</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">basicMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">lambertMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">normalMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>if the wireframe is not going to be visible on top of the
fill then don't draw it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">neverUsed</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">mesh</span><span class="o">:</span> <span class="kc">undefined</span>
      <span class="p">};</span>
      <span class="nx">newRectCreated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">rectanglesPool</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strokeTime</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaultNormalFill</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaultNormalStroke</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;rect: default normal color: &quot;</span> <span class="o">+</span> <span class="nx">applyDefaultNormalColor</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;rect: alphaToBeUsed: &quot;</span> <span class="o">+</span> <span class="nx">alphaToBeUsed</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">neverUsed</span> <span class="o">||</span> <span class="p">(</span><span class="nx">colorToBeUsed</span> <span class="o">===</span> <span class="nx">angleColor</span> <span class="o">||</span> <span class="nx">applyDefaultNormalColor</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>if (doStroke) console.log('smart optimisation, was supposed to do the stroke but not doing it!!');</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">neverUsed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">normalMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;creating normal material&quot;</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">normalMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshNormalMaterial</span><span class="p">({</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">planeGeometry</span><span class="p">,</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;associating normal material to existing mesh&quot;</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lightsAreOn</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;rect: lights are not on&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
          <span class="nx">color</span><span class="o">:</span> <span class="nx">colorToBeUsed</span><span class="p">,</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">planeGeometry</span><span class="p">,</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>this is to run the code twice. This should be neater
and turned into a function call really.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;rect: lights are on&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;creating lambert:&quot;</span><span class="o">+</span><span class="nx">currentFillColor</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">currentFillAlpha</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">ambientColor</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">reflectValue</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">refractValue</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshLambertMaterial</span><span class="p">({</span>
          <span class="nx">color</span><span class="o">:</span> <span class="nx">colorToBeUsed</span><span class="p">,</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">ambient</span><span class="o">:</span> <span class="nx">ambientColor</span><span class="p">,</span>
          <span class="nx">reflectivity</span><span class="o">:</span> <span class="nx">reflectValue</span><span class="p">,</span>
          <span class="nx">refractionRatio</span><span class="o">:</span> <span class="nx">refractValue</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">ambient</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">ambientColor</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">reflectivity</span> <span class="o">=</span> <span class="nx">reflectValue</span><span class="p">;</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">refractionRatio</span> <span class="o">=</span> <span class="nx">refractValue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">planeGeometry</span><span class="p">,</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">);</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">resetTheSpinThingy</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="nx">resetTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span><span class="p">)</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isLine</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isRectangle</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isBox</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isCylinder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isAmbientLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isPointLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isSphere</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>


    <span class="nx">usedRectangles</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span> <span class="o">&amp;&amp;</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pushMatrix</span><span class="p">();</span>
      <span class="nx">rotate</span><span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">/</span> <span class="mi">50</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixAutoUpdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">worldMatrix</span><span class="p">);</span>
    <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixWorldNeedsUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span> <span class="o">&amp;&amp;</span> <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">popMatrix</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">b</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">newRectCreated</span><span class="p">)</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pooledRectangle</span><span class="p">.</span><span class="nx">mesh</span><span class="p">);</span>

  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">ambientLight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">colorToBeUsed</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>each pooled rectangle contains a geometry,
a basic material and a lambert material.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">color$1</span><span class="p">(</span><span class="mi">125</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">color</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">newLightCreated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">lightsAreOn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">defaultNormalFill</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">defaultNormalStroke</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">pooledAmbientLight</span> <span class="o">=</span> <span class="nx">ambientLightsPool</span><span class="p">[</span><span class="nx">usedAmbientLights</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">pooledAmbientLight</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;no ambientLight in pool, creating one&#39;</span><span class="p">);</span>
    <span class="nx">pooledAmbientLight</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">AmbientLight</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
    <span class="nx">newLightCreated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">ambientLightsPool</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pooledAmbientLight</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;existing ambientLight in pool, setting color: &#39;</span> <span class="o">+</span> <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">r</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">g</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">b</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">isLine</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">isRectangle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">isBox</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">isCylinder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">isAmbientLight</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">isPointLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">isSphere</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


  <span class="nx">usedAmbientLights</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">matrixAutoUpdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">worldMatrix</span><span class="p">);</span>
  <span class="nx">pooledAmbientLight</span><span class="p">.</span><span class="nx">matrixWorldNeedsUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">newLightCreated</span><span class="p">)</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pooledAmbientLight</span><span class="p">);</span>


<span class="p">}</span>

<span class="kd">var</span> <span class="nx">gradStack</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">defaultGradientColor1</span> <span class="o">=</span> <span class="nx">orange</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">defaultGradientColor2</span> <span class="o">=</span> <span class="nx">red</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">defaultGradientColor3</span> <span class="o">=</span> <span class="nx">black</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">whichDefaultBackground</span><span class="p">;</span>

<span class="nx">pickRandomDefaultGradient</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">whichDefaultBackground</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">whichDefaultBackground</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">whichDefaultBackground</span> <span class="o">=</span> <span class="p">(</span><span class="nx">whichDefaultBackground</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">whichDefaultBackground</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defaultGradientColor1</span> <span class="o">=</span> <span class="nx">orange</span><span class="p">;</span>
    <span class="nx">defaultGradientColor2</span> <span class="o">=</span> <span class="nx">red</span><span class="p">;</span>
    <span class="nx">defaultGradientColor3</span> <span class="o">=</span> <span class="nx">black</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#fakeStartingBlinkingCursor&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichDefaultBackground</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defaultGradientColor1</span> <span class="o">=</span> <span class="nx">white</span><span class="p">;</span>
    <span class="nx">defaultGradientColor2</span> <span class="o">=</span> <span class="nx">khaki</span><span class="p">;</span>
    <span class="nx">defaultGradientColor3</span> <span class="o">=</span> <span class="nx">peachpuff</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#fakeStartingBlinkingCursor&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;LightPink&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichDefaultBackground</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defaultGradientColor1</span> <span class="o">=</span> <span class="nx">lightsteelblue</span><span class="p">;</span>
    <span class="nx">defaultGradientColor2</span> <span class="o">=</span> <span class="nx">lightcyan</span><span class="p">;</span>
    <span class="nx">defaultGradientColor3</span> <span class="o">=</span> <span class="nx">paleturquoise</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#fakeStartingBlinkingCursor&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;CadetBlue&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichDefaultBackground</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defaultGradientColor1</span> <span class="o">=</span> <span class="nx">silver</span><span class="p">;</span>
    <span class="nx">defaultGradientColor2</span> <span class="o">=</span> <span class="nx">lightgrey</span><span class="p">;</span>
    <span class="nx">defaultGradientColor3</span> <span class="o">=</span> <span class="nx">gainsboro</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#fakeStartingBlinkingCursor&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichDefaultBackground</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">defaultGradientColor1</span> <span class="o">=</span> <span class="nx">color</span><span class="p">(</span><span class="mi">155</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="p">);</span>
    <span class="nx">defaultGradientColor2</span> <span class="o">=</span> <span class="nx">color</span><span class="p">(</span><span class="mi">155</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="p">);</span>
    <span class="nx">defaultGradientColor3</span> <span class="o">=</span> <span class="nx">color</span><span class="p">(</span><span class="mi">155</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">155</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#fakeStartingBlinkingCursor&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;DarkOliveGreen&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resetGradientStack</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">currentGradientStackValue</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>the first time we render a mesh we need to
render it with the material that takes the
bigger buffer space, otherwise the
more complicated materials won't show
up, see:
https://github.com/mrdoob/three.js/issues/1051
so we always need to create a normalmaterial
and render that material first, in case
the user will ever want to use it.
Another workaround would be to create a mesh
for each different type of material</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">gradStack</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>the first time we render a mesh we need to
render it with the material that takes the
bigger buffer space, see:
https://github.com/mrdoob/three.js/issues/1051
Another workaround would be to create a mesh
for each different type of material</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">simpleGradient</span><span class="p">(</span><span class="nx">defaultGradientColor1</span><span class="p">,</span> <span class="nx">defaultGradientColor2</span><span class="p">,</span> <span class="nx">defaultGradientColor3</span><span class="p">);</span>

<span class="p">}</span>

<span class="nx">background</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">color</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;adding solid background to stack&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>lights are on</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">currentGradientStackValue</span> <span class="o">=</span> <span class="nx">currentGradientStackValue</span> <span class="o">+</span> <span class="s2">&quot; null null null null &quot;</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">;</span>
  <span class="nx">gradStack</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
    <span class="nx">gradStacka</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">gradStackb</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">gradStackc</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">gradStackd</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">solid</span><span class="o">:</span> <span class="nx">a</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">simpleGradient</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">currentGradientStackValue</span> <span class="o">=</span> <span class="nx">currentGradientStackValue</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">c</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">d</span> <span class="o">+</span> <span class="s2">&quot;null &quot;</span><span class="p">;</span>
  <span class="nx">gradStack</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
    <span class="nx">gradStacka</span><span class="o">:</span> <span class="nx">a</span><span class="p">,</span>
    <span class="nx">gradStackb</span><span class="o">:</span> <span class="nx">b</span><span class="p">,</span>
    <span class="nx">gradStackc</span><span class="o">:</span> <span class="nx">c</span><span class="p">,</span>
    <span class="nx">gradStackd</span><span class="o">:</span> <span class="nx">d</span><span class="p">,</span>
    <span class="nx">solid</span><span class="o">:</span> <span class="kc">null</span>
  <span class="p">});</span>

<span class="p">}</span>

<span class="kd">var</span> <span class="nx">simpleGradientUpdateIfChanged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>empty arguments gives some sort
of grey ambient light.
black is too stark and white
doesn't show the effect with the
default white fill</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">((</span><span class="nx">currentGradientStackValue</span> <span class="o">===</span> <span class="nx">previousGradientStackValue</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="nx">previousGradientStackValue</span> <span class="o">=</span> <span class="nx">currentGradientStackValue</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;repainting background&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">diagonal</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">scaledBackgroundWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">scaledBackgroundHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
      <span class="kd">var</span> <span class="nx">radgrad</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">scanningGradStack</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">scanningGradStack</span> <span class="o">&lt;</span> <span class="nx">gradStack</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">scanningGradStack</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">gradStack</span><span class="p">[</span><span class="nx">scanningGradStack</span><span class="p">].</span><span class="nx">gradStacka</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">radgrad</span> <span class="o">=</span> <span class="nx">backgroundSceneContext</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="nx">scaledBackgroundWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">scaledBackgroundWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">scaledBackgroundHeight</span><span class="p">);</span>
          <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">gradStack</span><span class="p">[</span><span class="nx">scanningGradStack</span><span class="p">].</span><span class="nx">gradStacka</span><span class="p">));</span>
          <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">gradStack</span><span class="p">[</span><span class="nx">scanningGradStack</span><span class="p">].</span><span class="nx">gradStackb</span><span class="p">));</span>
          <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">gradStack</span><span class="p">[</span><span class="nx">scanningGradStack</span><span class="p">].</span><span class="nx">gradStackc</span><span class="p">));</span>

          <span class="nx">backgroundSceneContext</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
          <span class="nx">backgroundSceneContext</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">radgrad</span><span class="p">;</span>
          <span class="nx">backgroundSceneContext</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">scaledBackgroundWidth</span><span class="p">,</span> <span class="nx">scaledBackgroundHeight</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;solid background: &quot;</span><span class="o">+</span> <span class="nx">gradStack</span><span class="p">[</span><span class="nx">scanningGradStack</span><span class="p">].</span><span class="nx">solid</span><span class="p">);</span>
          <span class="nx">backgroundSceneContext</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
          <span class="nx">backgroundSceneContext</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">color</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">gradStack</span><span class="p">[</span><span class="nx">scanningGradStack</span><span class="p">].</span><span class="nx">solid</span><span class="p">);</span>
          <span class="nx">backgroundSceneContext</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">scaledBackgroundWidth</span><span class="p">,</span> <span class="nx">scaledBackgroundHeight</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">}</span>


<span class="nx">animationStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>we could be more efficient and
reuse the previous stack elements
but I don't think it matters here</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="nx">animationStyleValue</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">}</span>


<span class="nx">animationStyleUpdateIfChanged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>simpleGradient(color(70),color(30),color(0),1);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">((</span><span class="nx">animationStyleValue</span> <span class="o">!==</span> <span class="nx">previousanimationStyleValue</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>if (a===undefined) a = color(0);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>alert('simpleGradientUpdateIfChanged curr '+currentGradientStackValue + " prev " +previousGradientStackValue );</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">previousanimationStyleValue</span> <span class="o">=</span> <span class="nx">animationStyleValue</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">isWebGLUsed</span> <span class="o">&amp;&amp;</span> <span class="nx">animationStyleValue</span> <span class="o">===</span> <span class="nx">motionBlur</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">effectBlend</span><span class="p">.</span><span class="nx">uniforms</span><span class="p">[</span><span class="s1">&#39;mixRatio&#39;</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isWebGLUsed</span> <span class="o">&amp;&amp;</span> <span class="nx">animationStyleValue</span> <span class="o">===</span> <span class="nx">motionBlur</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">blendAmount</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>turns out when you type normal that the first two letters "no"
are sent as "false"</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">isWebGLUsed</span> <span class="o">&amp;&amp;</span> <span class="nx">animationStyleValue</span> <span class="o">===</span> <span class="nx">paintOver</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">effectBlend</span><span class="p">.</span><span class="nx">uniforms</span><span class="p">[</span><span class="s1">&#39;mixRatio&#39;</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isWebGLUsed</span> <span class="o">&amp;&amp;</span> <span class="nx">animationStyleValue</span> <span class="o">===</span> <span class="nx">paintOver</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">blendAmount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>alert("actual called " + a);</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">isWebGLUsed</span> <span class="o">&amp;&amp;</span> <span class="nx">animationStyleValue</span> <span class="o">===</span> <span class="nx">normal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">effectBlend</span><span class="p">.</span><span class="nx">uniforms</span><span class="p">[</span><span class="s1">&#39;mixRatio&#39;</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isWebGLUsed</span> <span class="o">&amp;&amp;</span> <span class="nx">animationStyleValue</span> <span class="o">===</span> <span class="nx">normal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">blendAmount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>alert("actual changed!");</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span>

<span class="p">}</span>


<span class="nx">box</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>alert("no change");</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>alert('motion blur canvas');</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="nx">doStroke</span> <span class="o">||</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">defaultNormalFill</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">defaultNormalStroke</span> <span class="o">&amp;&amp;</span> <span class="nx">currentStrokeColor</span> <span class="o">===</span> <span class="nx">currentFillColor</span> <span class="o">&amp;&amp;</span> <span class="nx">currentFillAlpha</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">currentStrokeAlpha</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">||</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">defaultNormalFill</span> <span class="o">&amp;&amp;</span> <span class="nx">defaultNormalStroke</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>alert('paintOver canvas');</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;si: &quot;</span> <span class="o">+</span> <span class="nx">startIndex</span> <span class="o">+</span> <span class="s2">&quot; endI: &quot;</span> <span class="o">+</span> <span class="nx">endIndex</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>alert('normal canvas');</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">strokeTime</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">colorToBeUsed</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">newBoxCreated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>simple case - if there is no fill and
no stroke then there is nothing to do.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">fillAndStroke</span> <span class="o">=</span> <span class="nx">startIndex</span><span class="p">;</span> <span class="nx">fillAndStroke</span> <span class="o">&lt;</span> <span class="nx">endIndex</span><span class="p">;</span> <span class="nx">fillAndStroke</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fillAndStroke</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">strokeTime</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">currentStrokeColor</span><span class="p">;</span>
      <span class="nx">alphaToBeUsed</span> <span class="o">=</span> <span class="nx">currentStrokeAlpha</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">currentFillColor</span><span class="p">;</span>
      <span class="nx">alphaToBeUsed</span> <span class="o">=</span> <span class="nx">currentFillAlpha</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">pooledBox</span> <span class="o">=</span> <span class="nx">boxesPool</span><span class="p">[</span><span class="nx">usedBoxes</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>if the wireframe is not going to be visible on top of the
fill then don't draw it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pooledBox</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">basicMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">lambertMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">normalMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>if (doStroke) console.log('smart optimisation, was supposed to do the stroke but not doing it!!');</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">neverUsed</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">mesh</span><span class="o">:</span> <span class="kc">undefined</span>
      <span class="p">};</span>
      <span class="nx">newBoxCreated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">boxesPool</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pooledBox</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strokeTime</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaultNormalFill</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaultNormalStroke</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">neverUsed</span> <span class="o">||</span> <span class="p">(</span><span class="nx">colorToBeUsed</span> <span class="o">===</span> <span class="nx">angleColor</span> <span class="o">||</span> <span class="nx">applyDefaultNormalColor</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>alert('cube!')</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">neverUsed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">normalMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;creating normal material&quot;</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">normalMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshNormalMaterial</span><span class="p">({</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">cubeGeometry</span><span class="p">,</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;associating normal material to existing mesh&quot;</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lightsAreOn</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
          <span class="nx">color</span><span class="o">:</span> <span class="nx">colorToBeUsed</span><span class="p">,</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">cubeGeometry</span><span class="p">,</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>this is to run the code twice. This should be neater
and turned into a function call really.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;creating lambert:&quot;</span><span class="o">+</span><span class="nx">currentFillColor</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">currentFillAlpha</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">ambientColor</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">reflectValue</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">refractValue</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshLambertMaterial</span><span class="p">({</span>
          <span class="nx">color</span><span class="o">:</span> <span class="nx">colorToBeUsed</span><span class="p">,</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">ambient</span><span class="o">:</span> <span class="nx">ambientColor</span><span class="p">,</span>
          <span class="nx">reflectivity</span><span class="o">:</span> <span class="nx">reflectValue</span><span class="p">,</span>
          <span class="nx">refractionRatio</span><span class="o">:</span> <span class="nx">refractValue</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">ambient</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">ambientColor</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">reflectivity</span> <span class="o">=</span> <span class="nx">reflectValue</span><span class="p">;</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">refractionRatio</span> <span class="o">=</span> <span class="nx">refractValue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">cubeGeometry</span><span class="p">,</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">);</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">resetTheSpinThingy</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="nx">resetTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span><span class="p">)</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isLine</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isRectangle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isBox</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isCylinder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isAmbientLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isPointLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isSphere</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


    <span class="nx">usedBoxes</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span> <span class="o">&amp;&amp;</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pushMatrix</span><span class="p">();</span>
      <span class="nx">rotate</span><span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">/</span> <span class="mi">50</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixAutoUpdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">worldMatrix</span><span class="p">);</span>
    <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixWorldNeedsUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span> <span class="o">&amp;&amp;</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">popMatrix</span><span class="p">();</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>each pooled box contains a geometry,
a basic material and a lambert material.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">b</span> <span class="o">!==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strokeTime</span><span class="p">)</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">));</span>
      <span class="k">else</span> <span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="nx">b</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="nx">c</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">newBoxCreated</span><span class="p">)</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pooledBox</span><span class="p">.</span><span class="nx">mesh</span><span class="p">);</span>
  <span class="p">}</span>


<span class="p">}</span>


<span class="nx">peg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>the first time we render a mesh we need to
render it with the material that takes the
bigger buffer space, otherwise the
more complicated materials won't show
up, see:
https://github.com/mrdoob/three.js/issues/1051
so we always need to create a normalmaterial
and render that material first, in case
the user will ever want to use it.
Another workaround would be to create a mesh
for each different type of material</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>the first time we render a mesh we need to
render it with the material that takes the
bigger buffer space, see:
https://github.com/mrdoob/three.js/issues/1051
Another workaround would be to create a mesh
for each different type of material</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="nx">doStroke</span> <span class="o">||</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">defaultNormalFill</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">defaultNormalStroke</span> <span class="o">&amp;&amp;</span> <span class="nx">currentStrokeColor</span> <span class="o">===</span> <span class="nx">currentFillColor</span> <span class="o">&amp;&amp;</span> <span class="nx">currentFillAlpha</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">currentStrokeAlpha</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">||</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">defaultNormalFill</span> <span class="o">&amp;&amp;</span> <span class="nx">defaultNormalStroke</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>lights are on</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;si: &quot;</span> <span class="o">+</span> <span class="nx">startIndex</span> <span class="o">+</span> <span class="s2">&quot; endI: &quot;</span> <span class="o">+</span> <span class="nx">endIndex</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>TODO: meshes should be built from geometries that are
ever so slight larger than the "fill" mesh so there
is no z-fighting...
constant 0.001 below is to avoid z-fighting</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">strokeTime</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">colorToBeUsed</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">newCylinderCreated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>simple case - if there is no fill and
no stroke then there is nothing to do.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">fillAndStroke</span> <span class="o">=</span> <span class="nx">startIndex</span><span class="p">;</span> <span class="nx">fillAndStroke</span> <span class="o">&lt;</span> <span class="nx">endIndex</span><span class="p">;</span> <span class="nx">fillAndStroke</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fillAndStroke</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">strokeTime</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">currentStrokeColor</span><span class="p">;</span>
      <span class="nx">alphaToBeUsed</span> <span class="o">=</span> <span class="nx">currentStrokeAlpha</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">currentFillColor</span><span class="p">;</span>
      <span class="nx">alphaToBeUsed</span> <span class="o">=</span> <span class="nx">currentFillAlpha</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">pooledCylinder</span> <span class="o">=</span> <span class="nx">cylindersPool</span><span class="p">[</span><span class="nx">usedCylinders</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>if the wireframe is not going to be visible on top of the
fill then don't draw it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pooledCylinder</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">basicMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">lambertMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">normalMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>if (doStroke) console.log('smart optimisation, was supposed to do the stroke but not doing it!!');</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">neverUsed</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">mesh</span><span class="o">:</span> <span class="kc">undefined</span>
      <span class="p">};</span>
      <span class="nx">newCylinderCreated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">cylindersPool</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strokeTime</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaultNormalFill</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaultNormalStroke</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">neverUsed</span> <span class="o">||</span> <span class="p">(</span><span class="nx">colorToBeUsed</span> <span class="o">===</span> <span class="nx">angleColor</span> <span class="o">||</span> <span class="nx">applyDefaultNormalColor</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>alert('cube!')</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">neverUsed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">normalMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;creating normal material&quot;</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">normalMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshNormalMaterial</span><span class="p">({</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span><span class="p">,</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">cylinderGeometry</span><span class="p">,</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;associating normal material to existing mesh&quot;</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lightsAreOn</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
          <span class="nx">color</span><span class="o">:</span> <span class="nx">colorToBeUsed</span><span class="p">,</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span><span class="p">,</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">cylinderGeometry</span><span class="p">,</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>this is to run the code twice. This should be neater
and turned into a function call really.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;creating lambert:&quot;</span><span class="o">+</span><span class="nx">currentFillColor</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">currentFillAlpha</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">ambientColor</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">reflectValue</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">refractValue</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshLambertMaterial</span><span class="p">({</span>
          <span class="nx">color</span><span class="o">:</span> <span class="nx">colorToBeUsed</span><span class="p">,</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">ambient</span><span class="o">:</span> <span class="nx">ambientColor</span><span class="p">,</span>
          <span class="nx">reflectivity</span><span class="o">:</span> <span class="nx">reflectValue</span><span class="p">,</span>
          <span class="nx">refractionRatio</span><span class="o">:</span> <span class="nx">refractValue</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span><span class="p">,</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">ambient</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">ambientColor</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">reflectivity</span> <span class="o">=</span> <span class="nx">reflectValue</span><span class="p">;</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">refractionRatio</span> <span class="o">=</span> <span class="nx">refractValue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">cylinderGeometry</span><span class="p">,</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">);</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">resetTheSpinThingy</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="nx">resetTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span><span class="p">)</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isLine</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isRectangle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isBox</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isCylinder</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isAmbientLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isPointLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isSphere</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


    <span class="nx">usedCylinders</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span> <span class="o">&amp;&amp;</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pushMatrix</span><span class="p">();</span>
      <span class="nx">rotate</span><span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">/</span> <span class="mi">50</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span><span class="p">);</span>      
    <span class="p">}</span>

    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixAutoUpdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">worldMatrix</span><span class="p">);</span>
    <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixWorldNeedsUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span> <span class="o">&amp;&amp;</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">popMatrix</span><span class="p">();</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>each pooled cylinder contains a geometry,
a basic material and a lambert material.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">b</span> <span class="o">!==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strokeTime</span><span class="p">)</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">));</span>
      <span class="k">else</span> <span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="nx">b</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="nx">c</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">newCylinderCreated</span><span class="p">)</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pooledCylinder</span><span class="p">.</span><span class="nx">mesh</span><span class="p">);</span>
  <span class="p">}</span>


<span class="p">}</span>


<span class="nx">ballDetail</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
  <span class="nx">ballDetLevel</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">ball</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">pooledSphereGeometry</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>the first time we render a mesh we need to
render it with the material that takes the
bigger buffer space, otherwise the
more complicated materials won't show
up, see:
https://github.com/mrdoob/three.js/issues/1051
so we always need to create a normalmaterial
and render that material first, in case
the user will ever want to use it.
Another workaround would be to create a mesh
for each different type of material</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;fill: &quot;</span><span class="o">+</span><span class="nx">doFill</span><span class="o">+</span><span class="s2">&quot; stroke: &quot;</span><span class="o">+</span><span class="nx">doStroke</span><span class="o">+</span><span class="s2">&quot; fillCol &quot;</span> <span class="o">+</span> <span class="nx">currentFillColor</span> <span class="o">+</span> <span class="s2">&quot; stroke col &quot;</span> <span class="o">+</span> <span class="nx">currentStrokeColor</span> <span class="o">+</span> <span class="s2">&quot; fill alpha &quot;</span> <span class="o">+</span> <span class="nx">currentFillAlpha</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>the first time we render a mesh we need to
render it with the material that takes the
bigger buffer space, see:
https://github.com/mrdoob/three.js/issues/1051
Another workaround would be to create a mesh
for each different type of material</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="nx">doStroke</span> <span class="o">||</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">defaultNormalFill</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">defaultNormalStroke</span> <span class="o">&amp;&amp;</span> <span class="nx">currentStrokeColor</span> <span class="o">===</span> <span class="nx">currentFillColor</span> <span class="o">&amp;&amp;</span> <span class="nx">currentFillAlpha</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">currentStrokeAlpha</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">||</span> <span class="p">(</span><span class="nx">currentStrokeSize</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">defaultNormalFill</span> <span class="o">&amp;&amp;</span> <span class="nx">defaultNormalStroke</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>lights are on</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doFill</span> <span class="o">&amp;&amp;</span> <span class="nx">doStroke</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;si: &quot;</span> <span class="o">+</span> <span class="nx">startIndex</span> <span class="o">+</span> <span class="s2">&quot; endI: &quot;</span> <span class="o">+</span> <span class="nx">endIndex</span> <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>TODO: meshes should be built from geometries that are
ever so slight larger than the "fill" mesh so there
is no z-fighting...
constant 0.001 below is to avoid z-fighting</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">strokeTime</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">colorToBeUsed</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">newSphereCreated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>simple case - if there is no fill and
no stroke then there is nothing to do.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">fillAndStroke</span> <span class="o">=</span> <span class="nx">startIndex</span><span class="p">;</span> <span class="nx">fillAndStroke</span> <span class="o">&lt;</span> <span class="nx">endIndex</span><span class="p">;</span> <span class="nx">fillAndStroke</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fillAndStroke</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">strokeTime</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">currentStrokeColor</span><span class="p">;</span>
      <span class="nx">alphaToBeUsed</span> <span class="o">=</span> <span class="nx">currentStrokeAlpha</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">colorToBeUsed</span> <span class="o">=</span> <span class="nx">currentFillColor</span><span class="p">;</span>
      <span class="nx">alphaToBeUsed</span> <span class="o">=</span> <span class="nx">currentFillAlpha</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">spheresPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">spheresPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;creating pool for ball det level &#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">usedSpheres</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">usedSpheres</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;creating counter for ball det level &#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">pooledSphere</span> <span class="o">=</span> <span class="nx">spheresPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">][</span><span class="nx">usedSpheres</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>if the wireframe is not going to be visible on top of the
fill then don't draw it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pooledSphere</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">basicMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">lambertMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="nx">normalMaterial</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>if (doStroke) console.log('smart optimisation, was supposed to do the stroke but not doing it!!');</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">neverUsed</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">mesh</span><span class="o">:</span> <span class="kc">undefined</span>
      <span class="p">};</span>
      <span class="nx">newSphereCreated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">spheresPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">pooledSphere</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;making space for pool for sphere , size of pool for spheres of detail &#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span> <span class="o">+</span> <span class="s1">&#39; is &#39;</span> <span class="o">+</span> <span class="nx">spheresPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">+</span><span class="nx">ballDetLevel</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strokeTime</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaultNormalFill</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">defaultNormalStroke</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">applyDefaultNormalColor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">neverUsed</span> <span class="o">||</span> <span class="p">(</span><span class="nx">colorToBeUsed</span> <span class="o">===</span> <span class="nx">angleColor</span> <span class="o">||</span> <span class="nx">applyDefaultNormalColor</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>alert('ball!')</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">neverUsed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">normalMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;creating normal material&quot;</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">normalMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshNormalMaterial</span><span class="p">({</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span><span class="p">,</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledSphereGeometry</span> <span class="o">=</span> <span class="nx">sphereGeometriesPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphereGeometry</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pooledSphereGeometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ballDetLevel</span><span class="p">,</span> <span class="nx">ballDetLevel</span><span class="p">);</span>
          <span class="nx">sphereGeometriesPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pooledSphereGeometry</span><span class="p">;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;creating ball geometry of detail &#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">pooledSphereGeometry</span><span class="p">,</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;associating normal material to existing mesh&quot;</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">normalMaterial</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lightsAreOn</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
          <span class="nx">color</span><span class="o">:</span> <span class="nx">colorToBeUsed</span><span class="p">,</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span><span class="p">,</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledSphereGeometry</span> <span class="o">=</span> <span class="nx">sphereGeometriesPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphereGeometry</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pooledSphereGeometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ballDetLevel</span><span class="p">,</span> <span class="nx">ballDetLevel</span><span class="p">);</span>
          <span class="nx">sphereGeometriesPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pooledSphereGeometry</span><span class="p">;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;creating ball geometry of detail &#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">pooledSphereGeometry</span><span class="p">,</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">basicMaterial</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>this is to run the code twice. This should be neater
and turned into a function call really.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;creating lambert:&quot;</span><span class="o">+</span><span class="nx">currentFillColor</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">currentFillAlpha</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">ambientColor</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">reflectValue</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">refractValue</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshLambertMaterial</span><span class="p">({</span>
          <span class="nx">color</span><span class="o">:</span> <span class="nx">colorToBeUsed</span><span class="p">,</span>
          <span class="nx">opacity</span><span class="o">:</span> <span class="nx">alphaToBeUsed</span><span class="p">,</span>
          <span class="nx">ambient</span><span class="o">:</span> <span class="nx">ambientColor</span><span class="p">,</span>
          <span class="nx">reflectivity</span><span class="o">:</span> <span class="nx">reflectValue</span><span class="p">,</span>
          <span class="nx">refractionRatio</span><span class="o">:</span> <span class="nx">refractValue</span><span class="p">,</span>
          <span class="nx">wireframe</span><span class="o">:</span> <span class="nx">strokeTime</span><span class="p">,</span>
          <span class="nx">wireframeLinewidth</span><span class="o">:</span> <span class="nx">currentStrokeSize</span><span class="p">,</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">colorToBeUsed</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="nx">alphaToBeUsed</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">wireframe</span> <span class="o">=</span> <span class="nx">strokeTime</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">wireframeLinewidth</span> <span class="o">=</span> <span class="nx">currentStrokeSize</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">ambient</span><span class="p">.</span><span class="nx">setHex</span><span class="p">(</span><span class="nx">ambientColor</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">reflectivity</span> <span class="o">=</span> <span class="nx">reflectValue</span><span class="p">;</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">.</span><span class="nx">refractionRatio</span> <span class="o">=</span> <span class="nx">refractValue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pooledSphereGeometry</span> <span class="o">=</span> <span class="nx">sphereGeometriesPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphereGeometry</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">pooledSphereGeometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ballDetLevel</span><span class="p">,</span> <span class="nx">ballDetLevel</span><span class="p">);</span>
          <span class="nx">sphereGeometriesPool</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pooledSphereGeometry</span><span class="p">;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;creating ball geometry of detail &#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">pooledSphereGeometry</span><span class="p">,</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">);</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">lambertMaterial</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">resetTheSpinThingy</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">=</span> <span class="nx">SPINFRAMES</span><span class="p">;</span>
      <span class="nx">resetTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span><span class="p">)</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isLine</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isRectangle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isBox</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isCylinder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isAmbientLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isPointLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">isSphere</span> <span class="o">=</span> <span class="nx">ballDetLevel</span><span class="p">;</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">doubleSided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


    <span class="nx">usedSpheres</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">=</span> <span class="nx">usedSpheres</span><span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">ballDetLevel</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span> <span class="o">&amp;&amp;</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pushMatrix</span><span class="p">();</span>
      <span class="nx">rotate</span><span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">/</span> <span class="mi">50</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span><span class="p">);</span>      
    <span class="p">}</span>

    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixAutoUpdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="nx">worldMatrix</span><span class="p">);</span>
    <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrixWorldNeedsUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">doTheSpinThingy</span> <span class="o">&amp;&amp;</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">startCountdown</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">popMatrix</span><span class="p">();</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>each pooled sphere contains a geometry,
a basic material and a lambert material.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strokeTime</span><span class="p">)</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">a</span><span class="p">));</span>
      <span class="k">else</span> <span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="nx">a</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="nx">a</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">newSphereCreated</span><span class="p">)</span> <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pooledSphere</span><span class="p">.</span><span class="nx">mesh</span><span class="p">);</span>
  <span class="p">}</span>


<span class="p">}</span>



<span class="cm">/**</span>
<span class="cm"> * extend the Number prototype</span>
<span class="cm"> * @param func</span>
<span class="cm"> * @param scope [optional]</span>
<span class="cm"> */</span>
<span class="nb">Number</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">times</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">scope</span> <span class="o">||</span> <span class="nb">window</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>


<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">simpleCubeDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// there you go!\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// a simple cube!\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;background yellow\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,time/2000,time/2000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webgltwocubesDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;background 155,255,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;2 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0, 1, time/2000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">cubesAndSpikes</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;simpleGradient fuchsia,color(100,200,200),yellow\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 2.1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,time/5000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box 0.1,0.1,0.1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0,0.1,0.1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box 0.01,0.01,1&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglturbineDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;background 155,55,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;70 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/100000,1,time/100000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglzfightartDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Explore the artifacts\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// of your GPU!\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Go Z-fighting, go!\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fill red\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0.000001\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fill yellow\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">littleSpiralOfCubes</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;background orange\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 0.1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;10 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,time/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 1,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">tentacleDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;background 155,255,155\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 0.15\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;10 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,time/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 0.9\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 1,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">lampDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;animationStyle motionBlur\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;simpleGradient red,yellow,color(255,0,255)\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//animationStyle paintOver\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/4000, time/4000,  time/4000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;90 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/200000, time/200000,  time/200000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;line\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;line\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move -0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;line\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;line&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">trillionfeathersDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;animationStyle paintOver\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 2,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;20 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0.25,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;line\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move -0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;line&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">monsterblobDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ballDetail 6\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;animationStyle motionBlur\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/5000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;simpleGradient fuchsia,aqua,yellow\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,time/5000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0.2,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ball -1&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">industrialMusicDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;bpm 350\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;addSound &#39;alienBeep&#39;  ,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;addSound &#39;beepC&#39;  ,&#39;zxzz zzzz xzzx xxxz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;addSound &#39;beepA&#39;  ,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;addSound &#39;lowFlash&#39;  ,&#39;zzxz zzzz zzzz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;addSound &#39;beepB&#39;  ,&#39;xzzx zzzz zxzz zxzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;addSound &#39;voltage&#39; ,&#39;xzxz zxzz xzxx xzxx&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;addSound &#39;tranceKick&#39; ,&#39;zxzx zzzx xzzz zzxx&#39;&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">trySoundsDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;bpm 350\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// leave this one as base\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;addSound &#39;tranceKick&#39; ,&#39;zxzx zzzx xzzz zzxx&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// uncomment the sounds you want to try\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;toc&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;highHatClosed&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;highHatOpen&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;toc2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;toc3&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;toc4&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;snare&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;snare2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;china&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;crash&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;crash2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;crash3&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;ride&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;glass&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;glass1&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;glass2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;glass3&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;thump&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;lowFlash&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;lowFlash2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;tranceKick2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;tranceKick&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;wosh&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;voltage&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;beepA&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;beepB&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;beepC&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;beepD&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;beep&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;hello&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//addSound &#39;alienBeep&#39;,&#39;zzxz zzzz zzxz zzzz&#39;&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">springysquaresDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;animationStyle motionBlur\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;simpleGradient fuchsia,color(100,200,200),yellow\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 0.3\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0,0,0.5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/2000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0.7,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rect&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">diceDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;animationStyle motionBlur\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;simpleGradient color(255),moccasin,peachpuff\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;stroke 255,100,100,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fill red,155\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;move -0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 0.3\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0,0,0.5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;1 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 2,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglalmostvoronoiDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 10\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;2 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,time/10000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ball -1&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglshardsDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 10\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fill 0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;strokeSize 7\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,time/20000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ball \n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ball -1.01&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglredthreadsDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 10.5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;background black\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;stroke red\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;noFill\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;strokeSize 7\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/20000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ball\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 0,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ball&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglnuclearOctopusDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;simpleGradient black,color(0,0,(time/5)%255),black\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 0.2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;animationStyle motionBlur\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//animationStyle paintOver\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;stroke 255,0,0,120\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fill time%255,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;pushMatrix\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;count = 0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;count++\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;pushMatrix\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate count+3+time/1000,2+count + time/1000,4+count\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;120 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 0.9\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 1,1,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/100\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;popMatrix&quot;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>the first time we render a mesh we need to
render it with the material that takes the
bigger buffer space, otherwise the
more complicated materials won't show
up, see:
https://github.com/mrdoob/three.js/issues/1051
so we always need to create a normalmaterial
and render that material first, in case
the user will ever want to use it.
Another workaround would be to create a mesh
for each different type of material</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">simpleCubeDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// there you go!\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// a simple cube!\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond jaune\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,temps/2000,temps/2000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webgltwocubesDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond 155,255,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;2 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0, 1, temps/2000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">cubesAndSpikes</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;dégradéSimple fuchsia,couleur(100,200,200),jaune\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 2.1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,temps/5000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite 0.1,0.1,0.1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0,0.1,0.1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite 0.01,0.01,1&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglturbineDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond 155,55,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;70 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/100000,1,temps/100000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglzfightartDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Explore the artifacts\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// of your GPU!\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Go Z-fighting, go!\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;remplissage rouge\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0.000001\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;remplissage jaune\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">littleSpiralOfCubes</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond orange\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 0.1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;10 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,temps/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 1,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">tentacleDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond 155,255,155\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 0.15\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;10 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,temps/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 0.9\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 1,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">lampDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;styleAnimation flouMouvement\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;dégradéSimple rouge,jaune,couleur(255,0,255)\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//styleAnimation peindreAuDessus\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/4000, temps/4000,  temps/4000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;90 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/200000, temps/200000,  temps/200000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace -0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">trillionfeathersDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;styleAnimation peindreAuDessus\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 2,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;20 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0.25,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace -0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">monsterblobDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;balleDetail 6\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;styleAnimation flouMouvement\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/5000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;dégradéSimple fuchsia,aqua,jaune\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,temps/5000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0.2,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;balle -1&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">industrialMusicDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;bpm 350\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ajouteSon &#39;alienBeep&#39;  ,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ajouteSon &#39;beepC&#39;  ,&#39;zxzz zzzz xzzx xxxz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ajouteSon &#39;beepA&#39;  ,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ajouteSon &#39;lowFlash&#39;  ,&#39;zzxz zzzz zzzz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ajouteSon &#39;beepB&#39;  ,&#39;xzzx zzzz zxzz zxzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ajouteSon &#39;voltage&#39; ,&#39;xzxz zxzz xzxx xzxx&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ajouteSon &#39;tranceKick&#39; ,&#39;zxzx zzzx xzzz zzxx&#39;&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">trySoundsDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;bpm 350\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// leave this one as base\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ajouteSon &#39;tranceKick&#39; ,&#39;zxzx zzzx xzzz zzxx&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// uncomment the sounds you want to try\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;toc&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;highHatClosed&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;highHatOpen&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;toc2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;toc3&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;toc4&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;snare&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;snare2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;china&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;crash&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;crash2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;crash3&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;ride&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;glass&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;glass1&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;glass2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;glass3&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;thump&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;lowFlash&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;lowFlash2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;tranceKick2&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;tranceKick&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;wosh&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;voltage&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;beepA&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;beepB&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;beepC&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;beepD&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;beep&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;hello&#39;,&#39;zzxz zzzz zzxz zzzz&#39;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//ajouteSon &#39;alienBeep&#39;,&#39;zzxz zzzz zzxz zzzz&#39;&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">springysquaresDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;styleAnimation flouMouvement\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;dégradéSimple fuchsia,couleur(100,200,200),jaune\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 0.3\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0,0,0.5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/2000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0.7,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rect&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">diceDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;styleAnimation flouMouvement\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;dégradéSimple couleur(255),moccasin,peche\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;trait 255,100,100,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;remplissage rouge,155\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace -0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 0.3\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0,0,0.5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;1 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 2,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglalmostvoronoiDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 10\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;2 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,temps/10000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;balle -1&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglshardsDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 10\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;remplissage 0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;traitSize 7\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,temps/20000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;balle \n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;balle -1.01&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglredthreadsDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 10.5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond noir\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;trait rouge\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;sansRemplissage\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;traitSize 7\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;5 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/20000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;balle\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 0,1,1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;balle&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">webglnuclearOctopusDemo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;dégradéSimple noir,couleur(0,0,(temps/5)%255),noir\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 0.2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;styleAnimation flouMouvement\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//styleAnimation peindreAuDessus\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;trait 255,0,0,120\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;remplissage temps%255,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;sauveMatrice\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;count = 0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;count++\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;sauveMatrice\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne count+3+temps/1000,2+count + temps/1000,4+count\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;120 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 0.9\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 1,1,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/100\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;restaureMatrice&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>the first time we render a mesh we need to
render it with the material that takes the
bigger buffer space, see:
https://github.com/mrdoob/three.js/issues/1051
Another workaround would be to create a mesh
for each different type of material</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">introTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Lines beginning with two\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// slashes (like these) are just comments.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// Everything else is run\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// about 30 to 60 times per second\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// in order to create an animation.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Click the link below to start the tutorial.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:hello_world&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">helloworldTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// type these three letters\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// in one of these empty lines below:\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;b&quot; and &quot;o&quot; and &quot;x&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// (you should then see a box facing you)\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// click below for the next tutorial\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:some_notes&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">somenotesTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// If this makes sense to you:\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// the syntax is similar to Coffeescript\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// and the commands are almost\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// like Processing.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// If this doesn&#39;t make sense to you\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// don&#39;t worry.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:rotate&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">rotateTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// now that we have a box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// let&#39;s rotate it:\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// type &quot;rotate 1&quot; in the\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// line before the &quot;box&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// click for the next tutorial:\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:frame&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">frameTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// make the box spin\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// by replacing &quot;1&quot; with &quot;frame&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;frame&quot; contains a number\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// always incrementing as\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// the screen is re-drawn.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// (use &quot;frame/100&quot; to slow it down)\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:time&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">timeTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;frame/100&quot; has one problem:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// faster computers will make\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// the cube spin too fast.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// Replace it with &quot;time/2000&quot;.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate frame/100\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;time&quot; counts the\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// number of milliseconds since\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// the program started, so it&#39;s\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// independent of how fast\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// the computer is at drawing.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:move&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">moveTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// you can move any object\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// by using &quot;move&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 1,1,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// try to use a rotate before \n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// the first box to see how the\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// scene changes.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:scale&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">scaleTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// you can make an object bigger\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// or smaller by using &quot;scale&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 3\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;scale 2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// try to use a rotate before \n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// the first box to see how the\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// scene changes.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:times&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">timesTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;times&quot; (not to be confused with\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;time&quot;!) can be used to\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// repeat operations like so:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0.2,0.2,0.2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// note how the tabs indicate \n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// exactly the block of code\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// to be repeated.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:fill&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">fillTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;fill&quot; changes the\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// color of all the faces:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fill 255,255,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// the three numbers indicate \n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// red green and blue values.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// You can also use color names such as indigo\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Try replacing the numbers with\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;angleColor&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:stroke&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">strokeTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;stroke&quot; changes all the\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// edges:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;strokeSize 5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;stroke 255,255,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// the three numbers are RGB\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// but you can also use the color names\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// or the special color &quot;angleColor&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// Also you can use &quot;strokeSize&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// to specify the thickness.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:color_names&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">colornamesTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// you can call colors by name\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// try to un-comment one line:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//fill greenyellow\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//fill indigo\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//fill lemonchiffon // whaaaat?\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// more color names here:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// http://html-color-codes.info/color-names/\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// (just use them in lower case)\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:lights&quot;</span><span class="p">;</span>


  <span class="kd">var</span> <span class="nx">lightsTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;ambientLight&quot; creates an\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// ambient light so things have\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// some sort of shading:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ambientLight 0,255,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// you can turn that light on and \n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// off while you build the scene\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// by using &quot;lights&quot; and &quot;noLights&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:background&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">backgroundTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;background&quot; creates a\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// solid background:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;background 0,0,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:gradient&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">gradientTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// even nicer, you can paint a\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// background gradient:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;simpleGradient color(190,10,10),color(30,90,100),color(0)\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:line&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">lineTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// draw lines like this:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;20 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/9000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;line\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:ball&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">ballTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// draw balls like this:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ballDetail 10\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 times -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0.2,0.2,0.2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ball\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// (&quot;ballDetail&quot; is optional)\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:pushpopMatrix&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">pushpopMatrixTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// pushMatrix creates a bookmark of\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// the position, which you can\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// return to later by using popMatrix.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// You can reset using &quot;resetMatrix&quot;.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;pushMatrix // bookmark the position after the rotation\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;line\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;move 0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;line\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;popMatrix // go back to the bookmarked position\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;move -0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;line\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;resetMatrix // resets the position\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;line // not affected by initial rotation\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:animation_style&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">animationstyleTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// try uncommenting either line\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// with the animationStyle\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;background 255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//animationStyle motionBlur\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//animationStyle paintOver\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate frame/10\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:do_once&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">doonceTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// delete either check mark below\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;rotate time/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;✓doOnce -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;background 255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;fill 255,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;✓doOnce -&gt; ball\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;box\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// ...the line or block of code\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// are ran one time only, after that the\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// check marks immediately re-appear\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// P.S. keep hitting the delete button\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// on that first check mark for seizures.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:autocode&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">autocodeTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// the Autocode button invents random\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// variations for you.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// You can interrupt the Autocoder at\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// any time by pressing the button again,\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// or you can press CTRL-Z\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// (or CMD-Z on Macs) to undo (or re-do) some of\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// the steps even WHILE the autocoder is running,\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// if you see that things got\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// boring down a particular path of changes.&#39;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>lights are on</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">introTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Les lignes qui commencent avec deux slashes\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// (comme celle-ci) sont des commentaires.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// Tout le reste est lancé\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// entre 30 et 60 fois par seconde\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// pour créer une animation\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Cliquez sur le lien ci-dessous pour démarrer le tutorial.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:hello_world&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">helloworldTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Tapez ces cinq lettres\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// sur une des lignes vides\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// b, o, i, t, e\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// (vous devriez voir une belle boite apparaître)\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// cliquez pour le prochain tutorial :\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:some_notes&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">somenotesTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Au cas où cela vous dit quelque chose :\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// la syntaxe est similaire à Coffeescript\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// et les commandes sont presque\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// comme Processing.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Si cela ne veut rien dire pour vous\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// pas de soucis.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:rotate&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">rotateTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Maintenant nous avons une boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// faisons la tourner:\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// tapez &quot;tourne 1&quot; sur la ligne\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// au dessus de &quot;boite&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// cliquez pour le prochain tutorial :\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:frame&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">frameTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// faites tourner la boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// en remplaçant &quot;1&quot; par &quot;image&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;image&quot; contient un nombre\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// qui s’incrémente au fur et à mesure\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// que l’écran est re-dessiné.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// (utilisez &quot;image/100&quot; pour la ralentir)\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:time&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">timeTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;image/100&quot; a un problème :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// les ordinateurs rapides vont faire\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// tourner le cube trop vite.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// Remplacez le par &quot;temps/2000&quot;.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne image/100\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;temps&quot; compte le nombre de millisecondes\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// depuis que le programme  a démarré,\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// il est donc indépendent de la vitesse\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// à laquelle l’ordinateur dessine les images.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:move&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">moveTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// vous pouvez déplacer n’importe quel objet\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// en utilisant &quot;deplace&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 1,1,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// essayez d’utiliser tourne\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// avant la première boite pour voir\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// comment la scène change.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:scale&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">scaleTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// vous pouvez changer la taille des objets\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// en utilisant &quot;taille&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 3\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;taille 2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// essayez d’utiliser tourne\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// avant la première boite pour voir\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// comment la scène change..\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:times&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">timesTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;fois&quot; peut-être utilisé\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// pour répéter des opérations :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0.2,0.2,0.2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// notez comme les tabulations indiquent \n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// exactement le bloc de code\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// qui doit être répété.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:fill&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">fillTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;remplissage&quot; défini la\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// couleur de toutes les faces :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;remplissage 255,255,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// les trois nombres indiquent\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// les valeurs de rouge, vert et bleu.\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Vous pouvez aussi utiliser\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// des noms de couleur comme indigo\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// Essayez de remplacer les nombres avec\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;couleurAngle&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:stroke&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">strokeTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;trait&quot; change la couleur\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// des arrêtes :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tailleTrait 5\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;trait 255,255,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// les trois nombres sont les valeurs RVB\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// mais vous pouvez utiliser les noms des couleurs,\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// ou la couleur spéciale  &quot;couleurAngle&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// Vous pouvez aussi utiliser &quot;tailleTrait&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// pour préciser l’épaisseur.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:color_names&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">colornamesTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// vous pouvez indiquer les couleurs par nom\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// essayer de dé-commenter une ligne :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//remplissage rouge\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//remplissage vert\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//remplissage pêche\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne 1\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// plus de noms de couleurs ici :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// http://html-color-codes.info/color-names/\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// (utilisez en minuscule, pas de majuscules)\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:lights&quot;</span><span class="p">;</span>


  <span class="kd">var</span> <span class="nx">lightsTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;eclairageAmbiant&quot; créé un\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// éclairage ambiant de sorte que les objets\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// ont une sorte de d’ombrage:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;eclairageAmbiant 0,255,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// vous pouvez éteindre ou allumer cet éclairage\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// pendant que vous construisez la scène&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// en utilisant &quot;eclairage&quot; et &quot;sansEclairage&quot;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:background&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">backgroundTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// &quot;fond&quot; créé un\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// fond de couleur :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond 0,0,255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:gradient&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">gradientTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// encore plus sympa, vous pouvez\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// créér un fond en dégradé:\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;degradeSimple couleur(190,10,10),couleur(30,90,100),couleur(0)\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:line&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">lineTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// dessinez des lignes comme ceci :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;20 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/9000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:ball&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">ballTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// dessinez des balles comme ceci :\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;balleDetail 10\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;3 fois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0.2,0.2,0.2\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;balle\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// (&quot;balleDetail&quot; est optionnel)\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:pushpopMatrix&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">pushpopMatrixTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// sauveMatrice mémorise\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// la position, et vous pouvez\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// y revenir plus tard avec restaureMatrice.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// Vous pouvez revenir à zéro avec &quot;effaceMatrice&quot;.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;sauveMatrice // mémorise la position après la rotation\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace 0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;restaureMatrice // revient à la position mémorisée\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;deplace -0.5,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;effaceMatrice // remets la position à zéro\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;ligne // cette ligne n’est donc pas affecté par la rotation\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:animation_style&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">animationstyleTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// essayez de dé-commenter l’une ou l’autre\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// des deux lignes  avec styleAnimation\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond 255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//styleAnimation flouMouvement\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;//styleAnimation peindreAudessus\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne image/10\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:do_once&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">doonceTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// effacez l’une ou l’autre des coches\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;tourne temps/1000\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;✓uneFois -&gt;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;fond 255\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span> <span class="o">+</span> <span class="s2">&quot;remplissage 255,0,0\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;✓uneFois -&gt; balle\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;boite\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// …la ligne ou le bloc de code\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// n’est exécuté qu’une seule fois, et après cela\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// la coche réapparait immédiattement\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// P.S. continuez de supprimer la première coche\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// en continu pour provoquer un évanouissement :-)\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// next-tutorial:autocode&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">autocodeTutorial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// le bouton Autocode invente pour vous\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// des variations aléatoires du code.\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// vous pouvez arrêter Autocode\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// à tout moment en ré-appuyant sur le bouton\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// ou vous pouvez faire CTRL-Z\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// (CMD-Z sur Mac) pour annuler (or rétablir) certainesn&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// des étapes y compris PENDANT que Autocode est actif\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// si par exemple vous trouvez que les choses\n&#39;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s1">&#39;// deviennent ennuyeuse dans la direction prise par Autocode.&#39;</span><span class="p">;</span>

<span class="p">}</span>
<span class="kd">var</span> <span class="nx">autocodeOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">blinkingAutocoderTimeout</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">blinkingAutocoderStatus</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">dimcodeOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


<span class="kd">function</span> <span class="nx">blinkAutocodeIndicator</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">blinkingAutocoderStatus</span> <span class="o">=</span> <span class="o">!</span><span class="nx">blinkingAutocoderStatus</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">blinkingAutocoderStatus</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#autocodeIndicatorContainer&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#autocodeIndicatorContainer&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">);</span>
    <span class="nx">mutate</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">toggleAutocode</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">autocodeOn</span> <span class="o">=</span> <span class="o">!</span><span class="nx">autocodeOn</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">autocodeOn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#autocodeIndicator&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Autocode: inactif&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#autocodeIndicator&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Autocode: off&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">blinkingAutocoderTimeout</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#autocodeIndicatorContainer&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#autocodeIndicator&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Autocode: actif&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#autocodeIndicator&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Autocode: on&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">blinkingAutocoderTimeout</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="s1">&#39;blinkAutocodeIndicator();&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#autocodeIndicatorContainer&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="p">(</span>
    <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;bookmark&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;autocodeTutorial&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="p">)</span> <span class="nx">loadDemoOrTutorial</span><span class="p">(</span><span class="s1">&#39;cubesAndSpikes&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kd">function</span> <span class="nx">mutate</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">whichMutation</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">whichMutation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">replaceAFloat</span><span class="p">();</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichMutation</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">replaceAnInteger</span><span class="p">();</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichMutation</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="nx">replaceABoxWithABall</span><span class="p">();</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichMutation</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="nx">replaceABallWithABox</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>TODO: meshes should be built from geometries that are
ever so slight larger than the "fill" mesh so there
is no z-fighting...
constant 0.001 below is to avoid z-fighting</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">}</span>

<span class="kd">function</span> <span class="nx">replaceAFloat</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">rePattern</span> <span class="o">=</span> <span class="sr">/([-+]?[0-9]*\.[0-9]+)/gi</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">allMatches</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">allMatches</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">else</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="nx">allMatches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="nx">whichOneToChange</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">numberOfResults</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">countWhichOneToSwap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">urlId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">countWhichOneToSwap</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">countWhichOneToSwap</span> <span class="o">===</span> <span class="nx">whichOneToChange</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">whichOp</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">12</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">));</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;time/1000&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;temps/1000&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">editorContent</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">replaceABoxWithABall</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">rePattern</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">rePattern</span> <span class="o">=</span> <span class="sr">/(box)/gi</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">rePattern</span> <span class="o">=</span> <span class="sr">/(boite)/gi</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">allMatches</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">allMatches</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">else</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="nx">allMatches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="nx">whichOneToChange</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">numberOfResults</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">countWhichOneToSwap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">urlId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">countWhichOneToSwap</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">countWhichOneToSwap</span> <span class="o">===</span> <span class="nx">whichOneToChange</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;ball&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;balle&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">editorContent</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">replaceTimeWithAConstant</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">rePattern</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">rePattern</span> <span class="o">=</span> <span class="sr">/(time)/gi</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">rePattern</span> <span class="o">=</span> <span class="sr">/(temps)/gi</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">allMatches</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">allMatches</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">else</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="nx">allMatches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="nx">whichOneToChange</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">numberOfResults</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">countWhichOneToSwap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">urlId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">countWhichOneToSwap</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">countWhichOneToSwap</span> <span class="o">===</span> <span class="nx">whichOneToChange</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">editorContent</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">replaceABallWithABox</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">rePattern</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">rePattern</span> <span class="o">=</span> <span class="sr">/(ball)/gi</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">rePattern</span> <span class="o">=</span> <span class="sr">/(balle)/gi</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">allMatches</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">allMatches</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">else</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="nx">allMatches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="nx">whichOneToChange</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">numberOfResults</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">countWhichOneToSwap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">urlId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">countWhichOneToSwap</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">countWhichOneToSwap</span> <span class="o">===</span> <span class="nx">whichOneToChange</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;box&quot;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;boite&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">editorContent</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">replaceAnInteger</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">rePattern</span> <span class="o">=</span> <span class="sr">/([-+]?[0-9]+)/gi</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">allMatches</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">allMatches</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">else</span> <span class="nx">numberOfResults</span> <span class="o">=</span> <span class="nx">allMatches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="nx">whichOneToChange</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">numberOfResults</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">countWhichOneToSwap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">editorContent</span> <span class="o">=</span> <span class="nx">editorContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rePattern</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">urlId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">countWhichOneToSwap</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">countWhichOneToSwap</span> <span class="o">===</span> <span class="nx">whichOneToChange</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">whichOp</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">7</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">whichOp</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Math.floor(1+time/1000)&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Math.floor(1+temps/1000)&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">editorContent</span><span class="p">);</span>

<span class="p">}</span>

<span class="kd">function</span> <span class="nx">triggerReset</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">pickRandomDefaultGradient</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">autocodeOn</span><span class="p">)</span> <span class="nx">toggleAutocode</span><span class="p">();</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resetButtonContainer&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">);</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;$(&quot;#resetButtonContainer&quot;).css(&quot;background-color&quot;,&quot;&quot;);&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">loadDemoOrTutorial</span><span class="p">(</span><span class="nx">whichDemo</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nx">Detector</span><span class="p">.</span><span class="nx">webgl</span> <span class="o">||</span> <span class="nx">forceCanvasRenderer</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">userWarnedAboutWebglExamples</span> <span class="o">&amp;&amp;</span> <span class="nx">whichDemo</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;webgl&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">userWarnedAboutWebglExamples</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#exampleNeedsWebgl&#39;</span><span class="p">).</span><span class="nx">modal</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#simplemodal-container&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>French demos <strong><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em></strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;bookmark=&#39;</span> <span class="o">+</span> <span class="nx">whichDemo</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">fakeText</span><span class="p">)</span> <span class="nx">shrinkFakeText</span><span class="p">();</span>
  <span class="nx">undimEditor</span><span class="p">();</span>

  <span class="nx">doTheSpinThingy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">prependMessage</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nx">Detector</span><span class="p">.</span><span class="nx">webgl</span> <span class="o">||</span> <span class="nx">forceCanvasRenderer</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">whichDemo</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;webgl&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">prependMessage</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;// this drawing makes much more sense\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;// in a WebGL-enabled browser\n&quot;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">switch</span> <span class="p">(</span><span class="nx">whichDemo</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="s1">&#39;simpleCubeDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">simpleCubeDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;webgltwocubesDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">webgltwocubesDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;cubesAndSpikes&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">cubesAndSpikes</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;webglturbineDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">webglturbineDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;webglzfightartDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">webglzfightartDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;littleSpiralOfCubes&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">littleSpiralOfCubes</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;tentacleDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">tentacleDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;lampDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">lampDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;trillionfeathersDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">trillionfeathersDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;monsterblobDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">monsterblobDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;industrialMusicDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">industrialMusicDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;trySoundsDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">trySoundsDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;springysquaresDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">springysquaresDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;diceDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">diceDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;webglalmostvoronoiDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">webglalmostvoronoiDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;webglshardsDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">webglshardsDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;webglredthreadsDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">webglredthreadsDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;webglnuclearOctopusDemo&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">webglnuclearOctopusDemo</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;introTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">introTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;helloworldTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">helloworldTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;somenotesTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">somenotesTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;rotateTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">rotateTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;frameTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">frameTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;timeTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">timeTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;moveTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">moveTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;scaleTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">scaleTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;timesTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">timesTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;fillTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">fillTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;strokeTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">strokeTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;colornamesTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">colornamesTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;lightsTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">lightsTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;backgroundTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">backgroundTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;gradientTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">gradientTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;lineTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">lineTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;ballTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">ballTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;pushpopMatrixTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">pushpopMatrixTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;animationstyleTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">animationstyleTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;doonceTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">doonceTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s1">&#39;autocodeTutorial&#39;</span><span class="o">:</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">prependMessage</span> <span class="o">+</span> <span class="nx">autocodeTutorial</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">editor</span><span class="p">.</span><span class="nx">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p><strong><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em><em>*</em>*</strong> French tutorials</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">}</span>


<span class="kd">var</span> <span class="nx">changesHappened</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">cursorActivity</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">editor</span> <span class="o">=</span> <span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">fromTextArea</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">),</span> <span class="p">{</span>
  <span class="nx">lineNumbers</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">indentWithTabs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">tabSize</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">indentUnit</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">lineWrapping</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>else if (whichMutation == 4)
replacetimeWithAConstant();</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">onBlur</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;editor.focus()&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
  <span class="p">}),</span>
  <span class="nx">onChange</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">registerCode</span><span class="p">();</span>
  <span class="p">}),</span>
  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;livecodelab&quot;</span><span class="p">,</span>
  <span class="nx">onCursorActivity</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">suspendDimmingAndCheckIfLink</span><span class="p">();</span>
  <span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>set the demo as a hash state
so that ideally people can link directly to
a specific demo they like.
(in the document.ready function we check for
this hash value and load the correct demo)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">});</span>


<span class="nx">editor</span><span class="p">.</span><span class="nx">setOption</span><span class="p">(</span><span class="s2">&quot;theme&quot;</span><span class="p">,</span> <span class="s1">&#39;night&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">selectTheme</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">theme</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">setOption</span><span class="p">(</span><span class="s2">&quot;theme&quot;</span><span class="p">,</span> <span class="nx">theme</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>bring the cursor to the top</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">adjustCodeMirrorHeight</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>setting the value of the editor triggers the
codeMirror onChange callback, and that runs
the demo.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.CodeMirror-scroll&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">-</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#theMenu&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">fakeCursorInterval</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">fakeCursorBlinking</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#fakeStartingBlinkingCursor&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
    <span class="nx">opacity</span><span class="o">:</span> <span class="mf">0.2</span>
  <span class="p">},</span> <span class="s2">&quot;fast&quot;</span><span class="p">,</span> <span class="s2">&quot;swing&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
    <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span>
  <span class="p">},</span> <span class="s2">&quot;fast&quot;</span><span class="p">,</span> <span class="s2">&quot;swing&quot;</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>We want the code editor to always have focus
since there is nothing else to type into.
One of those little wonders: you have to pause a little
before giving the editor focus, otherwise for some reason
the focus is not regained. Go figure.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">wheel</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>

  <span class="cm">/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)</span>
<span class="cm">   * Licensed under the MIT License (LICENSE.txt).</span>
<span class="cm">   *</span>
<span class="cm">   * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.</span>
<span class="cm">   * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.</span>
<span class="cm">   * Thanks to: Seamus Leahy for adding deltaX and deltaY</span>
<span class="cm">   *</span>
<span class="cm">   * Version: 3.0.6</span>
<span class="cm">   *</span>
<span class="cm">   * Requires: 1.2.2+</span>
<span class="cm">   */</span>

  <span class="kd">var</span> <span class="nx">orgEvent</span> <span class="o">=</span> <span class="nx">event</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span>
    <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="nx">delta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">returnValue</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">deltaX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">deltaY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">event</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">fix</span><span class="p">(</span><span class="nx">orgEvent</span><span class="p">);</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;mousewheel&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>onScroll: (function(){alert('scroll')})</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">orgEvent</span><span class="p">.</span><span class="nx">wheelDelta</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">delta</span> <span class="o">=</span> <span class="nx">orgEvent</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">/</span> <span class="mi">120</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">orgEvent</span><span class="p">.</span><span class="nx">detail</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">delta</span> <span class="o">=</span> <span class="o">-</span><span class="nx">orgEvent</span><span class="p">.</span><span class="nx">detail</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>resizing the text area is necessary otherwise
as the user types to the end of it, instead of just scrolling
the content leaving all the other parts of the page where
they are, it expands and it pushes down
the view of the page, meaning that the canvas goes up and
the menu disappears
so we have to resize it at launch and also every time the window
is resized.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">deltaY</span> <span class="o">=</span> <span class="nx">delta</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>alert("code height:" + $('#code').height());
alert("window height:" + window.innerHeight);
alert("code height:" + $('.CodeMirror-scroll').css('height'));
alert("menu height:" + $('#theMenu').height());</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">orgEvent</span><span class="p">.</span><span class="nx">axis</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">orgEvent</span><span class="p">.</span><span class="nx">axis</span> <span class="o">===</span> <span class="nx">orgEvent</span><span class="p">.</span><span class="nx">HORIZONTAL_AXIS</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">deltaY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">deltaX</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">delta</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>/////////// START OF MOUSEWHEEL HANDLER CODE
I couldn't quote get the exact Javascript plugin below to
work in its original form, so I only took the
"calculation" routine.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">orgEvent</span><span class="p">.</span><span class="nx">wheelDeltaY</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">deltaY</span> <span class="o">=</span> <span class="nx">orgEvent</span><span class="p">.</span><span class="nx">wheelDeltaY</span> <span class="o">/</span> <span class="mi">120</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">orgEvent</span><span class="p">.</span><span class="nx">wheelDeltaX</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">deltaX</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">orgEvent</span><span class="p">.</span><span class="nx">wheelDeltaX</span> <span class="o">/</span> <span class="mi">120</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">deltaX</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">deltaY</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">deltaY</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cursorPositio</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getCursor</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>Old school scrollwheel delta</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cursorPositio</span><span class="p">.</span><span class="nx">line</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">editor</span><span class="p">.</span><span class="nx">lineCount</span><span class="p">())</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cursorPositio</span><span class="p">.</span><span class="nx">line</span> <span class="o">!==</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">lineCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">editor</span><span class="p">.</span><span class="nx">setCursor</span><span class="p">(</span><span class="nx">cursorPositio</span><span class="p">.</span><span class="nx">line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">cursorPositio</span><span class="p">.</span><span class="nx">ch</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">deltaY</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cursorPositio</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getCursor</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">setCursor</span><span class="p">(</span><span class="nx">cursorPositio</span><span class="p">.</span><span class="nx">line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">cursorPositio</span><span class="p">.</span><span class="nx">ch</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Initialization code. */</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMMouseScroll&#39;</span><span class="p">,</span> <span class="nx">wheel</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onmousewheel</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">onmousewheel</span> <span class="o">=</span> <span class="nx">wheel</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>New school multidimensional scroll (touchpads) deltas</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">suspendDimmingAndCheckIfLink</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p>Gecko</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">cursorP</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getCursor</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">cursorP</span><span class="p">.</span><span class="nx">ch</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">currentLineContent</span> <span class="o">=</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getLine</span><span class="p">(</span><span class="nx">cursorP</span><span class="p">.</span><span class="nx">line</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">currentLineContent</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;// next-tutorial:&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">currentLineContent</span> <span class="o">=</span> <span class="nx">currentLineContent</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">17</span><span class="p">);</span>
      <span class="nx">currentLineContent</span> <span class="o">=</span> <span class="nx">currentLineContent</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>Webkit</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;loadDemoOrTutorial(&quot;&#39;</span> <span class="o">+</span> <span class="nx">currentLineContent</span> <span class="o">+</span> <span class="s1">&#39;Tutorial&quot;);&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">fakeText</span> <span class="o">||</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;cursor activity! opacity: &#39;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">));</span>
  <span class="nx">cursorActivity</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">undimEditor</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">undimEditor</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">fakeText</span> <span class="o">||</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.99</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;undimming the editor&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
      <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span>
    <span class="p">},</span> <span class="s2">&quot;fast&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <p>this is to prevent that when the cursor reaches the
last line, then it goes to the END of the line
we avoid that because of a nasty workaround
where we check whether the cursor is in the
first few characters of the line to avoid
following a "next-tutorial" link.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">dimEditor</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>/////////// END OF MOUSEWHEEL HANDLER CODE
this function is called when the cursor moves
and we handle this in two ways
1) we suspend the dimming countdown
2) we undim the editor if it is dimmed
3) we check whether the user moved the cursor over a link</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;starting fadeout animation&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
      <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">},</span> <span class="s2">&quot;slow&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">dimIfNoCursorActivity</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">fakeText</span> <span class="o">||</span> <span class="nx">editor</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">cursorActivity</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;marking cursor activity = false. Will check again in the next interval&#39;</span><span class="p">);</span>
    <span class="nx">cursorActivity</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;no activity in the last interval. Dimming now, starting opacity is: &#39;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">)</span> <span class="p">);</span>
    <span class="nx">dimEditor</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>Now this is kind of a nasty hack: we check where the
cursor is, and if it's over a line containing the
link then we follow it.
There was no better way, for some reason some onClick
events are lost, so what happened is that one would click on
the link and nothing would happen.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">toggleDimCode</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">dimcodeOn</span> <span class="o">=</span> <span class="o">!</span><span class="nx">dimcodeOn</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dimcodeOn</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">dimIntervalID</span><span class="p">);</span>
    <span class="nx">undimEditor</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#dimCodeIndicator&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Code Caché: inactif&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#dimCodeIndicator&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Hide Code: off&quot;</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>alert(""+url);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dimIntervalID</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="s2">&quot;dimIfNoCursorActivity()&quot;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#dimCodeIndicator&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Code Caché: actif&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#dimCodeIndicator&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Hide Code: on&quot;</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">}</span>


<span class="kd">var</span> <span class="nx">closeAndCheckAudio</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>Now that there is a manual switch to toggle it off and on
the dimming goes to full INvisibility
see toggleDimCode() 
not sure about that, want to try it on people -- julien </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">modal</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;checkAudio();&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>

<span class="kd">var</span> <span class="nx">checkAudio</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">buzz</span><span class="p">.</span><span class="nx">isSupported</span><span class="p">())</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p>TODO there is a chance that the animation library
doesn't bring the opacity completely to zero
but rather to a value close to it.
Make the animation step to print something
just to make sure that this is not the case.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#noAudioMessage&#39;</span><span class="p">).</span><span class="nx">modal</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#simplemodal-container&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="kd">var</span> <span class="nx">loadAndTestAllTheSounds</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;loading and testing all sounds&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">cycleSoundDefs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">cycleSoundDefs</span> <span class="o">&lt;</span> <span class="nx">numberOfSounds</span><span class="p">;</span> <span class="nx">cycleSoundDefs</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">buzz</span><span class="p">.</span><span class="nx">isMP3Supported</span><span class="p">())</span> <span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundFile</span> <span class="o">=</span> <span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundFile</span> <span class="o">+</span> <span class="s2">&quot;.mp3&quot;</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">buzz</span><span class="p">.</span><span class="nx">isOGGSupported</span><span class="p">())</span> <span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundFile</span> <span class="o">=</span> <span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundFile</span> <span class="o">+</span> <span class="s2">&quot;.ogg&quot;</span><span class="p">;</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">break</span>
      <span class="p">}</span>

      <span class="nx">soundBank</span><span class="p">[</span><span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">soundFiles</span><span class="p">[</span><span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundFile</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p>a function to toggle code diming on and off -- julien </p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;chrome&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="sr">/MSIE (\d+\.\d+);/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">preloadSounds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">preloadSounds</span> <span class="o">&lt;</span> <span class="nx">CHANNELSPERSOUND</span><span class="p">;</span> <span class="nx">preloadSounds</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>we restart a setInterval</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">setTimeout</span><span class="p">(</span><span class="s2">&quot;checkSound(&quot;</span> <span class="o">+</span> <span class="nx">cycleSoundDefs</span> <span class="o">+</span> <span class="s2">&quot;);&quot;</span><span class="p">,</span> <span class="mi">200</span> <span class="o">*</span> <span class="nx">cycleSoundDefs</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

    <span class="p">}</span> <span class="c1">// end of the for loop</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;chrome&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="p">(</span><span class="sr">/MSIE (\d+\.\d+);/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">)))</span> <span class="p">{</span>
      <span class="nx">startEnvironment</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="kd">var</span> <span class="nx">checkSound</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cycleSoundDefs</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">newSound</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">buzz</span><span class="p">.</span><span class="nx">sound</span><span class="p">(</span><span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundFile</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;loading sound &quot;</span><span class="o">+</span> <span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundFile</span><span class="p">);</span>
    <span class="nx">newSound</span><span class="p">.</span><span class="nx">mute</span><span class="p">()</span>
    <span class="nx">newSound</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
    <span class="nx">newSound</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;ended&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;ended&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">unmute</span><span class="p">();</span>
      <span class="nx">endedFirstPlay</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">endedFirstPlay</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loading&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;tested &quot;</span><span class="o">+</span><span class="nx">endedFirstPlay</span><span class="o">+</span><span class="s2">&quot; sounds&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">endedFirstPlay</span> <span class="o">===</span> <span class="nx">numberOfSounds</span> <span class="o">*</span> <span class="nx">CHANNELSPERSOUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;tested all sounds&quot;</span><span class="p">);</span>
        <span class="nx">startEnvironment</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">newSound</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
    <span class="nx">soundBank</span><span class="p">[</span><span class="nx">soundDef</span><span class="p">[</span><span class="nx">cycleSoundDefs</span><span class="p">].</span><span class="nx">soundName</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">newSound</span><span class="p">);</span>
  <span class="p">}</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;document ready&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isCanvasSupported</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#noCanvasMessage&#39;</span><span class="p">).</span><span class="nx">modal</span><span class="p">({</span>
      <span class="nx">onClose</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loading&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;sorry :-(&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">modal</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#simplemodal-container&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">loadAndTestAllTheSounds</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">startEnvironment</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">pickRandomDefaultGradient</span><span class="p">();</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;startEnvironment&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">init</span><span class="p">())</span> <span class="nx">animate</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Detector</span><span class="p">.</span><span class="nx">webgl</span> <span class="o">||</span> <span class="nx">forceCanvasRenderer</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>$('#noWebGLMessage').close();</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#noWebGLMessage&#39;</span><span class="p">).</span><span class="nx">modal</span><span class="p">({</span>
      <span class="nx">onClose</span><span class="o">:</span> <span class="nx">closeAndCheckAudio</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#simplemodal-container&#39;</span><span class="p">).</span><span class="nx">height</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>if (true) {</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;backGroundCanvas&#39;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">fullScreenifyBackground</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fullscreenify</span><span class="p">(</span><span class="nx">canvas</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">resetGradientStack</span><span class="p">();</span>
  <span class="nx">simpleGradientUpdateIfChanged</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">frenchVersion</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#demoMenu&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Démos&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tutorialsMenu&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Tutoriaux&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#resetButton&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Effacer&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#autocodeIndicator&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Autocode: inactif&quot;</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#simpleCubeDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Cube simple&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#webgltwocubesDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;WebGL: Deux cubes&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cubesAndSpikes&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Cubes et piques&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#webglturbineDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;WebGL: Turbine&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#webglzfightartDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;WebGL: Z-fight art!&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#littleSpiralOfCubes&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Petite spirale&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tentacleDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Tentacule&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#lampDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Lampe&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#trillionfeathersDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Mille milliards de plumes&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#monsterblobDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Monstre blob&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#industrialMusicDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Son: Industriel&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#trySoundsDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Son: Essayez les tous&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#springysquaresDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Carrés rebondissants&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#diceDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Dé&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#webglalmostvoronoiDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;WebGL: Presque Voronoi&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#webglshardsDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;WebGL: Échardes&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#webglredthreadsDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;WebGL: Fils rouges&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#webglnuclearOctopusDemo&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;WebGL: Pieuvre nucléaire&quot;</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#introTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;intro&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#helloworldTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#somenotesTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;quelques notes&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#rotateTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;tourne&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#frameTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#timeTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;temps&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#moveTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;déplace&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#scaleTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;taille&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#timesTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;fois&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#fillTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;remplissage&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#strokeTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;trait&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#colornamesTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;les couleurs par leur nom&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#lightsTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;éclairages&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#backgroundTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;fond&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#gradientTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;degradeSimple&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#lineTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;ligne&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ballTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;balle&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pushpopMatrixTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;matrice&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#animationstyleTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;styleAnimation&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#doonceTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;uneFois&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#autocodeTutorial&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;autocode&quot;</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startingCourtainScreen&#39;</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formCode&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="nx">editor</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
  <span class="nx">adjustCodeMirrorHeight</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>Chrome can deal with dynamic loading
of many files but doesn't like loading too many audio objects
so fast - it crashes.
At the opposite end, Safari doesn't like loading sound dynamically
and instead works fine by loading sound all at the beginning.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;bookmark&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">demoToLoad</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s2">&quot;bookmark&quot;</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>if you load and play all the channels of all the sounds all together
the browser freezes, and the OS doesn't feel too well either
so better stagger the checks in time.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">loadDemoOrTutorial</span><span class="p">(</span><span class="nx">demoToLoad</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">fakeCursorInterval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="s2">&quot;fakeCursorBlinking()&quot;</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>$('#noWebGLMessage').modal()</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">dimcodeOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">toggleDimCode</span><span class="p">();</span>

<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>alert('resizing canvas');</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">fullscreenify</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <p>check if the url points to a particular demo,
in which case we load the demo directly.
otherwise we do as usual.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">adjustCodeMirrorHeight</span><span class="p">();</span>
    <span class="nx">resize</span><span class="p">(</span><span class="nx">canvas</span><span class="p">);</span>
  <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

  <span class="nx">resize</span><span class="p">(</span><span class="nx">canvas</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nx">resize</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">scale</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nx">y</span><span class="o">:</span> <span class="mi">1</span>
    <span class="p">};</span>
    <span class="nx">scale</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">+</span> <span class="mi">40</span><span class="p">)</span> <span class="o">/</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">scale</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">+</span> <span class="mi">40</span><span class="p">)</span> <span class="o">/</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>

    <span class="nx">scale</span> <span class="o">=</span> <span class="nx">scale</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">scale</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>setTimeout ( "loadDemoOrTutorial('"+demoToLoad+"');",500);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="cm">/*</span>
<span class="cm">        if (scale.x &lt; 1 || scale.y &lt; 1) {</span>
<span class="cm">            scale = &#39;1, 1&#39;;</span>
<span class="cm">        } else if (scale.x &lt; scale.y) {</span>
<span class="cm">            scale = scale.x + &#39;, &#39; + scale.x;</span>
<span class="cm">        } else {</span>
<span class="cm">            scale = scale.y + &#39;, &#39; + scale.y;</span>
<span class="cm">        }</span>
<span class="cm">        */</span>

    <span class="nx">canvas</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="nx">style</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="s1">&#39;-ms-transform-origin: left top; -webkit-transform-origin: left top; -moz-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top; -ms-transform: scale(&#39;</span> <span class="o">+</span> <span class="nx">scale</span> <span class="o">+</span> <span class="s1">&#39;); -webkit-transform: scale3d(&#39;</span> <span class="o">+</span> <span class="nx">scale</span> <span class="o">+</span> <span class="s1">&#39;, 1); -moz-transform: scale(&#39;</span> <span class="o">+</span> <span class="nx">scale</span> <span class="o">+</span> <span class="s1">&#39;); -o-transform: scale(&#39;</span> <span class="o">+</span> <span class="nx">scale</span> <span class="o">+</span> <span class="s1">&#39;); transform: scale(&#39;</span> <span class="o">+</span> <span class="nx">scale</span> <span class="o">+</span> <span class="s1">&#39;);&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>Init of the dim code toggle.
set it to false, then immediatly toggle it to true with the managing function
that way we can easily invert the default: just change false to true -- julien</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>/////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>alert('style: ' +  style);</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <p>this code below is if one wants to keep the aspect ratio
but I mean one doesn't necessarily resize the window
keeping the same aspect ratio.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>TODO In theory we want to re-draw the background because the
aspect ration might have changed.
But for the time being we only have vertical
gradients so that's not going to be a problem.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 