'use strict';var LiveCodeLabCore;
LiveCodeLabCore=function(){function b(a){this.paramsObject=a;this.three=THREE;this.timeKeeper=new TimeKeeper;this.blendControls=new BlendControls(this);this.colourFunctions=new ColourFunctions;this.renderer=new Renderer(this);this.soundSystem=new SoundSystem(this.paramsObject.eventRouter,buzz,createBowser(),new SampleBank(buzz));this.backgroundPainter=new BackgroundPainter(this.paramsObject.canvasForBackground,this);this.drawFunctionRunner=new ProgramRunner(this.paramsObject.eventRouter,this);this.codeTransformer=
new CodeTransformer(this.paramsObject.eventRouter,CoffeeScript,this);this.animationLoop=new AnimationLoop(this.paramsObject.eventRouter,this.paramsObject.statsWidget,this);this.threeJsSystem=new ThreeJsSystem(Detector,THREEx,this.paramsObject.blendedThreeJsSceneCanvas,this.paramsObject.forceCanvasRenderer,this.paramsObject.testMode,this.three);this.matrixCommands=new MatrixCommands(this.three,this);this.graphicsCommands=new GraphicsCommands(this.three,this);this.lightSystem=new LightsCommands(this.graphicsCommands,
this)}b.prototype.paintARandomBackground=function(){return this.backgroundPainter.paintARandomBackground()};b.prototype.startAnimationLoop=function(){return this.animationLoop.animate()};b.prototype.runLastWorkingDrawFunction=function(){return this.drawFunctionRunner.reinstateLastWorkingDrawFunction()};b.prototype.loadAndTestAllTheSounds=function(){return this.soundSystem.loadAndTestAllTheSounds()};b.prototype.playStartupSound=function(){return this.soundSystem.playStartupSound()};b.prototype.isAudioSupported=
function(){return this.soundSystem.isAudioSupported()};b.prototype.updateCode=function(a){this.codeTransformer.updateCode(a);if(""!==a&&this.dozingOff)return this.dozingOff=!1,this.animationLoop.animate(),this.paramsObject.eventRouter.trigger("livecodelab-waking-up")};b.prototype.getForeground3DSceneImage=function(a){var f,b,d,e;f=this.threeJsSystem.blendedThreeJsSceneCanvas;e=new Image;e.src=f.toDataURL();a&&(b=document.createElement("canvas"),b.width=f.width,b.height=f.height,d=b.getContext("2d"),
d.drawImage(e,0,0),d.globalCompositeOperation="destination-over",d.fillStyle=a,d.fillRect(0,0,f.width,f.height),e=new Image,e.src=b.toDataURL());return e};return b}();var EventRouter;
EventRouter=function(){function b(){}b.prototype.events={};b.prototype.bind=function(a,f,b){f={callback:f,context:b};this.events[a]||(this.events[a]=[]);return this.events[a].push(f)};b.prototype.trigger=function(a){var f,b,d,e,g,h;f=Array.prototype.slice.call(arguments);if(this.events[a]){f=f.slice(1);b=this.events[a];h=[];e=0;for(g=b.length;e<g;e++)d=b[e],h.push(d.callback.apply(d.context,f));return h}};return b}();
var CodeChecker,Parser,__hasProp={}.hasOwnProperty,__extends=function(b,a){function f(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);f.prototype=a.prototype;b.prototype=new f;b.__super__=a.prototype;return b};
Parser=function(){function b(){}b.prototype.setString=function(a){this.position=0;this.source=a;this.sourceLength=this.source.length;return""!==a?this.finished=!1:this.finished=!0};b.prototype.pop=function(){var a;if(!(this.position>=this.sourceLength))return a=this.source.charAt(this.position),this.position+=1,this.position>=this.sourceLength&&(this.finished=!0),a};b.prototype.peek=function(){if(this.position<this.sourceLength)return this.source.charAt(this.position)};return b}();
CodeChecker=function(b){function a(){this.charHandlers={"[":function(){if(!this.states.inSingleString&&!this.states.inDoubleString&&!this.states.inComment)return this.states.bracketStack.push("[")},"]":function(){var a;if(!this.states.inSingleString&&!this.states.inDoubleString&&!this.states.inComment&&(a=this.states.bracketStack.pop(),"["!==a))return this.states.err=!0,this.states.message=this.generateErrMessage(a)},"(":function(){if(!this.states.inSingleString&&!this.states.inDoubleString&&!this.states.inComment)return this.states.bracketStack.push("(")},
")":function(){var a;if(!this.states.inSingleString&&!this.states.inDoubleString&&!this.states.inComment&&(a=this.states.bracketStack.pop(),"("!==a))return this.states.err=!0,this.states.message=this.generateErrMessage(a)},"{":function(){if(!this.states.inSingleString&&!this.states.inDoubleString&&!this.states.inComment)return this.states.bracketStack.push("{")},"}":function(){var a;if(!this.states.inSingleString&&!this.states.inDoubleString&&!this.states.inComment&&(a=this.states.bracketStack.pop(),
"{"!==a))return this.states.err=!0,this.states.message=this.generateErrMessage(a)},"'":function(){if(!this.states.inComment){if(this.states.inSingleString)return this.states.inSingleString=!1,this.states.singleQ-=1;if(!this.states.inDoubleString)return this.states.inSingleString=!0,this.states.singleQ+=1}},'"':function(){if(!this.states.inComment){if(this.states.inDoubleString)return this.states.inDoubleString=!1,this.states.doubleQ-=1;if(!this.states.inSingleString)return this.states.inDoubleString=
!0,this.states.doubleQ+=1}},"/":function(){if(!this.states.inSingleString&&!this.states.inDoubleString&&!this.states.inComment&&"/"===this.peek())return this.pop(),this.states.inComment=!0},"\\":function(){return this.pop()},"\n":function(){if(this.states.inSingleString)return this.states.message=this.generateErrMessage("'"),this.states.err=!0;if(this.states.inDoubleString)return this.states.message=this.generateErrMessage('"'),this.states.err=!0;if(this.states.inComment)return this.states.inComment=
!1}}}__extends(a,b);a.prototype.states={};a.prototype.resetState=function(){return{err:!1,bracketStack:[],doubleQ:0,singleQ:0,inSingleString:!1,inDoubleString:!1,inComment:!1,message:""}};a.prototype.isErr=function(a){var b;a.bracketStack.length?(b=a.bracketStack.pop(),this.states.message=this.generateErrMessage(b),a.err=!0):a.inSingleString?(this.states.message=this.generateErrMessage("'"),a.err=!0):a.inDoubleString&&(this.states.message=this.generateErrMessage('"'),a.err=!0);return a};a.prototype.generateErrMessage=
function(a){switch(a){case "{":a="Unbalanced {}";break;case "(":a="Unbalanced ()";break;case "[":a="Unbalanced []";break;case "'":a="Missing '";break;case '"':a='Missing "';break;default:a="Unexpected "+a}return a};a.prototype.parseChar=function(a){if(this.charHandlers[a])return this.charHandlers[a]()};a.prototype.parse=function(a){this.states=this.resetState();for(this.setString(a);!this.finished&&!this.states.err;)a=this.pop(),this.parseChar(a);return this.isErr(this.states)};return a}(Parser);
var UrlRouter;UrlRouter=function(){function b(a){this.eventRouter=a;this.eventRouter.bind("set-url-hash",this.setHash,this)}b.prototype.getHash=function(){var a;return(a=window.location.href.match(/#(.*)$/))?a[1]:""};b.prototype.setHash=function(a){return window.location.hash=a};b.prototype.urlPointsToDemoOrTutorial=function(){var a,b;a=!1;if(b=this.getHash())this.eventRouter.trigger("url-hash-changed",b),a=!0;return a};return b}();var BigCursor;
BigCursor=function(){function b(){this.fakeCursorInterval=void 0;this.isShowing=!0}b.prototype.startBigCursorBlinkingAnimation=function(){return $("#fakeStartingBlinkingCursor").animate({opacity:0.2},"fast","swing").animate({opacity:1},"fast","swing")};b.prototype.toggleBlink=function(a){if(a){if(!this.fakeCursorInterval)return this.fakeCursorInterval=setInterval(this.startBigCursorBlinkingAnimation,800)}else return clearTimeout(this.fakeCursorInterval),this.fakeCursorInterval=null};b.prototype.shrinkBigCursor=
function(){var a;if(this.isShowing)return a=$("#caption").html(),a=a.substring(0,a.length-1),$("#caption").html(a+"|"),$("#fakeStartingBlinkingCursor").html(""),$("#toMove").animate({opacity:0,margin:-100,fontSize:300,left:0},"fast"),setTimeout('$("#formCode").animate({opacity: 1}, "fast");',120),setTimeout('$("#justForFakeCursor").hide();',200),setTimeout('$("#toMove").hide();',200),this.isShowing=!1,this.toggleBlink(!1)};b.prototype.unshrinkBigCursor=function(){if(!this.isShowing)return $("#formCode").animate({opacity:0},
"fast"),$("#justForFakeCursor").show(),$("#toMove").show(),$("#caption").html("|"),$("#toMove").animate({opacity:1,margin:0,fontSize:350,left:0},"fast",function(){$("#caption").html("");return $("#fakeStartingBlinkingCursor").html("|")}),this.isShowing=!0,this.toggleBlink(!0)};return b}();var LexerRule,LexerState;
LexerState=function(){function b(){}b.prototype.rules=[];b.prototype.addRule=function(a,b){return this.rules.push(new LexerRule(a,b))};b.prototype.lex=function(a){for(a=this.findAndRunActionPairedToLongestAppliableRegex(a);"function"===typeof a;)a=a();return a};b.prototype.findAndRunActionPairedToLongestAppliableRegex=function(a){var b,c,d,e,g,h,j;c=e=null;d=-1;for(b=h=j=this.rules.length-1;0>=j?0>=h:0<=h;b=0>=j?++h:--h)if(g=this.rules[b],(b=g.matches(a))&&b[0].length>=d)e=g,c=b,d=b[0].length;if(e)return e.action(c,
a.substring(d),this);throw"Lexing error; no match found for: '"+a+"'";};b.prototype.returnAFunctionThatAppliesRulesAndRunsActionFor=function(a){var b=this;return function(){return b.findAndRunActionPairedToLongestAppliableRegex(a)}};return b}();LexerRule=function(){function b(a,b){this.regex=a;this.action=b;this.regex=RegExp("^("+this.regex.source+")");this.regex.compile&&this.regex.compile(this.regex)}b.prototype.matches=function(a){(a=a.match(this.regex))&&a.shift();return a};return b}();var SampleBank;
SampleBank=function(){function b(a){this.fileType=void 0;if(a.isMP3Supported())this.fileType="mp3";else if(a.isOGGSupported())this.fileType="ogg";else return;this.load("bing","./sound/audioFiles/start_bing");this.load("highHatClosed","./sound/audioFiles/AMB_HHCL");this.load("highHatOpen","./sound/audioFiles/AMB_HHOP");this.load("toc3","./sound/audioFiles/AMB_LTM2");this.load("toc4","./sound/audioFiles/AMB_RIM1");this.load("snare","./sound/audioFiles/AMB_SN13");this.load("snare2","./sound/audioFiles/AMB_SN_5");
this.load("crash","./sound/audioFiles/CRASH_1");this.load("crash2","./sound/audioFiles/CRASH_5");this.load("crash3","./sound/audioFiles/CRASH_6");this.load("ride","./sound/audioFiles/RIDE_1");this.load("glass","./sound/audioFiles/glass2");this.load("thump","./sound/audioFiles/8938__patchen__piano-hits-hand-03v2");this.load("lowFlash","./sound/audioFiles/9569__thanvannispen__industrial-low-flash04");this.load("lowFlash2","./sound/audioFiles/9570__thanvannispen__industrial-low-flash07");this.load("tranceKick2",
"./sound/audioFiles/24004__laya__dance-kick3");this.load("tranceKick","./sound/audioFiles/33325__laya__trance-kick01");this.load("voltage","./sound/audioFiles/49255__keinzweiter__bonobob-funk");this.load("beepA","./sound/audioFiles/100708__steveygos93__bleep_a");this.load("beepB","./sound/audioFiles/100708__steveygos93__bleep_b");this.load("beepC","./sound/audioFiles/100708__steveygos93__bleep_c");this.load("beepD","./sound/audioFiles/100708__steveygos93__bleep_d");this.load("alienBeep","./sound/audioFiles/132389__blackie666__alienbleep");
this.load("penta1","./sound/audioFiles/toneMatrix-1");this.load("penta2","./sound/audioFiles/toneMatrix-2");this.load("penta3","./sound/audioFiles/toneMatrix-3");this.load("penta4","./sound/audioFiles/toneMatrix-4");this.load("penta5","./sound/audioFiles/toneMatrix-5");this.load("penta6","./sound/audioFiles/toneMatrix-6");this.load("penta7","./sound/audioFiles/toneMatrix-7");this.load("penta8","./sound/audioFiles/toneMatrix-8");this.load("penta9","./sound/audioFiles/toneMatrix-9");this.load("penta10",
"./sound/audioFiles/toneMatrix-10");this.load("penta11","./sound/audioFiles/toneMatrix-11");this.load("penta12","./sound/audioFiles/toneMatrix-12");this.load("penta13","./sound/audioFiles/toneMatrix-13");this.load("penta14","./sound/audioFiles/toneMatrix-14");this.load("penta15","./sound/audioFiles/toneMatrix-15");this.load("penta16","./sound/audioFiles/toneMatrix-16");this.load("ciack","./sound/audioFiles/ciack");this.load("snap","./sound/audioFiles/snap");this.load("thump2","./sound/audioFiles/thump2");
this.load("dish","./sound/audioFiles/dish")}b.prototype.sounds=[];b.prototype.soundsByName={};b.prototype.fileType=void 0;b.prototype.load=function(a,b){var c;c=this.sounds.length;this.sounds.push({name:a,path:b+"."+this.fileType});return this.soundsByName[a]=c};b.prototype.getByName=function(a){return this.sounds[this.soundsByName[a]]};b.prototype.getByNumber=function(a){return this.sounds[a]};return b}();var SoundSystem;
SoundSystem=function(){function b(a,b,c,d){var e=this;this.eventRouter=a;this.buzz=b;this.Bowser=c;this.samplebank=d;this.soundLoops.soundIDs=[];this.soundLoops.beatStrings=[];if(this.Bowser.firefox)this.playSound=function(a,b,f){return e.play_using_DYNAMICALLY_CREATED_AUDIO_TAG(a,b,f)};else if(this.Bowser.safari||this.Bowser.msie||this.Bowser.chrome)this.playSound=function(a,b,f){return e.play_using_BUZZJS_WITH_ONE_POOL_PER_SOUND(a,b,f)};window.bpm=function(a){return e.bpm(a)};window.play=function(a,
b){return e.play(a,b)}}b.prototype.oldupdatesPerMinute=0;b.prototype.soundLoopTimer=void 0;b.prototype.beatNumber=0;b.prototype.totalCreatedSoundObjects=0;b.prototype.soundSystemIsMangled=!1;b.prototype.CHANNELSPERSOUND=6;b.prototype.endedFirstPlay=0;b.prototype.buzzObjectsPool=[];b.prototype.soundFilesPaths={};b.prototype.soundLoops=[];b.prototype.updatesPerMinute=void 0;b.prototype.anyCodeReactingTobpm=!1;b.prototype.resetLoops=function(){this.soundLoops.soundIDs=[];return this.soundLoops.beatStrings=
[]};b.prototype.playStartupSound=function(){return(new this.buzz.sound(this.samplebank.getByName("bing").path)).play()};b.prototype.SetUpdatesPerMinute=function(a){this.updatesPerMinute=a};b.prototype.bpm=function(a){if(void 0!==a)return 125<a&&(a=125),0>a&&(a=0),this.updatesPerMinute=4*a};b.prototype.play=function(a,b){this.anyCodeReactingTobpm=!0;b=b.replace(/\s*/g,"");this.soundLoops.soundIDs.push(a);return this.soundLoops.beatStrings.push(b)};b.prototype.play_using_BUZZ_JS_FIRE_AND_FORGET=function(a,
b,c){this.buzzObjectsPool=c;return(new this.buzz.sound(a[b])).play()};b.prototype.play_using_DYNAMICALLY_CREATED_AUDIO_TAG=function(a,b,c){var d,e;this.buzzObjectsPool=c;c=e=d=void 0;c=a[b];d=document.createElement("audio");d.setAttribute("preload","auto");d.autobuffer=!0;e=document.createElement("source");e.type="audio/ogg";e.src=c;d.appendChild(e);d.addEventListener("load",function(){d.play();return $(".filename span").html(d.src)},!0);return d.play()};b.prototype.play_using_BUZZJS_WITH_ONE_POOL_PER_SOUND=
function(a,b,c){var d,e,g,h;this.buzzObjectsPool=c;d=void 0;c=this.buzzObjectsPool[b];g=0;for(h=c.length;g<h;g++)if(e=c[g],e.isEnded()){d=e;break}if(void 0===d){if(31<this.totalCreatedSoundObjects){this.soundSystemIsMangled=!0;$("#soundSystemIsMangledMessage").modal();$("#simplemodal-container").height(250);return}d=new this.buzz.sound(a[b]);this.buzzObjectsPool[b].push(d);this.totalCreatedSoundObjects+=1}return d.play()};b.prototype.soundLoop=function(){var a,b,c,d,e;if(!this.soundSystemIsMangled){this.beatNumber+=
1;e=[];a=c=0;for(d=this.soundLoops.soundIDs.length;0<=d?c<d:c>d;a=0<=d?++c:--c)b=this.soundLoops.soundIDs[a],this.soundFilesPaths[b]?(a=this.soundLoops.beatStrings[a],a=a.charAt(this.beatNumber%a.length),"x"===a?e.push(this.playSound(this.soundFilesPaths,b,this.buzzObjectsPool)):e.push(void 0)):e.push(void 0);return e}};b.prototype.changeUpdatesPerMinuteIfNeeded=function(){var a=this;if(this.oldupdatesPerMinute!==this.updatesPerMinute)return clearTimeout(this.soundLoopTimer),0!==this.updatesPerMinute&&
(this.soundLoopTimer=setInterval(function(){return a.soundLoop()},6E4/this.updatesPerMinute)),this.oldupdatesPerMinute=this.updatesPerMinute};b.prototype.isAudioSupported=function(){var a=this;return setTimeout(function(){if(!a.buzz.isSupported())return $("#noAudioMessage").modal(),$("#simplemodal-container").height(200)},500)};b.prototype.checkSound=function(a,b){var c,d=this;c=new this.buzz.sound(b.path);c.load();c.mute();c.bind("ended",function(){c.unbind("ended");c.unmute();d.endedFirstPlay+=
1;if(d.endedFirstPlay===a.sounds.length*d.CHANNELSPERSOUND)return d.eventRouter.trigger("all-sounds-loaded-and tested")});c.play();return this.buzzObjectsPool[b.name].push(c)};b.prototype.loadAndTestAllTheSounds=function(){var a,b,c,d,e,g,h,j=this;c=b=void 0;b=this.samplebank;a=d=0;for(g=b.sounds.length;0<=g?d<g:d>g;a=0<=g?++d:--d)if(c=b.getByNumber(a),this.buzzObjectsPool[c.name]=[],this.soundFilesPaths[c.name]=c.path,this.Bowser.safari){e=0;for(h=this.CHANNELSPERSOUND;0<=h?e<h:e>h;0<=h?++e:--e)setTimeout(function(a,
b){return j.checkSound(a,b)},20*a,b,c)}if(!this.Bowser.safari)return this.eventRouter.trigger("all-sounds-loaded-and tested")};return b}();
var buzz={defaults:{autoplay:!1,duration:5E3,formats:[],loop:!1,placerunner:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(b,a){function f(a){for(var b=[],c=a.length-1,f=0;f<=c;f++)b.push({start:a.start(c),end:a.end(c)});return b}function c(a,b){var c=document.createElement("source");c.src=b;buzz.types[b.split(".").pop()]&&(c.type=buzz.types[b.split(".").pop()]);
a.appendChild(c)}var a=a||{},d=0,e=[],g={},h=buzz.isSupported();this.load=function(){if(!h)return this;this.sound.load();return this};this.play=function(){if(!h)return this;this.sound.play();return this};this.togglePlay=function(){if(!h)return this;this.sound.paused?this.sound.play():this.sound.pause();return this};this.pause=function(){if(!h)return this;this.sound.pause();return this};this.isPaused=function(){return!h?null:this.sound.paused};this.stop=function(){if(!h)return this;this.setTime(0);
this.sound.pause();return this};this.isEnded=function(){return!h?null:this.sound.ended};this.loop=function(){if(!h)return this;this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!h)return this;this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=function(){if(!h)return this;this.sound.muted=!0;return this};this.unmute=function(){if(!h)return this;this.sound.muted=!1;return this};this.toggleMute=
function(){if(!h)return this;this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){return!h?null:this.sound.muted};this.setVolume=function(a){if(!h)return this;0>a&&(a=0);100<a&&(a=100);this.volume=a;this.sound.volume=a/100;return this};this.getVolume=function(){return!h?this:this.volume};this.increaseVolume=function(a){return this.setVolume(this.volume+(a||1))};this.decreaseVolume=function(a){return this.setVolume(this.volume-(a||1))};this.setTime=function(a){if(!h)return this;
this.whenReady(function(){this.sound.currentTime=a});return this};this.getTime=function(){if(!h)return null;var a=Math.round(100*this.sound.currentTime)/100;return isNaN(a)?buzz.defaults.placerunner:a};this.setPercent=function(a){return!h?this:this.setTime(buzz.fromPercent(a,this.sound.duration))};this.getPercent=function(){if(!h)return null;var a=Math.round(buzz.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(a)?buzz.defaults.placerunner:a};this.setSpeed=function(a){if(!h)return this;
this.sound.playbackRate=a};this.getSpeed=function(){return!h?null:this.sound.playbackRate};this.getDuration=function(){if(!h)return null;var a=Math.round(100*this.sound.duration)/100;return isNaN(a)?buzz.defaults.placerunner:a};this.getPlayed=function(){return!h?null:f(this.sound.played)};this.getBuffered=function(){return!h?null:f(this.sound.buffered)};this.getSeekable=function(){return!h?null:f(this.sound.seekable)};this.getErrorCode=function(){return h&&this.sound.error?this.sound.error.code:0};
this.getErrorMessage=function(){if(!h)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){return!h?null:this.sound.readyState};this.getStateMessage=function(){if(!h)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";
case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){return!h?null:this.sound.networkState};this.getNetworkStateMessage=function(){if(!h)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(a,b){if(!h)return this;this.sound[a]=b;return this};this.get=function(a){return!h?null:a?this.sound[a]:this.sound};this.bind=
function(a,b){if(!h)return this;for(var a=a.split(" "),c=this,f=function(a){b.call(c,a)},d=0;d<a.length;d++){var g=a[d],j=g,g=j.split(".")[0];e.push({idx:j,func:f});this.sound.addEventListener(g,f,!0)}return this};this.unbind=function(a){if(!h)return this;for(var a=a.split(" "),b=0;b<a.length;b++)for(var c=a[b],f=c.split(".")[0],d=0;d<e.length;d++){var g=e[d].idx.split(".");if(e[d].idx==c||g[1]&&g[1]==c.replace(".",""))this.sound.removeEventListener(f,e[d].func,!0),e.splice(d,1)}return this};this.bindOnce=
function(a,b){if(!h)return this;var c=this;g[d++]=!1;this.bind(a+"."+d,function(){g[d]||(g[d]=!0,b.call(c));c.unbind(a+"."+d)})};this.trigger=function(a){if(!h)return this;for(var a=a.split(" "),b=0;b<a.length;b++)for(var c=a[b],f=0;f<e.length;f++){var d=e[f].idx.split(".");if(e[f].idx==c||d[0]&&d[0]==c.replace(".","")){var g=document.createEvent("HTMLEvents");g.initEvent(d[0],!1,!0);this.sound.dispatchEvent(g)}}return this};this.fadeTo=function(a,b,c){function f(){setTimeout(function(){d<a&&g.volume<
a?(g.setVolume(g.volume+=1),f()):d>a&&g.volume>a?(g.setVolume(g.volume-=1),f()):c instanceof Function&&c.apply(g)},e)}if(!h)return this;b instanceof Function?(c=b,b=buzz.defaults.duration):b=b||buzz.defaults.duration;var d=this.volume,e=b/Math.abs(d-a),g=this;this.play();this.whenReady(function(){f()});return this};this.fadeIn=function(a,b){return!h?this:this.setVolume(0).fadeTo(100,a,b)};this.fadeOut=function(a,b){return!h?this:this.fadeTo(0,a,b)};this.fadeWith=function(a,b){if(!h)return this;this.fadeOut(b,
function(){this.stop()});a.play().fadeIn(b);return this};this.whenReady=function(a){if(!h)return null;var b=this;0===this.sound.readyState?this.bind("canplay.buzzwhenready",function(){a.call(b)}):a.call(b)};if(h&&b){for(var j in buzz.defaults)buzz.defaults.hasOwnProperty(j)&&(a[j]=a[j]||buzz.defaults[j]);this.sound=document.createElement("audio");if(b instanceof Array)for(var l in b)b.hasOwnProperty(l)&&c(this.sound,b[l]);else if(a.formats.length)for(var m in a.formats)a.formats.hasOwnProperty(m)&&
c(this.sound,b+"."+a.formats[m]);else c(this.sound,b);a.loop&&this.loop();a.autoplay&&(this.sound.autoplay="autoplay");this.sound.preload=!0===a.preload?"auto":!1===a.preload?"none":a.preload;this.setVolume(a.volume);buzz.sounds.push(this)}},group:function(b){function a(){for(var a=f(null,arguments),d=a.shift(),e=0;e<b.length;e++)b[e][d].apply(b[e],a)}function f(a,b){return a instanceof Array?a:Array.prototype.slice.call(b)}b=f(b,arguments);this.getSounds=function(){return b};this.add=function(a){for(var a=
f(a,arguments),d=0;d<a.length;d++)b.push(a[d])};this.remove=function(a){for(var a=f(a,arguments),d=0;d<a.length;d++)for(var e=0;e<b.length;e++)if(b[e]==a[d]){b.splice(e,1);break}};this.load=function(){a("load");return this};this.play=function(){a("play");return this};this.togglePlay=function(){a("togglePlay");return this};this.pause=function(b){a("pause",b);return this};this.stop=function(){a("stop");return this};this.mute=function(){a("mute");return this};this.unmute=function(){a("unmute");return this};
this.toggleMute=function(){a("toggleMute");return this};this.setVolume=function(b){a("setVolume",b);return this};this.increaseVolume=function(b){a("increaseVolume",b);return this};this.decreaseVolume=function(b){a("decreaseVolume",b);return this};this.loop=function(){a("loop");return this};this.unloop=function(){a("unloop");return this};this.setTime=function(b){a("setTime",b);return this};this.set=function(b,f){a("set",b,f);return this};this.bind=function(b,f){a("bind",b,f);return this};this.unbind=
function(b){a("unbind",b);return this};this.bindOnce=function(b,f){a("bindOnce",b,f);return this};this.trigger=function(b){a("trigger",b);return this};this.fade=function(b,f,e,g){a("fade",b,f,e,g);return this};this.fadeIn=function(b,f){a("fadeIn",b,f);return this};this.fadeOut=function(b,f){a("fadeOut",b,f);return this}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return!!buzz.el.canPlayType},isOGGSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},
isWAVSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(b,a){var f,c,d;f=Math.floor(b/3600);f=isNaN(f)?"--":10<=f?f:"0"+f;c=a?Math.floor(b/60%60):Math.floor(b/60);c=isNaN(c)?"--":10<=c?c:"0"+c;d=Math.floor(b%60);d=isNaN(d)?
"--":10<=d?d:"0"+d;return a?f+":"+c+":"+d:c+":"+d},fromTimer:function(b){var a=b.toString().split(":");a&&3==a.length&&(b=3600*parseInt(a[0],10)+60*parseInt(a[1],10)+parseInt(a[2],10));a&&2==a.length&&(b=60*parseInt(a[0],10)+parseInt(a[1],10));return b},toPercent:function(b,a,f){f=Math.pow(10,f||0);return Math.round(100*b/a*f)/f},fromPercent:function(b,a,f){f=Math.pow(10,f||0);return Math.round(a/100*b*f)/f}},AnimationLoop,lastTime,vendors,x;
AnimationLoop=function(){function b(a,b,c,d){this.eventRouter=a;this.stats=b;this.liveCodeLabCoreInstance=c;this.forceUseOfTimeoutForScheduling=null!=d?d:!1;this.wantedFramesPerSecond=this.AS_HIGH_FPS_AS_POSSIBLE;window.frame=0}b.prototype.loopInterval=null;b.prototype.wantedFramesPerSecond=null;b.prototype.liveCodeLabCoreInstance=void 0;b.prototype.AS_HIGH_FPS_AS_POSSIBLE=-1;b.prototype.scheduleNextFrame=function(){var a,b=this;if(this.forceUseOfTimeoutForScheduling)return this.wantedFramesPerSecond===
this.AS_HIGH_FPS_AS_POSSIBLE?setTimeout(function(){return b.animate()},1E3/60):setTimeout(function(){return b.animate()},1E3/this.wantedFramesPerSecond);if(this.wantedFramesPerSecond===this.AS_HIGH_FPS_AS_POSSIBLE)return window.requestAnimationFrame(function(){return b.animate()});if(void 0===a)return a=setInterval(function(){return window.requestAnimationFrame(function(){return this.animate()})},1E3/this.wantedFramesPerSecond)};b.prototype.animate=function(){var a;this.liveCodeLabCoreInstance.matrixCommands.resetMatrixStack();
this.liveCodeLabCoreInstance.soundSystem.resetLoops();0===window.frame?this.liveCodeLabCoreInstance.timeKeeper.resetTime():this.liveCodeLabCoreInstance.timeKeeper.updateTime();this.liveCodeLabCoreInstance.drawFunctionRunner.resetTrackingOfDoOnceOccurrences();this.liveCodeLabCoreInstance.soundSystem.anyCodeReactingTobpm=!1;this.liveCodeLabCoreInstance.soundSystem.SetUpdatesPerMinute(240);this.liveCodeLabCoreInstance.lightSystem.noLights();this.liveCodeLabCoreInstance.graphicsCommands.reset();this.liveCodeLabCoreInstance.blendControls.animationStyle(this.liveCodeLabCoreInstance.blendControls.animationStyles.normal);
this.liveCodeLabCoreInstance.backgroundPainter.resetGradientStack();if(this.liveCodeLabCoreInstance.drawFunctionRunner.drawFunction){this.scheduleNextFrame();try{this.liveCodeLabCoreInstance.drawFunctionRunner.runDrawFunction()}catch(b){this.eventRouter.trigger("runtime-error-thrown",b);return}a=this.liveCodeLabCoreInstance.drawFunctionRunner;a.putTicksNextToDoOnceBlocksThatHaveBeenRun(this.liveCodeLabCoreInstance.codeTransformer)}else this.liveCodeLabCoreInstance.dozingOff=!0,window.frame=0;0===
frame&&this.liveCodeLabCoreInstance.timeKeeper.resetTime();this.liveCodeLabCoreInstance.blendControls.animationStyleUpdateIfChanged();this.liveCodeLabCoreInstance.backgroundPainter.simpleGradientUpdateIfChanged();this.liveCodeLabCoreInstance.soundSystem.changeUpdatesPerMinuteIfNeeded();window.frame++;this.liveCodeLabCoreInstance.renderer.render(this.liveCodeLabCoreInstance.graphicsCommands);if(this.stats)return this.stats.update()};return b}();lastTime=0;vendors=["ms","moz","webkit","o"];
for(x=0;x<vendors.length&&!window.requestAnimationFrame;)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"],++x;window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var a,f,c;a=(new Date).getTime();c=Math.max(0,16-(a-lastTime));f=window.setTimeout(function(){return b(a+c)},c);lastTime=a+c;return f});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(b){return clearTimeout(b)});var ThreeJsSystem;
ThreeJsSystem=function(){function b(a,b,c,d,e,g){this.blendedThreeJsSceneCanvas=c;this.forceCanvasRenderer=d;if(!this.blendedThreeJsSceneCanvas){this.blendedThreeJsSceneCanvas=document.createElement("canvas");this.blendedThreeJsSceneCanvas.width=window.innerWidth;this.blendedThreeJsSceneCanvas.height=window.innerHeight}if(!this.forceCanvasRenderer&&a.webgl){this.ballDefaultDetLevel=16;this.blendedThreeJsSceneCanvasContext=this.blendedThreeJsSceneCanvas.getContext("experimental-webgl");this.renderer=
new g.WebGLRenderer({canvas:this.blendedThreeJsSceneCanvas,preserveDrawingBuffer:e,antialias:false,premultipliedAlpha:false});this.isWebGLUsed=true}else{this.ballDefaultDetLevel=6;a=this.currentFrameThreeJsSceneCanvas=document.createElement("canvas");a.width=this.blendedThreeJsSceneCanvas.width;a.height=this.blendedThreeJsSceneCanvas.height;this.currentFrameThreeJsSceneCanvasContext=a.getContext("2d");c=this.previousFrameThreeJSSceneRenderForBlendingCanvas=document.createElement("canvas");c.width=
this.blendedThreeJsSceneCanvas.width;c.height=this.blendedThreeJsSceneCanvas.height;this.previousFrameThreeJSSceneRenderForBlendingCanvasContext=this.previousFrameThreeJSSceneRenderForBlendingCanvas.getContext("2d");this.blendedThreeJsSceneCanvasContext=this.blendedThreeJsSceneCanvas.getContext("2d");this.renderer=new g.CanvasRenderer({canvas:a,antialias:true,preserveDrawingBuffer:e})}this.renderer.setSize(this.blendedThreeJsSceneCanvas.width,this.blendedThreeJsSceneCanvas.height);this.scene=new g.Scene;
this.scene.matrixAutoUpdate=false;this.camera=new g.PerspectiveCamera(35,this.blendedThreeJsSceneCanvas.width/this.blendedThreeJsSceneCanvas.height,1,1E4);this.camera.position.set(0,0,5);this.scene.add(this.camera);b.WindowResize.bind(this.renderer,this.camera);if(this.isWebGLUsed){e={format:g.RGBAFormat,stencilBuffer:true};b=new g.WebGLRenderTarget(this.blendedThreeJsSceneCanvas.width,this.blendedThreeJsSceneCanvas.height,e);e=new g.SavePass(new g.WebGLRenderTarget(this.blendedThreeJsSceneCanvas.width,
this.blendedThreeJsSceneCanvas.height,e));e.clear=false;this.effectBlend=new g.ShaderPass(g.ShaderExtras.blend,"tDiffuse1");c=new g.ShaderPass(g.ShaderExtras.screen);this.effectBlend.uniforms.tDiffuse2.value=e.renderTarget;this.effectBlend.uniforms.mixRatio.value=0;a=new g.RenderPass(this.scene,this.camera);this.composer=new g.EffectComposer(this.renderer,b);this.composer.addPass(a);this.composer.addPass(this.effectBlend);this.composer.addPass(e);this.composer.addPass(c);c.renderToScreen=true}}b.isWebGLUsed=
false;b.composer={};return b}();var Renderer;
Renderer=function(){function b(a){this.liveCodeLabCoreInstance=a}b.prototype.render=function(a){var b,c,d,e;e=this.liveCodeLabCoreInstance.threeJsSystem;d=e.renderer;b=e.blendedThreeJsSceneCanvasContext;c=e.previousFrameThreeJSSceneRenderForBlendingCanvasContext;this.combDisplayList(a);if(e.isWebGLUsed)return e.composer.render();d.render(e.scene,e.camera);b.globalAlpha=1;b.clearRect(0,0,window.innerWidth,window.innerHeight);b.globalAlpha=this.liveCodeLabCoreInstance.blendControls.blendAmount;b.drawImage(e.previousFrameThreeJSSceneRenderForBlendingCanvas,
0,0);b.globalAlpha=1;b.drawImage(e.currentFrameThreeJsSceneCanvas,0,0);c.globalCompositeOperation="copy";c.drawImage(e.blendedThreeJsSceneCanvas,0,0);return e.currentFrameThreeJsSceneCanvasContext.clearRect(0,0,window.innerWidth,window.innerHeight)};b.prototype.combDisplayList=function(a){var b,c,d,e,g;b=this.liveCodeLabCoreInstance.threeJsSystem;a=a.objectsUsedInFrameCounts;e=b.scene.children;g=[];c=0;for(d=e.length;c<d;c++){b=e[c];if(a[b.primitiveType+b.detailLevel]>0){b.visible=true;g.push(a[b.primitiveType+
b.detailLevel]=a[b.primitiveType+b.detailLevel]-1)}else g.push(b.visible=false)}return g};return b}();var ColourLiterals;
ColourLiterals=function(){function b(){var a,b,c;c={aliceblue:"0xfff0f8ff",antiquewhite:"0xfffaebd7",aqua:"0xff00ffff",aquamarine:"0xff7fffd4",azure:"0xfff0ffff",beige:"0xfff5f5dc",bisque:"0xffffe4c4",black:"0xff000000",blanchedalmond:"0xffffebcd",blue:"0xff0000ff",blueviolet:"0xff8a2be2",brown:"0xffa52a2a",burlywood:"0xffdeb887",cadetblue:"0xff5f9ea0",chartreuse:"0xff7fff00",chocolate:"0xffd2691e",coral:"0xffff7f50",cornflowerblue:"0xff6495ed",cornsilk:"0xfffff8dc",crimson:"0xffdc143c",cyan:"0xff00ffff",
darkblue:"0xff00008b",darkcyan:"0xff008b8b",darkgoldenrod:"0xffb8860b",darkgray:"0xffa9a9a9",darkgrey:"0xffa9a9a9",darkgreen:"0xff006400",darkkhaki:"0xffbdb76b",darkmagenta:"0xff8b008b",darkolivegreen:"0xff556b2f",darkorange:"0xffff8c00",darkorchid:"0xff9932cc",darkred:"0xff8b0000",darksalmon:"0xffe9967a",darkseagreen:"0xff8fbc8f",darkslateblue:"0xff483d8b",darkslategray:"0xff2f4f4f",darkslategrey:"0xff2f4f4f",darkturquoise:"0xff00ced1",darkviolet:"0xff9400d3",deeppink:"0xffff1493",deepskyblue:"0xff00bfff",
dimgray:"0xff696969",dimgrey:"0xff696969",dodgerblue:"0xff1e90ff",firebrick:"0xffb22222",floralwhite:"0xfffffaf0",forestgreen:"0xff228b22",fuchsia:"0xffff00ff",gainsboro:"0xffdcdcdc",ghostwhite:"0xfff8f8ff",gold:"0xffffd700",goldenrod:"0xffdaa520",gray:"0xff808080",grey:"0xff808080",green:"0xff008000",greenyellow:"0xffadff2f",honeydew:"0xfff0fff0",hotpink:"0xffff69b4",indianred:"0xffcd5c5c",indigo:"0xff4b0082",ivory:"0xfffffff0",khaki:"0xfff0e68c",lavender:"0xffe6e6fa",lavenderblush:"0xfffff0f5",
lawngreen:"0xff7cfc00",lemonchiffon:"0xfffffacd",lightblue:"0xffadd8e6",lightcoral:"0xfff08080",lightcyan:"0xffe0ffff",lightgoldenrodyellow:"0xfffafad2",lightgrey:"0xffd3d3d3",lightgray:"0xffd3d3d3",lightgreen:"0xff90ee90",lightpink:"0xffffb6c1",lightsalmon:"0xffffa07a",lightseagreen:"0xff20b2aa",lightskyblue:"0xff87cefa",lightslategray:"0xff778899",lightslategrey:"0xff778899",lightsteelblue:"0xffb0c4de",lightyellow:"0xffffffe0",lime:"0xff00ff00",limegreen:"0xff32cd32",linen:"0xfffaf0e6",magenta:"0xffff00ff",
maroon:"0xff800000",mediumaquamarine:"0xff66cdaa",mediumblue:"0xff0000cd",mediumorchid:"0xffba55d3",mediumpurple:"0xff9370d8",mediumseagreen:"0xff3cb371",mediumslateblue:"0xff7b68ee",mediumspringgreen:"0xff00fa9a",mediumturquoise:"0xff48d1cc",mediumvioletred:"0xffc71585",midnightblue:"0xff191970",mintcream:"0xfff5fffa",mistyrose:"0xffffe4e1",moccasin:"0xffffe4b5",navajowhite:"0xffffdead",navy:"0xff000080",oldlace:"0xfffdf5e6",olive:"0xff808000",olivedrab:"0xff6b8e23",orange:"0xffffa500",orangered:"0xffff4500",
orchid:"0xffda70d6",palegoldenrod:"0xffeee8aa",palegreen:"0xff98fb98",paleturquoise:"0xffafeeee",palevioletred:"0xffd87093",papayawhip:"0xffffefd5",peachpuff:"0xffffdab9",peru:"0xffcd853f",pink:"0xffffc0cb",plum:"0xffdda0dd",powderblue:"0xffb0e0e6",purple:"0xff800080",red:"0xffff0000",rosybrown:"0xffbc8f8f",royalblue:"0xff4169e1",saddlebrown:"0xff8b4513",salmon:"0xfffa8072",sandybrown:"0xfff4a460",seagreen:"0xff2e8b57",seashell:"0xfffff5ee",sienna:"0xffa0522d",silver:"0xffc0c0c0",skyblue:"0xff87ceeb",
slateblue:"0xff6a5acd",slategray:"0xff708090",slategrey:"0xff708090",snow:"0xfffffafa",springgreen:"0xff00ff7f",steelblue:"0xff4682b4",tan:"0xffd2b48c",teal:"0xff008080",thistle:"0xffd8bfd8",tomato:"0xffff6347",turquoise:"0xff40e0d0",violet:"0xffee82ee",wheat:"0xfff5deb3",white:"0xffffffff",whitesmoke:"0xfff5f5f5",yellow:"0xffffff00",yellowgreen:"0xff9acd32",angleColor:"angleColor"};for(a in c){b=c[a];window[""+a]=parseInt(b);isNaN(window[""+a])&&(window[""+a]=b);this.colourNames.push(""+a)}}b.prototype.colourNames=
[];return b}();
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(b){return false}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var b=document.createElement("div");b.id="webgl-error-message";b.style.fontFamily="monospace";b.style.fontSize="13px";b.style.fontWeight="normal";b.style.textAlign="center";
b.style.background="#fff";b.style.color="#000";b.style.padding="1.5em";b.style.width="400px";b.style.margin="5em auto 0";if(!this.webgl)b.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.';
return b},addGetWebGLMessage:function(b){var a,f,b=b||{};a=b.parent!==void 0?b.parent:document.body;b=b.id!==void 0?b.id:"oldie";f=Detector.getWebGLErrorMessage();f.id=b;a.appendChild(f)}},badgeHeight=16,Stats=function(){var b,a,f=1,c=0,d=Date.now(),e=d,g=d,h=0,j=1E3,l=0,m,i,p,q=[[0,0,0],[255,255,255]],n=0,k=1E3,r=0,o,s,t,u=[[0,0,0],[255,255,255]];b=document.createElement("div");b.setAttribute("id","statsWidget");b.style.display="none";b.style.cursor="pointer";b.style.cursor="pointer";b.style.width=
"74px";b.style.zIndex="6";b.addEventListener("mousedown",function(a){a.preventDefault();f=(f+1)%2;if(f==0){m.style.display="block";o.style.display="none"}else{m.style.display="none";o.style.display="block"}},false);m=document.createElement("div");m.style.textAlign="right";m.style.lineHeight="1.2em";m.style.backgroundColor="rgb(0,0,0)";m.style.padding="0 0 0px 0px";m.style.display="none";b.appendChild(m);i=document.createElement("div");i.style.fontFamily="Helvetica, Arial, sans-serif";i.style.fontSize=
"9px";i.style.color="rgb("+q[1][0]+","+q[1][1]+","+q[1][2]+")";i.style.fontWeight="bold";i.innerHTML="FPS";m.appendChild(i);p=document.createElement("div");p.style.position="relative";p.style.width="74px";p.style.height=badgeHeight+"px";p.style.backgroundColor="rgb("+q[1][0]+","+q[1][1]+","+q[1][2]+")";for(m.appendChild(p);p.children.length<74;){a=document.createElement("span");a.style.width="1px";a.style.height=badgeHeight+"px";a.style.cssFloat="left";a.style.backgroundColor="rgb("+q[0][0]+","+q[0][1]+
","+q[0][2]+")";p.appendChild(a)}o=document.createElement("div");o.style.textAlign="right";o.style.lineHeight="1.2em";o.style.backgroundColor="rgb(0,0,0)";o.style.padding="0 0 0px 0px";o.style.display="block";b.appendChild(o);s=document.createElement("div");s.style.fontFamily="Helvetica, Arial, sans-serif";s.style.fontSize="9px";s.style.color="rgb("+u[1][0]+","+u[1][1]+","+u[1][2]+")";s.style.fontWeight="bold";s.innerHTML="MS";o.appendChild(s);t=document.createElement("div");t.style.position="relative";
t.style.width="74px";t.style.height=badgeHeight+"px";t.style.backgroundColor="rgb("+u[1][0]+","+u[1][1]+","+u[1][2]+")";for(o.appendChild(t);t.children.length<74;){a=document.createElement("span");a.style.width="1px";a.style.height=Math.random()*badgeHeight+"px";a.style.cssFloat="left";a.style.backgroundColor="rgb("+u[0][0]+","+u[0][1]+","+u[0][2]+")";t.appendChild(a)}return{getDomElement:function(){return b},getFps:function(){return h},getFpsMin:function(){return j},getFpsMax:function(){return l},
getMs:function(){return n},getMsMin:function(){return k},getMsMax:function(){return r},update:function(){d=Date.now();n=d-e;k=Math.min(k,n);r=Math.max(r,n);s.textContent=n+" MS ";var a=Math.min(badgeHeight,badgeHeight-n/200*badgeHeight);t.appendChild(t.firstChild).style.height=a+"px";e=d;c++;if(d>g+1E3){h=Math.round(c*1E3/(d-g));j=Math.min(j,h);l=Math.max(l,h);i.textContent=h+" FPS ("+j+"-"+l+")";a=Math.min(badgeHeight,badgeHeight-h/100*badgeHeight);p.appendChild(p.firstChild).style.height=a+"px";
g=d;c=0}}}},THREEx=THREEx||{};THREEx.WindowResize=function(b,a){var f=function(){b.setSize(window.innerWidth,window.innerHeight);a.aspect=window.innerWidth/window.innerHeight;a.updateProjectionMatrix()};window.addEventListener("resize",f,false);return{stop:function(){window.removeEventListener("resize",f)}}};THREEx.WindowResize.bind=function(b,a){return THREEx.WindowResize(b,a)};
THREE.ShaderExtras={screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},convolution:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},
uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"uniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\nvUv = uv - ( ( KERNEL_SIZE - 1.0 ) / 2.0 ) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cKernel[ KERNEL_SIZE ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i = 0; i < KERNEL_SIZE; i ++ ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
bokeh:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},aspect:{type:"f",value:1},aperture:{type:"f",value:0.025},maxblur:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"},
dofmipmap:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},maxblur:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float focus;\nuniform float maxblur;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\nvoid main() {\nvec4 depth = texture2D( tDepth, vUv );\nfloat factor = depth.x - focus;\nvec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );\ngl_FragColor = col;\ngl_FragColor.a = 1.0;\n}"},
sepia:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},amount:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nvec3 c = color.rgb;\ncolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\ncolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\ncolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\ngl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"},
dotscreen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(0.5,0.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\nfloat s = sin( angle ), c = cos( angle );\nvec2 tex = vUv * tSize - center;\nvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\nreturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nfloat average = ( color.r + color.g + color.b ) / 3.0;\ngl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"},
vignette:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\ngl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"},
bleachbypass:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 base = texture2D( tDiffuse, vUv );\nvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\nfloat lum = dot( lumCoeff, base.rgb );\nvec3 blend = vec3( lum );\nfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\nvec3 result1 = 2.0 * base.rgb * blend;\nvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\nvec3 newColor = mix( result1, result2, L );\nfloat A2 = opacity * base.a;\nvec3 mixRGB = A2 * newColor.rgb;\nmixRGB += ( ( 1.0 - A2 ) * base.rgb );\ngl_FragColor = vec4( mixRGB, base.a );\n}"},
focus:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:0.94},waveFactor:{type:"f",value:0.00125}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float sampleDistance;\nuniform float waveFactor;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( tDiffuse, uv );\nvin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );\nsample_dist = dot( vin, vin ) * 2.0;\nf = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\ncolor = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );\ncolor = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );\ngl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );\n}"},
triangleBlur:{uniforms:{texture:{type:"t",value:0,texture:null},delta:{type:"v2",value:new THREE.Vector2(1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define ITERATIONS 10.0\nuniform sampler2D texture;\nuniform vec2 delta;\nvarying vec2 vUv;\nfloat random( vec3 scale, float seed ) {\nreturn fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );\n}\nvoid main() {\nvec4 color = vec4( 0.0 );\nfloat total = 0.0;\nfloat offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );\nfor ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {\nfloat percent = ( t + offset - 0.5 ) / ITERATIONS;\nfloat weight = 1.0 - abs( percent );\ncolor += texture2D( texture, vUv + delta * percent ) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}"},
basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"},horizontalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \tvUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"},
verticalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t  ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\ngl_FragColor = sum;\n}"},
horizontalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat hh = h * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \t vUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"},
verticalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat vv = v * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t   ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;\ngl_FragColor = sum;\n}"},
blend:{uniforms:{tDiffuse1:{type:"t",value:0,texture:null},tDiffuse2:{type:"t",value:1,texture:null},mixRatio:{type:"f",value:0.5},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform float mixRatio;\nuniform sampler2D tDiffuse1;\nuniform sampler2D tDiffuse2;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel1 = texture2D( tDiffuse1, vUv );\nvec4 texel2 = texture2D( tDiffuse2, vUv );\nvec3 ca = vec3(texel1.x,texel1.y,texel1.z);\nvec3 cb = vec3(texel2.x,texel2.y,texel2.z);\nfloat alphaa = texel1.w ;\nfloat alphab = texel2.w*mixRatio;\nfloat alphao = (alphaa + alphab * (1.0-alphaa));\nvec3 co = (1.0/alphao) * (ca * alphaa + cb*alphab*(1.0-alphaa));\nvec4 mixxx = vec4(co, alphao );\ngl_FragColor =  mixxx;\n}"},
fxaa:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nfloat opacity  = rgbaM.w;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec3 rgbA = 0.5 * (\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz +\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz );\nfloat lumaB = dot( rgbB, luma );\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\ngl_FragColor = vec4( rgbA, opacity );\n} else {\ngl_FragColor = vec4( rgbB, opacity );\n}\n}"},
luminosity:{uniforms:{tDiffuse:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v, v, v, texel.w );\n}"},colorCorrection:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},powRGB:{type:"v3",value:new THREE.Vector3(2,2,2)},mulRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec3 powRGB;\nuniform vec3 mulRGB;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb = mulRGB * pow( gl_FragColor.rgb, powRGB );\n}"},
normalmap:{uniforms:{heightMap:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(512,512)},scale:{type:"v2",value:new THREE.Vector2(1,1)},height:{type:"f",value:0.05}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\nfloat val = texture2D( heightMap, vUv ).x;\nfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\nfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\ngl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"},
ssao:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},size:{type:"v2",value:new THREE.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},fogNear:{type:"f",value:5},fogFar:{type:"f",value:100},fogEnabled:{type:"i",value:0},aoClamp:{type:"f",value:0.3}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cameraNear;\nuniform float cameraFar;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogEnabled;\nuniform vec2 size;\nuniform float aoClamp;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nfloat width = size.x;\nfloat height = size.y;\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nconst int samples = 8;\nconst float radius = 5.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0002;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\nconst bool onlyAO = false;\nconst float lumInfluence = 0.3;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( width / 2.0 ) );\nfloat gg = fract( coord.t * ( height / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat doFog() {\nfloat zdepth = unpackDepth( texture2D( tDepth, vUv ) );\nfloat depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );\nreturn smoothstep( fogNear, fogFar, depth );\n}\nfloat readDepth( const in vec2 coord ) {\nreturn cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat pw;\nfloat ph;\nfloat ao;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\npw = cos( l ) * r;\nph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nif ( fogEnabled ) {\nao = mix( ao, 1.0, doFog() );\n}\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"},
colorify:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v * color, texel.w );\n}"},
unpackDepthRGBA:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvoid main() {\nfloat depth = 1.0 - unpackDepth( texture2D( tDiffuse, vUv ) );\ngl_FragColor = opacity * vec4( vec3( depth ), 1.0 );\n}"},
buildKernel:function(b){var a,f,c,d,e=2*Math.ceil(b*3)+1;e>25&&(e=25);d=(e-1)*0.5;f=Array(e);for(a=c=0;a<e;++a){f[a]=Math.exp(-((a-d)*(a-d))/(2*b*b));c=c+f[a]}for(a=0;a<e;++a)f[a]=f[a]/c;return f}};
THREE.EffectComposer=function(b,a){this.renderer=b;this.renderTarget1=a;if(this.renderTarget1===void 0){var f=window.innerWidth||1,c=window.innerHeight||1;this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};this.renderTarget1=new THREE.WebGLRenderTarget(f,c,this.renderTargetParameters)}this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=
new THREE.ShaderPass(THREE.ShaderExtras.screen)};
THREE.EffectComposer.prototype={swapBuffers:function(){var b=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=b},addPass:function(b){this.passes.push(b)},render:function(b){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var a=false,f,c,d=this.passes.length;for(c=0;c<d;c++){f=this.passes[c];if(f.enabled){f.render(this.renderer,this.writeBuffer,this.readBuffer,b,a);if(f.needsSwap){if(a){var e=this.renderer.context;e.stencilFunc(e.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,
this.writeBuffer,this.readBuffer,b);e.stencilFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}f instanceof THREE.MaskPass?a=true:f instanceof THREE.ClearMaskPass&&(a=false)}}},reset:function(b){this.renderTarget1=b;if(this.renderTarget1===void 0)this.renderTarget1=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters);this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2}};
THREE.EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);THREE.EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null);THREE.EffectComposer.scene=new THREE.Scene;THREE.EffectComposer.scene.add(THREE.EffectComposer.quad);THREE.RenderPass=function(b,a,f,c,d){this.scene=b;this.camera=a;this.overrideMaterial=f;this.clearColor=c;this.clearAlpha=d!==void 0?d:1;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.clear=this.enabled=true;this.needsSwap=false};
THREE.RenderPass.prototype={render:function(b,a,f){this.scene.overrideMaterial=this.overrideMaterial;if(this.clearColor){this.oldClearColor.copy(b.getClearColor());this.oldClearAlpha=b.getClearAlpha();b.setClearColor(this.clearColor,this.clearAlpha)}b.render(this.scene,this.camera,f,this.clear);this.clearColor&&b.setClearColor(this.oldClearColor,this.oldClearAlpha);this.scene.overrideMaterial=null}};
THREE.ShaderPass=function(b,a){this.textureID=a!==void 0?a:"tDiffuse";this.uniforms=THREE.UniformsUtils.clone(b.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader});this.renderToScreen=false;this.needsSwap=this.enabled=true;this.clear=false};
THREE.ShaderPass.prototype={render:function(b,a,f){if(this.uniforms[this.textureID])this.uniforms[this.textureID].value=f;THREE.EffectComposer.quad.material=this.material;this.renderToScreen?b.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):b.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,a,this.clear)}};THREE.MaskPass=function(b,a){this.scene=b;this.camera=a;this.clear=this.enabled=true;this.inverse=this.needsSwap=false};
THREE.MaskPass.prototype={render:function(b,a,f){var c=b.context;c.colorMask(false,false,false,false);c.depthMask(false);var d,e;if(this.inverse){d=0;e=1}else{d=1;e=0}c.enable(c.STENCIL_TEST);c.stencilOp(c.REPLACE,c.REPLACE,c.REPLACE);c.stencilFunc(c.ALWAYS,d,4294967295);c.clearStencil(e);b.render(this.scene,this.camera,f,this.clear);b.render(this.scene,this.camera,a,this.clear);c.colorMask(true,true,true,true);c.depthMask(true);c.stencilFunc(c.EQUAL,1,4294967295);c.stencilOp(c.KEEP,c.KEEP,c.KEEP)}};
THREE.ClearMaskPass=function(){this.enabled=true};THREE.ClearMaskPass.prototype={render:function(b){b=b.context;b.disable(b.STENCIL_TEST)}};
THREE.SavePass=function(b){var a=THREE.ShaderExtras.screen;this.textureID="tDiffuse";this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader});this.renderTarget=b;if(this.renderTarget===void 0){this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};this.renderTarget=new THREE.WebGLRenderTarget(window.innerWidth,
window.innerHeight,this.renderTargetParameters)}this.enabled=true;this.clear=this.needsSwap=false};THREE.SavePass.prototype={render:function(b,a,f){if(this.uniforms[this.textureID])this.uniforms[this.textureID].value=f;THREE.EffectComposer.quad.material=this.material;b.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTarget,this.clear)}};Number.prototype.times=function(b,a){var f,c,d;c=this.valueOf();f=0;for(d=[];f<c;){b.call(a||window,f);d.push(f++)}return d};
window.back=function(){};window.forward=function(){};window.close=function(){};var BackgroundPainter;
BackgroundPainter=function(){function b(a,b){var c,d=this;this.canvasForBackground=a;this.liveCodeLabCoreInstance=b;this.gradStack=[];this.defaultGradientColor1=orange;this.defaultGradientColor2=red;this.defaultGradientColor3=black;this.whichDefaultBackground=void 0;this.currentGradientStackValue="";this.previousGradientStackValue=0;if(!this.canvasForBackground)this.canvasForBackground=document.createElement("canvas");c=1/15;this.canvasForBackground.width=Math.floor(window.innerWidth*c);this.canvasForBackground.height=
Math.floor(window.innerHeight*c);this.backgroundSceneContext=this.canvasForBackground.getContext("2d");window.simpleGradient=function(a,b,f){return d.simpleGradient(a,b,f)};window.background=function(a,b,f){return d.background(a,b,f)}}b.prototype.simpleGradient=function(a,b,c,d){this.currentGradientStackValue=this.currentGradientStackValue+" "+a+""+b+""+c+""+d+"null ";return this.gradStack.push({gradStacka:this.liveCodeLabCoreInstance.colourFunctions.color(a),gradStackb:this.liveCodeLabCoreInstance.colourFunctions.color(b),
gradStackc:this.liveCodeLabCoreInstance.colourFunctions.color(c),gradStackd:this.liveCodeLabCoreInstance.colourFunctions.color(d),solid:null})};b.prototype.background=function(a,b,c,d){a=this.liveCodeLabCoreInstance.colourFunctions.color(a,b,c,d);this.currentGradientStackValue=this.currentGradientStackValue+" null null null null "+a+" ";return this.gradStack.push({gradStacka:void 0,gradStackb:void 0,gradStackc:void 0,gradStackd:void 0,solid:a})};b.prototype.paintARandomBackground=function(){this.whichDefaultBackground=
this.whichDefaultBackground===void 0?Math.floor(Math.random()*5):(this.whichDefaultBackground+1)%5;switch(this.whichDefaultBackground){case 0:this.defaultGradientColor1=orange;this.defaultGradientColor2=red;this.defaultGradientColor3=black;$("#fakeStartingBlinkingCursor").css("color","white");break;case 1:this.defaultGradientColor1=white;this.defaultGradientColor2=khaki;this.defaultGradientColor3=peachpuff;$("#fakeStartingBlinkingCursor").css("color","LightPink");break;case 2:this.defaultGradientColor1=
lightsteelblue;this.defaultGradientColor2=lightcyan;this.defaultGradientColor3=paleturquoise;$("#fakeStartingBlinkingCursor").css("color","CadetBlue");break;case 3:this.defaultGradientColor1=silver;this.defaultGradientColor2=lightgrey;this.defaultGradientColor3=gainsboro;$("#fakeStartingBlinkingCursor").css("color","white");break;case 4:this.defaultGradientColor1=this.liveCodeLabCoreInstance.colourFunctions.color(155,255,155);this.defaultGradientColor2=this.liveCodeLabCoreInstance.colourFunctions.color(155,
255,155);this.defaultGradientColor3=this.liveCodeLabCoreInstance.colourFunctions.color(155,255,155);$("#fakeStartingBlinkingCursor").css("color","DarkOliveGreen")}this.resetGradientStack();return this.simpleGradientUpdateIfChanged()};b.prototype.resetGradientStack=function(){this.currentGradientStackValue="";this.gradStack=[];return this.simpleGradient(this.defaultGradientColor1,this.defaultGradientColor2,this.defaultGradientColor3)};b.prototype.simpleGradientUpdateIfChanged=function(){var a,b,c,
d,e,g,h;a=this.liveCodeLabCoreInstance.colourFunctions.color;if(this.currentGradientStackValue!==this.previousGradientStackValue){this.previousGradientStackValue=this.currentGradientStackValue;Math.sqrt(Math.pow(this.canvasForBackground.width/2,2)+Math.pow(this.canvasForBackground.height/2,2));g=this.gradStack;h=[];d=0;for(e=g.length;d<e;d++){c=g[d];if(c.gradStacka!==void 0){b=this.backgroundSceneContext.createLinearGradient(this.canvasForBackground.width/2,0,this.canvasForBackground.width/2,this.canvasForBackground.height);
b.addColorStop(0,a.toString(c.gradStacka));b.addColorStop(0.5,a.toString(c.gradStackb));b.addColorStop(1,a.toString(c.gradStackc));this.backgroundSceneContext.globalAlpha=1;this.backgroundSceneContext.fillStyle=b}else{this.backgroundSceneContext.globalAlpha=1;this.backgroundSceneContext.fillStyle=a.toString(c.solid)}h.push(this.backgroundSceneContext.fillRect(0,0,this.canvasForBackground.width,this.canvasForBackground.height))}return h}};return b}();var Editor;
Editor=function(){function b(a,b){var c=this;this.eventRouter=a;this.eventRouter.bind("reset",function(){return c.codemirrorInstance.setValue("")});this.eventRouter.bind("code-updated-by-livecodelab",function(a){var b;b=c.codemirrorInstance.getCursor();b.ch=b.ch+1;c.setValue(a);return c.setCursor(b)});this.codemirrorInstance=b.fromTextArea(document.getElementById("code"),{mode:"livecodelab",theme:"night",lineNumbers:false,indentWithTabs:true,tabSize:1,indentUnit:1,lineWrapping:true,onBlur:function(){return setTimeout(c.codemirrorInstance.focus,
30)},onChange:function(){return c.eventRouter.trigger("code_changed",c.codemirrorInstance.getValue())},onCursorActivity:function(){return c.suspendDimmingAndCheckIfLink()}})}b.prototype.focus=function(){return this.codemirrorInstance.focus()};b.prototype.getValue=function(){return this.codemirrorInstance.getValue()};b.prototype.getCursor=function(a){return this.codemirrorInstance.getCursor(a)};b.prototype.setCursor=function(a,b){return this.codemirrorInstance.setCursor(a,b)};b.prototype.clearHistory=
function(a,b){return this.codemirrorInstance.clearHistory(a,b)};b.prototype.getLine=function(a){return this.codemirrorInstance.getLine(a)};b.prototype.setValue=function(a){return this.codemirrorInstance.setValue(a)};b.prototype.lineCount=function(){return this.codemirrorInstance.lineCount()};b.prototype.suspendDimmingAndCheckIfLink=function(){var a,b,c=this;b=a=a=void 0;a=this.codemirrorInstance.getCursor(true);if(a.ch>2){a=this.codemirrorInstance.getLine(a.line);if(a.indexOf("// next-tutorial:")===
0){a=a.substring(17);a=a.replace("_","");b=a+"Tutorial";setTimeout(function(){return c.eventRouter.trigger("load-program",b)},200)}}return this.codemirrorInstance.getValue()===""?void 0:this.eventRouter.trigger("editor-undim")};return b}();var ColourFunctions;
ColourFunctions=function(){function b(){var a=this;window.color=function(b,c,d,e){return a.color(b,c,d,e)};window.colorToHSB=function(b){return a.colorToHSB(b)};window.brightness=function(b){return a.brightness(b)};window.saturation=function(b){return a.saturation(b)};window.hue=function(b){return a.hue(b)};window.redF=function(b){return a.redF(b)};window.greenF=function(b){return a.greenF(b)};window.blueF=function(b){return a.blueF(b)};window.alpha=function(b){return a.alpha(b)};window.alphaZeroToOne=
function(b){return a.alphaZeroToOne(b)};window.lerp=function(b,c,d){return a.lerp(b,c,d)};window.lerpColor=function(b,c,d){return a.lerpColor(b,c,d)};window.colorMode=function(b,c,d,e,g){return a.colorMode(b,c,d,e,g)};window.blendColor=function(b,c,d){return a.blendColor(b,c,d)};this.colorModeA=this.colorModeZ=this.colorModeY=this.colorModeX=255;this.Constants={RGB:1,ARGB:2,HSB:3,ALPHA:4,CMYK:5,REPLACE:0,BLEND:1,ADD:2,SUBTRACT:4,LIGHTEST:8,DARKEST:16,DIFFERENCE:32,EXCLUSION:64,MULTIPLY:128,SCREEN:256,
OVERLAY:512,HARD_LIGHT:1024,SOFT_LIGHT:2048,DODGE:4096,BURN:8192,ALPHA_MASK:4278190080,RED_MASK:16711680,GREEN_MASK:65280,BLUE_MASK:255};window.HSB=this.Constants.HSB;this.curColorMode=window.RGB=this.Constants.RGB;this.color.toString=function(b){return"rgba("+((b&a.Constants.RED_MASK)>>>16)+","+((b&a.Constants.GREEN_MASK)>>>8)+","+(b&a.Constants.BLUE_MASK)+","+((b&a.Constants.ALPHA_MASK)>>>24)/255+")"};this.color.toInt=function(b,c,d,e){return e<<24&a.Constants.ALPHA_MASK|b<<16&a.Constants.RED_MASK|
c<<8&a.Constants.GREEN_MASK|d&a.Constants.BLUE_MASK};this.color.toArray=function(b){return[(b&a.Constants.RED_MASK)>>>16,(b&a.Constants.GREEN_MASK)>>>8,b&a.Constants.BLUE_MASK,(b&a.Constants.ALPHA_MASK)>>>24]};this.color.toGLArray=function(b){return[((b&a.Constants.RED_MASK)>>>16)/255,((b&a.Constants.GREEN_MASK)>>>8)/255,(b&a.Constants.BLUE_MASK)/255,((b&a.Constants.ALPHA_MASK)>>>24)/255]};this.color.toRGB=function(b,c,d){var e,g,h,j,b=b>a.colorModeX?a.colorModeX:b,c=c>a.colorModeY?a.colorModeY:c,
d=d>a.colorModeZ?a.colorModeZ:d,b=b/a.colorModeX*360,c=c/a.colorModeY*100,d=d/a.colorModeZ*100;e=Math.round(d/100*255);if(c===0)return[e,e,e];b=b%360;g=b%60;h=Math.round(d*(100-c)/1E4*255);j=Math.round(d*(6E3-c*g)/6E5*255);c=Math.round(d*(6E3-c*(60-g))/6E5*255);switch(Math.floor(b/60)){case 0:return[e,c,h];case 1:return[j,e,h];case 2:return[h,e,c];case 3:return[h,j,e];case 4:return[c,h,e];case 5:return[e,h,j]}};this.modes=this.modesFunction()}b.prototype.color$4=function(a,b,c,d){if(this.curColorMode===
this.Constants.HSB){c=this.color.toRGB(a,b,c);a=c[0];b=c[1];c=c[2]}else{a=Math.round(255*(a/this.colorModeX));b=Math.round(255*(b/this.colorModeY));c=Math.round(255*(c/this.colorModeZ))}d=Math.round(255*(d/this.colorModeA));a=a<0?0:a;b=b<0?0:b;c=c<0?0:c;d=d<0?0:d;return(d>255?255:d)<<24&this.Constants.ALPHA_MASK|(a>255?255:a)<<16&this.Constants.RED_MASK|(b>255?255:b)<<8&this.Constants.GREEN_MASK|(c>255?255:c)&this.Constants.BLUE_MASK};b.prototype.color$2=function(a,b){var c;if(a===-16777217)return-16777217;
if(a&this.Constants.ALPHA_MASK){c=Math.round(255*(b/this.colorModeA));c=c>255?255:c;return a-(a&this.Constants.ALPHA_MASK)+((c<0?0:c)<<24&this.Constants.ALPHA_MASK)}if(this.curColorMode===this.Constants.RGB)return this.color$4(a,a,a,b);if(this.curColorMode===this.Constants.HSB)return this.color$4(0,0,a/this.colorModeX*this.colorModeZ,b)};b.prototype.color$1=function(a){if(typeof a==="string")return a;if(a<=this.colorModeX&&a>=0){if(this.curColorMode===this.Constants.RGB)return this.color$4(a,a,a,
this.colorModeA);if(this.curColorMode===this.Constants.HSB)return this.color$4(0,0,a/this.colorModeX*this.colorModeZ,this.colorModeA)}if(a){a>2147483647&&(a=a-4294967296);return a}};b.prototype.color=function(a,b,c,d){return a!==void 0&&b!==void 0&&c!==void 0&&d!==void 0?this.color$4(a,b,c,d):a!==void 0&&b!==void 0&&c!==void 0?this.color$4(a,b,c,this.colorModeA):a!==void 0&&b!==void 0?this.color$2(a,b):typeof a==="number"||typeof a==="string"?this.color$1(a):this.color$4(this.colorModeX,this.colorModeY,
this.colorModeZ,this.colorModeA)};b.prototype.colorToHSB=function(a){var b,c,d,e;e=((a&this.Constants.RED_MASK)>>>16)/255;c=((a&this.Constants.GREEN_MASK)>>>8)/255;b=(a&this.Constants.BLUE_MASK)/255;a=max(max(e,c),b);d=min(min(e,c),b);if(d===a)return[0,0,a*this.colorModeZ];c=(e===a?(c-b)/(a-d):c===a?2+(b-e)/(a-d):4+(e-c)/(a-d))/6;c<0?c=c+1:c>1&&(c=c-1);return[c*this.colorModeX,(a-d)/a*this.colorModeY,a*this.colorModeZ]};b.prototype.brightness=function(a){return this.colorToHSB(a)[2]};b.prototype.saturation=
function(a){return this.colorToHSB(a)[1]};b.prototype.hue=function(a){return this.colorToHSB(a)[0]};b.prototype.redF=function(a){return((a&this.Constants.RED_MASK)>>>16)/255*this.colorModeX};b.prototype.greenF=function(a){return((a&this.Constants.GREEN_MASK)>>>8)/255*this.colorModeY};b.prototype.blueF=function(a){return(a&this.Constants.BLUE_MASK)/255*this.colorModeZ};b.prototype.alpha=function(a){return((a&this.Constants.ALPHA_MASK)>>>24)/255*this.colorModeA};b.prototype.alphaZeroToOne=function(a){return((a&
this.Constants.ALPHA_MASK)>>>24)/255};b.prototype.lerp=function(a,b,c){return(b-a)*c+a};b.prototype.lerpColor=function(a,b,c){var d,e,g,h,j,l,a=this.color(a),b=this.color(b);if(this.curColorMode===this.Constants.HSB){d=this.colorToHSB(a);a=((a&this.Constants.ALPHA_MASK)>>>24)/this.colorModeA;g=this.colorToHSB(b);b=((b&this.Constants.ALPHA_MASK)>>>24)/this.colorModeA;e=this.lerp(d[0],g[0],c);h=this.lerp(d[1],g[1],c);d=this.lerp(d[2],g[2],c);d=this.color.toRGB(e,h,d);c=this.lerp(a,b,c)*this.colorModeA;
return c<<24&this.Constants.ALPHA_MASK|d[0]<<16&this.Constants.RED_MASK|d[1]<<8&this.Constants.GREEN_MASK|d[2]&this.Constants.BLUE_MASK}j=(a&this.Constants.RED_MASK)>>>16;g=(a&this.Constants.GREEN_MASK)>>>8;d=a&this.Constants.BLUE_MASK;a=((a&this.Constants.ALPHA_MASK)>>>24)/this.colorModeA;l=(b&this.Constants.RED_MASK)>>>16;h=(b&this.Constants.GREEN_MASK)>>>8;e=b&this.Constants.BLUE_MASK;b=((b&this.Constants.ALPHA_MASK)>>>24)/this.colorModeA;j=this.lerp(j,l,c)|0;g=this.lerp(g,h,c)|0;d=this.lerp(d,
e,c)|0;c=this.lerp(a,b,c)*this.colorModeA;return c<<24&this.Constants.ALPHA_MASK|j<<16&this.Constants.RED_MASK|g<<8&this.Constants.GREEN_MASK|d&this.Constants.BLUE_MASK};b.prototype.colorMode=function(a,b,c,d,e){this.curColorMode=a;if(arguments.length>1){this.colorModeX=b;this.colorModeY=c||b;this.colorModeZ=d||b;return this.colorModeA=e||b}};b.prototype.modesFunction=function(){var a,b,c,d,e,g;a=this.Constants.ALPHA_MASK;d=this.Constants.RED_MASK;c=this.Constants.GREEN_MASK;b=this.Constants.BLUE_MASK;
g=Math.min;e=void 0;e=function(a,b,c,f,d,e,q,n,k,r,o){a=g(((a&4278190080)>>>24)+b,255)<<24;c=c+((k-c)*b>>8);f=f+((r-f)*b>>8);b=d+((o-d)*b>>8);return a|(c<0?0:c>255?255:c)<<16|(f<0?0:f>255?255:f)<<8|(b<0?0:b>255?255:b)};return function(g,j){var l,m,i,p,q,n,k,r,o,s;s=(j&a)>>>24;i=(g&d)>>16;m=(g&c)>>8;l=g&b;n=(j&d)>>16;q=(j&c)>>8;p=j&b;o=0;if(n!==0){o=(255-i<<8)/n;o=255-(o<0?0:o>255?255:o)}r=0;if(q!==0){r=(255-m<<8)/q;r=255-(r<0?0:r>255?255:r)}k=0;if(p!==0){k=(255-l<<8)/p;k=255-(k<0?0:k>255?255:k)}return e(g,
s,i,m,l,n,q,p,o,r,k)}};b.prototype.blendColor=function(a,b,c){if(c===this.Constants.REPLACE)return this.modes.replace(a,b);if(c===this.Constants.BLEND)return this.modes.blend(a,b);if(c===this.Constants.ADD)return this.modes.add(a,b);if(c===this.Constants.SUBTRACT)return this.modes.subtract(a,b);if(c===this.Constants.LIGHTEST)return this.modes.lightest(a,b);if(c===this.Constants.DARKEST)return this.modes.darkest(a,b);if(c===this.Constants.DIFFERENCE)return this.modes.difference(a,b);if(c===this.Constants.EXCLUSION)return this.modes.exclusion(a,
b);if(c===this.Constants.MULTIPLY)return this.modes.multiply(a,b);if(c===this.Constants.SCREEN)return this.modes.screen(a,b);if(c===this.Constants.HARD_LIGHT)return this.modes.hard_light(a,b);if(c===this.Constants.SOFT_LIGHT)return this.modes.soft_light(a,b);if(c===this.Constants.OVERLAY)return this.modes.overlay(a,b);if(c===this.Constants.DODGE)return this.modes.dodge(a,b);if(c===this.Constants.BURN)return this.modes.burn(a,b)};return b}();var MatrixCommands;
MatrixCommands=function(){function b(a,b){var c=this;this.liveCodeLabCore_three=a;this.liveCodeLabCoreInstance=b;this.worldMatrix=new this.liveCodeLabCore_three.Matrix4;window.pushMatrix=function(){return c.pushMatrix()};window.popMatrix=function(){return c.popMatrix()};window.resetMatrix=function(){return c.resetMatrix()};window.move=function(a,b,f){return c.move(a,b,f)};window.rotate=function(a,b,f){return c.rotate(a,b,f)};window.scale=function(a,b,f){return c.scale(a,b,f)}}b.prototype.matrixStack=
[];b.prototype.getWorldMatrix=function(){return this.worldMatrix};b.prototype.resetMatrixStack=function(){this.matrixStack=[];return this.worldMatrix.identity()};b.prototype.pushMatrix=function(){this.matrixStack.push(this.worldMatrix);return this.worldMatrix=(new this.liveCodeLabCore_three.Matrix4).copy(this.worldMatrix)};b.prototype.popMatrix=function(){return this.matrixStack.length?this.worldMatrix=this.matrixStack.pop():this.worldMatrix.identity()};b.prototype.resetMatrix=function(){return this.worldMatrix.identity()};
b.prototype.move=function(a,b,c){c==null&&(c=0);if(typeof a!=="number"){a=Math.sin(this.liveCodeLabCoreInstance.timeKeeper.getTime()/500);b=Math.cos(this.liveCodeLabCoreInstance.timeKeeper.getTime()/500);c=a}else if(typeof b!=="number")c=b=a;return this.worldMatrix.translate(new this.liveCodeLabCore_three.Vector3(a,b,c))};b.prototype.rotate=function(a,b,c){c==null&&(c=0);if(typeof a!=="number")c=b=a=this.liveCodeLabCoreInstance.timeKeeper.getTime()/1E3;else if(typeof b!=="number")c=b=a;return this.worldMatrix.rotateX(a).rotateY(b).rotateZ(c)};
b.prototype.scale=function(a,b,c){c==null&&(c=1);if(typeof a!=="number")c=b=a=1+Math.sin(this.liveCodeLabCoreInstance.timeKeeper.getTime()/500)/4;else if(typeof b!=="number")c=b=a;a>-1.0E-9&&a<1.0E-9&&(a=1.0E-9);b>-1.0E-9&&b<1.0E-9&&(b=1.0E-9);c>-1.0E-9&&c<1.0E-9&&(c=1.0E-9);return this.worldMatrix.scale(new this.liveCodeLabCore_three.Vector3(a,b,c))};return b}();var GraphicsCommands;
GraphicsCommands=function(){function b(a,b){var c,d,e,g=this;this.liveCodeLabCore_three=a;this.liveCodeLabCoreInstance=b;window.line=function(a,b,c){return g.line(a,b,c)};window.rect=function(a,b,c){return g.rect(a,b,c)};window.box=function(a,b,c){return g.box(a,b,c)};window.peg=function(a,b,c){return g.peg(a,b,c)};window.ball=function(a,b,c){return g.ball(a,b,c)};window.ballDetail=function(a){return g.ballDetail(a)};window.fill=function(a,b,c,f){return g.fill(a,b,c,f)};window.noFill=function(){return g.noFill()};
window.stroke=function(a,b,c,f){return g.stroke(a,b,c,f)};window.noStroke=function(){return g.noStroke()};window.strokeSize=function(a){return g.strokeSize(a)};this.primitiveTypes.ambientLight=0;this.primitiveTypes.line=1;this.primitiveTypes.rect=2;this.primitiveTypes.box=3;this.primitiveTypes.peg=4;this.primitiveTypes.ball=5;this.objectPools[this.primitiveTypes.line]=[];this.objectPools[this.primitiveTypes.rect]=[];this.objectPools[this.primitiveTypes.box]=[];this.objectPools[this.primitiveTypes.peg]=
[];c=d=0;for(e=this.maximumBallDetail-this.minimumBallDetail+1;0<=e?d<e:d>e;c=0<=e?++d:--d)this.objectPools[this.primitiveTypes.ball+c]=[];this.geometriesBank[this.primitiveTypes.line]=new this.liveCodeLabCore_three.Geometry;this.geometriesBank[this.primitiveTypes.line].vertices.push(new this.liveCodeLabCore_three.Vector3(0,-0.5,0));this.geometriesBank[this.primitiveTypes.line].vertices.push(new this.liveCodeLabCore_three.Vector3(0,0.5,0));this.geometriesBank[this.primitiveTypes.rect]=new this.liveCodeLabCore_three.PlaneGeometry(1,
1);this.geometriesBank[this.primitiveTypes.box]=new this.liveCodeLabCore_three.CubeGeometry(1,1,1);this.geometriesBank[this.primitiveTypes.peg]=new this.liveCodeLabCore_three.CylinderGeometry(0.5,0.5,1,32);c=d=0;for(e=this.maximumBallDetail-this.minimumBallDetail+1;0<=e?d<e:d>e;c=0<=e?++d:--d)this.geometriesBank[this.primitiveTypes.ball+c]=new this.liveCodeLabCore_three.SphereGeometry(1,this.minimumBallDetail+c,this.minimumBallDetail+c)}b.prototype.primitiveTypes={};b.prototype.minimumBallDetail=
2;b.prototype.maximumBallDetail=30;b.prototype.doFill=true;b.prototype.doStroke=true;b.prototype.reflectValue=1;b.prototype.refractValue=0.98;b.prototype.currentStrokeAlpha=void 0;b.prototype.currentStrokeColor=void 0;b.prototype.geometriesBank=[];b.prototype.SPIN_DURATION_IN_FRAMES=30;b.prototype.currentFillAlpha=void 0;b.prototype.currentFillColor=void 0;b.prototype.objectPools=[];b.prototype.ballDetLevel=8;b.prototype.currentStrokeSize=1;b.prototype.objectsUsedInFrameCounts=[];b.prototype.doTheSpinThingy=
true;b.prototype.resetTheSpinThingy=false;b.prototype.defaultNormalFill=true;b.prototype.defaultNormalStroke=true;b.prototype.createObjectIfNeededAndDressWithCorrectMaterial=function(a,b,c,d,e,g,h,j){var l,m,i,p;l=false;p=d.primitiveType+d.detailLevel;m=this.objectPools[p];i=m[this.objectsUsedInFrameCounts[p]];if(i===void 0){i={lineMaterial:void 0,basicMaterial:void 0,lambertMaterial:void 0,normalMaterial:void 0,threejsObject3D:new d.threeObjectConstructor(this.geometriesBank[p]),initialSpinCountdown:this.SPIN_DURATION_IN_FRAMES};
l=true;m.push(i)}if(d.primitiveType===this.primitiveTypes.line){if(i.lineMaterial===void 0)i.lineMaterial=new this.liveCodeLabCore_three.LineBasicMaterial;if(this.currentStrokeColor===angleColor||this.defaultNormalStroke){g=i.threejsObject3D.matrix.multiplyVector3(new this.liveCodeLabCore_three.Vector3(0,1,0)).normalize();i.lineMaterial.color.setHex(color((g.x+1)/2*255,(g.y+1)/2*255,(g.z+1)/2*255))}else i.lineMaterial.color.setHex(this.currentStrokeColor);i.lineMaterial.linewidth=this.currentStrokeSize;
i.threejsObject3D.material=i.lineMaterial}else if(l||g===angleColor||j){if(i.normalMaterial===void 0)i.normalMaterial=new this.liveCodeLabCore_three.MeshNormalMaterial;i.threejsObject3D.material=i.normalMaterial}else if(this.liveCodeLabCoreInstance.lightSystem.lightsAreOn){if(i.lambertMaterial===void 0)i.lambertMaterial=new this.liveCodeLabCore_three.MeshLambertMaterial;i.lambertMaterial.color.setHex(g);i.threejsObject3D.material=i.lambertMaterial}else{if(i.basicMaterial===void 0)i.basicMaterial=
new this.liveCodeLabCore_three.MeshBasicMaterial;i.basicMaterial.color.setHex(g);i.threejsObject3D.material=i.basicMaterial}i.threejsObject3D.material.side=d.sidedness;i.threejsObject3D.material.opacity=h;if(h<1)i.threejsObject3D.material.transparent=true;i.threejsObject3D.material.wireframe=e;i.threejsObject3D.material.wireframeLinewidth=this.currentStrokeSize;i.threejsObject3D.material.reflectivity=this.reflectValue;i.threejsObject3D.material.refractionRatio=this.refractValue;if(this.resetTheSpinThingy){i.initialSpinCountdown=
this.SPIN_DURATION_IN_FRAMES;this.resetTheSpinThingy=false;this.doTheSpinThingy=true}if(this.doTheSpinThingy)i.initialSpinCountdown=i.initialSpinCountdown-1;if(i.initialSpinCountdown===-1)this.doTheSpinThingy=false;i.threejsObject3D.primitiveType=d.primitiveType;i.threejsObject3D.detailLevel=d.detailLevel;this.objectsUsedInFrameCounts[p]=this.objectsUsedInFrameCounts[p]+1;if(this.doTheSpinThingy&&i.initialSpinCountdown>0){this.liveCodeLabCoreInstance.matrixCommands.pushMatrix();this.liveCodeLabCoreInstance.matrixCommands.rotate(i.initialSpinCountdown/
50)}i.threejsObject3D.matrixAutoUpdate=false;i.threejsObject3D.matrix.copy(this.liveCodeLabCoreInstance.matrixCommands.getWorldMatrix());i.threejsObject3D.matrixWorldNeedsUpdate=true;this.doTheSpinThingy&&i.initialSpinCountdown>0&&this.liveCodeLabCoreInstance.matrixCommands.popMatrix();if(l)i.threejsObject3D.matrix.scale(new this.liveCodeLabCore_three.Vector3(1.0E-4,1.0E-4,1.0E-4));else if(a!==1||b!==1||c!==1)e?i.threejsObject3D.matrix.scale(new this.liveCodeLabCore_three.Vector3(a+0.0010,b+0.0010,
c+0.0010)):i.threejsObject3D.matrix.scale(new this.liveCodeLabCore_three.Vector3(a,b,c));if(l)return this.liveCodeLabCoreInstance.threeJsSystem.scene.add(i.threejsObject3D)};b.prototype.commonPrimitiveDrawingLogic=function(a,b,c,d){if(a===void 0)c=b=a=1;else if(b===void 0)c=b=a;else c===void 0&&(c=1);if(this.doStroke||this.doFill&&d.canFill){if(d.canFill&&this.doFill&&(this.currentStrokeSize===0||!this.doStroke||this.currentStrokeSize<=1&&!this.defaultNormalFill&&!this.defaultNormalStroke&&this.currentStrokeColor===
this.currentFillColor&&this.currentFillAlpha===1&&this.currentStrokeAlpha===1)||this.currentStrokeSize<=1&&this.defaultNormalFill&&this.defaultNormalStroke)return this.createObjectIfNeededAndDressWithCorrectMaterial(a,b,c,d,false,this.currentFillColor,this.currentFillAlpha,this.defaultNormalFill);if((!this.doFill||!d.canFill)&&this.doStroke)return this.createObjectIfNeededAndDressWithCorrectMaterial(a,b,c,d,true,this.currentStrokeColor,this.currentStrokeAlpha,this.defaultNormalStroke);this.createObjectIfNeededAndDressWithCorrectMaterial(a,
b,c,d,true,this.currentStrokeColor,this.currentStrokeAlpha,this.defaultNormalStroke);return this.createObjectIfNeededAndDressWithCorrectMaterial(a,b,c,d,false,this.currentFillColor,this.currentFillAlpha,this.defaultNormalFill)}};b.prototype.reset=function(){var a,b,c,d;this.fill(4294967295);this.stroke(4294967295);this.currentStrokeSize=1;this.defaultNormalStroke=this.defaultNormalFill=true;this.ballDetLevel=this.liveCodeLabCoreInstance.threeJsSystem.ballDefaultDetLevel;this.objectsUsedInFrameCounts[this.primitiveTypes.ambientLight]=
0;this.objectsUsedInFrameCounts[this.primitiveTypes.line]=0;this.objectsUsedInFrameCounts[this.primitiveTypes.rect]=0;this.objectsUsedInFrameCounts[this.primitiveTypes.box]=0;this.objectsUsedInFrameCounts[this.primitiveTypes.peg]=0;d=[];a=b=0;for(c=this.maximumBallDetail-this.minimumBallDetail+1;0<=c?b<c:b>c;a=0<=c?++b:--b)d.push(this.objectsUsedInFrameCounts[this.primitiveTypes.ball+a]=0);return d};b.prototype.line=function(a,b,c){if(this.liveCodeLabCoreInstance.lightSystem.lightsAreOn){b=this.doFill;
c=this.currentStrokeSize;if(this.currentStrokeSize<2)this.currentStrokeSize=2;a===void 0&&(a=1);this.rect(0,a,0);this.doFill=b;this.currentStrokeSize=c}else return this.commonPrimitiveDrawingLogic(a,b,c,{canFill:false,primitiveType:this.primitiveTypes.line,sidedness:this.liveCodeLabCore_three.FrontSide,threeObjectConstructor:this.liveCodeLabCore_three.Line,detailLevel:0})};b.prototype.rect=function(a,b,c){return this.commonPrimitiveDrawingLogic(a,b,c,{canFill:true,primitiveType:this.primitiveTypes.rect,
sidedness:this.liveCodeLabCore_three.DoubleSide,threeObjectConstructor:this.liveCodeLabCore_three.Mesh,detailLevel:0})};b.prototype.box=function(a,b,c){return this.commonPrimitiveDrawingLogic(a,b,c,{canFill:true,primitiveType:this.primitiveTypes.box,sidedness:this.liveCodeLabCore_three.FrontSide,threeObjectConstructor:this.liveCodeLabCore_three.Mesh,detailLevel:0})};b.prototype.peg=function(a,b,c){return this.commonPrimitiveDrawingLogic(a,b,c,{canFill:true,primitiveType:this.primitiveTypes.peg,sidedness:this.liveCodeLabCore_three.FrontSide,
threeObjectConstructor:this.liveCodeLabCore_three.Mesh,detailLevel:0})};b.prototype.ballDetail=function(a){if(a!==void 0){a<2&&(a=2);a>30&&(a=30);return this.ballDetLevel=Math.round(a)}};b.prototype.ball=function(a,b,c){return this.commonPrimitiveDrawingLogic(a,b,c,{canFill:true,primitiveType:this.primitiveTypes.ball,sidedness:this.liveCodeLabCore_three.FrontSide,threeObjectConstructor:this.liveCodeLabCore_three.Mesh,detailLevel:this.ballDetLevel-this.minimumBallDetail})};b.prototype.fill=function(a,
b,c,d){this.doFill=true;if(a!==angleColor){this.defaultNormalFill=false;this.currentFillColor=color(a,b,c);return this.currentFillAlpha=alphaZeroToOne(color(a,b,c,d))}this.defaultNormalFill=true;this.currentFillColor=angleColor;return c===void 0&&b!==void 0?this.currentFillAlpha=b/this.liveCodeLabCoreInstance.colourFunctions.colorModeA:this.currentFillAlpha=1};b.prototype.noFill=function(){return this.defaultNormalFill=this.doFill=false};b.prototype.stroke=function(a,b,c,d){this.doStroke=true;if(a!==
angleColor){this.defaultNormalStroke=false;this.currentStrokeColor=color(a,b,c);return this.currentStrokeAlpha=alphaZeroToOne(color(a,b,c,d))}this.defaultNormalStroke=true;this.currentStrokeColor=angleColor;return c===void 0&&b!==void 0?this.currentStrokeAlpha=b/this.liveCodeLabCoreInstance.colourFunctions.colorModeA:this.currentStrokeAlpha=1};b.prototype.noStroke=function(){return this.doStroke=false};b.prototype.strokeSize=function(a){a===void 0?a=1:a<0&&(a=0);return this.currentStrokeSize=a};return b}();
var Marsaglia,PerlinNoise,Random,abs,acos,asin,atan,atan2,ceil,constrain,cos,currentRandom,degrees,dist,exp,floor,lerp,log,mag,map,max,min,noise,noiseDetail,noiseProfile,noiseSeed,norm,pow,radians,random,randomSeed,round,sin,sq,sqrt,tan;abs=Math.abs;ceil=Math.ceil;constrain=function(b,a,f){return b>f?f:b<a?a:b};
dist=function(){var b,a,f;if(arguments.length===4){b=arguments[0]-arguments[2];a=arguments[1]-arguments[3];return Math.sqrt(b*b+a*a)}if(arguments.length===6){b=arguments[0]-arguments[3];a=arguments[1]-arguments[4];f=arguments[2]-arguments[5];return Math.sqrt(b*b+a*a+f*f)}};exp=Math.exp;floor=Math.floor;lerp=function(b,a,f){return(a-b)*f+b};log=Math.log;mag=function(b,a,f){return f?Math.sqrt(b*b+a*a+f*f):Math.sqrt(b*b+a*a)};map=function(b,a,f,c,d){return c+(d-c)*((b-a)/(f-a))};
max=function(){var b,a,f;if(arguments.length===2)return arguments[0]<arguments[1]?arguments[1]:arguments[0];f=arguments.length===1?arguments[0]:arguments;if(!("length"in f&&f.length))throw"Non-empty array is expected";max=f[0];b=f.length;for(a=1;a<b;){max<f[a]&&(max=f[a]);++a}return max};
min=function(){var b,a,f;if(arguments.length===2)return arguments[0]<arguments[1]?arguments[0]:arguments[1];f=arguments.length===1?arguments[0]:arguments;if(!("length"in f&&f.length))throw"Non-empty array is expected";min=f[0];b=f.length;for(a=1;a<b;){min>f[a]&&(min=f[a]);++a}return min};norm=function(b,a,f){return(b-a)/(f-a)};pow=Math.pow;round=Math.round;sq=function(b){return b*b};sqrt=Math.sqrt;acos=Math.acos;asin=Math.asin;atan=Math.atan;atan2=Math.atan2;cos=Math.cos;
degrees=function(b){return b*180/Math.PI};radians=function(b){return b/180*Math.PI};sin=Math.sin;tan=Math.tan;currentRandom=Math.random;random=function(){var b,a;if(!arguments.length)return currentRandom();if(arguments.length===1)return currentRandom()*arguments[0];a=arguments[0];b=arguments[1];return currentRandom()*(b-a)+a};
Marsaglia=function(b,a){var f,c,d;d=b||362436069;c=a||521288629;f=function(){d=36969*(d&65535)+(d>>>16)&4294967295;c=18E3*(c&65535)+(c>>>16)&4294967295;return((d&65535)<<16|c&65535)&4294967295};this.nextDouble=function(){var a;a=f()/4294967296;return a<0?1+a:a};return this.nextInt=f};Marsaglia.createRandomized=function(){var b;b=new Date;return new Marsaglia(b/6E4&4294967295,b&4294967295)};randomSeed=function(b){return currentRandom=(new Marsaglia(b)).nextDouble};
Random=function(b){var a,f;a=false;random=f=void 0;this.nextGaussian=function(){var b,d,e;if(a){a=false;return f}for(b=e=d=void 0;;){d=2*random()-1;e=2*random()-1;b=d*d+e*e;if(!(b>=1||b===0))break}b=Math.sqrt(-2*Math.log(b)/b);f=e*b;a=true;return d*b};return random=b===void 0?Math.random:(new Marsaglia(b)).nextDouble};
PerlinNoise=function(b){var a,f,c,d,e,g,h;c=function(a,b,c,d){var f,a=a&15;f=a<8?b:c;b=a<4?c:a===12||a===14?b:d;return((a&1)===0?f:-f)+((a&2)===0?b:-b)};f=function(a,b,c){b=(a&1)===0?b:c;return(a&2)===0?-b:b};a=function(a,b){return(a&1)===0?-b:b};lerp=function(a,b,c){return b+a*(c-b)};g=b!==void 0?new Marsaglia(b):Marsaglia.createRandomized();d=b=void 0;e=new Uint8Array(512);for(b=0;b<256;){e[b]=b;++b}for(b=0;b<256;){h=e[d=g.nextInt()&255];e[d]=e[b];e[b]=h;++b}for(b=0;b<256;){e[b+256]=e[b];++b}this.noise3d=
function(a,b,d){var f,g,h,n,k,r,o;f=Math.floor(a)&255;g=Math.floor(b)&255;h=Math.floor(d)&255;a=a-Math.floor(a);b=b-Math.floor(b);d=d-Math.floor(d);n=(3-2*a)*a*a;k=(3-2*b)*b*b;r=e[f]+g;o=e[r]+h;r=e[r+1]+h;g=e[f+1]+g;f=e[g]+h;h=e[g+1]+h;return lerp((3-2*d)*d*d,lerp(k,lerp(n,c(e[o],a,b,d),c(e[f],a-1,b,d)),lerp(n,c(e[r],a,b-1,d),c(e[h],a-1,b-1,d))),lerp(k,lerp(n,c(e[o+1],a,b,d-1),c(e[f+1],a-1,b,d-1)),lerp(n,c(e[r+1],a,b-1,d-1),c(e[h+1],a-1,b-1,d-1))))};this.noise2d=function(a,b){var c,d,g,h;c=Math.floor(a)&
255;d=Math.floor(b)&255;a=a-Math.floor(a);b=b-Math.floor(b);g=(3-2*a)*a*a;h=e[c]+d;c=e[c+1]+d;return lerp((3-2*b)*b*b,lerp(g,f(e[h],a,b),f(e[c],a-1,b)),lerp(g,f(e[h+1],a,b-1),f(e[c+1],a-1,b-1)))};return this.noise1d=function(b){var c;c=Math.floor(b)&255;b=b-Math.floor(b);return lerp((3-2*b)*b*b,a(e[c],b),a(e[c+1],b-1))}};noiseProfile={generator:void 0,octaves:4,fallout:0.5,seed:void 0};
noise=function(b,a,f){var c,d,e,g,h;if(noiseProfile.generator===void 0)noiseProfile.generator=new PerlinNoise(noiseProfile.seed);d=noiseProfile.generator;g=c=1;for(e=h=0;e<noiseProfile.octaves;){c=c*noiseProfile.fallout;switch(arguments.length){case 1:h=h+c*(1+d.noise1d(g*b))/2;break;case 2:h=h+c*(1+d.noise2d(g*b,g*a))/2;break;case 3:h=h+c*(1+d.noise3d(g*b,g*a,g*f))/2}g=g*2;++e}return h};noiseDetail=function(b,a){noiseProfile.octaves=b;if(a!==void 0)return noiseProfile.fallout=a};
noiseSeed=function(b){noiseProfile.seed=b;return noiseProfile.generator=void 0};var ProgramRunner;
ProgramRunner=function(){function b(a,b){var c=this;this.eventRouter=a;this.liveCodeLabCoreInstance=b;window.addDoOnce=function(a){return c.addDoOnce(a)}}b.prototype.addDoOnce=function(a){return this.doOnceOccurrencesLineNumbers.push(a)};b.prototype.setDrawFunction=function(a){return this.drawFunction=a};b.prototype.resetTrackingOfDoOnceOccurrences=function(){return this.doOnceOccurrencesLineNumbers=[]};b.prototype.putTicksNextToDoOnceBlocksThatHaveBeenRun=function(){var a;a=this.liveCodeLabCoreInstance.codeTransformer;
if(this.doOnceOccurrencesLineNumbers.length)return this.setDrawFunction(a.addCheckMarksAndUpdateCodeAndNotifyChange(a,this.doOnceOccurrencesLineNumbers))};b.prototype.runDrawFunction=function(){this.drawFunction();this.consecutiveFramesWithoutRunTimeError=this.consecutiveFramesWithoutRunTimeError+1;if(this.consecutiveFramesWithoutRunTimeError===5){this.lastStableDrawFunction=this.drawFunction;return this.eventRouter.trigger("livecodelab-running-stably")}};b.prototype.reinstateLastWorkingDrawFunction=
function(){this.consecutiveFramesWithoutRunTimeError=0;return this.drawFunction=this.lastStableDrawFunction};return b}();var CodeTransformer;
CodeTransformer=function(){function b(a,b,c){this.eventRouter=a;this.CoffeeCompiler=b;this.liveCodeLabCoreInstance=c}b.prototype.currentCodeString=null;b.prototype.removeTickedDoOnce=function(a){a=a.replace(/^(\s)*\u2713[ ]*doOnce[ ]*\-\>[ ]*$/gm,"$1if false");return a=a.replace(/\u2713/g,"//")};b.prototype.addTracingInstructionsToDoOnceBlocks=function(a){var b,c,d;if(a.indexOf("doOnce")>-1){a=a.split("\n");b=c=0;for(d=a.length;0<=d?c<d:c>d;b=0<=d?++c:--c){a[b]=a[b].replace(/^(\s*)doOnce[ ]*\->[ ]*(.+)$/g,
"$1;addDoOnce("+b+"); (1+0).times -> $2");if(a[b].match(/^(\s*)doOnce[ ]*\->[ ]*$/g)){a[b]=a[b].replace(/^(\s*)doOnce[ ]*\->[ ]*$/g,"$1(1+0).times ->");a[b+1]=a[b+1].replace(/^(\s*)(.+)$/g,"$1;addDoOnce("+b+"); $2")}}a=a.join("\n")}return a};b.prototype.doesProgramContainStringsOrComments=function(a){var b,c;for(b=a;b.length;){a=b.charAt(0);c=b.charAt(1);if(a==="'"||a==='"'||a==="/"&&(c==="*"||c==="/"))return true;b=b.slice(1)}};b.prototype.stripCommentsAndCheckBasicSyntax=function(a){var b,c,d,e,
g,h,j,l;d=void 0;if(this.doesProgramContainStringsOrComments(a)){a=a.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')|(\/\/[^\n]*\n)|(\/\*(?:(?!\*\/)(?:.|\n))*\*\/)/g,function(a,b,c,d,f){if(b)return b;if(c)return c;if(d)return"\n";a=f.split("\n").length-1;b="";for(c=0;0<=a?c<a:c>a;0<=a?++c:--c)b=b+"\n";return b});d=a.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')/g,"")}else d=a;l=e=j=g=b=0;for(h=c=void 0;d.length;){c=d.charAt(0);if(c==="'")b=b+1;else if(c==='"')g=g+1;else if(c==="("||c===
")")j=j+1;else if(c==="{"||c==="}")e=e+1;else if(c==="["||c==="]")l=l+1;d=d.slice(1)}if(b&1||g&1||j&1||e&1||l&1){b&1&&(h="Missing '");g&1&&(h='Missing "');j&1&&(h="Unbalanced ()");e&1&&(h="Unbalanced {}");l&1&&(h="Unbalanced []");this.eventRouter.trigger("compile-time-error-thrown",h);return null}return a};b.prototype.adjustPostfixNotations=function(a){a=a.replace(/(\d+)[ ]+bpm(\s)/g,"bpm $1$2");a=a.replace(/([a-zA-Z]+)[ ]+fill(\s)/g,"fill $1$2");a=a.replace(/([a-zA-Z]+)[ ]+stroke(\s)/g,"stroke $1$2");
return a=a.replace(/([a-zA-Z]+)[ ]+background(\s)/g,"background $1$2")};b.prototype.updateCode=function(a){var b;this.currentCodeString=a;if(this.currentCodeString===""){this.liveCodeLabCoreInstance.graphicsCommands.resetTheSpinThingy=true;this.eventRouter.trigger("clear-error");this.liveCodeLabCoreInstance.drawFunctionRunner.consecutiveFramesWithoutRunTimeError=0;a=new Function("");this.liveCodeLabCoreInstance.drawFunctionRunner.setDrawFunction(null);this.liveCodeLabCoreInstance.drawFunctionRunner.lastStableDrawFunction=
null;return a}a=this.removeTickedDoOnce(a);a=this.stripCommentsAndCheckBasicSyntax(a);if(a!==null){a=this.adjustPostfixNotations(a);a=a.replace(/(\d+)\s+times[ ]*\->/g,";( $1 + 0).times ->");a=this.addTracingInstructionsToDoOnceBlocks(a);a=a.replace(/^(\s*)([a-z]+[a-zA-Z0-9]*)[ ]*$/gm,"$1;$2()");a=a.replace(/;\s*([a-z]+[a-zA-Z0-9]*)[ ]*([;\n]+)/g,";$1()$2");a=a.replace(/\->\s*([a-z]+[a-zA-Z0-9]*)[ ]*([;\n]+)/g,";$1()$2");if(a.match(/[\s\+\;]+draw\s*\(/))this.eventRouter.trigger("compile-time-error-thrown",
"You can't call draw()");else{a=a.replace(/;(if)\(\)/g,";$1");a=a.replace(/;(else)\(\)/g,";$1");a=a.replace(/;(for)\(\)/g,";$1");a=a.replace(/\/\//g,"#");a=a.replace(/([^a-zA-Z0-9])(scale)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(rotate)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(move)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(rect)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(line)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(bpm)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(play)(\s)+/g,
"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(pushMatrix)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(popMatrix)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(resetMatrix)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(fill)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(noFill)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(stroke)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(noStroke)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(strokeSize)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(animationStyle)(\s)+/g,
"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(simpleGradient)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(background)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(colorMode)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(color)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(lights)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(noLights)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(ambientLight)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(pointLight)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(ball)(\s)+/g,
"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(ballDetail)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(peg)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(abs)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(ceil)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(constrain)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(dist)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(exp)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(floor)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(lerp)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(log)(\s)+/g,
"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(mag)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(map)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(max)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(min)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(norm)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(pow)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(round)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(sq)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(sqrt)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(acos)(\s)+/g,
"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(asin)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(atan)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(atan2)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(cos)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(degrees)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(radians)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(sin)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(tan)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(random)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(randomSeed)(\s)+/g,
"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(noise)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(noiseDetail)(\s)+/g,"$1;$2$3");a=a.replace(/([^a-zA-Z0-9])(noiseSeed)(\s)+/g,"$1;$2$3");a=a.replace(/->(\s+);/g,"->$1");a=a.replace(/(\sif\s*.*\s*);/g,"$1");a=a.replace(/(\s);(else\s*if\s*.*\s*);/g,"$1$2");a=a.replace(/(\s);(else.*\s*);/g,"$1$2");try{b=this.CoffeeCompiler.compile(a,{bare:"on"})}catch(c){this.eventRouter.trigger("compile-time-error-thrown",c);return}this.eventRouter.trigger("clear-error");this.liveCodeLabCoreInstance.drawFunctionRunner.consecutiveFramesWithoutRunTimeError=
0;b=b.replace(/var frame/,";");a=new Function(b);this.liveCodeLabCoreInstance.drawFunctionRunner.setDrawFunction(a);return a}}};b.prototype.addCheckMarksAndUpdateCodeAndNotifyChange=function(a,b){var c,d,e,g;c=this.currentCodeString;c=c.split("\n");e=0;for(g=b.length;e<g;e++){d=b[e];c[d]=c[d].replace(/^(\s*)doOnce([ ]*\->[ ]*.*)$/gm,"$1\u2713doOnce$2")}c=c.join("\n");this.eventRouter.trigger("code-updated-by-livecodelab",c);return this.updateCode(c)};return b}();var ProgramLoader;
ProgramLoader=function(){function b(a,b,c){var d=this;this.eventRouter=a;this.texteditor=b;this.liveCodeLabCoreInstance=c;this.lastHash="";this.programs={demos:{},tutorials:{}};setInterval(function(){return d.pollHash()},100);a.bind("url-hash-changed",function(a){return d.loadAppropriateDemoOrTutorialBasedOnHash(a)},this);this.programs.demos.roseDemo={submenu:"Basic",title:"Rose",code:"// 'B rose' by Guy John (@rumblesan)\n// Mozilla Festival 2012\n// adapted from 'A rose' by Lib4tech\n\ndoOnce -> frame = 0\nbackground red\nscale 1.5\nanimationStyle paintOver\nrotate frame/100\nfill 255-((frame/2)%255),0,0\nstroke 255-((frame/2)%255),0,0\nscale 1-((frame/2)%255) / 255\nbox".replace(/\u25B6/g,
"\t")};this.programs.demos.cheeseAndOlivesDemo={submenu:"Basic",title:"Cheese and olives",code:"// 'Cheese and olives' by\n// Davina Tirvengadum\n// Mozilla festival 2012\n\nbackground white\nscale .3\nmove 0,-1\nfill yellow\nstroke black\nrotate\nstrokeSize 3\nline 4\nbox\n\nrotate 2,3\nmove 0,3\nscale .3\nfill black\nstroke black\nball\n\nrotate 3\nmove 5\nscale 1\nfill green\nstroke green\nball\n\nrotate 1\nmove -3\nscale 1\nfill yellow\nstroke yellow\nball".replace(/\u25B6/g,"\t")};this.programs.demos.simpleCubeDemo=
{submenu:"Basic",title:"Simple cube",code:"// there you go!\n// a simple cube!\n\nbackground yellow\nrotate 0,time/2000,time/2000\nbox".replace(/\u25B6/g,"\t")};this.programs.demos.webgltwocubesDemo={submenu:"WebGL",title:"WebGL: Two cubes",code:"background 155,255,255\n2 times ->\n\u25b6rotate 0, 1, time/2000\n\u25b6box".replace(/\u25B6/g,"\t")};this.programs.demos.cubesAndSpikes={submenu:"Basic",title:"Cubes and spikes",code:"simpleGradient fuchsia,color(100,200,200),yellow\nscale 2.1\n5 times ->\n\u25b6rotate 0,1,time/5000\n\u25b6box 0.1,0.1,0.1\n\u25b6move 0,0.1,0.1\n\u25b63 times ->\n\u25b6\u25b6rotate 0,1,1\n\u25b6\u25b6box 0.01,0.01,1".replace(/\u25B6/g,
"\t")};this.programs.demos.webglturbineDemo={submenu:"WebGL",title:"WebGL: Turbine",code:"background 155,55,255\n70 times ->\n\u25b6rotate time/100000,1,time/100000\n\u25b6box".replace(/\u25B6/g,"\t")};this.programs.demos.webglzfightartDemo={submenu:"WebGL",title:"WebGL: Z-fight!",code:"// Explore the artifacts\n// of your GPU!\n// Go Z-fighting, go!\nscale 5\nrotate\nfill red\nbox\nrotate 0.000001\nfill yellow\nbox".replace(/\u25B6/g,"\t")};this.programs.demos.littleSpiralOfCubes={submenu:"Basic",
title:"Little spiral",code:"background orange\nscale 0.1\n10 times ->\n\u25b6rotate 0,1,time/1000\n\u25b6move 1,1,1\n\u25b6box".replace(/\u25B6/g,"\t")};this.programs.demos.tentacleDemo={submenu:"Basic",title:"Tentacle",code:"background 155,255,155\nscale 0.15\n3 times ->\n\u25b6rotate 0,1,1\n\u25b610 times ->\n\u25b6\u25b6rotate 0,1,time/1000\n\u25b6\u25b6scale 0.9\n\u25b6\u25b6move 1,1,1\n\u25b6\u25b6box".replace(/\u25B6/g,"\t")};this.programs.demos.lampDemo={submenu:"Basic",title:"Lamp",code:"animationStyle motionBlur\nsimpleGradient red,yellow,color(255,0,255)\n//animationStyle paintOver\nscale 2\nrotate time/4000, time/4000,  time/4000\n90 times ->\n\u25b6rotate time/200000, time/200000,  time/200000\n\u25b6line\n\u25b6move 0.5,0,0\n\u25b6line\n\u25b6move -0.5,0,0\n\u25b6line\n\u25b6line".replace(/\u25B6/g,
"\t")};this.programs.demos.trillionfeathersDemo={submenu:"Basic",title:"A trillion feathers",code:"animationStyle paintOver\nmove 2,0,0\nscale 2\nrotate\n20 times ->\n\u25b6rotate\n\u25b6move 0.25,0,0\n\u25b6line\n\u25b6move -0.5,0,0\n\u25b6line".replace(/\u25B6/g,"\t")};this.programs.demos.monsterblobDemo={submenu:"Basic",title:"Monster blob",code:"ballDetail 6\nanimationStyle motionBlur\nrotate time/5000\nsimpleGradient fuchsia,aqua,yellow\n5 times ->\n\u25b6rotate 0,1,time/5000\n\u25b6move 0.2,0,0\n\u25b63 times ->\n\u25b6\u25b6rotate 1\n\u25b6\u25b6ball -1".replace(/\u25B6/g,
"\t")};this.programs.demos.industrialMusicDemo={submenu:"Sound",title:"Sound: Industrial",code:"bpm 88\nplay 'alienBeep'  ,'zzxz zzzz zzxz zzzz'\nplay 'beepC'  ,'zxzz zzzz xzzx xxxz'\nplay 'beepA'  ,'zzxz zzzz zzxz zzzz'\nplay 'lowFlash'  ,'zzxz zzzz zzzz zzzz'\nplay 'beepB'  ,'xzzx zzzz zxzz zxzz'\nplay 'voltage'  ,'xzxz zxzz xzxx xzxx'\nplay 'tranceKick'  ,'zxzx zzzx xzzz zzxx'".replace(/\u25B6/g,"\t")};this.programs.demos.trySoundsDemo={submenu:"Sound",title:"Sound: Try them all",code:"bpm 88\n// leave this one as base\nplay 'tranceKick'  ,'zxzx zzzx xzzz zzxx'\n\n// uncomment the sounds you want to try\n//play 'toc'  ,'zzxz zzzz zzxz zzzz'\n//play 'highHatClosed'  ,'zzxz zzzz zzxz zzzz'\n//play 'highHatOpen'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc2'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc3'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc4'  ,'zzxz zzzz zzxz zzzz'\n//play 'snare'  ,'zzxz zzzz zzxz zzzz'\n//play 'snare2'  ,'zzxz zzzz zzxz zzzz'\n//play 'china'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash2'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash3'  ,'zzxz zzzz zzxz zzzz'\n//play 'ride'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass1'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass2'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass3'  ,'zzxz zzzz zzxz zzzz'\n//play 'thump'  ,'zzxz zzzz zzxz zzzz'\n//play 'lowFlash'  ,'zzxz zzzz zzxz zzzz'\n//play 'lowFlash2'  ,'zzxz zzzz zzxz zzzz'\n//play 'tranceKick2'  ,'zzxz zzzz zzxz zzzz'\n//play 'tranceKick'  ,'zzxz zzzz zzxz zzzz'\n//play 'wosh'  ,'zzxz zzzz zzxz zzzz'\n//play 'voltage'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepA'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepB'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepC'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepD'  ,'zzxz zzzz zzxz zzzz'\n//play 'beep'  ,'zzxz zzzz zzxz zzzz'\n//play 'hello'  ,'zzxz zzzz zzxz zzzz'\n//play 'alienBeep'  ,'zzxz zzzz zzxz zzzz'".replace(/\u25B6/g,
"\t")};this.programs.demos.springysquaresDemo={submenu:"Basic",title:"Springy squares",code:"animationStyle motionBlur\nsimpleGradient fuchsia,color(100,200,200),yellow\nscale 0.3\n3 times ->\n\u25b6move 0,0,0.5\n\u25b65 times ->\n\u25b6\u25b6rotate time/2000\n\u25b6\u25b6move 0.7,0,0\n\u25b6\u25b6rect".replace(/\u25B6/g,"\t")};this.programs.demos.diceDemo={submenu:"Basic",title:"Dice",code:"animationStyle motionBlur\nsimpleGradient color(255),moccasin,peachpuff\nstroke 255,100,100,255\nfill red,155\nmove -0.5,0,0\nscale 0.3\n3 times ->\n\u25b6move 0,0,0.5\n\u25b61 times ->\n\u25b6\u25b6rotate time/1000\n\u25b6\u25b6move 2,0,0\n\u25b6\u25b6box".replace(/\u25B6/g,
"\t")};this.programs.demos.webglalmostvoronoiDemo={submenu:"WebGL",title:"WebGL: Almost Voronoi",code:"scale 10\n2 times ->\n\u25b6rotate 0,1,time/10000\n\u25b6ball -1".replace(/\u25B6/g,"\t")};this.programs.demos.webglshardsDemo={submenu:"WebGL",title:"WebGL: Shards",code:"scale 10\nfill 0\nstrokeSize 7\n5 times ->\n\u25b6rotate 0,1,time/20000\n\u25b6ball \n\u25b6rotate 0,1,1\n\u25b6ball -1.01".replace(/\u25B6/g,"\t")};this.programs.demos.webglredthreadsDemo={submenu:"WebGL",title:"WebGL: Red threads",
code:"scale 10.5\nbackground black\nstroke red\nnoFill\nstrokeSize 7\n5 times ->\n\u25b6rotate time/20000\n\u25b6ball\n\u25b6rotate 0,1,1\n\u25b6ball".replace(/\u25B6/g,"\t")};this.programs.demos.webglnuclearOctopusDemo={submenu:"WebGL",title:"WebGL: Nuclear octopus",code:"simpleGradient black,color(0,0,(time/5)%255),black\nscale 0.2\nmove 5,0,0\nanimationStyle motionBlur\n//animationStyle paintOver\nstroke 255,0,0,120\nfill time%255,0,0\npushMatrix\ncount = 0\n3 times ->\n\u25b6count++\n\u25b6pushMatrix\n\u25b6rotate count+3+time/1000,2+count + time/1000,4+count\n\u25b6120 times ->\n\u25b6\u25b6scale 0.9\n\u25b6\u25b6move 1,1,0\n\u25b6\u25b6rotate time/100\n\u25b6\u25b6box\n\u25b6popMatrix".replace(/\u25B6/g,
"\t")};this.programs.tutorials.introTutorial={submenu:"Intro",title:"intro",code:"// Lines beginning with two\n// slashes (like these) are just comments.\n\n// Everything else is run\n// about 30 to 60 times per second\n// in order to create an animation.\n\n// Click the link below to start the tutorial.\n\n// next-tutorial:hello_world".replace(/\u25B6/g,"\t")};this.programs.tutorials.helloworldTutorial={submenu:"Intro",title:"hello world",code:"// type these three letters\n// in one of these empty lines below:\n// 'b' and 'o' and 'x'\n\n\n\n// (you should then see a box facing you)\n// click below for the next tutorial\n// next-tutorial:some_notes".replace(/\u25B6/g,
"\t")};this.programs.tutorials.somenotesTutorial={submenu:"Intro",title:"some notes",code:"// If this makes sense to you:\n// the syntax is similar to Coffeescript\n// and the commands are almost\n// like Processing.\n\n// If this doesn't make sense to you\n// don't worry.\n\n// next-tutorial:rotate".replace(/\u25B6/g,"\t")};this.programs.tutorials.rotateTutorial={submenu:"Intro",title:"a taste of animation",code:"// now that we have a box\n// let's rotate it:\n// type 'rotate 1' in the\n// line before the 'box'\n\n\nbox\n\n// click for the next tutorial:\n// next-tutorial:frame".replace(/\u25B6/g,
"\t")};this.programs.tutorials.frameTutorial={submenu:"Animation",title:"frame",code:"// make the box spin\n// by replacing '1' with 'frame'\n\nrotate 1\nbox\n\n// 'frame' contains a number\n// always incrementing as\n// the screen is re-drawn.\n// (use 'frame/100' to slow it down)\n// next-tutorial:time".replace(/\u25B6/g,"\t")};this.programs.tutorials.timeTutorial={submenu:"Animation",title:"time",code:"// 'frame/100' has one problem:\n// faster computers will make\n// the cube spin too fast.\n// Replace it with 'time/2000'.\n\nrotate frame/100\nbox\n\n// 'time' counts the\n// number of milliseconds since\n// the program started, so it's\n// independent of how fast\n// the computer is at drawing.\n// next-tutorial:move".replace(/\u25B6/g,
"\t")};this.programs.tutorials.moveTutorial={submenu:"Placing things",title:"move",code:"// you can move any object\n// by using 'move'\n\nbox\nmove 1,1,0\nbox\n\n// try to use a rotate before\n// the first box to see how the\n// scene changes.\n// next-tutorial:scale".replace(/\u25B6/g,"\t")};this.programs.tutorials.scaleTutorial={submenu:"Placing things",title:"scale",code:"// you can make an object bigger\n// or smaller by using 'scale'\n\nrotate 3\nbox\nmove 1\nscale 2\nbox\n\n// try to use scale or move before\n// the first box to see how the\n// scene changes.\n// next-tutorial:times".replace(/\u25B6/g,
"\t")};this.programs.tutorials.timesTutorial={submenu:"Repeating stuff",title:"times",code:"// 'times' (not to be confused with\n// 'time'!) can be used to\n// repeat operations like so:\n\nrotate 1\n3 times ->\n\u25b6move 0.2,0.2,0.2\n\u25b6box\n\n// note how the tabs indicate\n// exactly the block of code\n// to be repeated.\n// next-tutorial:fill".replace(/\u25B6/g,"\t")};this.programs.tutorials.fillTutorial={submenu:"Graphics",title:"fill",code:"// 'fill' changes the\n// color of all the faces:\n\nrotate 1\nfill 255,255,0\nbox\n\n// the three numbers indicate \n// red green and blue values.\n// You can also use color names such as 'indigo'\n// Try replacing the numbers with\n// 'angleColor'\n// next-tutorial:stroke".replace(/\u25B6/g,
"\t")};this.programs.tutorials.strokeTutorial={submenu:"Graphics",title:"stroke",code:"// 'stroke' changes all the\n// edges:\n\nrotate 1\nstrokeSize 5\nstroke 255,255,255\nbox\n\n// the three numbers are RGB\n// but you can also use the color names\n// or the special color 'angleColor'\n// Also you can use 'strokeSize'\n// to specify the thickness.\n// next-tutorial:color_names".replace(/\u25B6/g,"\t")};this.programs.tutorials.colornamesTutorial={submenu:"Graphics",title:"color by name",code:"// you can call colors by name\n// try to un-comment one line:\n//fill greenyellow\n//fill indigo\n//fill lemonchiffon // whaaaat?\n\nrotate 1\nbox\n\n// more color names here:\n// http://html-color-codes.info/color-names/\n// (just use them in lower case)\n// next-tutorial:lights".replace(/\u25B6/g,
"\t")};this.programs.tutorials.lightsTutorial={submenu:"Graphics",title:"lights",code:"// 'ambientLight' creates an\n// ambient light so things have\n// some sort of shading:\n\nambientLight 0,255,255\nrotate time/1000\nbox\n\n// you can turn that light on and \n// off while you build the scene\n// by using 'lights' and 'noLights'\n// next-tutorial:background".replace(/\u25B6/g,"\t")};this.programs.tutorials.backgroundTutorial={submenu:"Graphics",title:"background",code:"// 'background' creates a\n// solid background:\n\nbackground 0,0,255\nrotate time/1000\nbox\n\n// next-tutorial:gradient".replace(/\u25B6/g,
"\t")};this.programs.tutorials.gradientTutorial={submenu:"Graphics",title:"gradient",code:"// even nicer, you can paint a\n// background gradient:\n\nsimpleGradient color(190,10,10),color(30,90,100),color(0)\nrotate time/1000\nbox\n\n// next-tutorial:line".replace(/\u25B6/g,"\t")};this.programs.tutorials.lineTutorial={submenu:"Graphics",title:"line",code:"// draw lines like this:\n\n20 times ->\n\u25b6rotate time/9000\n\u25b6line\n\n// next-tutorial:ball".replace(/\u25B6/g,"\t")};this.programs.tutorials.ballTutorial=
{submenu:"Graphics",title:"ball",code:"// draw balls like this:\n\nballDetail 10\n3 times ->\n\u25b6move 0.2,0.2,0.2\n\u25b6ball\n\n// ('ballDetail' is optional)\n// next-tutorial:pushpopMatrix".replace(/\u25B6/g,"\t")};this.programs.tutorials.pushpopMatrixTutorial={submenu:"Graphics",title:"push and pop",code:"// pushMatrix creates a bookmark of\n// the position, which you can\n// return to later by using popMatrix.\n// You can reset using 'resetMatrix'.\n\nrotate time/1000\npushMatrix // bookmark the position after the rotation\nline\nmove 0.5,0,0\nline\npopMatrix // go back to the bookmarked position\nmove -0.5,0,0\nline\nresetMatrix // resets the position\nline // not affected by initial rotation\n// next-tutorial:animation_style".replace(/\u25B6/g,
"\t")};this.programs.tutorials.animationstyleTutorial={submenu:"Graphics",title:"animation style",code:"// try uncommenting either line\n// with the animationStyle\n\nbackground 255\n//animationStyle motionBlur\n//animationStyle paintOver\nrotate frame/10\nbox\n\n// next-tutorial:do_once".replace(/\u25B6/g,"\t")};this.programs.tutorials.doonceTutorial={submenu:"Controlling the flow",title:"do once",code:"// delete either check mark below\n\nrotate time/1000\n\u2713doOnce ->\n\u25b6background 255\n\u25b6fill 255,0,0\n\u2713doOnce -> ball\nbox\n\n// ...the line or block of code\n// are ran one time only, after that the\n// check marks immediately re-appear\n// P.S. keep hitting the delete button\n// on that first check mark for seizures.\n// next-tutorial:conditionals".replace(/\u25B6/g,
"\t")};this.programs.tutorials.conditionalsTutorial={submenu:"Controlling the flow",title:"conditionals",code:"// you can draw different things\n// (or in general do different things)\n// based on any\n// test condition you want:\n\nrotate\nif frame%3 == 0\n\u25b6box\nelse if frame%3 == 1\n\u25b6ball\nelse\n\u25b6peg\n\n// next-tutorial:autocode".replace(/\u25B6/g,"\t")};this.programs.tutorials.autocodeTutorial={submenu:"Others",title:"autocode",code:"// the Autocode button invents random\n// variations for you.\n\n// You can interrupt the Autocoder at\n// any time by pressing the button again,\n// or you can press CTRL-Z\n// (or CMD-Z on Macs) to undo (or re-do) some of\n// the steps even WHILE the autocoder is running,\n// if you see that things got\n// boring down a particular path of changes.".replace(/\u25B6/g,
"\t")}}b.prototype.loadDemoOrTutorial=function(a){var b,c=this;if((!Detector.webgl||this.liveCodeLabCoreInstance.threeJsSystem.forceCanvasRenderer)&&!b&&a.indexOf("webgl")===0){b=true;$("#exampleNeedsWebgl").modal();$("#simplemodal-container").height(200)}this.eventRouter.trigger("set-url-hash","bookmark="+a);this.eventRouter.trigger("big-cursor-hide");this.eventRouter.trigger("editor-undim");this.liveCodeLabCoreInstance.graphicsCommands.doTheSpinThingy=false;b="";if((!Detector.webgl||this.liveCodeLabCoreInstance.threeJsSystem.forceCanvasRenderer)&&
a.indexOf("webgl")===0)b="// This drawing makes much more sense\n// in a WebGL-enabled browser.\n\n".replace(/\u25B6/g,"\t");if(this.programs.demos[a]||this.programs.tutorials[a]){this.programs.demos[a]?this.texteditor.setValue(b+this.programs.demos[a].code):this.programs.tutorials[a]&&this.texteditor.setValue(b+this.programs.tutorials[a].code);setTimeout(function(){return c.texteditor.clearHistory()},30)}this.texteditor.setCursor(0,0);a=this.liveCodeLabCoreInstance.blendControls;a.animationStyle(a.animationStyles.normal);
a.animationStyleUpdateIfChanged();return this.liveCodeLabCoreInstance.renderer.render(this.liveCodeLabCoreInstance.graphicsCommands)};b.prototype.loadAppropriateDemoOrTutorialBasedOnHash=function(a){var b=this;if(a=a.match(/bookmark=(.*)/))return this.loadDemoOrTutorial(a[1]);this.texteditor.setValue("");return setTimeout(function(){return b.texteditor.clearHistory()},30)};b.prototype.pollHash=function(){if(this.lastHash!==location.hash){this.lastHash=location.hash;return this.loadAppropriateDemoOrTutorialBasedOnHash(this.lastHash)}};
return b}();var Autocoder,TOKEN_ARGDLIM,TOKEN_COLOUR,TOKEN_COLOUROP,TOKEN_COMMENT,TOKEN_DOONCE,TOKEN_ITERATION,TOKEN_MESH,TOKEN_NEWLINE,TOKEN_NUM,TOKEN_OP,TOKEN_SPACE,TOKEN_STATEFUN,TOKEN_TAB,TOKEN_TRANSLATION,TOKEN_UNKNOWN,TOKEN_VARIABLE;
Autocoder=function(){function b(a,b,c){var d,e,g=this;this.eventRouter=a;this.editor=b;this.colourNames=c;this.Tokens=[];this.LexersOnlyState=new LexerState;a=function(a,b,c){return g.LexersOnlyState.addRule(a,function(a,d,f){g.Tokens.push(new b(a[0],c));return f.returnAFunctionThatAppliesRulesAndRunsActionFor(d)})};a(/\/\/.*\n/,TOKEN_COMMENT);a(/\t/,TOKEN_TAB);a(/-?[0-9]+\.?[0-9]*/,TOKEN_NUM);a(/-?\.[0-9]*/,TOKEN_NUM);a(/[*|\/|+|\-|=]/,TOKEN_OP);a(/,/,TOKEN_ARGDLIM);a(/[\n|\r]{1,2}/,TOKEN_NEWLINE);
a(/rotate/,TOKEN_TRANSLATION);a(/move/,TOKEN_TRANSLATION);a(/scale/,TOKEN_TRANSLATION);e=this.colourNames;c=0;for(d=e.length;c<d;c++){b=e[c];a(RegExp(b),TOKEN_COLOUR,this.colourNames)}a(/background/,TOKEN_COLOUROP);a(/fill/,TOKEN_COLOUROP);a(/stroke/,TOKEN_COLOUROP);a(/simpleGradient/,TOKEN_COLOUROP);a(/box/,TOKEN_MESH);a(/ball/,TOKEN_MESH);a(/peg/,TOKEN_MESH);a(/rect/,TOKEN_MESH);a(/line/,TOKEN_MESH);a(/ambientLight/,TOKEN_STATEFUN);a(/noStroke/,TOKEN_STATEFUN);a(/ballDetail/,TOKEN_STATEFUN);a(/animationStyle\s\w+/,
TOKEN_STATEFUN);a(/\d+\s+times\s+->/,TOKEN_ITERATION);a(/time/,TOKEN_VARIABLE);a(/delay/,TOKEN_VARIABLE);a(/\?doOnce\s+->\s*/,TOKEN_DOONCE);a(/ +/,TOKEN_SPACE);a(/'/,TOKEN_UNKNOWN);a(/[\u2713]?doOnce\s+\->?/,TOKEN_UNKNOWN);a(/==/,TOKEN_UNKNOWN);a(/else/,TOKEN_UNKNOWN);a(/next-tutorial:\w+/,TOKEN_UNKNOWN);a(/\w+/,TOKEN_UNKNOWN);a(/if/,TOKEN_UNKNOWN);a(/pushMatrix/,TOKEN_UNKNOWN);a(/popMatrix/,TOKEN_UNKNOWN);a(/play/,TOKEN_UNKNOWN);a(/bpm/,TOKEN_UNKNOWN);a(/color\s*\(.+\)/,TOKEN_UNKNOWN);a(/noFill/,
TOKEN_UNKNOWN);a(/frame/,TOKEN_UNKNOWN);a(/strokeSize/,TOKEN_UNKNOWN);a(/\(/,TOKEN_UNKNOWN);a(/\)/,TOKEN_UNKNOWN);a(/%/,TOKEN_UNKNOWN)}b.prototype.active=false;b.prototype.autocoderMutateTimeout=void 0;b.prototype.numberOfResults=0;b.prototype.whichOneToChange=0;b.prototype.emit=function(a){var b,c,d,e;b="";d=0;for(e=a.length;d<e;d++){c=a[d];b=b+c.string}return b};b.prototype.canMutate=function(a){return typeof a.mutate==="function"?true:false};b.prototype.pickMutatableTokenAndMutateIt=function(a){var b,
c,d,e;b=[];d=0;for(e=a.length;d<e;d++){c=a[d];this.canMutate(c)&&b.push(c)}if(b.length!==0){a=Math.floor(Math.random()*b.length);return b[a].mutate()}};b.prototype.replaceTimeWithAConstant=function(){var a,b,c,d;c=this.editor.getValue();d=/(time)/g;a=c.match(d);b=0;this.numberOfResults=a?a.length:0;this.whichOneToChange=Math.floor(Math.random()*this.numberOfResults)+1;c=c.replace(d,function(a){b++;return b===this.whichOneToChange?""+Math.floor(Math.random()*20)+1:a});return this.editor.setValue(c)};
b.prototype.mutate=function(){var a;a=this.editor.getValue();this.Tokens=[];try{this.LexersOnlyState.lex(a)}catch(b){}this.pickMutatableTokenAndMutateIt(this.Tokens);return this.editor.setValue(this.emit(this.Tokens))};b.prototype.autocoderMutate=function(){this.eventRouter.trigger("autocoderbutton-flash");return this.mutate()};b.prototype.toggle=function(a){var b=this;if(this.active=a===void 0?!this.active:a){this.autocoderMutateTimeout=setInterval(function(){return b.autocoderMutate()},1E3);(this.editor.getValue()===
""||window.location.hash.indexOf("bookmark")!==-1&&window.location.hash.indexOf("autocodeTutorial")!==-1)&&this.eventRouter.trigger("load-program","cubesAndSpikes")}else clearInterval(this.autocoderMutateTimeout);return this.eventRouter.trigger("autocoder-button-pressed",this.active)};return b}();TOKEN_COMMENT=function(){function b(a){this.string=a}b.prototype.toString=function(){return"COMMENT("+string+")"};return b}();
TOKEN_SPACE=function(){function b(a){this.string=a}b.prototype.toString=function(){return"SPACE("+string+")"};return b}();TOKEN_NEWLINE=function(){function b(a){this.string=a}b.prototype.toString=function(){return"<br/>"};return b}();TOKEN_TRANSLATION=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_TRANSLATION("+this.string+")"};return b}();
TOKEN_VARIABLE=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_VARIABLE("+this.string+")"};return b}();TOKEN_NUM=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_NUM("+this.string+")"};b.prototype.mutate=function(){var a,b;a=new Number(this.string);0===a&&(a=0.1);Math.random();Math.random();b=a*Math.random();a=(a+b).toFixed(2);return this.string=a.toString()};return b}();
TOKEN_OP=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_OP("+this.string+")"};return b}();TOKEN_ARGDLIM=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_ARGDLIM("+this.string+")"};return b}();TOKEN_TAB=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_TAB("+this.string+")"};return b}();
TOKEN_DOONCE=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_DOONCE("+this.string+")"};return b}();TOKEN_MESH=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_MESH("+this.string+")"};b.prototype.mutate=function(){switch(this.string){case "box":this.string="ball";break;case "ball":this.string="box";break;case "line":this.string="rect";break;case "rect":this.string="line"}};return b}();
TOKEN_STATEFUN=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_STATEFUN("+this.string+")"};return b}();TOKEN_ITERATION=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_ITERATION("+this.string+")"};b.prototype.mutate=function(){var a;a=/\d/.exec(this.string);Math.random()>0.5?a++:a--;return this.string=a.toString()+" times ->"};return b}();
TOKEN_UNKNOWN=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_UNKNOWN("+this.string+")"};return b}();TOKEN_COLOUR=function(){function b(a,b){this.string=a;this.colourNames=b}b.prototype.toString=function(){return"TOKEN_COLOUR("+this.string+")"};b.prototype.mutate=function(){var a;for(a=Math.floor(Math.random()*this.colourNames.length);this.string===this.colourNames[a];)a=Math.floor(Math.random()*this.colourNames.length);return this.string=this.colourNames[a]};return b}();
TOKEN_COLOUROP=function(){function b(a){this.string=a}b.prototype.toString=function(){return"TOKEN_COLOUROP("+this.string+")"};return b}();var EditorDimmer;
EditorDimmer=function(){function b(a,b){this.eventRouter=a;this.bigCursor=b}b.prototype.cursorActivity=true;b.prototype.dimIntervalID=void 0;b.prototype.dimCodeOn=false;b.prototype.undimEditor=function(){if(!this.bigCursor.isShowing&&$("#formCode").css("opacity")<0.99)return $("#formCode").animate({opacity:1},"fast")};b.prototype.dimEditor=function(){if($("#formCode").css("opacity")>0)return $("#formCode").animate({opacity:0},"slow")};b.prototype.dimIfNoCursorActivity=function(){return this.cursorActivity?
this.cursorActivity=false:this.dimEditor()};b.prototype.toggleDimCode=function(a){var b=this;if(this.dimCodeOn=a===void 0?!this.dimCodeOn:a)this.dimIntervalID=setInterval(function(){return b.dimIfNoCursorActivity()},5E3);else{clearInterval(this.dimIntervalID);this.undimEditor()}return this.eventRouter.trigger("auto-hide-code-button-pressed",this.dimCodeOn)};return b}();var TimeKeeper;
TimeKeeper=function(){function b(){window.time=0}b.prototype.time=void 0;b.prototype.timeAtStart=void 0;b.prototype.updateTime=function(){var a;a=new Date;this.time=a.getTime()-this.timeAtStart;return window.time=a.getTime()-this.timeAtStart};b.prototype.resetTime=function(){var a;a=new Date;this.time=0;window.time=0;return this.timeAtStart=a.getTime()};b.prototype.getTime=function(){return this.time};return b}();var BlendControls;
BlendControls=function(){function b(a){var b=this;this.liveCodeLabCoreInstance=a;window.normal=this.animationStyles.normal=0;window.paintOver=this.animationStyles.paintOver=1;window.motionBlur=this.animationStyles.motionBlur=2;window.animationStyle=function(a){return b.animationStyle(a)}}b.prototype.previousanimationStyleValue=0;b.prototype.animationStyleValue=0;b.prototype.animationStyles={};b.prototype.blendAmount=0;b.prototype.animationStyle=function(a){return a===false||a===void 0?void 0:this.animationStyleValue=
a};b.prototype.animationStyleUpdateIfChanged=function(){var a;if(this.animationStyleValue!==this.previousanimationStyleValue){this.previousanimationStyleValue=this.animationStyleValue;a=this.liveCodeLabCoreInstance.threeJsSystem.isWebGLUsed;this.animationStyles=this.animationStyles;if(a&&this.animationStyleValue===this.animationStyles.motionBlur)this.liveCodeLabCoreInstance.threeJsSystem.effectBlend.uniforms.mixRatio.value=0.7;else if(!a&&this.animationStyleValue===this.animationStyles.motionBlur)this.blendAmount=
0.6;if(a&&this.animationStyleValue===this.animationStyles.paintOver)this.liveCodeLabCoreInstance.threeJsSystem.effectBlend.uniforms.mixRatio.value=1;else if(!a&&this.animationStyleValue===this.animationStyles.paintOver)this.blendAmount=1;if(a&&this.animationStyleValue===this.animationStyles.normal)return this.liveCodeLabCoreInstance.threeJsSystem.effectBlend.uniforms.mixRatio.value=0;if(!a&&this.animationStyleValue===this.animationStyles.normal)return this.blendAmount=0}};return b}();var LightsCommands;
LightsCommands=function(){function b(a,b){var c=this;this.liveCodeLabCore_graphicsCommands=a;this.liveCodeLabCoreInstance=b;this.objectPools=this.liveCodeLabCore_graphicsCommands.objectPools;this.primitiveTypes=this.liveCodeLabCore_graphicsCommands.primitiveTypes;this.objectsUsedInFrameCounts=this.liveCodeLabCore_graphicsCommands.objectsUsedInFrameCounts;this.objectPools[this.primitiveTypes.ambientLight]=[];this.objectsUsedInFrameCounts[this.primitiveTypes.ambientLight]=0;window.lights=function(){return c.lights()};
window.noLights=function(){return c.noLights()};window.ambientLight=function(a,b,f,h){return c.ambientLight(a,b,f,h)}}b.prototype.lightsAreOn=false;b.prototype.lights=function(){return this.lightsAreOn=true};b.prototype.noLights=function(){return this.lightsAreOn=false};b.prototype.ambientLight=function(a,b,c,d){var e;e=false;b=a===void 0?this.liveCodeLabCoreInstance.colourFunctions.color(255):this.liveCodeLabCoreInstance.colourFunctions.color(a,b,c,d);this.lightsAreOn=true;this.liveCodeLabCore_graphicsCommands.defaultNormalFill=
false;this.liveCodeLabCore_graphicsCommands.defaultNormalStroke=false;a=this.objectPools[this.primitiveTypes.ambientLight];c=a[this.objectsUsedInFrameCounts[this.primitiveTypes.ambientLight]];if(c===void 0){c=new this.liveCodeLabCoreInstance.three.PointLight(b);c.position.set(10,50,130);e=true;a.push(c);c.detailLevel=0;c.primitiveType=this.primitiveTypes.ambientLight}else c.color.setHex(b);this.objectsUsedInFrameCounts[this.primitiveTypes.ambientLight]=this.objectsUsedInFrameCounts[this.primitiveTypes.ambientLight]+
1;if(e)return this.liveCodeLabCoreInstance.threeJsSystem.scene.add(c)};return b}();var Ui;
Ui=function(){function b(a,b,c){var d=this;this.eventRouter=a;this.stats=b;this.programLoader=c;this.eventRouter.bind("report-runtime-or-compile-time-error",function(a){return d.checkErrorAndReport(a)},this);this.eventRouter.bind("clear-error",function(){return d.clearError()},this);this.eventRouter.bind("autocoder-button-pressed",function(a){return a===true?$("#autocodeIndicatorContainer").html("Autocode: on").css("background-color","#FF0000"):$("#autocodeIndicatorContainer").html("Autocode").css("background-color",
"")});this.eventRouter.bind("autocoderbutton-flash",function(){return $("#autocodeIndicatorContainer").fadeOut(100).fadeIn(100)});this.eventRouter.bind("auto-hide-code-button-pressed",function(a){return a===true?$("#dimCodeButtonContainer").html("Hide Code: on"):$("#dimCodeButtonContainer").html("Hide Code: off")})}b.prototype.resizeCanvas=function(a){var b,a=$(a);b={x:1,y:1};b.x=(window.innerWidth+40)/a.width();b.y=(window.innerHeight+40)/a.height();b=b.x+", "+b.y;return a.css("-ms-transform-origin",
"left top").css("-webkit-transform-origin","left top").css("-moz-transform-origin","left top").css("-o-transform-origin","left top").css("transform-origin","left top").css("-ms-transform","scale("+b+")").css("-webkit-transform","scale3d("+b+", 1)").css("-moz-transform","scale("+b+")").css("-o-transform","scale("+b+")").css("transform","scale("+b+")")};b.prototype.adjustCodeMirrorHeight=function(){return $(".CodeMirror-scroll").css("height",window.innerHeight-$("#theMenu").height())};b.prototype.fullscreenify=
function(a){var b=this;window.addEventListener("resize",function(){b.adjustCodeMirrorHeight();return b.resizeCanvas(a)},false);return this.resizeCanvas(a)};b.prototype.checkErrorAndReport=function(a){$("#errorMessageDiv").css("color","red");a=a.message||a;a.indexOf("Unexpected 'INDENT'")>-1?a="weird indentation":a.indexOf("Unexpected 'TERMINATOR'")>-1?a="line not complete":a.indexOf("Unexpected 'CALL_END'")>-1?a="line not complete":a.indexOf("Unexpected '}'")>-1?a="something wrong":a.indexOf("Unexpected 'MATH'")>
-1?a="weird arithmetic there":a.indexOf("Unexpected 'LOGIC'")>-1?a="odd expression thingy":a.indexOf("Unexpected 'NUMBER'")>-1?a="lost number?":a.indexOf("Unexpected 'NUMBER'")>-1?a="lost number?":a.indexOf("ReferenceError")>-1&&(a=a.replace(/ReferenceError:\s/g,""));return $("#errorMessageDiv").text(a)};b.prototype.clearError=function(){$("#errorMessageDiv").css("color","#000000");return $("#errorMessageDiv").text("")};b.prototype.soundSystemOk=function(){return $("#soundSystemStatus").text("Sound System On").removeClass("off")};
b.prototype.hideStatsWidget=function(){return $("#statsWidget").hide()};b.prototype.showStatsWidget=function(){return setTimeout('$("#statsWidget").show()',1)};b.prototype.setup=function(){var a=this;return $(document).ready(function(){var b,c,d,e,g,h,j,l,m,i;g=a.eventRouter;$("<span >LiveCodeLab</span>").appendTo($("<li>").appendTo($("#nav"))).click(function(){$("#aboutWindow").modal();$("#simplemodal-container").height(250);return false});$("<span >Demos</span>").appendTo($("<li>").attr("id","demos").addClass("current").addClass("sf-parent").appendTo($("#nav")));
$("<ul id='ulForDemos'></ul>").appendTo($("#demos"));c=a.programLoader.programs.demos;e={};for(b in c){h=c[b].submenu;e[h]==null&&(e[h]=[]);e[h].push(b)}for(d in e){c=d.replace(" ","_");$("<li></li>").appendTo($("#ulForDemos")).attr("id","hookforDemos"+c);$("<span>"+d+"</span>").appendTo($("#hookforDemos"+c));$("<ul id='"+c+"'></ul>").appendTo($("#hookforDemos"+c));i=e[d];h=0;for(m=i.length;h<m;h++){b=i[h];b="<li><a id='"+b+"'>"+a.programLoader.programs.demos[b].title+"</a></li>";$(b).appendTo($("#"+
c))}}$("<span >Tutorials</span>").appendTo($("<li>").attr("id","tutorials").addClass("current").addClass("sf-parent").appendTo($("#nav")));$("<ul id='ulForTutorials'></ul>").appendTo($("#tutorials"));b=a.programLoader.programs.tutorials;d={};for(j in b){e=b[j].submenu;d[e]==null&&(d[e]=[]);d[e].push(j)}for(l in d){e=l.replace(" ","_");$("<li></li>").appendTo($("#ulForTutorials")).attr("id","hookforTutorials"+e);$("<span>"+l+"</span>").appendTo($("#hookforTutorials"+e));$("<ul id='"+e+"'></ul>").appendTo($("#hookforTutorials"+
e));m=d[l];c=0;for(h=m.length;c<h;c++){j=m[c];b="<li><a id='"+j+"'>"+a.programLoader.programs.tutorials[j].title+"</a></li>";$(b).appendTo($("#"+e))}}$("ul.sf-menu").sooperfish();$("#demos ul li a").click(function(){g.trigger("load-program",$(this).attr("id"));return false});$("#tutorials li a").click(function(){g.trigger("load-program",$(this).attr("id"));return false});$("<span >Autocode</span>").appendTo($("<li>").appendTo($("#nav"))).attr("id","autocodeIndicatorContainer");$("#autocodeIndicatorContainer").click(function(){g.trigger("toggle-autocoder");
return false});$("<span >Hide Code: on</span>").appendTo($("<li>").appendTo($("#nav"))).attr("id","dimCodeButtonContainer");$("#dimCodeButtonContainer").click(function(){g.trigger("editor-toggle-dim");return false});$("<span >Reset</span>").appendTo($("<li>").appendTo($("#nav"))).click(function(){g.trigger("reset");$(a).stop().fadeOut(100).fadeIn(100);return false});$('<span id="errorMessageDiv">msg will go here</span>').appendTo($("<li>").appendTo($("#nav")));a.stats.getDomElement().style.position=
"absolute";a.stats.getDomElement().style.right="0px";a.stats.getDomElement().style.top="0px";document.body.appendChild(a.stats.getDomElement());$("#startingCourtainScreen").fadeOut();$("#formCode").css("opacity",0);a.fullscreenify("#backGroundCanvas");return a.adjustCodeMirrorHeight()})};return b}();
var createBowser=function(){var b=navigator.userAgent,a=/msie/i.test(b),f=/chrome/i.test(b),c=/phantom/i.test(b),d=/safari/i.test(b)&&!f&&!c,e=/iphone/i.test(b),g=/ipad/i.test(b),h=/touchpad/i.test(b),j=/android/i.test(b),l=/opera/i.test(b),m=/firefox/i.test(b),i=/gecko\//i.test(b),p=/seamonkey\//i.test(b),q=/version\/(\d+(\.\d+)?)/i,n,k=function(){if(a)return{msie:true,version:b.match(/msie (\d+(\.\d+)?);/i)[1]};if(f)return{webkit:true,chrome:true,version:b.match(/chrome\/(\d+(\.\d+)?)/i)[1]};if(c)return{webkit:true,
phantom:true,version:b.match(/phantomjs\/(\d+(\.\d+)+)/i)[1]};if(h)return{webkit:true,touchpad:true,version:b.match(/touchpad\/(\d+(\.\d+)?)/i)[1]};if(e||g){n={webkit:true,mobile:true,ios:true,iphone:e,ipad:g};if(q.test(b))n.version=b.match(q)[1];return n}if(j)return{webkit:true,android:true,mobile:true,version:b.match(q)[1]};if(d)return{webkit:true,safari:true,version:b.match(q)[1]};if(l)return{opera:true,version:b.match(q)[1]};if(i){n={gecko:true,mozilla:true,version:b.match(/firefox\/(\d+(\.\d+)?)/i)[1]};
if(m)n.firefox=true;return n}if(p)return{seamonkey:true,version:b.match(/seamonkey\/(\d+(\.\d+)?)/i)[1]}}();k.msie&&k.version>=7||k.chrome&&k.version>=10||k.firefox&&k.version>=4||k.safari&&k.version>=5||k.opera&&k.version>=10?k.a=true:k.msie&&k.version<7||k.chrome&&k.version<10||k.firefox&&k.version<4||k.safari&&k.version<5||k.opera&&k.version<10?k.c=true:k.x=true;return k};
