'use strict';function McState(){var a=[],b=function(b){return function(e){a.push(new McRule(b,e))}};b.rules=a;b.lex=function(a){for(a=b.run(a);"function"==typeof a;)a=a();return a};b.run=McRunMethod;b.continuation=function(a){return function(){return b.run(a)}};return b}function McRule(a,b){this.regex=RegExp("^("+a.source+")");this.regex.compile&&this.regex.compile(this.regex);this.action=b}McRule.prototype.matches=function(a){(a=a.match(this.regex))&&a.shift();return a};
function McRunMethod(a){for(var b=null,c=null,e=-1,g=this.rules.length-1;0<=g;--g){var h=this.rules[g],i=h.matches(a);i&&i[0].length>=e&&(b=h,c=i,e=i[0].length)}if(b)return b.action(c,a.substring(e),this);throw"Lexing error; no match found for: '"+a+"'";}function McCONTINUE(a){return function(b,c){return a.run(c)}}
var McLexer={State:McState},Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.textAlign="center";a.style.background="#eee";a.style.color=
"#000";a.style.padding="1em";a.style.width="475px";a.style.margin="5em auto 0";this.webgl||(a.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/">here</a>.');
return a},addGetWebGLMessage:function(a){var b,c,a=a||{};b=void 0!==a.parent?a.parent:document.body;a=void 0!==a.id?a.id:"oldie";c=Detector.getWebGLErrorMessage();c.id=a;b.appendChild(c)}},badgeHeight=16,Stats=function(){var a,b,c=1,e=0,g=Date.now(),h=g,i=g,j=0,f=1E3,d=0,p,m,n,k=[[0,0,0],[255,255,255]],l=0,r=1E3,q=0,o,s,t,u=[[0,0,0],[255,255,255]];a=document.createElement("div");a.style.cursor="pointer";a.style.width="74px";a.style.zIndex="6";a.addEventListener("mousedown",function(a){a.preventDefault();
c=(c+1)%2;0==c?(p.style.display="block",o.style.display="none"):(p.style.display="none",o.style.display="block")},!1);p=document.createElement("div");p.style.textAlign="right";p.style.lineHeight="1.2em";p.style.backgroundColor="rgb(0,0,0)";p.style.padding="0 0 0px 0px";p.style.display="none";a.appendChild(p);m=document.createElement("div");m.style.fontFamily="Helvetica, Arial, sans-serif";m.style.fontSize="9px";m.style.color="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";m.style.fontWeight="bold";m.innerHTML=
"FPS";p.appendChild(m);n=document.createElement("div");n.style.position="relative";n.style.width="74px";n.style.height=badgeHeight+"px";n.style.backgroundColor="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";for(p.appendChild(n);74>n.children.length;)b=document.createElement("span"),b.style.width="1px",b.style.height=badgeHeight+"px",b.style.cssFloat="left",b.style.backgroundColor="rgb("+k[0][0]+","+k[0][1]+","+k[0][2]+")",n.appendChild(b);o=document.createElement("div");o.style.textAlign="right";o.style.lineHeight=
"1.2em";o.style.backgroundColor="rgb(0,0,0)";o.style.padding="0 0 0px 0px";o.style.display="block";a.appendChild(o);s=document.createElement("div");s.style.fontFamily="Helvetica, Arial, sans-serif";s.style.fontSize="9px";s.style.color="rgb("+u[1][0]+","+u[1][1]+","+u[1][2]+")";s.style.fontWeight="bold";s.innerHTML="MS";o.appendChild(s);t=document.createElement("div");t.style.position="relative";t.style.width="74px";t.style.height=badgeHeight+"px";t.style.backgroundColor="rgb("+u[1][0]+","+u[1][1]+
","+u[1][2]+")";for(o.appendChild(t);74>t.children.length;)b=document.createElement("span"),b.style.width="1px",b.style.height=Math.random()*badgeHeight+"px",b.style.cssFloat="left",b.style.backgroundColor="rgb("+u[0][0]+","+u[0][1]+","+u[0][2]+")",t.appendChild(b);return{getDomElement:function(){return a},getFps:function(){return j},getFpsMin:function(){return f},getFpsMax:function(){return d},getMs:function(){return l},getMsMin:function(){return r},getMsMax:function(){return q},update:function(){g=
Date.now();l=g-h;r=Math.min(r,l);q=Math.max(q,l);s.textContent=l+" MS ";var a=Math.min(badgeHeight,badgeHeight-l/200*badgeHeight);t.appendChild(t.firstChild).style.height=a+"px";h=g;e++;g>i+1E3&&(j=Math.round(1E3*e/(g-i)),f=Math.min(f,j),d=Math.max(d,j),m.textContent=j+" FPS ("+f+"-"+d+")",a=Math.min(badgeHeight,badgeHeight-j/100*badgeHeight),n.appendChild(n.firstChild).style.height=a+"px",i=g,e=0)}}},THREEx=THREEx||{};
THREEx.WindowResize=function(a,b){var c=function(){a.setSize(window.innerWidth,window.innerHeight);b.aspect=window.innerWidth/window.innerHeight;b.updateProjectionMatrix()};window.addEventListener("resize",c,!1);return{stop:function(){window.removeEventListener("resize",c)}}};THREEx.WindowResize.bind=function(a,b){return THREEx.WindowResize(a,b)};
THREE.ShaderExtras={screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},convolution:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},
uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"uniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\nvUv = uv - ( ( KERNEL_SIZE - 1.0 ) / 2.0 ) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cKernel[ KERNEL_SIZE ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i = 0; i < KERNEL_SIZE; i ++ ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
bokeh:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},aspect:{type:"f",value:1},aperture:{type:"f",value:0.025},maxblur:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"},
dofmipmap:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},maxblur:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float focus;\nuniform float maxblur;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\nvoid main() {\nvec4 depth = texture2D( tDepth, vUv );\nfloat factor = depth.x - focus;\nvec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );\ngl_FragColor = col;\ngl_FragColor.a = 1.0;\n}"},
sepia:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},amount:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nvec3 c = color.rgb;\ncolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\ncolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\ncolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\ngl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"},
dotscreen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(0.5,0.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\nfloat s = sin( angle ), c = cos( angle );\nvec2 tex = vUv * tSize - center;\nvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\nreturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nfloat average = ( color.r + color.g + color.b ) / 3.0;\ngl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"},
vignette:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\ngl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"},
bleachbypass:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 base = texture2D( tDiffuse, vUv );\nvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\nfloat lum = dot( lumCoeff, base.rgb );\nvec3 blend = vec3( lum );\nfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\nvec3 result1 = 2.0 * base.rgb * blend;\nvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\nvec3 newColor = mix( result1, result2, L );\nfloat A2 = opacity * base.a;\nvec3 mixRGB = A2 * newColor.rgb;\nmixRGB += ( ( 1.0 - A2 ) * base.rgb );\ngl_FragColor = vec4( mixRGB, base.a );\n}"},
focus:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:0.94},waveFactor:{type:"f",value:0.00125}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float sampleDistance;\nuniform float waveFactor;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color, org, tmp, add;\nfloat sample_dist, f;\nvec2 vin;\nvec2 uv = vUv;\nadd += color = org = texture2D( tDiffuse, uv );\nvin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );\nsample_dist = dot( vin, vin ) * 2.0;\nf = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;\nvec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\nadd += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );\nif( tmp.b < color.b ) color = tmp;\ncolor = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );\ncolor = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );\ngl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );\n}"},
triangleBlur:{uniforms:{texture:{type:"t",value:0,texture:null},delta:{type:"v2",value:new THREE.Vector2(1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define ITERATIONS 10.0\nuniform sampler2D texture;\nuniform vec2 delta;\nvarying vec2 vUv;\nfloat random( vec3 scale, float seed ) {\nreturn fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );\n}\nvoid main() {\nvec4 color = vec4( 0.0 );\nfloat total = 0.0;\nfloat offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );\nfor ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {\nfloat percent = ( t + offset - 0.5 ) / ITERATIONS;\nfloat weight = 1.0 - abs( percent );\ncolor += texture2D( texture, vUv + delta * percent ) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}"},
basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"},horizontalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \tvUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"},
verticalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t  ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\ngl_FragColor = sum;\n}"},
horizontalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat hh = h * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \t vUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"},
verticalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512},r:{type:"f",value:0.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat vv = v * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t   ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;\ngl_FragColor = sum;\n}"},
blend:{uniforms:{tDiffuse1:{type:"t",value:0,texture:null},tDiffuse2:{type:"t",value:1,texture:null},mixRatio:{type:"f",value:0.5},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform float mixRatio;\nuniform sampler2D tDiffuse1;\nuniform sampler2D tDiffuse2;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel1 = texture2D( tDiffuse1, vUv );\nvec4 texel2 = texture2D( tDiffuse2, vUv );\nvec3 ca = vec3(texel1.x,texel1.y,texel1.z);\nvec3 cb = vec3(texel2.x,texel2.y,texel2.z);\nfloat alphaa = texel1.w ;\nfloat alphab = texel2.w*mixRatio;\nfloat alphao = (alphaa + alphab * (1.0-alphaa));\nvec3 co = (1.0/alphao) * (ca * alphaa + cb*alphab*(1.0-alphaa));\nvec4 mixxx = vec4(co, alphao );\ngl_FragColor =  mixxx;\n}"},
fxaa:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nfloat opacity  = rgbaM.w;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec3 rgbA = 0.5 * (\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz +\ntexture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz );\nfloat lumaB = dot( rgbB, luma );\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\ngl_FragColor = vec4( rgbA, opacity );\n} else {\ngl_FragColor = vec4( rgbB, opacity );\n}\n}"},
luminosity:{uniforms:{tDiffuse:{type:"t",value:0,texture:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v, v, v, texel.w );\n}"},colorCorrection:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},powRGB:{type:"v3",value:new THREE.Vector3(2,2,2)},mulRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec3 powRGB;\nuniform vec3 mulRGB;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb = mulRGB * pow( gl_FragColor.rgb, powRGB );\n}"},
normalmap:{uniforms:{heightMap:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(512,512)},scale:{type:"v2",value:new THREE.Vector2(1,1)},height:{type:"f",value:0.05}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\nfloat val = texture2D( heightMap, vUv ).x;\nfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\nfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\ngl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"},
ssao:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},size:{type:"v2",value:new THREE.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},fogNear:{type:"f",value:5},fogFar:{type:"f",value:100},fogEnabled:{type:"i",value:0},aoClamp:{type:"f",value:0.3}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cameraNear;\nuniform float cameraFar;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogEnabled;\nuniform vec2 size;\nuniform float aoClamp;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nfloat width = size.x;\nfloat height = size.y;\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nconst int samples = 8;\nconst float radius = 5.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0002;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\nconst bool onlyAO = false;\nconst float lumInfluence = 0.3;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( width / 2.0 ) );\nfloat gg = fract( coord.t * ( height / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat doFog() {\nfloat zdepth = unpackDepth( texture2D( tDepth, vUv ) );\nfloat depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );\nreturn smoothstep( fogNear, fogFar, depth );\n}\nfloat readDepth( const in vec2 coord ) {\nreturn cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat pw;\nfloat ph;\nfloat ao;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\npw = cos( l ) * r;\nph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nif ( fogEnabled ) {\nao = mix( ao, 1.0, doFog() );\n}\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"},
colorify:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v * color, texel.w );\n}"},
unpackDepthRGBA:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvoid main() {\nfloat depth = 1.0 - unpackDepth( texture2D( tDiffuse, vUv ) );\ngl_FragColor = opacity * vec4( vec3( depth ), 1.0 );\n}"},
buildKernel:function(a){var b,c,e,g,h=2*Math.ceil(3*a)+1;25<h&&(h=25);g=0.5*(h-1);c=Array(h);for(b=e=0;b<h;++b)c[b]=Math.exp(-((b-g)*(b-g))/(2*a*a)),e+=c[b];for(b=0;b<h;++b)c[b]/=e;return c}};
THREE.EffectComposer=function(a,b){this.renderer=a;this.renderTarget1=b;void 0===this.renderTarget1&&(this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBufer:!1},this.renderTarget1=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters));this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=new THREE.ShaderPass(THREE.ShaderExtras.screen)};
THREE.EffectComposer.prototype={swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=a},addPass:function(a){this.passes.push(a)},render:function(a){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var b=!1,c,e,g=this.passes.length;for(e=0;e<g;e++)if(c=this.passes[e],c.enabled){c.render(this.renderer,this.writeBuffer,this.readBuffer,a,b);if(c.needsSwap){if(b){var h=this.renderer.context;h.stencilFunc(h.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,
this.writeBuffer,this.readBuffer,a);h.stencilFunc(h.EQUAL,1,4294967295)}this.swapBuffers()}c instanceof THREE.MaskPass?b=!0:c instanceof THREE.ClearMaskPass&&(b=!1)}},reset:function(a){this.renderTarget1=a;void 0===this.renderTarget1&&(this.renderTarget1=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters));this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;THREE.EffectComposer.quad.scale.set(window.innerWidth,
window.innerHeight,1);THREE.EffectComposer.camera.left=window.innerWidth/-2;THREE.EffectComposer.camera.right=window.innerWidth/2;THREE.EffectComposer.camera.top=window.innerHeight/2;THREE.EffectComposer.camera.bottom=window.innerHeight/-2;THREE.EffectComposer.camera.updateProjectionMatrix()}};THREE.EffectComposer.camera=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1E4,1E4);
THREE.EffectComposer.geometry=new THREE.PlaneGeometry(1,1);THREE.EffectComposer.quad=new THREE.Mesh(THREE.EffectComposer.geometry,null);THREE.EffectComposer.quad.position.z=-100;THREE.EffectComposer.quad.scale.set(window.innerWidth,window.innerHeight,1);THREE.EffectComposer.scene=new THREE.Scene;THREE.EffectComposer.scene.add(THREE.EffectComposer.quad);THREE.EffectComposer.scene.add(THREE.EffectComposer.camera);
THREE.RenderPass=function(a,b,c,e,g){this.scene=a;this.camera=b;this.overrideMaterial=c;this.clearColor=e;this.clearAlpha=void 0!==g?g:1;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.clear=this.enabled=!0;this.needsSwap=!1};
THREE.RenderPass.prototype={render:function(a,b,c){this.scene.overrideMaterial=this.overrideMaterial;this.clearColor&&(this.oldClearColor.copy(a.getClearColor()),this.oldClearAlpha=a.getClearAlpha(),a.setClearColor(this.clearColor,this.clearAlpha));a.render(this.scene,this.camera,c,this.clear);this.clearColor&&a.setClearColor(this.oldClearColor,this.oldClearAlpha);this.scene.overrideMaterial=null}};
THREE.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader});this.renderToScreen=!1;this.needsSwap=this.enabled=!0;this.clear=!1};
THREE.ShaderPass.prototype={render:function(a,b,c){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].texture=c);THREE.EffectComposer.quad.material=this.material;this.renderToScreen?a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,b,this.clear)}};THREE.MaskPass=function(a,b){this.scene=a;this.camera=b;this.clear=this.enabled=!0;this.inverse=this.needsSwap=!1};
THREE.MaskPass.prototype={render:function(a,b,c){var e=a.context;e.colorMask(!1,!1,!1,!1);e.depthMask(!1);var g,h;this.inverse?(g=0,h=1):(g=1,h=0);e.enable(e.STENCIL_TEST);e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE);e.stencilFunc(e.ALWAYS,g,4294967295);e.clearStencil(h);a.render(this.scene,this.camera,c,this.clear);a.render(this.scene,this.camera,b,this.clear);e.colorMask(!0,!0,!0,!0);e.depthMask(!0);e.stencilFunc(e.EQUAL,1,4294967295);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};
THREE.ClearMaskPass=function(){this.enabled=!0};THREE.ClearMaskPass.prototype={render:function(a){a=a.context;a.disable(a.STENCIL_TEST)}};
THREE.SavePass=function(a){var b=THREE.ShaderExtras.screen;this.textureID="tDiffuse";this.uniforms=THREE.UniformsUtils.clone(b.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader});this.renderTarget=a;void 0===this.renderTarget&&(this.renderTargetParameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBufer:!1},this.renderTarget=new THREE.WebGLRenderTarget(window.innerWidth,
window.innerHeight,this.renderTargetParameters));this.enabled=!0;this.clear=this.needsSwap=!1};THREE.SavePass.prototype={render:function(a,b,c){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].texture=c);THREE.EffectComposer.quad.material=this.material;a.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTarget,this.clear)}};
CodeMirror.defineMode("livecodelab",function(a){function b(a){return RegExp("^(("+a.join(")|(")+"))\\b")}function c(a,b){if(a.sol()){var c=b.scopes[0].offset;if(a.eatSpace()){var g=a.indentation();return g>c?"indent":g<c?"dedent":null}0<c&&h(a,b)}if(a.eatSpace())return null;c=a.peek();if("#"===c||"/"===c&&a.match(/\/\//i))return a.skipToEnd(),"comment";if(a.match(/^-?[0-9\.]/,!1)){c=!1;a.match(/^-?\d*\.\d+(e[\+\-]?\d+)?/i)&&(c=!0);a.match(/^-?\d+\.\d*/)&&(c=!0);a.match(/^-?\.\d+/)&&(c=!0);if(c)return"number";
c=!1;a.match(/^-?0x[0-9a-f]+/i)&&(c=!0);a.match(/^-?[1-9]\d*(e[\+\-]?\d+)?/)&&(c=!0);a.match(/^-?0(?![\dx])/i)&&(c=!0);if(c)return"number"}if(a.match(o))return b.tokenize=e(a.current(),"string"),b.tokenize(a,b);if(a.match(s)){if("/"!=a.current()||a.match(/^.*\//,!1))return b.tokenize=e(a.current(),"string-2"),b.tokenize(a,b);a.backUp(1)}if(a.match(n)||a.match(m))return"punctuation";if(a.match(p)||a.match(f)||a.match(l))return"operator";if(a.match(d))return"punctuation";if(a.match(t))return"atom";
if(a.match(q))return"keyword";if(a.match(k))return"variable";a.next();return j}function e(b,d){var e=RegExp(b),f=1==b.length;return function(b,g){for(;!b.eol();)if(b.eatWhile(/[^'"\/\\]/),b.eat("\\")){if(b.next(),f&&b.eol())return d}else{if(b.match(e))return g.tokenize=c,d;b.eat(/['"\/]/)}f&&(a.mode.singleLineStringErrors?d=j:g.tokenize=c);return d}}function g(b,c,d){var d=d||"coffee",e=0;if("coffee"===d)for(b=0;b<c.scopes.length;b++){if("coffee"===c.scopes[b].type){e=c.scopes[b].offset+a.indentUnit;
break}}else e=b.column()+b.current().length;c.scopes.unshift({offset:e,type:d})}function h(a,b){if(1!=b.scopes.length){if("coffee"===b.scopes[0].type){for(var c=a.indentation(),d=-1,e=0;e<b.scopes.length;++e)if(c===b.scopes[e].offset){d=e;break}if(-1===d)return!0;for(;b.scopes[0].offset!==c;)b.scopes.shift()}else b.scopes.shift();return!1}}function i(a,b){var c=b.tokenize(a,b),d=a.current();if("."===d)return c=b.tokenize(a,b),a.current(),"variable"===c?"variable":j;if("@"===d)return c=b.tokenize(a,
b),a.current(),"variable"===c?"variable-2":j;"return"===d&&(b.dedent+=1);(("->"===d||"=>"===d)&&!b.lambda&&"coffee"==b.scopes[0].type&&""===a.peek()||"indent"===c)&&g(a,b);var e="[({".indexOf(d);-1!==e&&g(a,b,"])}".slice(e,e+1));r.exec(d)&&g(a,b);"then"==d&&h(a,b);if("dedent"===c&&h(a,b))return j;e="])}".indexOf(d);if(-1!==e&&h(a,b))return j;0<b.dedent&&a.eol()&&"coffee"==b.scopes[0].type&&(1<b.scopes.length&&b.scopes.shift(),b.dedent-=1);return c}var j="error",f=/^[\+\-\*/%&|\^~<>!?]/,d=/^[\(\)\[\]\{\}@,:`=;\.]/,
p=RegExp("^((->)|(=>)|(\\+\\+)|(\\+\\=)|(\\-\\-)|(\\-\\=)|(\\*\\*)|(\\*\\=)|(\\/\\/)|(\\/\\=)|(==)|(!=)|(<=)|(>=)|(<>)|(<<)|(>>)|(//))"),m=/^((\.\.)|(\+=)|(\-=)|(\*=)|(%=)|(\/=)|(&=)|(\|=)|(\^=))/,n=/^((\.\.\.)|(\/\/=)|(>>=)|(<<=)|(\*\*=))/,k=/^[_A-Za-z][_A-Za-z0-9]*/,l=b("and,or,not,is,isnt,in,instanceof,typeof".split(",")),r="draw,for,while,loop,if,unless,else,switch,try,catch,finally,class".split(","),q=b(r.concat("break,by,continue,debugger,delete,do,in,of,new,return,then,this,throw,when,until".split(","))),
r=b(r),o=/^('{3}|"{3}|['"])/,s=/^(\/{3}|\/)/,t=b("Infinity,NaN,undefined,null,true,false,on,off,yes,no".split(","));return{startState:function(a){return{tokenize:c,scopes:[{offset:a||0,type:"coffee"}],lastToken:null,lambda:!1,dedent:0}},token:function(a,b){if(a.match(/\/\/\s*(next-tutorial:([^\s]+))\b/))return"link";var c=i(a,b);b.lastToken={style:c,content:a.current()};a.eol()&&a.lambda&&(b.lambda=!1);return c},indent:function(a){return a.tokenize!=c?0:a.scopes[0].offset}}});
CodeMirror.defineMIME("text/x-coffeescript","coffeescript");
var stats,scene,renderer,camera,editor,isWebGLUsed=!1,linesPool=[],rectanglesPool=[],boxesPool=[],cylindersPool=[],spheresPool={},sphereGeometriesPool={},ambientLightsPool=[],pointLightsPool=[],usedLines=0,usedRectangles=0,usedBoxes=0,usedCylinders=0,usedAmbientLights=0,usedPointLights=0,usedSpheres={},ballDefaultDetLevel,ballDetLevel,currentStrokeSize=1,cubeGeometry=new THREE.CubeGeometry(1,1,1),planeGeometry=new THREE.PlaneGeometry(1,1),lineGeometry=new THREE.Geometry,cylinderGeometry=new THREE.CylinderGeometry(0.5,
0.5,1,32);lineGeometry.vertices.push(new THREE.Vertex(new THREE.Vector3(0,-0.5,0)));lineGeometry.vertices.push(new THREE.Vertex(new THREE.Vector3(0,0.5,0)));
var worldMatrix=new THREE.Matrix4,forceCanvasRenderer=!1,backgroundScene,backgroundSceneContext,sceneRenderingCanvas,sceneRenderingCanvasContext,previousRenderForBlending,previousRenderForBlendingContext,finalRenderWithSceneAndBlend,finalRenderWithSceneAndBlendContext,useRequestAnimationFrame=!0,wantedFramesPerSecond=-1,backGroundFraction=15,scaledBackgroundWidth,scaledBackgroundHeight,repaintBackroundEveryFrame=!0,fullScreenifyBackground=!0,animationStyleValue=0,previousanimationStyleValue=0,currentGradientStackValue=
"",previousGradientStackValue=0,blendAmount=0,normal=0,paintOver=1,motionBlur=2,soundLoops=[];soundLoops.soundIDs=[];soundLoops.beatStrings=[];var programHasBasicError=!1,reasonOfBasicError="",consecutiveFramesWithoutRunTimeError=0,out,lastStableProgram,doTheSpinThingy=!0,resetTheSpinThingy=!1,SPINFRAMES=30,userWarnedAboutWebglExamples=!1,dimIntervalID;function isCanvasSupported(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}
var aliceblue=4293982463,antiquewhite=4294634455,aqua=4278255615,aquamarine=4286578644,azure=4293984255,beige=4294309340,bisque=4294960324,black=4278190080,blanchedalmond=4294962125,blue=4278190335,blueviolet=4287245282,brown=4289014314,burlywood=4292786311,cadetblue=4284456608,chartreuse=4286578432,chocolate=4291979550,coral=4294934352,cornflowerblue=4284782061,cornsilk=4294965468,crimson=4292613180,cyan=4278255615,darkblue=4278190219,darkcyan=4278225803,darkgoldenrod=4290283019,darkgray=4289309097,
darkgrey=4289309097,darkgreen=4278215680,darkkhaki=4290623339,darkmagenta=4287299723,darkolivegreen=4283788079,darkorange=4294937600,darkorchid=4288230092,darkred=4287299584,darksalmon=4293498490,darkseagreen=4287609999,darkslateblue=4282924427,darkslategray=4281290575,darkslategrey=4281290575,darkturquoise=4278243025,darkviolet=4287889619,deeppink=4294907027,deepskyblue=4278239231,dimgray=4285098345,dimgrey=4285098345,dodgerblue=4280193279,firebrick=4289864226,floralwhite=4294966E3,forestgreen=4280453922,
fuchsia=4294902015,gainsboro=4292664540,ghostwhite=4294506751,gold=4294956800,goldenrod=4292519200,gray=4286611584,grey=4286611584,green=4278222848,greenyellow=4289593135,honeydew=4293984240,hotpink=4294928820,indianred=4291648604,indigo=4283105410,ivory=4294967280,khaki=4293977740,lavender=4293322490,lavenderblush=4294963445,lawngreen=4286381056,lemonchiffon=4294965965,lightblue=4289583334,lightcoral=4293951616,lightcyan=4292935679,lightgoldenrodyellow=4294638290,lightgrey=4292072403,lightgray=4292072403,
lightgreen=4287688336,lightpink=4294948545,lightsalmon=4294942842,lightseagreen=4280332970,lightskyblue=4287090426,lightslategray=4286023833,lightslategrey=4286023833,lightsteelblue=4289774814,lightyellow=4294967264,lime=4278255360,limegreen=4281519410,linen=4294635750,magenta=4294902015,maroon=4286578688,mediumaquamarine=4284927402,mediumblue=4278190285,mediumorchid=4290401747,mediumpurple=4287852760,mediumseagreen=4282168177,mediumslateblue=4286277870,mediumspringgreen=4278254234,mediumturquoise=
4282962380,mediumvioletred=4291237253,midnightblue=4279834992,mintcream=4294311930,mistyrose=4294960353,moccasin=4294960309,navajowhite=4294958765,navy=4278190208,oldlace=4294833638,olive=4286611456,olivedrab=4285238819,orange=4294944E3,orangered=4294919424,orchid=4292505814,palegoldenrod=4293847210,palegreen=4288215960,paleturquoise=4289720046,palevioletred=4292374675,papayawhip=4294963157,peachpuff=4294957753,peru=4291659071,pink=4294951115,plum=4292714717,powderblue=4289781990,purple=4286578816,
red=4294901760,rosybrown=4290547599,royalblue=4282477025,saddlebrown=4287317267,salmon=4294606962,sandybrown=4294222944,seagreen=4281240407,seashell=4294964718,sienna=4288696877,silver=4290822336,skyblue=4287090411,slateblue=4285160141,slategray=4285563024,slategrey=4285563024,snow=4294966010,springgreen=4278255487,steelblue=4282811060,tan=4291998860,teal=4278222976,thistle=4292394968,tomato=4294927175,turquoise=4282441936,violet=4293821166,wheat=4294303411,white=4294967295,whitesmoke=4294309365,
yellow=4294967040,yellowgreen=4288335154,createEditor=function(){return CodeMirror.fromTextArea(document.getElementById("code"),{lineNumbers:!1,indentWithTabs:!0,tabSize:1,indentUnit:1,lineWrapping:!0,onBlur:function(){setTimeout("editor.focus()",30)},onChange:function(){registerCode()},mode:"livecodelab",onCursorActivity:function(){suspendDimmingAndCheckIfLink()},theme:"night"})},Constants={RGB:1,ARGB:2,HSB:3,ALPHA:4,CMYK:5,REPLACE:0,BLEND:1,ADD:2,SUBTRACT:4,LIGHTEST:8,DARKEST:16,DIFFERENCE:32,EXCLUSION:64,
MULTIPLY:128,SCREEN:256,OVERLAY:512,HARD_LIGHT:1024,SOFT_LIGHT:2048,DODGE:4096,BURN:8192,ALPHA_MASK:4278190080,RED_MASK:16711680,GREEN_MASK:65280,BLUE_MASK:255},doFill=!0,fillStyle=[1,1,1,1],isFillDirty=!0,doStroke=!0,strokeStyle=[0,0,0,1],isStrokeDirty=!0,lineWidth=1,colorModeA=255,colorModeX=255,colorModeY=255,colorModeZ=255,curColorMode=Constants.RGB,max=function(){if(2===arguments.length)return arguments[0]<arguments[1]?arguments[1]:arguments[0];var a=1===arguments.length?arguments[0]:arguments;
if(!("length"in a&&0<a.length))throw"Non-empty array is expected";for(var b=a[0],c=a.length,e=1;e<c;++e)b<a[e]&&(b=a[e]);return b},min=function(){if(2===arguments.length)return arguments[0]<arguments[1]?arguments[0]:arguments[1];var a=1===arguments.length?arguments[0]:arguments;if(!("length"in a&&0<a.length))throw"Non-empty array is expected";for(var b=a[0],c=a.length,e=1;e<c;++e)b>a[e]&&(b=a[e]);return b};
function color$4(a,b,c,e){curColorMode===Constants.HSB?(c=color.toRGB(a,b,c),a=c[0],b=c[1],c=c[2]):(a=Math.round(255*(a/colorModeX)),b=Math.round(255*(b/colorModeY)),c=Math.round(255*(c/colorModeZ)));e=Math.round(255*(e/colorModeA));a=0>a?0:a;b=0>b?0:b;c=0>c?0:c;e=0>e?0:e;return(255<e?255:e)<<24&Constants.ALPHA_MASK|(255<a?255:a)<<16&Constants.RED_MASK|(255<b?255:b)<<8&Constants.GREEN_MASK|(255<c?255:c)&Constants.BLUE_MASK}
function color$2(a,b){var c;if(a===angleColor)return angleColor;if(a&Constants.ALPHA_MASK)return c=Math.round(255*(b/colorModeA)),c=255<c?255:c,a-(a&Constants.ALPHA_MASK)+((0>c?0:c)<<24&Constants.ALPHA_MASK);if(curColorMode===Constants.RGB)return color$4(a,a,a,b);if(curColorMode===Constants.HSB)return color$4(0,0,a/colorModeX*colorModeZ,b)}
function color$1(a){if(a<=colorModeX&&0<=a){if(curColorMode===Constants.RGB)return color$4(a,a,a,colorModeA);if(curColorMode===Constants.HSB)return color$4(0,0,a/colorModeX*colorModeZ,colorModeA)}if(a)return 2147483647<a&&(a-=4294967296),a}
var color=function(a,b,c,e){return void 0!==a&&void 0!==b&&void 0!==c&&void 0!==e?color$4(a,b,c,e):void 0!==a&&void 0!==b&&void 0!==c?color$4(a,b,c,colorModeA):void 0!==a&&void 0!==b?color$2(a,b):"number"===typeof a?color$1(a):color$4(colorModeX,colorModeY,colorModeZ,colorModeA)};color.toString=function(a){return"rgba("+((a&Constants.RED_MASK)>>>16)+","+((a&Constants.GREEN_MASK)>>>8)+","+(a&Constants.BLUE_MASK)+","+((a&Constants.ALPHA_MASK)>>>24)/255+")"};
color.toInt=function(a,b,c,e){return e<<24&Constants.ALPHA_MASK|a<<16&Constants.RED_MASK|b<<8&Constants.GREEN_MASK|c&Constants.BLUE_MASK};color.toArray=function(a){return[(a&Constants.RED_MASK)>>>16,(a&Constants.GREEN_MASK)>>>8,a&Constants.BLUE_MASK,(a&Constants.ALPHA_MASK)>>>24]};color.toGLArray=function(a){return[((a&Constants.RED_MASK)>>>16)/255,((a&Constants.GREEN_MASK)>>>8)/255,(a&Constants.BLUE_MASK)/255,((a&Constants.ALPHA_MASK)>>>24)/255]};
color.toRGB=function(a,b,c){var a=a>colorModeX?colorModeX:a,b=b>colorModeY?colorModeY:b,c=c>colorModeZ?colorModeZ:c,a=360*(a/colorModeX),b=100*(b/colorModeY),c=100*(c/colorModeZ),e=Math.round(255*(c/100));if(0===b)return[e,e,e];var a=a%360,g=a%60,h=Math.round(255*(c*(100-b)/1E4)),i=Math.round(255*(c*(6E3-b*g)/6E5)),b=Math.round(255*(c*(6E3-b*(60-g))/6E5));switch(Math.floor(a/60)){case 0:return[e,b,h];case 1:return[i,e,h];case 2:return[h,e,b];case 3:return[h,i,e];case 4:return[b,h,e];case 5:return[e,
h,i]}};function colorToHSB(a){var b,c,e,g;b=((a&Constants.RED_MASK)>>>16)/255;c=((a&Constants.GREEN_MASK)>>>8)/255;e=(a&Constants.BLUE_MASK)/255;g=max(max(b,c),e);a=min(min(b,c),e);if(a===g)return[0,0,g*colorModeZ];b=(b===g?(c-e)/(g-a):c===g?2+(e-b)/(g-a):4+(b-c)/(g-a))/6;0>b?b+=1:1<b&&(b-=1);return[b*colorModeX,(g-a)/g*colorModeY,g*colorModeZ]}
var brightness=function(a){return colorToHSB(a)[2]},saturation=function(a){return colorToHSB(a)[1]},hue=function(a){return colorToHSB(a)[0]},redF=function(a){return((a&Constants.RED_MASK)>>>16)/255*colorModeX},greenF=function(a){return((a&Constants.GREEN_MASK)>>>8)/255*colorModeY},blueF=function(a){return(a&Constants.BLUE_MASK)/255*colorModeZ},alpha=function(a){return((a&Constants.ALPHA_MASK)>>>24)/255*colorModeA},alphaZeroToOne=function(a){return((a&Constants.ALPHA_MASK)>>>24)/255},lerp=function(a,
b,c){return(b-a)*c+a},lerpColor=function(a,b,c){var e,g,h,i,j,f,a=color(a),b=color(b);if(curColorMode===Constants.HSB)return h=colorToHSB(a),a=((a&Constants.ALPHA_MASK)>>>24)/colorModeA,g=colorToHSB(b),b=((b&Constants.ALPHA_MASK)>>>24)/colorModeA,f=lerp(h[0],g[0],c),e=lerp(h[1],g[1],c),h=lerp(h[2],g[2],c),h=color.toRGB(f,e,h),c=lerp(a,b,c)*colorModeA,c<<24&Constants.ALPHA_MASK|h[0]<<16&Constants.RED_MASK|h[1]<<8&Constants.GREEN_MASK|h[2]&Constants.BLUE_MASK;e=(a&Constants.RED_MASK)>>>16;g=(a&Constants.GREEN_MASK)>>>
8;h=a&Constants.BLUE_MASK;a=((a&Constants.ALPHA_MASK)>>>24)/colorModeA;i=(b&Constants.RED_MASK)>>>16;j=(b&Constants.GREEN_MASK)>>>8;f=b&Constants.BLUE_MASK;b=((b&Constants.ALPHA_MASK)>>>24)/colorModeA;e=lerp(e,i,c)|0;g=lerp(g,j,c)|0;h=lerp(h,f,c)|0;c=lerp(a,b,c)*colorModeA;return c<<24&Constants.ALPHA_MASK|e<<16&Constants.RED_MASK|g<<8&Constants.GREEN_MASK|h&Constants.BLUE_MASK},colorMode=function(){curColorMode=arguments[0];1<arguments.length&&(colorModeX=arguments[1],colorModeY=arguments[2]||arguments[1],
colorModeZ=arguments[3]||arguments[1],colorModeA=arguments[4]||arguments[1])},blendColor=function(a,b,c){if(c===Constants.REPLACE)return modes.replace(a,b);if(c===Constants.BLEND)return modes.blend(a,b);if(c===Constants.ADD)return modes.add(a,b);if(c===Constants.SUBTRACT)return modes.subtract(a,b);if(c===Constants.LIGHTEST)return modes.lightest(a,b);if(c===Constants.DARKEST)return modes.darkest(a,b);if(c===Constants.DIFFERENCE)return modes.difference(a,b);if(c===Constants.EXCLUSION)return modes.exclusion(a,
b);if(c===Constants.MULTIPLY)return modes.multiply(a,b);if(c===Constants.SCREEN)return modes.screen(a,b);if(c===Constants.HARD_LIGHT)return modes.hard_light(a,b);if(c===Constants.SOFT_LIGHT)return modes.soft_light(a,b);if(c===Constants.OVERLAY)return modes.overlay(a,b);if(c===Constants.DODGE)return modes.dodge(a,b);if(c===Constants.BURN)return modes.burn(a,b)},currentFillAlpha=1,currentFillColor=16777215,defaultNormalFill=!0,defaultNormalStroke=!0,angleColor=-16777217,fill=function(a,b,c,e){defaultNormalFill=
!1;c=color(a,b,c,e);c===angleColor?(defaultNormalFill=!0,a=c,b=void 0!==b?b/colorModeA:1):(a=color(redF(c),greenF(c),blueF(c)),b=alphaZeroToOne(c));a===currentFillColor&&b===currentFillAlpha&&doFill||(doFill=!0,currentFillColor=a,currentFillAlpha=b)},noFill=function(){defaultNormalFill=doFill=!1},currentStrokeAlpha=1,currentStrokeColor=0,stroke=function(a,b,c,e){defaultNormalStroke=!1;c=color(a,b,c,e);c===angleColor?(defaultNormalStroke=!0,a=c,b=void 0!==b?b/colorModeA:1):(a=color(redF(c),greenF(c),
blueF(c)),b=alphaZeroToOne(c));a===currentStrokeColor&&b===currentStrokeAlpha&&doStroke||(doStroke=!0,currentStrokeColor=a,currentStrokeAlpha=b)},noStroke=function(){doStroke=!1},strokeSize=function(a){void 0===a?a=1:0>a&&(a=0);currentStrokeSize=a},modes=function(){function a(a,b,c,e,g,i,k,l,r,q,o){a=h(((a&4278190080)>>>24)+b,255)<<24;c+=(r-c)*b>>8;e+=(q-e)*b>>8;b=g+((o-g)*b>>8);return a|(0>c?0:255<c?255:c)<<16|(0>e?0:255<e?255:e)<<8|(0>b?0:255<b?255:b)}var b=Constants.ALPHA_MASK,c=Constants.RED_MASK,
e=Constants.GREEN_MASK,g=Constants.BLUE_MASK,h=Math.min,i=Math.max;return{replace:function(a,b){return b},blend:function(a,f){var d=(f&b)>>>24,i=a&c,m=a&e,n=a&g,k=f&c,l=f&e,r=f&g;return h(((a&b)>>>24)+d,255)<<24|i+((k-i)*d>>8)&c|m+((l-m)*d>>8)&e|n+((r-n)*d>>8)&g},add:function(a,f){var d=(f&b)>>>24;return h(((a&b)>>>24)+d,255)<<24|h((a&c)+((f&c)>>8)*d,c)&c|h((a&e)+((f&e)>>8)*d,e)&e|h((a&g)+((f&g)*d>>8),g)},subtract:function(a,f){var d=(f&b)>>>24;return h(((a&b)>>>24)+d,255)<<24|i((a&c)-((f&c)>>8)*
d,e)&c|i((a&e)-((f&e)>>8)*d,g)&e|i((a&g)-((f&g)*d>>8),0)},lightest:function(a,f){var d=(f&b)>>>24;return h(((a&b)>>>24)+d,255)<<24|i(a&c,((f&c)>>8)*d)&c|i(a&e,((f&e)>>8)*d)&e|i(a&g,(f&g)*d>>8)},darkest:function(a,f){var d=(f&b)>>>24,i=a&c,m=a&e,n=a&g,k=h(a&c,((f&c)>>8)*d),l=h(a&e,((f&e)>>8)*d),r=h(a&g,(f&g)*d>>8);return h(((a&b)>>>24)+d,255)<<24|i+((k-i)*d>>8)&c|m+((l-m)*d>>8)&e|n+((r-n)*d>>8)&g},difference:function(h,f){var d=(h&c)>>16,i=(h&e)>>8,m=h&g,n=(f&c)>>16,k=(f&e)>>8,l=f&g;return a(h,(f&
b)>>>24,d,i,m,n,k,l,d>n?d-n:n-d,i>k?i-k:k-i,m>l?m-l:l-m)},exclusion:function(h,f){var d=(h&c)>>16,i=(h&e)>>8,m=h&g,n=(f&c)>>16,k=(f&e)>>8,l=f&g;return a(h,(f&b)>>>24,d,i,m,n,k,l,d+n-(d*n>>7),i+k-(i*k>>7),m+l-(m*l>>7))},multiply:function(h,f){var d=(h&c)>>16,i=(h&e)>>8,m=h&g,n=(f&c)>>16,k=(f&e)>>8,l=f&g;return a(h,(f&b)>>>24,d,i,m,n,k,l,d*n>>8,i*k>>8,m*l>>8)},screen:function(h,f){var d=(h&c)>>16,i=(h&e)>>8,m=h&g,n=(f&c)>>16,k=(f&e)>>8,l=f&g;return a(h,(f&b)>>>24,d,i,m,n,k,l,255-((255-d)*(255-n)>>8),
255-((255-i)*(255-k)>>8),255-((255-m)*(255-l)>>8))},hard_light:function(h,f){var d=(h&c)>>16,i=(h&e)>>8,m=h&g,n=(f&c)>>16,k=(f&e)>>8,l=f&g;return a(h,(f&b)>>>24,d,i,m,n,k,l,128>n?d*n>>7:255-((255-d)*(255-n)>>7),128>k?i*k>>7:255-((255-i)*(255-k)>>7),128>l?m*l>>7:255-((255-m)*(255-l)>>7))},soft_light:function(h,f){var d=(h&c)>>16,i=(h&e)>>8,m=h&g,n=(f&c)>>16,k=(f&e)>>8,l=f&g;return a(h,(f&b)>>>24,d,i,m,n,k,l,(d*n>>7)+(d*d>>8)-(d*d*n>>15),(i*k>>7)+(i*i>>8)-(i*i*k>>15),(m*l>>7)+(m*m>>8)-(m*m*l>>15))},
overlay:function(h,f){var d=(h&c)>>16,i=(h&e)>>8,m=h&g,n=(f&c)>>16,k=(f&e)>>8,l=f&g;return a(h,(f&b)>>>24,d,i,m,n,k,l,128>d?d*n>>7:255-((255-d)*(255-n)>>7),128>i?i*k>>7:255-((255-i)*(255-k)>>7),128>m?m*l>>7:255-((255-m)*(255-l)>>7))},dodge:function(h,f){var d=(f&b)>>>24,i=(h&c)>>16,m=(h&e)>>8,n=h&g,k=(f&c)>>16,l=(f&e)>>8,r=f&g,q=255;255!==k&&(q=(i<<8)/(255-k),q=0>q?0:255<q?255:q);var o=255;255!==l&&(o=(m<<8)/(255-l),o=0>o?0:255<o?255:o);var s=255;255!==r&&(s=(n<<8)/(255-r),s=0>s?0:255<s?255:s);return a(h,
d,i,m,n,k,l,r,q,o,s)},burn:function(h,f){var d=(f&b)>>>24,i=(h&c)>>16,m=(h&e)>>8,n=h&g,k=(f&c)>>16,l=(f&e)>>8,r=f&g,q=0;0!==k&&(q=(255-i<<8)/k,q=255-(0>q?0:255<q?255:q));var o=0;0!==l&&(o=(255-m<<8)/l,o=255-(0>o?0:255<o?255:o));var s=0;0!==r&&(s=(255-n<<8)/r,s=255-(0>s?0:255<s?255:s));return a(h,d,i,m,n,k,l,r,q,o,s)}}}(),drawLoopTimer=null,frame=0,doLNOnce=[],loopInterval,time,timeAtStart,anyCodeReactingTobpm;
function animate(){useRequestAnimationFrame?-1===wantedFramesPerSecond?requestAnimationFrame(animate):void 0===loopInterval&&(loopInterval=setInterval("window.requestAnimationFrame(animate)",1E3/wantedFramesPerSecond)):setTimeout("animate();",1E3/wantedFramesPerSecond);matrixStack=[];worldMatrix.identity();soundLoops.soundIDs=[];soundLoops.beatStrings=[];if("undefined"!=typeof draw){var a=new Date;0===frame?(timeAtStart=a.getTime(),time=0):time=a.getTime()-timeAtStart;doLNOnce=[];anyCodeReactingTobpm=
!1;fill(4294967295);stroke(4278190080);currentStrokeSize=1;defaultNormalStroke=defaultNormalFill=!0;ballDetLevel=ballDefaultDetLevel;noLights();usedPointLights=usedAmbientLights=usedBoxes=usedRectangles=usedLines=0;updatesPerMinute=240;usedSpheres={};animationStyleValue=normal;resetGradientStack();try{draw()}catch(b){if(autocodeOn){editor.undo();return}checkErrorAndReport(b);consecutiveFramesWithoutRunTimeError=0;out=lastStableProgram;window.eval(lastStableProgram);return}0===frame&&(timeAtStart=
a.getTime(),time=0);anyCodeReactingTobpm&&changeUpdatesPerMinuteIfNeeded();animationStyleUpdateIfChanged();simpleGradientUpdateIfChanged();changeUpdatesPerMinuteIfNeeded();frame++;consecutiveFramesWithoutRunTimeError++;5==consecutiveFramesWithoutRunTimeError&&(lastStableProgram=out)}combDisplayList();render();stats.update();if(0!==doLNOnce.length){for(var a=editor.getValue(),a=a.split("\n"),c=0;c<doLNOnce.length;c++)a[doLNOnce[c]]=a[doLNOnce[c]].replace(/^(\s*)doOnce([ ]*\->[ ]*.+)$/gm,"$1\u2713doOnce$2"),
a[doLNOnce[c]]=a[doLNOnce[c]].replace(/^(\s*)doOnce([ ]*\->[ ]*)$/gm,"$1\u2713doOnce$2");a=a.join("\n");c=editor.getCursor();c.ch+=1;editor.setValue(a);editor.setCursor(c);registerCode()}}var composer;
function render(){isWebGLUsed?composer.render():(renderer.render(scene,camera),finalRenderWithSceneAndBlendContext.globalAlpha=1,finalRenderWithSceneAndBlendContext.clearRect(0,0,window.innerWidth,window.innerHeight),finalRenderWithSceneAndBlendContext.globalAlpha=blendAmount,finalRenderWithSceneAndBlendContext.drawImage(previousRenderForBlending,0,0),finalRenderWithSceneAndBlendContext.globalAlpha=1,finalRenderWithSceneAndBlendContext.drawImage(sceneRenderingCanvas,0,0),previousRenderForBlendingContext.globalCompositeOperation=
"copy",previousRenderForBlendingContext.drawImage(finalRenderWithSceneAndBlend,0,0),sceneRenderingCanvasContext.clearRect(0,0,window.innerWidth,window.innerHeight))}var dimcodeOn=!1;function triggerReset(){pickRandomDefaultGradient();autocodeOn&&toggleAutocodeAndUpdateButtonAndBlinking();editor.setValue("");$("#resetButtonContainer").css("background-color","#FF0000");setTimeout('$("#resetButtonContainer").css("background-color","");',200)}var changesHappened=!1,cursorActivity=!0;
function selectTheme(a){editor.setOption("theme",a.options[a.selectedIndex].innerHTML)}function adjustCodeMirrorHeight(){$(".CodeMirror-scroll").css("height",window.innerHeight-$("#theMenu").height())}
function fullscreenify(a){function b(a){var b={x:1,y:1};b.x=(window.innerWidth+40)/a.width;b.y=(window.innerHeight+40)/a.height;b=b.x+", "+b.y;a.setAttribute("style",c+" -ms-transform-origin: left top; -webkit-transform-origin: left top; -moz-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top; -ms-transform: scale("+b+"); -webkit-transform: scale3d("+b+", 1); -moz-transform: scale("+b+"); -o-transform: scale("+b+"); transform: scale("+b+");")}var c=a.getAttribute("style")||
"";window.addEventListener("resize",function(){adjustCodeMirrorHeight();b(a)},!1);b(a)}
function combDisplayList(){for(var a=0;a<scene.objects.length;++a){var b=scene.objects[a];b.isLine?0<usedLines?(b.visible=!0,usedLines--):b.visible=!1:b.isRectangle?0<usedRectangles?(b.visible=!0,usedRectangles--):b.visible=!1:b.isBox?0<usedBoxes?(b.visible=!0,usedBoxes--):b.visible=!1:b.isCylinder?0<usedCylinders?(b.visible=!0,usedCylinders--):b.visible=!1:b.isAmbientLight?0<usedAmbientLights?(b.visible=!0,usedAmbientLights--):b.visible=!1:0!==b.isSphere&&(0<usedSpheres[""+b.isSphere]?(b.visible=
!0,usedSpheres[""+b.isSphere]-=1):b.visible=!1)}}function clearDisplayList(){}
var foo=function(a){if(autocodeOn)editor.undo();else return-1<a.indexOf("Uncaught ReferenceError: ")&&(a=a.substring(25)),$("#dangerSignText").css("color","red"),$("#errorMessageText").text(a),consecutiveFramesWithoutRunTimeError=6,window.eval(lastStableProgram),!0},updatesPerMinute=0,oldupdatesPerMinute=0,soundLoopTimer,beatNumber=0,bpm=function(a){void 0!==a&&(125<a&&(a=125),0>a&&(a=0),updatesPerMinute=4*a)},changeUpdatesPerMinuteIfNeeded=function(){oldupdatesPerMinute!==updatesPerMinute&&(clearTimeout(soundLoopTimer),
0!==updatesPerMinute&&(soundLoopTimer=setInterval("soundLoop();",6E4/updatesPerMinute)),oldupdatesPerMinute=updatesPerMinute)},soundLoop=function(){if(!soundSystemIsMangled){beatNumber++;beatNumber%=16;log("about to loop in "+soundLoops.soundIDs+" of length "+soundLoops.soundIDs.length);for(var a=0;a<soundLoops.soundIDs.length;a++){var b=soundLoops.soundIDs[a],c;c=soundLoops.beatStrings[a].charAt(beatNumber);log("checking sound loop "+soundLoops.beatStrings[a]+" beat "+beatNumber+" : "+c);if("x"===
c){c=soundBank[b];var e=c.length,g=void 0;log("playing  "+b+" length: "+e);for(var h=0;h<e;h++){var i=c[h];if(i.isEnded()){g=i;log("sound bank "+h+" is available ");break}else log("sound bank "+h+" has not ended ")}void 0===g&&(log("creating new sound object "),31<totalCreatedSoundObjects&&(soundSystemIsMangled=!0,$("#soundSystemIsMangledMessage").modal(),$("#simplemodal-container").height(250)),g=new buzz.sound(soundFiles[b]),soundBank[b].push(g),totalCreatedSoundObjects++);g.play()}}}},play=function(a,
b){anyCodeReactingTobpm=!0;b=b.replace(/\s*/g,"");soundLoops.soundIDs.push(a);soundLoops.beatStrings.push(b);log("pushing "+a+" beat: "+b)},buzz={defaults:{autoplay:!1,duration:5E3,formats:[],loop:!1,placeholder:"--",preload:"metadata",volume:80},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(a,b){function c(a){for(var b=[],c=a.length-1,d=0;d<=c;d++)b.push({start:a.start(c),end:a.end(c)});return b}
function e(a,b){var c=document.createElement("source");c.src=b;buzz.types[b.split(".").pop()]&&(c.type=buzz.types[b.split(".").pop()]);a.appendChild(c)}var b=b||{},g=0,h=[],i={},j=buzz.isSupported();this.load=function(){if(!j)return this;this.sound.load();return this};this.play=function(){if(!j)return this;this.sound.play();return this};this.togglePlay=function(){if(!j)return this;this.sound.paused?this.sound.play():this.sound.pause();return this};this.pause=function(){if(!j)return this;this.sound.pause();
return this};this.isPaused=function(){return!j?null:this.sound.paused};this.stop=function(){if(!j)return this;this.setTime(0);this.sound.pause();return this};this.isEnded=function(){return!j?null:this.sound.ended};this.loop=function(){if(!j)return this;this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!j)return this;this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=function(){if(!j)return this;
this.sound.muted=!0;return this};this.unmute=function(){if(!j)return this;this.sound.muted=!1;return this};this.toggleMute=function(){if(!j)return this;this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){return!j?null:this.sound.muted};this.setVolume=function(a){if(!j)return this;0>a&&(a=0);100<a&&(a=100);this.volume=a;this.sound.volume=a/100;return this};this.getVolume=function(){return!j?this:this.volume};this.increaseVolume=function(a){return this.setVolume(this.volume+(a||
1))};this.decreaseVolume=function(a){return this.setVolume(this.volume-(a||1))};this.setTime=function(a){if(!j)return this;this.whenReady(function(){this.sound.currentTime=a});return this};this.getTime=function(){if(!j)return null;var a=Math.round(100*this.sound.currentTime)/100;return isNaN(a)?buzz.defaults.placeholder:a};this.setPercent=function(a){return!j?this:this.setTime(buzz.fromPercent(a,this.sound.duration))};this.getPercent=function(){if(!j)return null;var a=Math.round(buzz.toPercent(this.sound.currentTime,
this.sound.duration));return isNaN(a)?buzz.defaults.placeholder:a};this.setSpeed=function(a){if(!j)return this;this.sound.playbackRate=a};this.getSpeed=function(){return!j?null:this.sound.playbackRate};this.getDuration=function(){if(!j)return null;var a=Math.round(100*this.sound.duration)/100;return isNaN(a)?buzz.defaults.placeholder:a};this.getPlayed=function(){return!j?null:c(this.sound.played)};this.getBuffered=function(){return!j?null:c(this.sound.buffered)};this.getSeekable=function(){return!j?
null:c(this.sound.seekable)};this.getErrorCode=function(){return j&&this.sound.error?this.sound.error.code:0};this.getErrorMessage=function(){if(!j)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){return!j?null:this.sound.readyState};this.getStateMessage=function(){if(!j)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";
case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){return!j?null:this.sound.networkState};this.getNetworkStateMessage=function(){if(!j)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(a,b){if(!j)return this;this.sound[a]=
b;return this};this.get=function(a){return!j?null:a?this.sound[a]:this.sound};this.bind=function(a,b){if(!j)return this;for(var a=a.split(" "),c=this,d=function(a){b.call(c,a)},e=0;e<a.length;e++){var f=a[e],g=f,f=g.split(".")[0];h.push({idx:g,func:d});this.sound.addEventListener(f,d,!0)}return this};this.unbind=function(a){if(!j)return this;for(var a=a.split(" "),b=0;b<a.length;b++)for(var c=a[b],d=c.split(".")[0],e=0;e<h.length;e++){var f=h[e].idx.split(".");if(h[e].idx==c||f[1]&&f[1]==c.replace(".",
""))this.sound.removeEventListener(d,h[e].func,!0),h.splice(e,1)}return this};this.bindOnce=function(a,b){if(!j)return this;var c=this;i[g++]=!1;this.bind(a+"."+g,function(){i[g]||(i[g]=!0,b.call(c));c.unbind(a+"."+g)})};this.trigger=function(a){if(!j)return this;for(var a=a.split(" "),b=0;b<a.length;b++)for(var c=a[b],d=0;d<h.length;d++){var e=h[d].idx.split(".");if(h[d].idx==c||e[0]&&e[0]==c.replace(".","")){var f=document.createEvent("HTMLEvents");f.initEvent(e[0],!1,!0);this.sound.dispatchEvent(f)}}return this};
this.fadeTo=function(a,b,c){function d(){setTimeout(function(){e<a&&g.volume<a?(g.setVolume(g.volume+=1),d()):e>a&&g.volume>a?(g.setVolume(g.volume-=1),d()):c instanceof Function&&c.apply(g)},f)}if(!j)return this;b instanceof Function?(c=b,b=buzz.defaults.duration):b=b||buzz.defaults.duration;var e=this.volume,f=b/Math.abs(e-a),g=this;this.play();this.whenReady(function(){d()});return this};this.fadeIn=function(a,b){return!j?this:this.setVolume(0).fadeTo(100,a,b)};this.fadeOut=function(a,b){return!j?
this:this.fadeTo(0,a,b)};this.fadeWith=function(a,b){if(!j)return this;this.fadeOut(b,function(){this.stop()});a.play().fadeIn(b);return this};this.whenReady=function(a){if(!j)return null;var b=this;0===this.sound.readyState?this.bind("canplay.buzzwhenready",function(){a.call(b)}):a.call(b)};if(j&&a){for(var f in buzz.defaults)buzz.defaults.hasOwnProperty(f)&&(b[f]=b[f]||buzz.defaults[f]);this.sound=document.createElement("audio");if(a instanceof Array)for(var d in a)a.hasOwnProperty(d)&&e(this.sound,
a[d]);else if(b.formats.length)for(var p in b.formats)b.formats.hasOwnProperty(p)&&e(this.sound,a+"."+b.formats[p]);else e(this.sound,a);b.loop&&this.loop();b.autoplay&&(this.sound.autoplay="autoplay");this.sound.preload=!0===b.preload?"auto":!1===b.preload?"none":b.preload;this.setVolume(b.volume);buzz.sounds.push(this)}},group:function(a){function b(){for(var b=c(null,arguments),g=b.shift(),h=0;h<a.length;h++)a[h][g].apply(a[h],b)}function c(a,b){return a instanceof Array?a:Array.prototype.slice.call(b)}
a=c(a,arguments);this.getSounds=function(){return a};this.add=function(b){for(var b=c(b,arguments),g=0;g<b.length;g++)a.push(b[g])};this.remove=function(b){for(var b=c(b,arguments),g=0;g<b.length;g++)for(var h=0;h<a.length;h++)if(a[h]==b[g]){a.splice(h,1);break}};this.load=function(){b("load");return this};this.play=function(){b("play");return this};this.togglePlay=function(){b("togglePlay");return this};this.pause=function(a){b("pause",a);return this};this.stop=function(){b("stop");return this};
this.mute=function(){b("mute");return this};this.unmute=function(){b("unmute");return this};this.toggleMute=function(){b("toggleMute");return this};this.setVolume=function(a){b("setVolume",a);return this};this.increaseVolume=function(a){b("increaseVolume",a);return this};this.decreaseVolume=function(a){b("decreaseVolume",a);return this};this.loop=function(){b("loop");return this};this.unloop=function(){b("unloop");return this};this.setTime=function(a){b("setTime",a);return this};this.set=function(a,
c){b("set",a,c);return this};this.bind=function(a,c){b("bind",a,c);return this};this.unbind=function(a){b("unbind",a);return this};this.bindOnce=function(a,c){b("bindOnce",a,c);return this};this.trigger=function(a){b("trigger",a);return this};this.fade=function(a,c,h,i){b("fade",a,c,h,i);return this};this.fadeIn=function(a,c){b("fadeIn",a,c);return this};this.fadeOut=function(a,c){b("fadeOut",a,c);return this}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return!!buzz.el.canPlayType},
isOGGSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(a,b){var c,e,g;c=Math.floor(a/3600);c=isNaN(c)?"--":10<=c?
c:"0"+c;e=b?Math.floor(a/60%60):Math.floor(a/60);e=isNaN(e)?"--":10<=e?e:"0"+e;g=Math.floor(a%60);g=isNaN(g)?"--":10<=g?g:"0"+g;return b?c+":"+e+":"+g:e+":"+g},fromTimer:function(a){var b=a.toString().split(":");b&&3==b.length&&(a=3600*parseInt(b[0],10)+60*parseInt(b[1],10)+parseInt(b[2],10));b&&2==b.length&&(a=60*parseInt(b[0],10)+parseInt(b[1],10));return a},toPercent:function(a,b,c){c=Math.pow(10,c||0);return Math.round(100*a/b*c)/c},fromPercent:function(a,b,c){c=Math.pow(10,c||0);return Math.round(b/
100*a*c)/c}},totalCreatedSoundObjects=0,soundSystemIsMangled=!1,CHANNELSPERSOUND=6,soundDef=[],soundDefCounter=0;soundDef[soundDefCounter++]={soundName:"bing",soundFile:"./sound/audioFiles/start_bing"};soundDef[soundDefCounter++]={soundName:"toc",soundFile:"./sound/audioFiles/AMB_BD_1"};soundDef[soundDefCounter++]={soundName:"highHatClosed",soundFile:"./sound/audioFiles/AMB_HHCL"};soundDef[soundDefCounter++]={soundName:"highHatOpen",soundFile:"./sound/audioFiles/AMB_HHOP"};
soundDef[soundDefCounter++]={soundName:"toc2",soundFile:"./sound/audioFiles/AMB_HTM"};soundDef[soundDefCounter++]={soundName:"toc3",soundFile:"./sound/audioFiles/AMB_LTM2"};soundDef[soundDefCounter++]={soundName:"toc4",soundFile:"./sound/audioFiles/AMB_RIM1"};soundDef[soundDefCounter++]={soundName:"snare",soundFile:"./sound/audioFiles/AMB_SN13"};soundDef[soundDefCounter++]={soundName:"snare2",soundFile:"./sound/audioFiles/AMB_SN_5"};soundDef[soundDefCounter++]={soundName:"china",soundFile:"./sound/audioFiles/CHINA_1"};
soundDef[soundDefCounter++]={soundName:"crash",soundFile:"./sound/audioFiles/CRASH_1"};soundDef[soundDefCounter++]={soundName:"crash2",soundFile:"./sound/audioFiles/CRASH_5"};soundDef[soundDefCounter++]={soundName:"crash3",soundFile:"./sound/audioFiles/CRASH_6"};soundDef[soundDefCounter++]={soundName:"ride",soundFile:"./sound/audioFiles/RIDE_1"};soundDef[soundDefCounter++]={soundName:"glass",soundFile:"./sound/audioFiles/glass2"};soundDef[soundDefCounter++]={soundName:"glass1",soundFile:"./sound/audioFiles/glass3"};
soundDef[soundDefCounter++]={soundName:"glass2",soundFile:"./sound/audioFiles/glass4"};soundDef[soundDefCounter++]={soundName:"glass3",soundFile:"./sound/audioFiles/glass5"};soundDef[soundDefCounter++]={soundName:"thump",soundFile:"./sound/audioFiles/8938__patchen__piano-hits-hand-03v2"};soundDef[soundDefCounter++]={soundName:"lowFlash",soundFile:"./sound/audioFiles/9569__thanvannispen__industrial-low-flash04"};soundDef[soundDefCounter++]={soundName:"lowFlash2",soundFile:"./sound/audioFiles/9570__thanvannispen__industrial-low-flash07"};
soundDef[soundDefCounter++]={soundName:"tranceKick2",soundFile:"./sound/audioFiles/24004__laya__dance-kick3"};soundDef[soundDefCounter++]={soundName:"tranceKick",soundFile:"./sound/audioFiles/33325__laya__trance-kick01"};soundDef[soundDefCounter++]={soundName:"wosh",soundFile:"./sound/audioFiles/33960__krlox__pudricion-4"};soundDef[soundDefCounter++]={soundName:"voltage",soundFile:"./sound/audioFiles/49255__keinzweiter__bonobob-funk"};soundDef[soundDefCounter++]={soundName:"beepA",soundFile:"./sound/audioFiles/100708__steveygos93__bleep_a"};
soundDef[soundDefCounter++]={soundName:"beepB",soundFile:"./sound/audioFiles/100708__steveygos93__bleep_b"};soundDef[soundDefCounter++]={soundName:"beepC",soundFile:"./sound/audioFiles/100708__steveygos93__bleep_c"};soundDef[soundDefCounter++]={soundName:"beepD",soundFile:"./sound/audioFiles/100708__steveygos93__bleep_d"};soundDef[soundDefCounter++]={soundName:"beep",soundFile:"./sound/audioFiles/116508_Beep"};soundDef[soundDefCounter++]={soundName:"hello",soundFile:"./sound/audioFiles/116508_Hello"};
soundDef[soundDefCounter++]={soundName:"alienBeep",soundFile:"./sound/audioFiles/132389__blackie666__alienbleep"};
var numberOfSounds=soundDefCounter,soundBank={},soundFiles={},endedFirstPlay=0,startingSound,closeAndCheckAudio=function(){$.modal.close();setTimeout("checkAudio();",500)},checkAudio=function(){buzz.isSupported()||($("#noAudioMessage").modal(),$("#simplemodal-container").height(200))},loadAndTestAllTheSounds=function(){log("loading and testing all sounds");for(var a=0;a<numberOfSounds;a++){if(buzz.isMP3Supported())soundDef[a].soundFile+=".mp3";else if(buzz.isOGGSupported())soundDef[a].soundFile+=
".ogg";else break;soundBank[soundDef[a].soundName]=[];soundFiles[soundDef[a].soundName]=soundDef[a].soundFile;if(-1===navigator.userAgent.toLowerCase().indexOf("chrome")&&!/MSIE (\d+\.\d+);/.test(navigator.userAgent))for(var b=0;b<CHANNELSPERSOUND;b++)setTimeout("checkSound("+a+");",200*a)}(-1<navigator.userAgent.toLowerCase().indexOf("chrome")||/MSIE (\d+\.\d+);/.test(navigator.userAgent))&&startEnvironment()},checkSound=function(a){var b=new buzz.sound(soundDef[a].soundFile);log("loading sound "+
soundDef[a].soundFile);b.mute();b.load();b.bind("ended",function(){this.unbind("ended");this.unmute();endedFirstPlay++;0===endedFirstPlay%10&&$("#loading").append("/");log("tested "+endedFirstPlay+" sounds");endedFirstPlay===numberOfSounds*CHANNELSPERSOUND&&(log("tested all sounds"),startEnvironment())});b.play();soundBank[soundDef[a].soundName].push(b)},startEnvironment=function(){pickRandomDefaultGradient();log("startEnvironment");initThreeJs()||animate();if(!Detector.webgl||forceCanvasRenderer)$("#noWebGLMessage").modal({onClose:closeAndCheckAudio}),
$("#simplemodal-container").height(200);var a=document.getElementById("backGroundCanvas");fullScreenifyBackground&&fullscreenify(a);resetGradientStack();simpleGradientUpdateIfChanged();$("#startingCourtainScreen").fadeOut();$("#formCode").css("opacity",0);editor=createEditor();editor.focus();adjustCodeMirrorHeight();-1!==window.location.hash.indexOf("bookmark")?(a=window.location.hash.substring(10),loadDemoOrTutorial(a)):(startingSound=new buzz.sound("./sound/audioFiles/start_bing",{formats:["ogg",
"mp3"]}),setTimeout("startingSound.play();",650));fakeCursorInterval=setInterval("fakeCursorBlinking()",800);dimcodeOn=!1;toggleDimCode()};$(document).ready(function(){log("document ready");isCanvasSupported?loadAndTestAllTheSounds():($("#noCanvasMessage").modal({onClose:function(){$("#loading").text("sorry :-(");$.modal.close()}}),$("#simplemodal-container").height(200))});var parentObject,rootObject;rootObject=parentObject=0;
var currentObject,matrixStack=[],pushMatrix=function(){matrixStack.push(worldMatrix);worldMatrix=(new THREE.Matrix4).copy(worldMatrix)},popMatrix=function(){0!==matrixStack.length?worldMatrix=matrixStack.pop():worldMatrix.identity()},resetMatrix=function(){worldMatrix.identity()},move=function(a,b,c){0===arguments.length?(a=Math.sin(time/500),b=Math.cos(time/500),c=a):1==arguments.length?c=b=a:2==arguments.length&&(c=0);worldMatrix.translate(new THREE.Vector3(a,b,c))};
function rotate(a,b,c){0===arguments.length?c=b=a=time/1E3:1==arguments.length?c=b=a:2==arguments.length&&(c=0);worldMatrix.rotateX(a).rotateY(b).rotateZ(c)}
var scale=function(a,b,c){0===arguments.length?c=b=a=1+Math.sin(time/500)/4:1==arguments.length?c=b=a:2==arguments.length&&(c=1);-1.0E-9<a&&1.0E-9>a&&(a=1.0E-9);-1.0E-9<b&&1.0E-9>b&&(b=1.0E-9);-1.0E-9<c&&1.0E-9>c&&(c=1.0E-9);worldMatrix.scale(new THREE.Vector3(a,b,c))},gradStack=[],defaultGradientColor1=orange,defaultGradientColor2=red,defaultGradientColor3=black,whichDefaultBackground,pickRandomDefaultGradient=function(){whichDefaultBackground=void 0===whichDefaultBackground?Math.floor(5*Math.random()):
(whichDefaultBackground+1)%5;0===whichDefaultBackground?(defaultGradientColor1=orange,defaultGradientColor2=red,defaultGradientColor3=black,$("#fakeStartingBlinkingCursor").css("color","white")):1===whichDefaultBackground?(defaultGradientColor1=white,defaultGradientColor2=khaki,defaultGradientColor3=peachpuff,$("#fakeStartingBlinkingCursor").css("color","LightPink")):2===whichDefaultBackground?(defaultGradientColor1=lightsteelblue,defaultGradientColor2=lightcyan,defaultGradientColor3=paleturquoise,
$("#fakeStartingBlinkingCursor").css("color","CadetBlue")):3===whichDefaultBackground?(defaultGradientColor1=silver,defaultGradientColor2=lightgrey,defaultGradientColor3=gainsboro,$("#fakeStartingBlinkingCursor").css("color","white")):4===whichDefaultBackground&&(defaultGradientColor1=color(155,255,155),defaultGradientColor2=color(155,255,155),defaultGradientColor3=color(155,255,155),$("#fakeStartingBlinkingCursor").css("color","DarkOliveGreen"))},resetGradientStack=function(){currentGradientStackValue=
"";gradStack=[];simpleGradient(defaultGradientColor1,defaultGradientColor2,defaultGradientColor3)},background=function(a,b,c,e){a=color(a,b,c,e);currentGradientStackValue=currentGradientStackValue+" null null null null "+a+" ";gradStack.push({gradStacka:void 0,gradStackb:void 0,gradStackc:void 0,gradStackd:void 0,solid:a})},simpleGradient=function(a,b,c,e){currentGradientStackValue=currentGradientStackValue+" "+a+""+b+""+c+""+e+"null ";gradStack.push({gradStacka:a,gradStackb:b,gradStackc:c,gradStackd:e,
solid:null})},simpleGradientUpdateIfChanged=function(){if(currentGradientStackValue!==previousGradientStackValue){previousGradientStackValue=currentGradientStackValue;log("repainting background");Math.sqrt(Math.pow(scaledBackgroundWidth/2,2)+Math.pow(scaledBackgroundHeight/2,2));for(var a,b=0;b<gradStack.length;b++)void 0!==gradStack[b].gradStacka?(a=backgroundSceneContext.createLinearGradient(scaledBackgroundWidth/2,0,scaledBackgroundWidth/2,scaledBackgroundHeight),a.addColorStop(0,color.toString(gradStack[b].gradStacka)),
a.addColorStop(0.5,color.toString(gradStack[b].gradStackb)),a.addColorStop(1,color.toString(gradStack[b].gradStackc)),backgroundSceneContext.globalAlpha=1,backgroundSceneContext.fillStyle=a):(log("solid background: "+gradStack[b].solid),backgroundSceneContext.globalAlpha=1,backgroundSceneContext.fillStyle=color.toString(gradStack[b].solid)),backgroundSceneContext.fillRect(0,0,scaledBackgroundWidth,scaledBackgroundHeight)}},line=function(a,b,c){void 0===a?c=b=a=1:1===arguments.length&&(c=b=a);if(doStroke){var e=
linesPool[usedLines];void 0===e?(e=new THREE.LineBasicMaterial({opacity:currentStrokeAlpha,linewidth:currentStrokeSize}),e=new THREE.Line(lineGeometry,e),e.isLine=!0,e.isRectangle=!1,e.isBox=!1,e.isCylinder=!1,e.isAmbientLight=!1,e.isPointLight=!1,e.isSphere=0,linesPool.push(e),scene.add(e)):(e.material.opacity=currentStrokeAlpha,e.material.linewidth=currentStrokeSize);usedLines++;e.matrixAutoUpdate=!1;e.matrix.copy(worldMatrix);e.matrixWorldNeedsUpdate=!0;1!==a&&e.matrix.scale(new THREE.Vector3(1,
a,1));if(currentStrokeColor===angleColor||defaultNormalStroke){var g=e.matrix.multiplyVector3(new THREE.Vector3(0,1,0)).normalize();log(g.x+" "+g.y+" "+g.z);e.material.color.setHex(color(255*((g.x+1)/2),255*((g.y+1)/2),255*((g.z+1)/2)))}else e.material.color.setHex(currentStrokeColor)}},rect=function(a,b,c){void 0===a?c=b=a=1:1===arguments.length&&(c=b=a);var e=0,g=0;if(doStroke||doFill){doFill&&(0===currentStrokeSize||!doStroke||1>=currentStrokeSize&&!defaultNormalFill&&!defaultNormalStroke&&currentStrokeColor===
currentFillColor&&1===currentFillAlpha&&1===currentStrokeAlpha)||1>=currentStrokeSize&&defaultNormalFill&&defaultNormalStroke?(e=0,g=1):(e=!doFill&&doStroke?1:0,g=2);for(var h=!1,i,j=!1,f=e;f<g;f++){1===f?(h=!0,e=currentStrokeColor,i=currentStrokeAlpha):(e=currentFillColor,i=currentFillAlpha);var d=rectanglesPool[usedRectangles];void 0===d&&(d={basicMaterial:void 0,lambertMaterial:void 0,normalMaterial:void 0,neverUsed:!0,mesh:void 0},j=!0,rectanglesPool.push(d));var p=!1,p=h?defaultNormalStroke?
!0:!1:defaultNormalFill?!0:!1;log("rect: default normal color: "+p);log("rect: alphaToBeUsed: "+i);d.neverUsed||e===angleColor||p?(d.neverUsed=!1,void 0===d.normalMaterial?(log("creating normal material"),d.normalMaterial=new THREE.MeshNormalMaterial({opacity:i,wireframe:h,wireframeLinewidth:currentStrokeSize})):(d.normalMaterial.opacity=i,d.normalMaterial.wireframe=h,d.normalMaterial.doubleSided=!0,d.normalMaterial.wireframeLinewidth=currentStrokeSize),void 0===d.mesh)?(d.mesh=new THREE.Mesh(planeGeometry,
d.normalMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.normalMaterial:lightsAreOn?(log("rect: lights are on"),void 0===d.lambertMaterial?(log("creating lambert:"+currentFillColor+" "+currentFillAlpha+" "+ambientColor+" "+reflectValue+" "+refractValue),d.lambertMaterial=new THREE.MeshLambertMaterial({color:e,opacity:i,ambient:ambientColor,reflectivity:reflectValue,refractionRatio:refractValue,wireframe:h,wireframeLinewidth:currentStrokeSize})):(d.lambertMaterial.color.setHex(e),d.lambertMaterial.opacity=
i,d.lambertMaterial.wireframe=h,d.lambertMaterial.wireframeLinewidth=currentStrokeSize,d.lambertMaterial.doubleSided=!0,d.lambertMaterial.ambient.setHex(ambientColor),d.lambertMaterial.reflectivity=reflectValue,d.lambertMaterial.refractionRatio=refractValue),void 0===d.mesh)?(d.mesh=new THREE.Mesh(planeGeometry,d.lambertMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.lambertMaterial:(log("rect: lights are not on"),void 0===d.basicMaterial?d.basicMaterial=new THREE.MeshBasicMaterial({color:e,
opacity:i,wireframe:h,wireframeLinewidth:currentStrokeSize}):(d.basicMaterial.color.setHex(e),d.basicMaterial.opacity=i,d.basicMaterial.wireframe=h,d.basicMaterial.doubleSided=!0,d.basicMaterial.wireframeLinewidth=currentStrokeSize),void 0===d.mesh)?(d.mesh=new THREE.Mesh(planeGeometry,d.basicMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.basicMaterial;resetTheSpinThingy&&(d.startCountdown=SPINFRAMES,resetTheSpinThingy=!1,doTheSpinThingy=!0);doTheSpinThingy&&d.startCountdown--; -1===d.startCountdown&&
(doTheSpinThingy=!1);d.mesh.isLine=!1;d.mesh.isRectangle=!0;d.mesh.isBox=!1;d.mesh.isCylinder=!1;d.mesh.isAmbientLight=!1;d.mesh.isPointLight=!1;d.mesh.isSphere=0;d.mesh.doubleSided=!0;usedRectangles++;doTheSpinThingy&&0<d.startCountdown&&(pushMatrix(),rotate(d.startCountdown/50),log(""+d.startCountdown));d.mesh.matrixAutoUpdate=!1;d.mesh.matrix.copy(worldMatrix);d.mesh.matrixWorldNeedsUpdate=!0;doTheSpinThingy&&0<d.startCountdown&&popMatrix();(1!==a||1!==b)&&d.mesh.matrix.scale(new THREE.Vector3(a,
b,1));j&&scene.add(d.mesh)}}},box=function(a,b,c){void 0===a?c=b=a=1:1===arguments.length&&(c=b=a);var e=0,g=0;if(doStroke||doFill){doFill&&(0===currentStrokeSize||!doStroke||1>=currentStrokeSize&&!defaultNormalFill&&!defaultNormalStroke&&currentStrokeColor===currentFillColor&&1===currentFillAlpha&&1===currentStrokeAlpha)||1>=currentStrokeSize&&defaultNormalFill&&defaultNormalStroke?(e=0,g=1):(e=!doFill&&doStroke?1:0,g=2);for(var h=!1,i,j=!1,f=e;f<g;f++){1===f?(h=!0,e=currentStrokeColor,i=currentStrokeAlpha):
(e=currentFillColor,i=currentFillAlpha);var d=boxesPool[usedBoxes];void 0===d&&(d={basicMaterial:void 0,lambertMaterial:void 0,normalMaterial:void 0,neverUsed:!0,mesh:void 0},j=!0,boxesPool.push(d));var p=!1,p=h?defaultNormalStroke?!0:!1:defaultNormalFill?!0:!1;d.neverUsed||e===angleColor||p?(d.neverUsed=!1,void 0===d.normalMaterial?(log("creating normal material"),d.normalMaterial=new THREE.MeshNormalMaterial({opacity:i,wireframe:h,wireframeLinewidth:currentStrokeSize})):(d.normalMaterial.opacity=
i,d.normalMaterial.wireframe=h,d.normalMaterial.wireframeLinewidth=currentStrokeSize,d.normalMaterial.doubleSided=!1),void 0===d.mesh)?(d.mesh=new THREE.Mesh(cubeGeometry,d.normalMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.normalMaterial:lightsAreOn?(void 0===d.lambertMaterial?(log("creating lambert:"+currentFillColor+" "+currentFillAlpha+" "+ambientColor+" "+reflectValue+" "+refractValue),d.lambertMaterial=new THREE.MeshLambertMaterial({color:e,opacity:i,ambient:ambientColor,reflectivity:reflectValue,
refractionRatio:refractValue,wireframe:h,wireframeLinewidth:currentStrokeSize})):(d.lambertMaterial.color.setHex(e),d.lambertMaterial.opacity=i,d.lambertMaterial.wireframe=h,d.lambertMaterial.wireframeLinewidth=currentStrokeSize,d.lambertMaterial.doubleSided=!1,d.lambertMaterial.ambient.setHex(ambientColor),d.lambertMaterial.reflectivity=reflectValue,d.lambertMaterial.refractionRatio=refractValue),void 0===d.mesh)?(d.mesh=new THREE.Mesh(cubeGeometry,d.lambertMaterial),d.startCountdown=SPINFRAMES):
d.mesh.material=d.lambertMaterial:(void 0===d.basicMaterial?d.basicMaterial=new THREE.MeshBasicMaterial({color:e,opacity:i,wireframe:h,wireframeLinewidth:currentStrokeSize}):(d.basicMaterial.color.setHex(e),d.basicMaterial.opacity=i,d.basicMaterial.wireframe=h,d.basicMaterial.wireframeLinewidth=currentStrokeSize,d.basicMaterial.doubleSided=!1),void 0===d.mesh)?(d.mesh=new THREE.Mesh(cubeGeometry,d.basicMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.basicMaterial;resetTheSpinThingy&&(d.startCountdown=
SPINFRAMES,resetTheSpinThingy=!1,doTheSpinThingy=!0);doTheSpinThingy&&d.startCountdown--; -1===d.startCountdown&&(doTheSpinThingy=!1);d.mesh.isLine=!1;d.mesh.isRectangle=!1;d.mesh.isBox=!0;d.mesh.isCylinder=!1;d.mesh.isAmbientLight=!1;d.mesh.isPointLight=!1;d.mesh.isSphere=0;d.mesh.doubleSided=!1;usedBoxes++;doTheSpinThingy&&0<d.startCountdown&&(pushMatrix(),rotate(d.startCountdown/50),log(""+d.startCountdown));d.mesh.matrixAutoUpdate=!1;d.mesh.matrix.copy(worldMatrix);d.mesh.matrixWorldNeedsUpdate=
!0;doTheSpinThingy&&0<d.startCountdown&&popMatrix();if(1!==a||1!==b||1!==c)h?d.mesh.matrix.scale(new THREE.Vector3(a+0.0010,b+0.0010,c+0.0010)):d.mesh.matrix.scale(new THREE.Vector3(a,b,c));j&&scene.add(d.mesh)}}},peg=function(a,b,c){void 0===a?c=b=a=1:1===arguments.length&&(c=b=a);var e=0,g=0;if(doStroke||doFill){doFill&&(0===currentStrokeSize||!doStroke||1>=currentStrokeSize&&!defaultNormalFill&&!defaultNormalStroke&&currentStrokeColor===currentFillColor&&1===currentFillAlpha&&1===currentStrokeAlpha)||
1>=currentStrokeSize&&defaultNormalFill&&defaultNormalStroke?(e=0,g=1):(e=!doFill&&doStroke?1:0,g=2);for(var h=!1,i,j=!1,f=e;f<g;f++){1===f?(h=!0,e=currentStrokeColor,i=currentStrokeAlpha):(e=currentFillColor,i=currentFillAlpha);var d=cylindersPool[usedCylinders];void 0===d&&(d={basicMaterial:void 0,lambertMaterial:void 0,normalMaterial:void 0,neverUsed:!0,mesh:void 0},j=!0,cylindersPool.push(d));var p=!1,p=h?defaultNormalStroke?!0:!1:defaultNormalFill?!0:!1;d.neverUsed||e===angleColor||p?(d.neverUsed=
!1,void 0===d.normalMaterial?(log("creating normal material"),d.normalMaterial=new THREE.MeshNormalMaterial({opacity:i,wireframe:h,wireframeLinewidth:currentStrokeSize})):(d.normalMaterial.opacity=i,d.normalMaterial.wireframe=h,d.normalMaterial.wireframeLinewidth=currentStrokeSize,d.normalMaterial.doubleSided=!1),void 0===d.mesh)?(d.mesh=new THREE.Mesh(cylinderGeometry,d.normalMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.normalMaterial:lightsAreOn?(void 0===d.lambertMaterial?(log("creating lambert:"+
currentFillColor+" "+currentFillAlpha+" "+ambientColor+" "+reflectValue+" "+refractValue),d.lambertMaterial=new THREE.MeshLambertMaterial({color:e,opacity:i,ambient:ambientColor,reflectivity:reflectValue,refractionRatio:refractValue,wireframe:h,wireframeLinewidth:currentStrokeSize})):(d.lambertMaterial.color.setHex(e),d.lambertMaterial.opacity=i,d.lambertMaterial.wireframe=h,d.lambertMaterial.wireframeLinewidth=currentStrokeSize,d.lambertMaterial.doubleSided=!1,d.lambertMaterial.ambient.setHex(ambientColor),
d.lambertMaterial.reflectivity=reflectValue,d.lambertMaterial.refractionRatio=refractValue),void 0===d.mesh)?(d.mesh=new THREE.Mesh(cylinderGeometry,d.lambertMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.lambertMaterial:(void 0===d.basicMaterial?d.basicMaterial=new THREE.MeshBasicMaterial({color:e,opacity:i,wireframe:h,wireframeLinewidth:currentStrokeSize}):(d.basicMaterial.color.setHex(e),d.basicMaterial.opacity=i,d.basicMaterial.wireframe=h,d.basicMaterial.wireframeLinewidth=currentStrokeSize,
d.basicMaterial.doubleSided=!1),void 0===d.mesh)?(d.mesh=new THREE.Mesh(cylinderGeometry,d.basicMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.basicMaterial;resetTheSpinThingy&&(d.startCountdown=SPINFRAMES,resetTheSpinThingy=!1,doTheSpinThingy=!0);doTheSpinThingy&&d.startCountdown--; -1===d.startCountdown&&(doTheSpinThingy=!1);d.mesh.isLine=!1;d.mesh.isRectangle=!1;d.mesh.isBox=!1;d.mesh.isCylinder=!0;d.mesh.isAmbientLight=!1;d.mesh.isPointLight=!1;d.mesh.isSphere=0;d.mesh.doubleSided=!1;
usedCylinders++;doTheSpinThingy&&0<d.startCountdown&&(pushMatrix(),rotate(d.startCountdown/50),log(""+d.startCountdown));d.mesh.matrixAutoUpdate=!1;d.mesh.matrix.copy(worldMatrix);d.mesh.matrixWorldNeedsUpdate=!0;doTheSpinThingy&&0<d.startCountdown&&popMatrix();if(1!==a||1!==b||1!==c)h?d.mesh.matrix.scale(new THREE.Vector3(a+0.0010,b+0.0010,c+0.0010)):d.mesh.matrix.scale(new THREE.Vector3(a,b,c));j&&scene.add(d.mesh)}}},ballDetail=function(a){void 0!==a&&(2>a&&(a=2),30<a&&(a=30),ballDetLevel=a)},
ball=function(a,b,c){void 0===a?c=b=a=1:1===arguments.length&&(c=b=a);var e,g=0,h=0;if(doStroke||doFill){doFill&&(0===currentStrokeSize||!doStroke||1>=currentStrokeSize&&!defaultNormalFill&&!defaultNormalStroke&&currentStrokeColor===currentFillColor&&1===currentFillAlpha&&1===currentStrokeAlpha)||1>=currentStrokeSize&&defaultNormalFill&&defaultNormalStroke?(g=0,h=1):(g=!doFill&&doStroke?1:0,h=2);for(var i=!1,j,f=!1;g<h;g++){1===g?(i=!0,e=currentStrokeColor,j=currentStrokeAlpha):(e=currentFillColor,
j=currentFillAlpha);void 0===spheresPool[""+ballDetLevel]&&(spheresPool[""+ballDetLevel]=[],log("creating pool for ball det level "+ballDetLevel));void 0===usedSpheres[""+ballDetLevel]&&(usedSpheres[""+ballDetLevel]=0,log("creating counter for ball det level "+ballDetLevel));var d=spheresPool[""+ballDetLevel][usedSpheres[""+ballDetLevel]];void 0===d&&(d={basicMaterial:void 0,lambertMaterial:void 0,normalMaterial:void 0,neverUsed:!0,mesh:void 0},f=!0,spheresPool[""+ballDetLevel].push(d),log("making space for pool for sphere , size of pool for spheres of detail "+
ballDetLevel+" is "+spheresPool[""+ballDetLevel].length));var p=!1,p=i?defaultNormalStroke?!0:!1:defaultNormalFill?!0:!1;d.neverUsed||e===angleColor||p?(d.neverUsed=!1,void 0===d.normalMaterial?(log("creating normal material"),d.normalMaterial=new THREE.MeshNormalMaterial({opacity:j,wireframe:i,wireframeLinewidth:currentStrokeSize})):(d.normalMaterial.opacity=j,d.normalMaterial.wireframe=i,d.normalMaterial.wireframeLinewidth=currentStrokeSize,d.normalMaterial.doubleSided=!1),void 0===d.mesh)?(e=sphereGeometriesPool[""+
ballDetLevel],void 0===e&&(e=new THREE.SphereGeometry(1,ballDetLevel,ballDetLevel),sphereGeometriesPool[""+ballDetLevel]=e,log("creating ball geometry of detail "+ballDetLevel)),d.mesh=new THREE.Mesh(e,d.normalMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.normalMaterial:lightsAreOn?(void 0===d.lambertMaterial?(log("creating lambert:"+currentFillColor+" "+currentFillAlpha+" "+ambientColor+" "+reflectValue+" "+refractValue),d.lambertMaterial=new THREE.MeshLambertMaterial({color:e,opacity:j,
ambient:ambientColor,reflectivity:reflectValue,refractionRatio:refractValue,wireframe:i,wireframeLinewidth:currentStrokeSize})):(d.lambertMaterial.color.setHex(e),d.lambertMaterial.opacity=j,d.lambertMaterial.wireframe=i,d.lambertMaterial.wireframeLinewidth=currentStrokeSize,d.lambertMaterial.doubleSided=!1,d.lambertMaterial.ambient.setHex(ambientColor),d.lambertMaterial.reflectivity=reflectValue,d.lambertMaterial.refractionRatio=refractValue),void 0===d.mesh)?(e=sphereGeometriesPool[""+ballDetLevel],
void 0===e&&(e=new THREE.SphereGeometry(1,ballDetLevel,ballDetLevel),sphereGeometriesPool[""+ballDetLevel]=e,log("creating ball geometry of detail "+ballDetLevel)),d.mesh=new THREE.Mesh(e,d.lambertMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.lambertMaterial:(void 0===d.basicMaterial?d.basicMaterial=new THREE.MeshBasicMaterial({color:e,opacity:j,wireframe:i,wireframeLinewidth:currentStrokeSize}):(d.basicMaterial.color.setHex(e),d.basicMaterial.opacity=j,d.basicMaterial.wireframe=i,d.basicMaterial.wireframeLinewidth=
currentStrokeSize,d.basicMaterial.doubleSided=!1),void 0===d.mesh)?(e=sphereGeometriesPool[""+ballDetLevel],void 0===e&&(e=new THREE.SphereGeometry(1,ballDetLevel,ballDetLevel),sphereGeometriesPool[""+ballDetLevel]=e,log("creating ball geometry of detail "+ballDetLevel)),d.mesh=new THREE.Mesh(e,d.basicMaterial),d.startCountdown=SPINFRAMES):d.mesh.material=d.basicMaterial;resetTheSpinThingy&&(d.startCountdown=SPINFRAMES,resetTheSpinThingy=!1,doTheSpinThingy=!0);doTheSpinThingy&&d.startCountdown--;
 -1===d.startCountdown&&(doTheSpinThingy=!1);d.mesh.isLine=!1;d.mesh.isRectangle=!1;d.mesh.isBox=!1;d.mesh.isCylinder=!1;d.mesh.isAmbientLight=!1;d.mesh.isPointLight=!1;d.mesh.isSphere=ballDetLevel;d.mesh.doubleSided=!1;usedSpheres[""+ballDetLevel]+=1;doTheSpinThingy&&0<d.startCountdown&&(pushMatrix(),rotate(d.startCountdown/50),log(""+d.startCountdown));d.mesh.matrixAutoUpdate=!1;d.mesh.matrix.copy(worldMatrix);d.mesh.matrixWorldNeedsUpdate=!0;doTheSpinThingy&&0<d.startCountdown&&popMatrix();1!==
a&&(i?d.mesh.matrix.scale(new THREE.Vector3(a+0.0010,a+0.0010,a+0.0010)):d.mesh.matrix.scale(new THREE.Vector3(a,a,a)));f&&scene.add(d.mesh)}}},abs=Math.abs,ceil=Math.ceil,constrain=function(a,b,c){return a>c?c:a<b?b:a},dist=function(){var a,b,c;if(4===arguments.length)return a=arguments[0]-arguments[2],b=arguments[1]-arguments[3],Math.sqrt(a*a+b*b);if(6===arguments.length)return a=arguments[0]-arguments[3],b=arguments[1]-arguments[4],c=arguments[2]-arguments[5],Math.sqrt(a*a+b*b+c*c)},exp=Math.exp,
floor=Math.floor,lerp=function(a,b,c){return(b-a)*c+a},log=Math.log,mag=function(a,b,c){return c?Math.sqrt(a*a+b*b+c*c):Math.sqrt(a*a+b*b)},map=function(a,b,c,e,g){return e+(g-e)*((a-b)/(c-b))},max=function(){if(2===arguments.length)return arguments[0]<arguments[1]?arguments[1]:arguments[0];var a=1===arguments.length?arguments[0]:arguments;if(!("length"in a&&0<a.length))throw"Non-empty array is expected";for(var b=a[0],c=a.length,e=1;e<c;++e)b<a[e]&&(b=a[e]);return b},min=function(){if(2===arguments.length)return arguments[0]<
arguments[1]?arguments[0]:arguments[1];var a=1===arguments.length?arguments[0]:arguments;if(!("length"in a&&0<a.length))throw"Non-empty array is expected";for(var b=a[0],c=a.length,e=1;e<c;++e)b>a[e]&&(b=a[e]);return b},norm=function(a,b,c){return(a-b)/(c-b)},pow=Math.pow,round=Math.round,sq=function(a){return a*a},sqrt=Math.sqrt,acos=Math.acos,asin=Math.asin,atan=Math.atan,atan2=Math.atan2,cos=Math.cos,degrees=function(a){return 180*a/Math.PI},radians=function(a){return a/180*Math.PI},sin=Math.sin,
tan=Math.tan,currentRandom=Math.random,random=function(){if(0===arguments.length)return currentRandom();if(1===arguments.length)return currentRandom()*arguments[0];var a=arguments[0],b=arguments[1];return currentRandom()*(b-a)+a},Marsaglia=function(a,b){var c=a||362436069,e=b||521288629,g=function(){c=36969*(c&65535)+(c>>>16)&4294967295;e=18E3*(e&65535)+(e>>>16)&4294967295;return((c&65535)<<16|e&65535)&4294967295};this.nextDouble=function(){var a=g()/4294967296;return 0>a?1+a:a};this.nextInt=g};
Marsaglia.createRandomized=function(){var a=new Date;return new Marsaglia(a/6E4&4294967295,a&4294967295)};
var randomSeed=function(a){currentRandom=(new Marsaglia(a)).nextDouble},Random=function(a){var b=!1,c,e;this.nextGaussian=function(){if(b)return b=!1,c;var a,h,i;do a=2*e()-1,h=2*e()-1,i=a*a+h*h;while(1<=i||0===i);i=Math.sqrt(-2*Math.log(i)/i);c=h*i;b=!0;return a*i};e=void 0===a?Math.random:(new Marsaglia(a)).nextDouble},PerlinNoise=function(a){function b(a,b,c,e){var a=a&15,g=8>a?b:c,b=4>a?c:12===a||14===a?b:e;return(0===(a&1)?g:-g)+(0===(a&2)?b:-b)}function c(a,b,c){b=0===(a&1)?b:c;return 0===(a&
2)?-b:b}function e(a,b,c){return b+a*(c-b)}var a=void 0!==a?new Marsaglia(a):Marsaglia.createRandomized(),g,h,i=new Uint8Array(512);for(g=0;256>g;++g)i[g]=g;for(g=0;256>g;++g){var j=i[h=a.nextInt()&255];i[h]=i[g];i[g]=j}for(g=0;256>g;++g)i[g+256]=i[g];this.noise3d=function(a,c,g){var h=Math.floor(a)&255,j=Math.floor(c)&255,k=Math.floor(g)&255,a=a-Math.floor(a),c=c-Math.floor(c),g=g-Math.floor(g),l=(3-2*a)*a*a,r=(3-2*c)*c*c,q=i[h]+j,o=i[q]+k,q=i[q+1]+k,j=i[h+1]+j,h=i[j]+k,k=i[j+1]+k;return e((3-2*
g)*g*g,e(r,e(l,b(i[o],a,c,g),b(i[h],a-1,c,g)),e(l,b(i[q],a,c-1,g),b(i[k],a-1,c-1,g))),e(r,e(l,b(i[o+1],a,c,g-1),b(i[h+1],a-1,c,g-1)),e(l,b(i[q+1],a,c-1,g-1),b(i[k+1],a-1,c-1,g-1))))};this.noise2d=function(a,b){var g=Math.floor(a)&255,h=Math.floor(b)&255,a=a-Math.floor(a),b=b-Math.floor(b),j=(3-2*a)*a*a,k=i[g]+h,g=i[g+1]+h;return e((3-2*b)*b*b,e(j,c(i[k],a,b),c(i[g],a-1,b)),e(j,c(i[k+1],a,b-1),c(i[g+1],a-1,b-1)))};this.noise1d=function(a){var b=Math.floor(a)&255,a=a-Math.floor(a);return e((3-2*a)*
a*a,0===(i[b]&1)?-a:a,0===(i[b+1]&1)?-(a-1):a-1)}},noiseProfile={generator:void 0,octaves:4,fallout:0.5,seed:void 0},noise=function(a,b,c){void 0===noiseProfile.generator&&(noiseProfile.generator=new PerlinNoise(noiseProfile.seed));for(var e=noiseProfile.generator,g=1,h=1,i=0,j=0;j<noiseProfile.octaves;++j){g*=noiseProfile.fallout;switch(arguments.length){case 1:i+=g*(1+e.noise1d(h*a))/2;break;case 2:i+=g*(1+e.noise2d(h*a,h*b))/2;break;case 3:i+=g*(1+e.noise3d(h*a,h*b,h*c))/2}h*=2}return i},noiseDetail=
function(a,b){noiseProfile.octaves=a;void 0!==b&&(noiseProfile.fallout=b)},noiseSeed=function(a){noiseProfile.seed=a;noiseProfile.generator=void 0};Number.prototype.times=function(a,b){for(var c=this.valueOf(),e=0;e<c;e++)a.call(b||window,e)};var listOfPossibleFunctions="function,alert,rect,line,box,ball,ballDetail,peg,rotate,move,scale,pushMatrix,popMatrix,resetMatrix,bpm,play,fill,noFill,stroke,noStroke,strokeSize,animationStyle,background,simpleGradient,color,lights,noLights,ambientLight,pointLight,abs,ceil,constrain,dist,exp,floor,lerp,log,mag,map,max,min,norm,pow,round,sq,sqrt,acos,asin,atan,atan2,cos,degrees,radians,sin,tan,random,randomSeed,noise,noiseDetail,noiseSeed,".split(",");
function checkErrorAndReport(a){$("#dangerSignText").css("color","red");a=""+a;-1<a.indexOf("Unexpected 'INDENT'")?a="weird indentation":-1<a.indexOf("Unexpected 'TERMINATOR'")?a="line not complete":-1<a.indexOf("Unexpected 'CALL_END'")?a="line not complete":-1<a.indexOf("Unexpected '}'")?a="something wrong":-1<a.indexOf("Unexpected 'MATH'")?a="weird arithmetic there":-1<a.indexOf("Unexpected 'LOGIC'")?a="odd expression thingy":-1<a.indexOf("Unexpected 'NUMBER'")?a="lost number?":-1<a.indexOf("Unexpected 'NUMBER'")?
a="lost number?":-1<a.indexOf("ReferenceError")&&(a=a.replace(/ReferenceError:\s/gm,""));$("#errorMessageText").text(a)}
function registerCode(){try{var a=editor.getValue();""!==a&&!0===fakeText&&shrinkFakeText();""===a&&!fakeText&&(fakeText=resetTheSpinThingy=!0,window.location.hash="",$("#formCode").animate({opacity:0},"fast"),log("unshrinking"),$("#justForFakeCursor").show(),$("#toMove").show(),$("#caption").html("|"),$("#toMove").animate({opacity:1,margin:0,fontSize:350,left:0},"fast",function(){$("#caption").html("");$("#fakeStartingBlinkingCursor").html("|")}));var b,c=!1,e,g,a=a.replace(/^(\s)*\u2713[ ]*doOnce[ ]*\-\>[ ]*$/gm,
"$1if false");for(b=a=a.replace("\u2713","//");b.length;){e=b.charAt(0);g=b.charAt(1);if("'"===e||'"'===e||"/"===e&&("*"===g||"/"===g)){c=!0;break}b=b.slice(1)}c?(a=a.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')|(\/\/[^\n]*\n)|(\/\*(?:(?!\*\/)(?:.|\n))*\*\/)/g,function(a,b,c,d,e){if(b)return b;if(c)return c;if(d)return"\n";a=e.split("\n").length-1;b="";for(c=0;c<a;c++)b=b+"\n";return b}),b=a.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')/g,"")):b=a;for(var h=g=c=0,i=0,j=0;b.length;){e=
b.charAt(0);if("'"===e)c+=1;else if('"'===e)g+=1;else if("("===e||")"===e)h+=1;else if("{"===e||"}"===e)i+=1;else if("["===e||"]"===e)j+=1;b=b.slice(1)}if(c&1||g&1||h&1||i&1||j&1){if(autocodeOn){editor.undo();return}programHasBasicError=!0;$("#dangerSignText").css("color","red");c&1&&(reasonOfBasicError="Missing '");g&1&&(reasonOfBasicError='Missing "');h&1&&(reasonOfBasicError="Unbalanced ()");i&1&&(reasonOfBasicError="Unbalanced {}");j&1&&(reasonOfBasicError="Unbalanced []");$("#errorMessageText").text(reasonOfBasicError);
return}var f="\t"+a.replace(/\n/g,"\n\t"),f=("draw = ->\n"+f).replace(/(\d+)[ ]+bpm(\s)/g,"bpm $1$2"),f=f.replace(/([a-zA-Z]+)[ ]+fill(\s)/g,"fill $1$2"),f=f.replace(/([a-zA-Z]+)[ ]+stroke(\s)/g,"stroke $1$2"),f=f.replace(/([a-zA-Z]+)[ ]+background(\s)/g,"background $1$2"),f=f.replace(/(\d+)\s+times[ ]*\->/g,";( $1 + 0).times ->");if(-1<f.indexOf("doOnce")){for(var d=f.split("\n"),a=0;a<d.length;a++)d[a]=d[a].replace(/^(\s*)doOnce[ ]*\->[ ]*(.+)$/gm,"$1;doLNOnce.push("+(a-1)+"); (1+0).times -> $2"),
d[a].match(/^(\s*)doOnce[ ]*\->[ ]*$/gm)&&(d[a]=d[a].replace(/^(\s*)doOnce[ ]*\->[ ]*$/gm,"$1(1+0).times ->"),d[a+1]=d[a+1].replace(/^(\s*)(.+)$/gm,"$1;doLNOnce.push("+(a-1)+"); $2"));f=d.join("\n")}f=f.replace(/^(\s*)([a-z]+[a-zA-Z0-9]*)[ ]*$/gm,"$1;$2()");f=f.replace(/;\s*([a-z]+[a-zA-Z0-9]*)[ ]*([;\n]+)/g,";$1()$2");f=f.replace(/\->\s*([a-z]+[a-zA-Z0-9]*)[ ]*([;\n]+)/g,";$1()$2");if(f.match(/[\s\+\;]+draw\s*\(/)){if(autocodeOn){editor.undo();return}programHasBasicError=!0;$("#dangerSignText").css("color",
"red");$("#errorMessageText").text("You can't call draw()");return}f=f.replace(/;(if)\(\)/g,";$1");f=f.replace(/;(else)\(\)/g,";$1");f=f.replace(/;(for)\(\)/g,";$1");f=f.replace(/\/\//g,"#");f=f.replace(/([^a-zA-Z0-9])(scale)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(rotate)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(move)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(rect)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(line)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(bpm)(\s)+/g,"$1;$2$3");
f=f.replace(/([^a-zA-Z0-9])(play)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(pushMatrix)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(popMatrix)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(resetMatrix)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(fill)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(noFill)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(stroke)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(noStroke)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(strokeSize)(\s)+/g,"$1;$2$3");f=
f.replace(/([^a-zA-Z0-9])(animationStyle)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(simpleGradient)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(background)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(color)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(lights)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(noLights)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(ambientLight)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(pointLight)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(ball)(\s)+/g,
"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(ballDetail)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(peg)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(abs)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(ceil)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(constrain)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(dist)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(exp)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(floor)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(lerp)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(log)(\s)+/g,
"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(mag)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(map)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(max)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(min)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(norm)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(pow)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(round)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(sq)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(sqrt)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(acos)(\s)+/g,
"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(asin)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(atan)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(atan2)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(cos)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(degrees)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(radians)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(sin)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(tan)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(random)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(randomSeed)(\s)+/g,
"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(noise)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(noiseDetail)(\s)+/g,"$1;$2$3");f=f.replace(/([^a-zA-Z0-9])(noiseSeed)(\s)+/g,"$1;$2$3");f=f.replace(/->(\s+);/g,"->$1");f=f.replace(/(\sif\s*.*\s*);/g,"$1");f=f.replace(/(\s);(else\s*if\s*.*\s*);/g,"$1$2");f=f.replace(/(\s);(else.*\s*);/g,"$1$2");out=CoffeeScript.compile(f,{bare:"on"});log("in javascript: "+out)}catch(p){if(autocodeOn){editor.undo();return}checkErrorAndReport(p);return}d=/([a-z]+[a-zA-Z0-9]*) = function/;
f=[];for(a=out;a=a.match(d);)f.push(a[1]),a=RegExp.rightContext;d=[];for(a=out;a=a.match(/\s([a-z]+[a-zA-Z0-9]*)\(/);)d.push(a[1]),a=RegExp.rightContext;for(a=0;a<d.length;a++)if(-1==listOfPossibleFunctions.indexOf(d[a])){if(0===f.length){$("#dangerSignText").css("color","red");$("#errorMessageText").text(d[a]+" doesn't exist");return}for(b=0;b<f.length&&d[a]!==f[b];b++)if(b==f.length-1){$("#dangerSignText").css("color","red");$("#errorMessageText").text(d[a]+" doesn't exist");return}}programHasBasicError=
!1;reasonOfBasicError="";$("#dangerSignText").css("color","#000000");$("#errorMessageText").text(reasonOfBasicError);consecutiveFramesWithoutRunTimeError=0;out=out.replace(/var frame/,";");window.eval(out)}"use strict";
var roseDemo="// 'A rose' by Guy John\n// Mozilla Festival 2012\n// adapted from 'A rose' by Lib4tech\n\nscale 1.5\nanimationStyle paintOver\nrotate frame/100\nfill 255-((frame/2)%255),0,0\nstroke 255-((frame/2)%255),0,0\nscale 1-((frame/2)%255) / 255\nbox".replace(/\u25B6/g,"\t"),cheeseAndOlivesDemo="// 'Cheese and olives' by\n// Davina Tirvengadum\n// Mozilla festival 2012\n\nbackground white\nscale .3\nmove 0,-1\nfill yellow\nstroke black\nrotate\nstrokeSize 3\nline 4\nbox\n\nrotate 2,3\nmove 0,3\nscale .3\nfill black\nstroke black\nball\n\nrotate 3\nmove 5\nscale 1\nfill green\nstroke green\nball\n\nrotate 1\nmove -3\nscale 1\nfill yellow\nstroke yellow\nball".replace(/\u25B6/g,
"\t"),simpleCubeDemo="// there you go!\n// a simple cube!\n\nbackground yellow\nrotate 0,time/2000,time/2000\nbox".replace(/\u25B6/g,"\t"),webgltwocubesDemo="background 155,255,255\n2 times ->\n\u25b6rotate 0, 1, time/2000\n\u25b6box".replace(/\u25B6/g,"\t"),cubesAndSpikes="simpleGradient fuchsia,color(100,200,200),yellow\nscale 2.1\n5 times ->\n\u25b6rotate 0,1,time/5000\n\u25b6box 0.1,0.1,0.1\n\u25b6move 0,0.1,0.1\n\u25b63 times ->\n\u25b6\u25b6rotate 0,1,1\n\u25b6\u25b6box 0.01,0.01,1".replace(/\u25B6/g,
"\t"),webglturbineDemo="background 155,55,255\n70 times ->\n\u25b6rotate time/100000,1,time/100000\n\u25b6box".replace(/\u25B6/g,"\t"),webglzfightartDemo="// Explore the artifacts\n// of your GPU!\n// Go Z-fighting, go!\nscale 5\nrotate\nfill red\nbox\nrotate 0.000001\nfill yellow\nbox".replace(/\u25B6/g,"\t"),littleSpiralOfCubes="background orange\nscale 0.1\n10 times ->\n\u25b6rotate 0,1,time/1000\n\u25b6move 1,1,1\n\u25b6box".replace(/\u25B6/g,"\t"),tentacleDemo="background 155,255,155\nscale 0.15\n3 times ->\n\u25b6rotate 0,1,1\n\u25b610 times ->\n\u25b6\u25b6rotate 0,1,time/1000\n\u25b6\u25b6scale 0.9\n\u25b6\u25b6move 1,1,1\n\u25b6\u25b6box".replace(/\u25B6/g,
"\t"),lampDemo="animationStyle motionBlur\nsimpleGradient red,yellow,color(255,0,255)\n//animationStyle paintOver\nscale 2\nrotate time/4000, time/4000,  time/4000\n90 times ->\n\u25b6rotate time/200000, time/200000,  time/200000\n\u25b6line\n\u25b6move 0.5,0,0\n\u25b6line\n\u25b6move -0.5,0,0\n\u25b6line\n\u25b6line".replace(/\u25B6/g,"\t"),trillionfeathersDemo="animationStyle paintOver\nmove 2,0,0\nscale 2\nrotate\n20 times ->\n\u25b6rotate\n\u25b6move 0.25,0,0\n\u25b6line\n\u25b6move -0.5,0,0\n\u25b6line".replace(/\u25B6/g,
"\t"),monsterblobDemo="ballDetail 6\nanimationStyle motionBlur\nrotate time/5000\nsimpleGradient fuchsia,aqua,yellow\n5 times ->\n\u25b6rotate 0,1,time/5000\n\u25b6move 0.2,0,0\n\u25b63 times ->\n\u25b6\u25b6rotate 1\n\u25b6\u25b6ball -1".replace(/\u25B6/g,"\t"),industrialMusicDemo="bpm 88\nplay 'alienBeep'  ,'zzxz zzzz zzxz zzzz'\nplay 'beepC'  ,'zxzz zzzz xzzx xxxz'\nplay 'beepA'  ,'zzxz zzzz zzxz zzzz'\nplay 'lowFlash'  ,'zzxz zzzz zzzz zzzz'\nplay 'beepB'  ,'xzzx zzzz zxzz zxzz'\nplay 'voltage'  ,'xzxz zxzz xzxx xzxx'\nplay 'tranceKick'  ,'zxzx zzzx xzzz zzxx'".replace(/\u25B6/g,
"\t"),trySoundsDemo="bpm 88\n// leave this one as base\nplay 'tranceKick'  ,'zxzx zzzx xzzz zzxx'\n\n// uncomment the sounds you want to try\n//play 'toc'  ,'zzxz zzzz zzxz zzzz'\n//play 'highHatClosed'  ,'zzxz zzzz zzxz zzzz'\n//play 'highHatOpen'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc2'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc3'  ,'zzxz zzzz zzxz zzzz'\n//play 'toc4'  ,'zzxz zzzz zzxz zzzz'\n//play 'snare'  ,'zzxz zzzz zzxz zzzz'\n//play 'snare2'  ,'zzxz zzzz zzxz zzzz'\n//play 'china'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash2'  ,'zzxz zzzz zzxz zzzz'\n//play 'crash3'  ,'zzxz zzzz zzxz zzzz'\n//play 'ride'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass1'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass2'  ,'zzxz zzzz zzxz zzzz'\n//play 'glass3'  ,'zzxz zzzz zzxz zzzz'\n//play 'thump'  ,'zzxz zzzz zzxz zzzz'\n//play 'lowFlash'  ,'zzxz zzzz zzxz zzzz'\n//play 'lowFlash2'  ,'zzxz zzzz zzxz zzzz'\n//play 'tranceKick2'  ,'zzxz zzzz zzxz zzzz'\n//play 'tranceKick'  ,'zzxz zzzz zzxz zzzz'\n//play 'wosh'  ,'zzxz zzzz zzxz zzzz'\n//play 'voltage'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepA'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepB'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepC'  ,'zzxz zzzz zzxz zzzz'\n//play 'beepD'  ,'zzxz zzzz zzxz zzzz'\n//play 'beep'  ,'zzxz zzzz zzxz zzzz'\n//play 'hello'  ,'zzxz zzzz zzxz zzzz'\n//play 'alienBeep'  ,'zzxz zzzz zzxz zzzz'".replace(/\u25B6/g,
"\t"),springysquaresDemo="animationStyle motionBlur\nsimpleGradient fuchsia,color(100,200,200),yellow\nscale 0.3\n3 times ->\n\u25b6move 0,0,0.5\n\u25b65 times ->\n\u25b6\u25b6rotate time/2000\n\u25b6\u25b6move 0.7,0,0\n\u25b6\u25b6rect".replace(/\u25B6/g,"\t"),diceDemo="animationStyle motionBlur\nsimpleGradient color(255),moccasin,peachpuff\nstroke 255,100,100,255\nfill red,155\nmove -0.5,0,0\nscale 0.3\n3 times ->\n\u25b6move 0,0,0.5\n\u25b61 times ->\n\u25b6\u25b6rotate time/1000\n\u25b6\u25b6move 2,0,0\n\u25b6\u25b6box".replace(/\u25B6/g,
"\t"),webglalmostvoronoiDemo="scale 10\n2 times ->\n\u25b6rotate 0,1,time/10000\n\u25b6ball -1".replace(/\u25B6/g,"\t"),webglshardsDemo="scale 10\nfill 0\nstrokeSize 7\n5 times ->\n\u25b6rotate 0,1,time/20000\n\u25b6ball \n\u25b6rotate 0,1,1\n\u25b6ball -1.01".replace(/\u25B6/g,"\t"),webglredthreadsDemo="scale 10.5\nbackground black\nstroke red\nnoFill\nstrokeSize 7\n5 times ->\n\u25b6rotate time/20000\n\u25b6ball\n\u25b6rotate 0,1,1\n\u25b6ball".replace(/\u25B6/g,"\t"),webglnuclearOctopusDemo="simpleGradient black,color(0,0,(time/5)%255),black\nscale 0.2\nmove 5,0,0\nanimationStyle motionBlur\n//animationStyle paintOver\nstroke 255,0,0,120\nfill time%255,0,0\npushMatrix\ncount = 0\n3 times ->\n\u25b6count++\n\u25b6pushMatrix\n\u25b6rotate count+3+time/1000,2+count + time/1000,4+count\n\u25b6120 times ->\n\u25b6\u25b6scale 0.9\n\u25b6\u25b6move 1,1,0\n\u25b6\u25b6rotate time/100\n\u25b6\u25b6box\n\u25b6popMatrix".replace(/\u25B6/g,
"\t");introTutorial="// Les lignes qui commencent avec deux slashes\n// (comme celle-ci) sont des commentaires.\n// Tout le reste est lanc\u00e9\n// entre 30 et 60 fois par seconde\n// pour cr\u00e9er une animation\n// Cliquez sur le lien ci-dessous pour d\u00e9marrer le tutorial.\n// next-tutorial:hello_world".replace(/\u25B6/g,"\t");
helloworldTutorial="// Tapez ces cinq lettres\n// sur une des lignes vides\n// b, o, i, t, e\n\n\n// (vous devriez voir une belle boite appara\u00eetre)\n// cliquez pour le prochain tutorial :\n// next-tutorial:some_notes".replace(/\u25B6/g,"\t");
somenotesTutorial="// Au cas o\u00f9 cela vous dit quelque chose :\n// la syntaxe est similaire \u00e0 Coffeescript\n// et les commandes sont presque\n// comme Processing.\n// Si cela ne veut rien dire pour vous\n// pas de soucis.\n// next-tutorial:rotate".replace(/\u25B6/g,"\t");
rotateTutorial="// Maintenant nous avons une boite\n// faisons la tourner:\n// tapez 'tourne 1' sur la ligne\n// au dessus de 'boite'\n\nboite\n\n// cliquez pour le prochain tutorial :\n// next-tutorial:frame".replace(/\u25B6/g,"\t");
frameTutorial="// faites tourner la boite\n// en rempla\u00e7ant '1' par 'image'\ntourne 1\nboite\n\n// 'image' contient un nombre\n// qui s\u2019incr\u00e9mente au fur et \u00e0 mesure\n// que l\u2019\u00e9cran est re-dessin\u00e9.\n// (utilisez 'image/100' pour la ralentir)\n// next-tutorial:time".replace(/\u25B6/g,"\t");
timeTutorial="// 'image/100' a un probl\u00e8me :\n// les ordinateurs rapides vont faire\n// tourner le cube trop vite.\n// Remplacez le par 'temps/2000'.\ntourne image/100\nboite\n\n// 'temps' compte le nombre de millisecondes\n// depuis que le programme  a d\u00e9marr\u00e9,\n// il est donc ind\u00e9pendent de la vitesse\n// \u00e0 laquelle l\u2019ordinateur dessine les images.\n// next-tutorial:move".replace(/\u25B6/g,"\t");
moveTutorial="// vous pouvez d\u00e9placer n\u2019importe quel objet\n// en utilisant 'deplace'\nboite\ndeplace 1,1,0\nboite\n\n// essayez d\u2019utiliser tourne\n// avant la premi\u00e8re boite pour voir\n// comment la sc\u00e8ne change.\n// next-tutorial:scale".replace(/\u25B6/g,"\t");
scaleTutorial="// vous pouvez changer la taille des objets\n// en utilisant 'taille'\ntourne 3\nboite\ndeplace 1\ntaille 2\nboite\n\n// essayez d\u2019utiliser tourne\n// avant la premi\u00e8re boite pour voir\n// comment la sc\u00e8ne change..\n// next-tutorial:times".replace(/\u25B6/g,"\t");
timesTutorial="// 'fois' peut-\u00eatre utilis\u00e9\n// pour r\u00e9p\u00e9ter des op\u00e9rations :\ntourne 1\n3 fois ->\n\u25b6deplace 0.2,0.2,0.2\n\u25b6boite\n\n// notez comme les tabulations indiquent \n// exactement le bloc de code\n// qui doit \u00eatre r\u00e9p\u00e9t\u00e9.\n// next-tutorial:fill".replace(/\u25B6/g,"\t");
fillTutorial="// 'remplissage' d\u00e9fini la\n// couleur de toutes les faces :\nremplissage 255,255,0\nboite\n\n// les trois nombres indiquent\n// les valeurs de rouge, vert et bleu.\n// Vous pouvez aussi utiliser\n// des noms de couleur comme indigo\n// Essayez de remplacer les nombres avec\n// 'couleurAngle'\n// next-tutorial:stroke".replace(/\u25B6/g,"\t");
strokeTutorial="// 'trait' change la couleur\n// des arr\u00eates :\ntourne 1\ntailleTrait 5\ntrait 255,255,255\nboite\n\n// les trois nombres sont les valeurs RVB\n// mais vous pouvez utiliser les noms des couleurs,\n// ou la couleur sp\u00e9ciale  'couleurAngle'\n// Vous pouvez aussi utiliser 'tailleTrait'\n// pour pr\u00e9ciser l\u2019\u00e9paisseur.\n// next-tutorial:color_names".replace(/\u25B6/g,"\t");
colornamesTutorial="// vous pouvez indiquer les couleurs par nom\n// essayer de d\u00e9-commenter une ligne :\n//remplissage rouge\n//remplissage vert\n//remplissage p\u00eache\ntourne 1\nboite\n\n// plus de noms de couleurs ici :\n// http://html-color-codes.info/color-names/\n// (utilisez en minuscule, pas de majuscules)\n// next-tutorial:lights".replace(/\u25B6/g,"\t");
lightsTutorial="// 'eclairageAmbiant' cr\u00e9\u00e9 un\n// \u00e9clairage ambiant de sorte que les objets\n// ont une sorte de d\u2019ombrage:\neclairageAmbiant 0,255,255\ntourne temps/1000\nboite\n\n// vous pouvez \u00e9teindre ou allumer cet \u00e9clairage\n// pendant que vous construisez la sc\u00e8ne\n// en utilisant 'eclairage' et 'sansEclairage'\n// next-tutorial:background".replace(/\u25B6/g,"\t");
backgroundTutorial="// 'fond' cr\u00e9\u00e9 un\n// fond de couleur :\nfond 0,0,255\ntourne temps/1000\nboite\n\n// next-tutorial:gradient".replace(/\u25B6/g,"\t");gradientTutorial="// encore plus sympa, vous pouvez\n// cr\u00e9\u00e9r un fond en d\u00e9grad\u00e9:\ndegradeSimple couleur(190,10,10),couleur(30,90,100),couleur(0)\ntourne temps/1000\nboite\n\n// next-tutorial:line".replace(/\u25B6/g,"\t");
lineTutorial="// dessinez des lignes comme ceci :\n20 fois ->\n\u25b6tourne temps/9000\n\u25b6ligne\n\n// next-tutorial:ball".replace(/\u25B6/g,"\t");ballTutorial="// dessinez des balles comme ceci :\nballeDetail 10\n3 fois ->\n\u25b6deplace 0.2,0.2,0.2\n\u25b6balle\n\n// ('balleDetail' est optionnel)\n// next-tutorial:pushpopMatrix".replace(/\u25B6/g,"\t");
pushpopMatrixTutorial="// sauveMatrice m\u00e9morise\n// la position, et vous pouvez\n// y revenir plus tard avec restaureMatrice.\n// Vous pouvez revenir \u00e0 z\u00e9ro avec 'effaceMatrice'.\ntourne temps/1000\nsauveMatrice // m\u00e9morise la position apr\u00e8s la rotation\nligne\ndeplace 0.5,0,0\nligne\nrestaureMatrice // revient \u00e0 la position m\u00e9moris\u00e9e\ndeplace -0.5,0,0\nligne\neffaceMatrice // remets la position \u00e0 z\u00e9ro\nligne // cette ligne n\u2019est donc pas affect\u00e9 par la rotation\n// next-tutorial:animation_style".replace(/\u25B6/g,"\t");
animationstyleTutorial="// essayez de d\u00e9-commenter l\u2019une ou l\u2019autre\n// des deux lignes  avec styleAnimation\nfond 255\n//styleAnimation flouMouvement\n//styleAnimation peindreAudessus\ntourne image/10\nboite\n\n// next-tutorial:do_once".replace(/\u25B6/g,"\t");
doonceTutorial="// effacez l\u2019une ou l\u2019autre des coches\ntourne temps/1000\n\u2713uneFois ->\n\u25b6fond 255\n\u25b6remplissage 255,0,0\n\u2713uneFois -> balle\nboite\n\n// \u2026la ligne ou le bloc de code\n// n\u2019est ex\u00e9cut\u00e9 qu\u2019une seule fois, et apr\u00e8s cela\n// la coche r\u00e9apparait imm\u00e9diattement\n// P.S. continuez de supprimer la premi\u00e8re coche\n// en continu pour provoquer un \u00e9vanouissement :-)\n// next-tutorial:autocode".replace(/\u25B6/g,"\t");
autocodeTutorial="// le bouton Autocode invente pour vous\n// des variations al\u00e9atoires du code.\n// vous pouvez arr\u00eater Autocode\n// \u00e0 tout moment en r\u00e9-appuyant sur le bouton\n// ou vous pouvez faire CTRL-Z\n// (CMD-Z sur Mac) pour annuler (or r\u00e9tablir) certainesn\n// des \u00e9tapes y compris PENDANT que Autocode est actif\n// si par exemple vous trouvez que les choses\n// deviennent ennuyeuse dans la direction prise par Autocode.".replace(/\u25B6/g,"\t");
function loadDemoOrTutorial(a){if((!Detector.webgl||forceCanvasRenderer)&&!userWarnedAboutWebglExamples&&0===a.indexOf("webgl"))userWarnedAboutWebglExamples=!0,$("#exampleNeedsWebgl").modal(),$("#simplemodal-container").height(200);window.location.hash="bookmark="+a;fakeText&&shrinkFakeText();undimEditor();doTheSpinThingy=!1;var b="";if((!Detector.webgl||forceCanvasRenderer)&&0===a.indexOf("webgl"))b="// this drawing makes much more sense\n// in a WebGL-enabled browser".replace(/\u25B6/g,"\t");switch(a){case "roseDemo":editor.setValue(b+
roseDemo);break;case "cheeseAndOlivesDemo":editor.setValue(b+cheeseAndOlivesDemo);break;case "simpleCubeDemo":editor.setValue(b+simpleCubeDemo);break;case "webgltwocubesDemo":editor.setValue(b+webgltwocubesDemo);break;case "cubesAndSpikes":editor.setValue(b+cubesAndSpikes);break;case "webglturbineDemo":editor.setValue(b+webglturbineDemo);break;case "webglzfightartDemo":editor.setValue(b+webglzfightartDemo);break;case "littleSpiralOfCubes":editor.setValue(b+littleSpiralOfCubes);break;case "tentacleDemo":editor.setValue(b+
tentacleDemo);break;case "lampDemo":editor.setValue(b+lampDemo);break;case "trillionfeathersDemo":editor.setValue(b+trillionfeathersDemo);break;case "monsterblobDemo":editor.setValue(b+monsterblobDemo);break;case "industrialMusicDemo":editor.setValue(b+industrialMusicDemo);break;case "trySoundsDemo":editor.setValue(b+trySoundsDemo);break;case "springysquaresDemo":editor.setValue(b+springysquaresDemo);break;case "diceDemo":editor.setValue(b+diceDemo);break;case "webglalmostvoronoiDemo":editor.setValue(b+
webglalmostvoronoiDemo);break;case "webglshardsDemo":editor.setValue(b+webglshardsDemo);break;case "webglredthreadsDemo":editor.setValue(b+webglredthreadsDemo);break;case "webglnuclearOctopusDemo":editor.setValue(b+webglnuclearOctopusDemo);break;case "introTutorial":editor.setValue(b+introTutorial);break;case "helloworldTutorial":editor.setValue(b+helloworldTutorial);break;case "somenotesTutorial":editor.setValue(b+somenotesTutorial);break;case "rotateTutorial":editor.setValue(b+rotateTutorial);break;
case "frameTutorial":editor.setValue(b+frameTutorial);break;case "timeTutorial":editor.setValue(b+timeTutorial);break;case "moveTutorial":editor.setValue(b+moveTutorial);break;case "scaleTutorial":editor.setValue(b+scaleTutorial);break;case "timesTutorial":editor.setValue(b+timesTutorial);break;case "fillTutorial":editor.setValue(b+fillTutorial);break;case "strokeTutorial":editor.setValue(b+strokeTutorial);break;case "colornamesTutorial":editor.setValue(b+colornamesTutorial);break;case "lightsTutorial":editor.setValue(b+
lightsTutorial);break;case "backgroundTutorial":editor.setValue(b+backgroundTutorial);break;case "gradientTutorial":editor.setValue(b+gradientTutorial);break;case "lineTutorial":editor.setValue(b+lineTutorial);break;case "ballTutorial":editor.setValue(b+ballTutorial);break;case "pushpopMatrixTutorial":editor.setValue(b+pushpopMatrixTutorial);break;case "animationstyleTutorial":editor.setValue(b+animationstyleTutorial);break;case "doonceTutorial":editor.setValue(b+doonceTutorial);break;case "conditionalsTutorial":editor.setValue(b+
conditionalsTutorial);break;case "autocodeTutorial":editor.setValue(b+autocodeTutorial)}editor.setCursor(0,0);animationStyle(normal);animationStyleUpdateIfChanged();combDisplayList();render();registerCode()}var autocodeOn=!1,blinkingAutocoderTimeout,blinkingAutocoderStatus=!1,numberOfResults=0,whichOneToChange=0;
function blinkAutocodeIndicator(){(blinkingAutocoderStatus=!blinkingAutocoderStatus)?$("#autocodeIndicatorContainer").css("background-color",""):($("#autocodeIndicatorContainer").css("background-color","#FF0000"),mutate())}
function toggleAutocodeAndUpdateButtonAndBlinking(){(autocodeOn=!autocodeOn)?($("#autocodeIndicator").html("Autocode: on"),blinkingAutocoderTimeout=setInterval("blinkAutocodeIndicator();",500),$("#autocodeIndicatorContainer").css("background-color","#FF0000"),(""===editor.getValue()||-1!==window.location.hash.indexOf("bookmark")&&-1!==window.location.hash.indexOf("autocodeTutorial"))&&loadDemoOrTutorial("cubesAndSpikes")):($("#autocodeIndicator").html("Autocode: off"),clearInterval(blinkingAutocoderTimeout),
$("#autocodeIndicatorContainer").css("background-color",""))}function mutate(){var a=editor.getValue();Tokens=[];try{INIT.lex(a)}catch(b){console.log(b)}pickMutatableTokenAndMutateIt(Tokens);a=emit(Tokens);editor.setValue(a)}
var INIT=new McLexer.State,colours="aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgrey,darkgreen,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,grey,green,greenyellow,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgrey,lightgray,lightgreen,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen".split(","),Tokens=
[];function COMMENT(a){this.string=a;this.toString=function(){return"COMMENT("+a+")"}}function SPACE(a){this.string=a;this.toString=function(){return"SPACE("+a+")"}}function NEWLINE(a){this.string=a;this.toString=function(){return"<br/>"}}function TRANSLATION(a){this.string=a;this.toString=function(){return"TRANSLATION("+a+")"}}function VARIABLE(a){this.string=a;this.toString=function(){return"VARIABLE("+a+")"}}
function NUM(a){this.string=a;this.toString=function(){return"NUM("+a+")"};this.mutate=function(){var a=new Number(this.string);0==a&&(a=0.1);Math.random();Math.random();var c=a*Math.random(),a=(a+c).toFixed(2);console.log("mutate number "+this.string+" -> "+a.toString());this.string=a.toString()}}function OP(a){this.string=a;this.toString=function(){return"OP("+a+")"}}function ARGDLIM(a){this.string=a;this.toString=function(){return"ARGDLIM("+a+")"}}
function TAB(a){this.string=a;this.toString=function(){return"TAB("+a+")"}}function DOONCE(a){this.string=a;this.toString=function(){return"DOONCE("+a+")"}}function COLOUROP(a){this.string=a;this.toString=function(){return"COLOUROP("+a+")"}}
function COLOUR(a){this.string=a;this.toString=function(){return"COLOUR("+a+")"};this.mutate=function(){for(var a=Math.floor(Math.random()*colours.length);this.string==colours[a];)a=Math.floor(Math.random()*colours.length);console.log("mutate colour "+this.string+" -> "+colours[a]);this.string=colours[a]}}
function MESH(a){this.string=a;this.toString=function(){return"MESH("+a+")"};this.mutate=function(){switch(this.string){case "box":this.string="ball";break;case "ball":this.string="box";break;case "line":this.string="rect";break;case "rect":this.string="line"}}}function STATEFUN(a){this.string=a;this.toString=function(){return"STATEFUN("+a+")"}}
function ITERATION(a){this.string=a;this.toString=function(){return"ITERATION("+a+")"};this.mutate=function(){var a=/\d/.exec(this.string);console.log("ITER NUM: "+a);0.5<Math.random()?a++:a--;this.string=a.toString()+" times ->"}}function UNKNOWN(a){this.string=a;this.toString=function(){return"UNKNOWN("+a+")"}}INIT(/\/\/.*\n/)(function(a,b,c){Tokens.push(new COMMENT(a[0]));return c.continuation(b)});INIT(/\t/)(function(a,b,c){Tokens.push(new TAB(a[0]));return c.continuation(b)});
INIT(/-?[0-9]+\.?[0-9]*/)(function(a,b,c){Tokens.push(new NUM(a[0]));return c.continuation(b)});INIT(/[*|\/|+|-]/)(function(a,b,c){Tokens.push(new OP(a[0]));return c.continuation(b)});INIT(/,/)(function(a,b,c){Tokens.push(new ARGDLIM(a[0]));return c.continuation(b)});INIT(/[\n|\r]{1,2}/)(function(a,b,c){Tokens.push(new NEWLINE(a[0]));return c.continuation(b)});INIT(/rotate/)(function(a,b,c){Tokens.push(new TRANSLATION(a[0]));return c.continuation(b)});
INIT(/move/)(function(a,b,c){Tokens.push(new TRANSLATION(a[0]));return c.continuation(b)});INIT(/scale/)(function(a,b,c){Tokens.push(new TRANSLATION(a[0]));return c.continuation(b)});for(var scanningAllColors=0;scanningAllColors<colours.length;scanningAllColors++)INIT(RegExp(colours[scanningAllColors]))(function(a,b,c){Tokens.push(new COLOUR(a[0]));return c.continuation(b)});INIT(/background/)(function(a,b,c){Tokens.push(new COLOUROP(a[0]));return c.continuation(b)});
INIT(/fill/)(function(a,b,c){Tokens.push(new COLOUROP(a[0]));return c.continuation(b)});INIT(/stroke/)(function(a,b,c){Tokens.push(new COLOUROP(a[0]));return c.continuation(b)});INIT(/simpleGradient/)(function(a,b,c){Tokens.push(new COLOUROP(a[0]));return c.continuation(b)});INIT(/box/)(function(a,b,c){Tokens.push(new MESH(a[0]));return c.continuation(b)});INIT(/ball/)(function(a,b,c){Tokens.push(new MESH(a[0]));return c.continuation(b)});INIT(/rect/)(function(a,b,c){Tokens.push(new MESH(a[0]));return c.continuation(b)});
INIT(/line/)(function(a,b,c){Tokens.push(new MESH(a[0]));return c.continuation(b)});INIT(/ballDetail/)(function(a,b,c){Tokens.push(new STATEFUN(a[0]));return c.continuation(b)});INIT(/animationStyle\s\w+/)(function(a,b,c){Tokens.push(new STATEFUN(a[0]));return c.continuation(b)});INIT(/\d+\s+times\s+->/)(function(a,b,c){Tokens.push(new ITERATION(a[0]));return c.continuation(b)});INIT(/time/)(function(a,b,c){Tokens.push(new VARIABLE(a[0]));return c.continuation(b)});
INIT(/delay/)(function(a,b,c){Tokens.push(new VARIABLE(a[0]));return c.continuation(b)});INIT(/\?doOnce\s+->\s*/)(function(a,b,c){Tokens.push(new DOONCE(a[0]));return c.continuation(b)});INIT(/ +/)(function(a,b,c){Tokens.push(new SPACE(a[0]));return c.continuation(b)});INIT(/color\s*\(.+\)/)(function(a,b,c){Tokens.push(new UNKNOWN(a[0]));return c.continuation(b)});INIT(/noFill/)(function(a,b,c){Tokens.push(new UNKNOWN(a[0]));return c.continuation(b)});
INIT(/strokeSize/)(function(a,b,c){Tokens.push(new UNKNOWN(a[0]));return c.continuation(b)});function emit(a){for(var b="",c=0;c<a.length;c++)b+=a[c].string;return b}function canMutate(a){return"function"==typeof a.mutate?!0:!1}function pickMutatableTokenAndMutateIt(a){for(var b=[],c=0;c<a.length;c++)canMutate(a[c])&&b.push(c);0==b.length?console.log("no possible mutations"):(console.log(b),c=Math.floor(Math.random()*b.length),a[b[c]].mutate())}
function replaceTimeWithAConstant(){var a=editor.getValue(),b;b=/(time)/gi;var c=a.match(b);numberOfResults=null===c?0:c.length;whichOneToChange=Math.floor(Math.random()*numberOfResults)+1;var e=0,a=a.replace(b,function(a){e++;return e===whichOneToChange?""+Math.floor(20*Math.random())+1:a});editor.setValue(a)}
function suspendDimmingAndCheckIfLink(){var a=editor.getCursor(!0);2<a.ch&&(a=editor.getLine(a.line),0===a.indexOf("// next-tutorial:")&&(a=a.substring(17),a=a.replace("_",""),setTimeout('loadDemoOrTutorial("'+a+'Tutorial");',200)));fakeText||""===editor.getValue()||(log("cursor activity! opacity: "+$("#formCode").css("opacity")),cursorActivity=!0,undimEditor())}
function undimEditor(){(fakeText||""===editor.getValue())&&$("#formCode").css("opacity",0);0.99>$("#formCode").css("opacity")&&(log("undimming the editor"),$("#formCode").animate({opacity:1},"fast"))}function dimEditor(){0<$("#formCode").css("opacity")&&(log("starting fadeout animation"),$("#formCode").animate({opacity:0},"slow"))}
function dimIfNoCursorActivity(){fakeText||""===editor.getValue()||(cursorActivity?(log("marking cursor activity = false. Will check again in the next interval"),cursorActivity=!1):(log("no activity in the last interval. Dimming now, starting opacity is: "+$("#formCode").css("opacity")),dimEditor()))}
function toggleDimCode(){(dimcodeOn=!dimcodeOn)?(dimIntervalID=setInterval("dimIfNoCursorActivity()",5E3),$("#dimCodeIndicator").html("Hide Code: on")):(clearInterval(dimIntervalID),undimEditor(),$("#dimCodeIndicator").html("Hide Code: off"))}
var ambientColor=color(255,255,255),reflectValue=1,refractValue=0.98,lightsAreOn=!1,lights=function(){lightsAreOn=!0},noLights=function(){lightsAreOn=!1},ambientLight=function(a,b,c,e){a=void 0===a?color$1(125):color(a,b,c,e);b=!1;lightsAreOn=!0;defaultNormalStroke=defaultNormalFill=!1;c=ambientLightsPool[usedAmbientLights];void 0===c?(log("no ambientLight in pool, creating one"),c=new THREE.AmbientLight(a),b=!0,ambientLightsPool.push(c)):(c.color.setHex(a),log("existing ambientLight in pool, setting color: "+
c.color.r+" "+c.color.g+" "+c.color.b));c.isLine=!1;c.isRectangle=!1;c.isBox=!1;c.isCylinder=!1;c.isAmbientLight=!0;c.isPointLight=!1;c.isSphere=0;usedAmbientLights++;c.matrixAutoUpdate=!1;c.matrix.copy(worldMatrix);c.matrixWorldNeedsUpdate=!0;b&&scene.add(c)},animationStyle=function(a){!1===a||void 0===a||(animationStyleValue=a)},animationStyleUpdateIfChanged=function(){animationStyleValue!==previousanimationStyleValue&&(previousanimationStyleValue=animationStyleValue,isWebGLUsed&&animationStyleValue===
motionBlur?effectBlend.uniforms.mixRatio.value=0.7:!isWebGLUsed&&animationStyleValue===motionBlur&&(blendAmount=0.6),isWebGLUsed&&animationStyleValue===paintOver?effectBlend.uniforms.mixRatio.value=1:!isWebGLUsed&&animationStyleValue===paintOver&&(blendAmount=1),isWebGLUsed&&animationStyleValue===normal?effectBlend.uniforms.mixRatio.value=0:!isWebGLUsed&&animationStyleValue===normal&&(blendAmount=0))},initThreeJs=function(){scaledBackgroundWidth=Math.floor(window.innerWidth/backGroundFraction);scaledBackgroundHeight=
Math.floor(window.innerHeight/backGroundFraction);!forceCanvasRenderer&&Detector.webgl&&!forceCanvasRenderer?(ballDefaultDetLevel=16,sceneRenderingCanvas=document.createElement("canvas"),renderer=new THREE.WebGLRenderer({canvas:sceneRenderingCanvas,preserveDrawingBuffer:!1,antialias:!1,premultipliedAlpha:!1}),isWebGLUsed=!0,navigator.userAgent.toLowerCase().indexOf("chrome"),renderer.setSize(window.innerWidth,window.innerHeight),document.getElementById("container").appendChild(sceneRenderingCanvas)):
(ballDefaultDetLevel=6,sceneRenderingCanvas=document.createElement("canvas"),sceneRenderingCanvasContext=sceneRenderingCanvas.getContext("2d"),renderer=new THREE.CanvasRenderer({canvas:sceneRenderingCanvas,antialias:!0,preserveDrawingBuffer:!1}),previousRenderForBlending=document.createElement("canvas"),previousRenderForBlending.width=window.innerWidth,previousRenderForBlending.height=window.innerHeight,previousRenderForBlendingContext=previousRenderForBlending.getContext("2d"),finalRenderWithSceneAndBlend=
document.getElementById("finalRenderWithSceneAndBlendCanvas"),finalRenderWithSceneAndBlend.width=window.innerWidth,finalRenderWithSceneAndBlend.height=window.innerWidth,finalRenderWithSceneAndBlendContext=finalRenderWithSceneAndBlend.getContext("2d"),renderer.setSize(window.innerWidth,window.innerHeight));backgroundScene=document.getElementById("backGroundCanvas");backgroundScene.width=scaledBackgroundWidth;backgroundScene.height=scaledBackgroundHeight;backgroundSceneContext=backgroundScene.getContext("2d");
stats=new Stats;stats.getDomElement().style.position="absolute";stats.getDomElement().style.right="0px";stats.getDomElement().style.top="0px";document.body.appendChild(stats.getDomElement());scene=new THREE.Scene;scene.matrixAutoUpdate=!1;camera=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,1E4);camera.position.set(0,0,5);scene.add(camera);var a=new THREE.PointLight(16777215);a.position.x=10;a.position.y=50;a.position.z=130;scene.add(a);THREEx.WindowResize.bind(renderer,camera);
isWebGLUsed&&buildPostprocessingChain()},effectBlend,buildPostprocessingChain=function(){var a={format:THREE.RGBAFormat,stencilBuffer:!0},b=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,a),a=new THREE.SavePass(new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,a));a.clear=!1;(new THREE.ShaderPass(THREE.ShaderExtras.fxaa)).uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight);effectBlend=new THREE.ShaderPass(THREE.ShaderExtras.blend,"tDiffuse1");var c=
new THREE.ShaderPass(THREE.ShaderExtras.screen);effectBlend.uniforms.tDiffuse2.texture=a.renderTarget;effectBlend.uniforms.mixRatio.value=0;var e=new THREE.RenderPass(scene,camera);composer=new THREE.EffectComposer(renderer,b);composer.addPass(e);composer.addPass(effectBlend);composer.addPass(a);composer.addPass(c);c.renderToScreen=!0},wheel=function(a){var b=a||window.event;[].slice.call(arguments,1);var c=0,e=0,a=$.event.fix(b);a.type="mousewheel";b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=
-b.detail/3);e=c;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(e=0);void 0!==b.wheelDeltaY&&(e=b.wheelDeltaY/120);0.2<e?(b=editor.getCursor(!0),b.line!==editor.lineCount()-1&&editor.setCursor(b.line+1,b.ch)):-0.2>e&&(b=editor.getCursor(!0),editor.setCursor(b.line-1,b.ch))};(function(){window.addEventListener&&(window.addEventListener("DOMMouseScroll",wheel,!1),window.onmousewheel=document.onmousewheel=wheel)})();var lastkey=0,fakeText=!0;
document.onkeypress=function(a){fakeText&&""!==editor.getValue()&&shrinkFakeText(a)};
var shrinkFakeText=function(a){void 0!==a?(a=a||window.event,a=a.keyCode||a.which,a=String.fromCharCode(a)):a="";var b=$("#caption").html(),b=b.substring(0,b.length-1);$("#caption").html(b+a+"|");$("#fakeStartingBlinkingCursor").html("");$("#toMove").animate({opacity:0,margin:-100,fontSize:300,left:0},"fast");setTimeout('$("#formCode").animate({opacity: 1}, "fast");',120);setTimeout('$("#justForFakeCursor").hide();',200);setTimeout('$("#toMove").hide();',200);fakeText=!1},fakeCursorInterval;
function fakeCursorBlinking(){$("#fakeStartingBlinkingCursor").animate({opacity:0.2},"fast","swing").animate({opacity:1},"fast","swing")}
$(document).ready(function(){$("#aboutMenu").click(function(){$("#aboutWindow").modal();$("#simplemodal-container").height(250);return!1});$("#demos li a").click(function(){loadDemoOrTutorial($(this).attr("id"));return!1});$("#tutorials li a").click(function(){loadDemoOrTutorial($(this).attr("id"));return!1});$("#autocodeIndicatorContainer").click(function(){toggleAutocodeAndUpdateButtonAndBlinking();return!1});$("#dimCodeButtonContainer").click(function(){toggleDimCode();return!1});$("#resetButtonContainer").click(function(){triggerReset();
return!1})});
